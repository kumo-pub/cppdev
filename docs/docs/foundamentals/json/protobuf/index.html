<!doctype html>
<html lang="en-GB" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-foundamentals/json/protobuf" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Protobuf-JSON conversion | Kumo Search</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/cppdev/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/cppdev/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/cppdev/docs/foundamentals/json/protobuf"><meta data-rh="true" property="og:locale" content="en_GB"><meta data-rh="true" property="og:locale:alternate" content="zh_cn"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Protobuf-JSON conversion | Kumo Search"><meta data-rh="true" name="description" content="Based on the jsontopb.h and pbtojson.h headers, this document details the bidirectional conversion functionality between Protobuf (PB) and JSON in Merak, including usage methods, advanced configurations, and precautions—maintaining the same structure and style as Merak&#x27;s official documentation."><meta data-rh="true" property="og:description" content="Based on the jsontopb.h and pbtojson.h headers, this document details the bidirectional conversion functionality between Protobuf (PB) and JSON in Merak, including usage methods, advanced configurations, and precautions—maintaining the same structure and style as Merak&#x27;s official documentation."><link data-rh="true" rel="icon" href="/cppdev/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/cppdev/docs/foundamentals/json/protobuf"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/cppdev/docs/foundamentals/json/protobuf" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/cppdev/zh-cn/docs/foundamentals/json/protobuf" hreflang="zh-cn"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/cppdev/docs/foundamentals/json/protobuf" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Foundamentals","item":"https://your-docusaurus-site.example.com/cppdev/docs/category/foundamentals"},{"@type":"ListItem","position":2,"name":"json","item":"https://your-docusaurus-site.example.com/cppdev/docs/foundamentals/json/"},{"@type":"ListItem","position":3,"name":"Protobuf-JSON conversion","item":"https://your-docusaurus-site.example.com/cppdev/docs/foundamentals/json/protobuf"}]}</script><link rel="alternate" type="application/rss+xml" href="/cppdev/blog/rss.xml" title="Kumo Search RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/cppdev/blog/atom.xml" title="Kumo Search Atom Feed"><link rel="stylesheet" href="/cppdev/assets/css/styles.582e0043.css">
<script src="/cppdev/assets/js/runtime~main.00bfb38e.js" defer="defer"></script>
<script src="/cppdev/assets/js/main.5784ddfa.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/cppdev/img/kumo-logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cppdev/"><div class="navbar__logo"><img src="/cppdev/img/kumo-logo.svg" alt="kumo Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/cppdev/img/kumo-logo.svg" alt="kumo Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Development</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cppdev/docs/intro">Tutorial</a><a class="navbar__item navbar__link" href="/cppdev/docs/integration/overview">Integration</a><a class="navbar__item navbar__link" href="/cppdev/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/kumose" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/cppdev/docs/foundamentals/json/protobuf" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en-GB">English</a></li><li><a href="/cppdev/zh-cn/docs/foundamentals/json/protobuf" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh-cn">中文（中国）</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cppdev/docs/intro"><span title="Overview" class="linkLabel_WmDU">Overview</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/cppdev/docs/category/foundamentals"><span title="Foundamentals" class="categoryLinkLabel_W154">Foundamentals</span></a><button aria-label="Collapse sidebar category &#x27;Foundamentals&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/docs/foundamentals/testing/"><span title="Performance Testing and Unit Testing" class="categoryLinkLabel_W154">Performance Testing and Unit Testing</span></a><button aria-label="Expand sidebar category &#x27;Performance Testing and Unit Testing&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/docs/foundamentals/log/"><span title="Log Section" class="categoryLinkLabel_W154">Log Section</span></a><button aria-label="Expand sidebar category &#x27;Log Section&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/docs/foundamentals/time"><span title="Time and Calendar" class="linkLabel_WmDU">Time and Calendar</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/docs/category/standardized-errors-and-error-return-values"><span title="Standardized Errors and Error Return Values" class="categoryLinkLabel_W154">Standardized Errors and Error Return Values</span></a><button aria-label="Expand sidebar category &#x27;Standardized Errors and Error Return Values&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/docs/foundamentals/strings/"><span title="strings operations" class="categoryLinkLabel_W154">strings operations</span></a><button aria-label="Expand sidebar category &#x27;strings operations&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/docs/foundamentals/flags"><span title="Turbo Command-Line Flags (Turbo Flags)" class="linkLabel_WmDU">Turbo Command-Line Flags (Turbo Flags)</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/docs/foundamentals/codec/"><span title="Codec" class="categoryLinkLabel_W154">Codec</span></a><button aria-label="Expand sidebar category &#x27;Codec&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/docs/foundamentals/format/"><span title="Format &amp; Output (String Formatting and Output)" class="linkLabel_WmDU">Format &amp; Output (String Formatting and Output)</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/docs/foundamentals/map/"><span title="Map Containers" class="categoryLinkLabel_W154">Map Containers</span></a><button aria-label="Expand sidebar category &#x27;Map Containers&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/docs/foundamentals/compress/"><span title="Compression" class="categoryLinkLabel_W154">Compression</span></a><button aria-label="Expand sidebar category &#x27;Compression&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/docs/foundamentals/fibers/"><span title="Fiber And Future" class="categoryLinkLabel_W154">Fiber And Future</span></a><button aria-label="Expand sidebar category &#x27;Fiber And Future&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/docs/foundamentals/monitor/"><span title="monitor" class="categoryLinkLabel_W154">monitor</span></a><button aria-label="Expand sidebar category &#x27;monitor&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/docs/foundamentals/filesystem/"><span title="filesystem" class="categoryLinkLabel_W154">filesystem</span></a><button aria-label="Expand sidebar category &#x27;filesystem&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/cppdev/docs/foundamentals/json/"><span title="json" class="categoryLinkLabel_W154">json</span></a><button aria-label="Collapse sidebar category &#x27;json&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/docs/foundamentals/json/overview"><span title="merak json" class="linkLabel_WmDU">merak json</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/docs/foundamentals/json/features"><span title="Features" class="linkLabel_WmDU">Features</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/docs/foundamentals/json/tutorial"><span title="Tutorial" class="linkLabel_WmDU">Tutorial</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/docs/foundamentals/json/pointer"><span title="Pointer" class="linkLabel_WmDU">Pointer</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/docs/foundamentals/json/stream"><span title="Streams" class="linkLabel_WmDU">Streams</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/docs/foundamentals/json/encoding"><span title="Encoding" class="linkLabel_WmDU">Encoding</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/docs/foundamentals/json/dom"><span title="DOM" class="linkLabel_WmDU">DOM</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/docs/foundamentals/json/sax"><span title="SAX" class="linkLabel_WmDU">SAX</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/docs/foundamentals/json/schema"><span title="Schema（模式）" class="linkLabel_WmDU">Schema（模式）</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/docs/foundamentals/json/internals"><span title="Architecture" class="linkLabel_WmDU">Architecture</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/docs/foundamentals/json/performance"><span title="Performance" class="linkLabel_WmDU">Performance</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cppdev/docs/foundamentals/json/protobuf"><span title="Protobuf-JSON conversion" class="linkLabel_WmDU">Protobuf-JSON conversion</span></a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cppdev/docs/rpc/"><span title="rpc" class="categoryLinkLabel_W154">rpc</span></a><button aria-label="Expand sidebar category &#x27;rpc&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cppdev/docs/retrieve/"><span title="Retrieve" class="categoryLinkLabel_W154">Retrieve</span></a><button aria-label="Expand sidebar category &#x27;Retrieve&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cppdev/docs/store/"><span title="store" class="categoryLinkLabel_W154">store</span></a><button aria-label="Expand sidebar category &#x27;store&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cppdev/docs/ir/"><span title="IR" class="categoryLinkLabel_W154">IR</span></a><button aria-label="Expand sidebar category &#x27;IR&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cppdev/docs/advance/"><span title="advance" class="categoryLinkLabel_W154">advance</span></a><button aria-label="Expand sidebar category &#x27;advance&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/cppdev/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/cppdev/docs/category/foundamentals"><span>Foundamentals</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/cppdev/docs/foundamentals/json/"><span>json</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Protobuf-JSON conversion</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Protobuf-JSON conversion</h1></header>
<p>Based on the <code>json_to_pb.h</code> and <code>pb_to_json.h</code> headers, this document details the bidirectional conversion functionality between Protobuf (PB) and JSON in Merak, including usage methods, advanced configurations, and precautions—maintaining the same structure and style as Merak&#x27;s official documentation.</p>
<p>[TOC]</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="overview">Overview<a href="#overview" class="hash-link" aria-label="Direct link to Overview" title="Direct link to Overview" translate="no">​</a></h2>
<p><code>json_to_pb.h</code> and <code>pb_to_json.h</code> provide efficient conversion capabilities between Protobuf messages and Merak JSON DOM (<code>Document</code>/<code>Value</code>) or JSON strings. They support core Protobuf features (nested messages, repeated fields, enums, oneofs, map fields, etc.) and are compatible with Merak&#x27;s high-performance design philosophy.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="core-features">Core Features<a href="#core-features" class="hash-link" aria-label="Direct link to Core Features" title="Direct link to Core Features" translate="no">​</a></h3>
<ul>
<li class=""><strong>Full Type Mapping</strong>: Accurate mapping between all Protobuf basic types (<code>int32</code>/<code>int64</code>/<code>uint32</code>/<code>uint64</code>/<code>double</code>/<code>float</code>/<code>bool</code>/<code>string</code>/<code>bytes</code>) and JSON types.</li>
<li class=""><strong>Protobuf Feature Support</strong>: Seamlessly handles nested messages, repeated fields (<code>repeated</code>), enums, oneofs, map fields (<code>map&lt;&gt;</code>), required fields, and optional fields.</li>
<li class=""><strong>Flexible Configuration</strong>: Offers conversion options (e.g., ignore unknown fields, control default value output, enum conversion modes).</li>
<li class=""><strong>Error Handling</strong>: Returns clear conversion status and supports detailed error information (e.g., field mismatch, type error, missing required fields).</li>
<li class=""><strong>High Performance</strong>: Reuses Merak DOM&#x27;s memory-optimized design for low-overhead conversion, suitable for large-scale data scenarios.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="dependencies">Dependencies<a href="#dependencies" class="hash-link" aria-label="Direct link to Dependencies" title="Direct link to Dependencies" translate="no">​</a></h3>
<ul>
<li class="">Depends on Merak core libraries (<code>document.h</code>/<code>value.h</code>/<code>stringbuffer.h</code>, etc.).</li>
<li class="">Depends on Protobuf library (version 3.0+ recommended); requires linking against Protobuf compiled artifacts (<code>libprotobuf</code>).</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-json-to-protobuf-json_to_pbh">1. JSON to Protobuf (<code>json_to_pb.h</code>)<a href="#1-json-to-protobuf-json_to_pbh" class="hash-link" aria-label="Direct link to 1-json-to-protobuf-json_to_pbh" title="Direct link to 1-json-to-protobuf-json_to_pbh" translate="no">​</a></h2>
<p><code>json_to_pb.h</code> provides interfaces to convert from Merak JSON DOM or JSON strings to Protobuf messages, core functionality being mapping JSON structures and values to corresponding fields in Protobuf messages.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="11-basic-usage">1.1 Basic Usage<a href="#11-basic-usage" class="hash-link" aria-label="Direct link to 1.1 Basic Usage" title="Direct link to 1.1 Basic Usage" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-1-define-protobuf-message">Step 1: Define Protobuf Message<a href="#step-1-define-protobuf-message" class="hash-link" aria-label="Direct link to Step 1: Define Protobuf Message" title="Direct link to Step 1: Define Protobuf Message" translate="no">​</a></h4>
<p>First, write a <code>.proto</code> file (example: <code>user.proto</code>) to define the target Protobuf message structure:</p>
<div class="language-proto codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-proto codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">syntax = &quot;proto3&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package example;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Nested message: Address information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message Address {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string street = 1;    // Street</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string city = 2;      // City</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint32 zip_code = 3;  // Zip code (optional)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Enum: User status</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">enum UserStatus {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  STATUS_UNKNOWN = 0;  // Default enum value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  STATUS_ACTIVE = 1;   // Active</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  STATUS_INACTIVE = 2; // Inactive</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Core message: User information</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message User {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string id = 1;                  // User ID (required)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string name = 2;                // User name (required)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  uint32 age = 3;                 // Age (optional)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  bool is_vip = 4;                // Whether VIP (default: false)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated string tags = 5;        // Tags (repeated field)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated Address addresses = 6;  // Address list (nested repeated message)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  UserStatus status = 7;           // User status (enum)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  map&lt;string, string&gt; ext_info = 8;// Extended information (map field)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Oneof field: Contact method (mutually exclusive)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  oneof contact {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string phone = 9;  // Phone number</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string email = 10; // Email address</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Compile the <code>.proto</code> file to generate C++ headers and source files (requires Protobuf compiler <code>protoc</code>):</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">protoc --cpp_out=./ user.proto</span><br></span></code></pre></div></div>
<p>This generates <code>user.pb.h</code> and <code>user.pb.cc</code>—include these in your project and link against the compiled artifacts.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="step-2-convert-json-to-protobuf-message">Step 2: Convert JSON to Protobuf Message<a href="#step-2-convert-json-to-protobuf-message" class="hash-link" aria-label="Direct link to Step 2: Convert JSON to Protobuf Message" title="Direct link to Step 2: Convert JSON to Protobuf Message" translate="no">​</a></h4>
<p>Use the <code>JsonToPb</code> series of interfaces for conversion, supporting input from either JSON strings or Merak DOM:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;merak/proto/json_to_pb.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;merak/json/document.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;user.pb.h&quot;</span><span class="token macro property" style="color:#36acaa">  </span><span class="token macro property comment" style="color:#999988;font-style:italic">// Compiled Protobuf header</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;iostream&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">namespace</span><span class="token plain"> merak</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">namespace</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 1. JSON string to convert</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> json_str </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token raw-string string" style="color:#e3116c">R&quot;(</span><br></span><span class="token-line" style="color:#393A34"><span class="token raw-string string" style="color:#e3116c">  {</span><br></span><span class="token-line" style="color:#393A34"><span class="token raw-string string" style="color:#e3116c">    &quot;id&quot;: &quot;user_123&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token raw-string string" style="color:#e3116c">    &quot;name&quot;: &quot;Alice&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token raw-string string" style="color:#e3116c">    &quot;age&quot;: 28,</span><br></span><span class="token-line" style="color:#393A34"><span class="token raw-string string" style="color:#e3116c">    &quot;is_vip&quot;: true,</span><br></span><span class="token-line" style="color:#393A34"><span class="token raw-string string" style="color:#e3116c">    &quot;tags&quot;: [&quot;student&quot;, &quot;tech&quot;],</span><br></span><span class="token-line" style="color:#393A34"><span class="token raw-string string" style="color:#e3116c">    &quot;addresses&quot;: [</span><br></span><span class="token-line" style="color:#393A34"><span class="token raw-string string" style="color:#e3116c">      {</span><br></span><span class="token-line" style="color:#393A34"><span class="token raw-string string" style="color:#e3116c">        &quot;street&quot;: &quot;123 Main St&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token raw-string string" style="color:#e3116c">        &quot;city&quot;: &quot;New York&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token raw-string string" style="color:#e3116c">        &quot;zip_code&quot;: 10001</span><br></span><span class="token-line" style="color:#393A34"><span class="token raw-string string" style="color:#e3116c">      }</span><br></span><span class="token-line" style="color:#393A34"><span class="token raw-string string" style="color:#e3116c">    ],</span><br></span><span class="token-line" style="color:#393A34"><span class="token raw-string string" style="color:#e3116c">    &quot;status&quot;: &quot;STATUS_ACTIVE&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token raw-string string" style="color:#e3116c">    &quot;ext_info&quot;: {</span><br></span><span class="token-line" style="color:#393A34"><span class="token raw-string string" style="color:#e3116c">      &quot;school&quot;: &quot;NYU&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token raw-string string" style="color:#e3116c">      &quot;major&quot;: &quot;CS&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token raw-string string" style="color:#e3116c">    },</span><br></span><span class="token-line" style="color:#393A34"><span class="token raw-string string" style="color:#e3116c">    &quot;email&quot;: &quot;alice@example.com&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token raw-string string" style="color:#e3116c">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token raw-string string" style="color:#e3116c">  )&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 2. Parse JSON string to Merak DOM (optional; direct string conversion is simpler)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Document json_doc</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">json_doc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Parse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">json_str</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">HasParseError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">cerr </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;JSON parse error: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetParseError_En</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">json_doc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetParseErrorCode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 3. Initialize Protobuf message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  User user_pb</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 4. Configure conversion options (omit for default)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  merak</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">proto</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">JsonToPbOptions options</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ignore_unknown_fields </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Ignore fields in JSON not defined in Protobuf</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">strict_required_fields </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Strictly check required fields (default: true)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">enum_parse_mode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> merak</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">proto</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">EnumParseMode</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kEnumParseName</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Parse enums by name (default)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 5. Perform conversion (two input modes: DOM or JSON string)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Mode 1: Convert from Merak DOM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> success </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> merak</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">proto</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">JsonToPb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">json_doc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">user_pb</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Mode 2: Convert directly from JSON string (internal DOM parsing)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// bool success = merak::proto::JsonToPb(json_str, &amp;user_pb, options);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">success</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">cerr </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;JSON to Protobuf failed: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> merak</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">proto</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">GetJsonToPbError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 6. Verify conversion result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">cout </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Conversion successful. User ID: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> user_pb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">id</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">cout </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;User status: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> user_pb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">status</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">cout </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Email: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> user_pb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">email</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="12-core-configuration-jsontopboptions">1.2 Core Configuration: <code>JsonToPbOptions</code><a href="#12-core-configuration-jsontopboptions" class="hash-link" aria-label="Direct link to 12-core-configuration-jsontopboptions" title="Direct link to 12-core-configuration-jsontopboptions" translate="no">​</a></h3>
<p>The configuration struct controls JSON-to-PB behavior. Field descriptions:</p>
<table><thead><tr><th>Field Name</th><th>Type</th><th>Default Value</th><th>Description</th></tr></thead><tbody><tr><td><code>ignore_unknown_fields</code></td><td><code>bool</code></td><td><code>false</code></td><td>Whether to ignore fields in JSON not defined in Protobuf (true: ignore; false: fail conversion)</td></tr><tr><td><code>strict_required_fields</code></td><td><code>bool</code></td><td><code>true</code></td><td>Whether to strictly check Protobuf <code>required</code> fields (true: fail if missing; false: allow missing)</td></tr><tr><td><code>enum_parse_mode</code></td><td><code>EnumParseMode</code> (enum)</td><td><code>kEnumParseName</code></td><td>Enum parsing mode:<br>- <code>kEnumParseName</code>: Parse by enum name (e.g., &quot;STATUS_ACTIVE&quot;)<br>- <code>kEnumParseNumber</code>: Parse by enum number (e.g., 1)</td></tr><tr><td><code>allow_hex_numbers</code></td><td><code>bool</code></td><td><code>false</code></td><td>Whether to allow hexadecimal numbers in JSON (true: support <code>0x123</code>; false: decimal only)</td></tr><tr><td><code>bytes_parse_mode</code></td><td><code>BytesParseMode</code> (enum)</td><td><code>kBytesParseBase64</code></td><td>Parsing mode for Protobuf <code>bytes</code> fields:<br>- <code>kBytesParseBase64</code>: Decode JSON string as Base64<br>- <code>kBytesParseRaw</code>: Treat JSON string as raw bytes</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="13-field-mapping-rules">1.3 Field Mapping Rules<a href="#13-field-mapping-rules" class="hash-link" aria-label="Direct link to 1.3 Field Mapping Rules" title="Direct link to 1.3 Field Mapping Rules" translate="no">​</a></h3>
<p>Type mapping between JSON and Protobuf follows the official Protobuf JSON specification. Core mappings:</p>
<table><thead><tr><th>Protobuf Field Type</th><th>JSON Type</th><th>Description</th></tr></thead><tbody><tr><td><code>int32</code>/<code>int64</code>/<code>uint32</code>/<code>uint64</code></td><td>Number or String</td><td>Supports JSON numbers (e.g., 123) or strings (e.g., &quot;123&quot;); conversion fails if out of range</td></tr><tr><td><code>double</code>/<code>float</code></td><td>Number or String</td><td>Supports JSON numbers (e.g., 3.14) or strings (e.g., &quot;3.14&quot;); NaN/Inf not supported</td></tr><tr><td><code>bool</code></td><td>Boolean or String</td><td>Supports JSON <code>true</code>/<code>false</code>, or strings &quot;true&quot;/&quot;false&quot; (case-insensitive)</td></tr><tr><td><code>string</code></td><td>String</td><td>Supports JSON strings with null characters (<code>\u0000</code>) (compliant with Merak features)</td></tr><tr><td><code>bytes</code></td><td>String</td><td>Defaults to Base64-encoded string; configurable to raw bytes via <code>bytes_parse_mode</code></td></tr><tr><td><code>enum</code></td><td>String or Number</td><td>Maps to enum name (e.g., &quot;STATUS_ACTIVE&quot;) or number (e.g., 1), depending on <code>enum_parse_mode</code></td></tr><tr><td><code>repeated T</code></td><td>Array</td><td>Each element in the JSON array follows the mapping rule for type T</td></tr><tr><td>Nested <code>message</code></td><td>Object</td><td>Fields in the JSON object map one-to-one with fields in the nested message</td></tr><tr><td><code>map&lt;K, V&gt;</code></td><td>Object</td><td>Keys are of type K (supports <code>string</code>/<code>int32</code>/<code>int64</code>/<code>uint32</code>/<code>uint64</code>); values are of type V</td></tr><tr><td><code>oneof</code></td><td>Single Field</td><td>Only one field from the oneof is allowed in JSON; conversion fails if multiple or none are present</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="14-error-handling">1.4 Error Handling<a href="#14-error-handling" class="hash-link" aria-label="Direct link to 1.4 Error Handling" title="Direct link to 1.4 Error Handling" translate="no">​</a></h3>
<p>For conversion failures, retrieve detailed error information via:</p>
<ul>
<li class=""><code>const char* GetJsonToPbError()</code>: Returns human-readable error description (e.g., &quot;required field &#x27;id&#x27; not found&quot;).</li>
<li class=""><code>int GetJsonToPbErrorCode()</code>: Returns error code (corresponds to <code>JsonToPbErrorCode</code> enum, e.g., <code>kJsonToPbErrorMissingRequiredField</code>).</li>
</ul>
<p>Common Error Types:</p>
<ul>
<li class="">Missing required Protobuf fields.</li>
<li class="">Mismatched field types (e.g., JSON string assigned to PB <code>int32</code> field).</li>
<li class="">Invalid enum values (e.g., unknown enum name or number).</li>
<li class="">Oneof field conflict (multiple oneof fields present in JSON).</li>
<li class="">Inconsistent types in JSON array (e.g., <code>repeated int32</code> mapped to JSON array with strings).</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-protobuf-to-json-pb_to_jsonh">2. Protobuf to JSON (<code>pb_to_json.h</code>)<a href="#2-protobuf-to-json-pb_to_jsonh" class="hash-link" aria-label="Direct link to 2-protobuf-to-json-pb_to_jsonh" title="Direct link to 2-protobuf-to-json-pb_to_jsonh" translate="no">​</a></h2>
<p><code>pb_to_json.h</code> provides interfaces to convert from Protobuf messages to Merak JSON DOM or JSON strings, supporting advanced features like output format control and default value handling.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="21-basic-usage">2.1 Basic Usage<a href="#21-basic-usage" class="hash-link" aria-label="Direct link to 2.1 Basic Usage" title="Direct link to 2.1 Basic Usage" translate="no">​</a></h3>
<p>Using the Protobuf message defined in Section 1.1, convert the PB message to JSON:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;merak/proto/pb_to_json.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;merak/json/document.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;merak/json/stringbuffer.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;merak/json/writer.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;user.pb.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;iostream&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">namespace</span><span class="token plain"> merak</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">namespace</span><span class="token plain"> example</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 1. Construct Protobuf message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  User user_pb</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  user_pb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set_id</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;user_456&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  user_pb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set_name</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Bob&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  user_pb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set_age</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  user_pb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set_is_vip</span><span class="token punctuation" style="color:#393A34">(</span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  user_pb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add_tags</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;engineer&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  user_pb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add_tags</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;golang&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Add nested address message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Address</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> addr </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> user_pb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">add_addresses</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  addr</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">set_street</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;456 Oak Ave&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  addr</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">set_city</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;London&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  addr</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">set_zip_code</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">EC1V </span><span class="token number" style="color:#36acaa">9L</span><span class="token plain">B</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  user_pb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set_status</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">UserStatus</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">STATUS_ACTIVE</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  user_pb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">mutable_ext_info</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">insert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;company&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ABC Corp&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  user_pb</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set_phone</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;+44 1234567890&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Set oneof field</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 2. Configure conversion options</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  merak</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">proto</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">PbToJsonOptions options</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">output_default_values </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Do not output default-valued fields (default: false)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">enum_output_mode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> merak</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">proto</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">EnumOutputMode</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kEnumOutputName</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Output enum names (default)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">use_proto_field_name </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic">// Use JSON field names (default: false; uses proto-defined names)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pretty_print </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">           </span><span class="token comment" style="color:#999988;font-style:italic">// Format JSON output (default: false)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  options</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">bytes_output_mode </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> merak</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">proto</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">BytesOutputMode</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kBytesOutputBase64</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Output bytes as Base64 (default)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 3. Perform conversion (two output modes: Merak DOM or JSON string)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Mode 1: Convert to Merak DOM (modifiable)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Document json_doc</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> success </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> merak</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">proto</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">PbToJson</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">user_pb</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">json_doc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> options</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">success</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">cerr </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Protobuf to JSON failed: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> merak</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">proto</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">GetPbToJsonError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Mode 2: Convert directly to JSON string (simpler)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// std::string json_str;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// bool success = merak::proto::PbToJson(user_pb, &amp;json_str, options);</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// 4. Output JSON result (formatted)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  StringBuffer buffer</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  PrettyWriter</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">StringBuffer</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">writer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">buffer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// Formatted writer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  json_doc</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Accept</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">writer</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">cout </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Protobuf to JSON result:&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">cout </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> buffer</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">endl</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>Output (formatted):</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;id&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;user_456&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Bob&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;age&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;is_vip&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;tags&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;engineer&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;golang&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;addresses&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;street&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;456 Oak Ave&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;city&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;London&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;zip_code&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">234567890</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;STATUS_ACTIVE&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;ext_info&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;company&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;ABC Corp&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;phone&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;+44 1234567890&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="22-core-configuration-pbtojsonoptions">2.2 Core Configuration: <code>PbToJsonOptions</code><a href="#22-core-configuration-pbtojsonoptions" class="hash-link" aria-label="Direct link to 22-core-configuration-pbtojsonoptions" title="Direct link to 22-core-configuration-pbtojsonoptions" translate="no">​</a></h3>
<p>Controls PB-to-JSON output behavior. Field descriptions:</p>
<table><thead><tr><th>Field Name</th><th>Type</th><th>Default Value</th><th>Description</th></tr></thead><tbody><tr><td><code>output_default_values</code></td><td><code>bool</code></td><td><code>false</code></td><td>Whether to output Protobuf default values (true: output; false: omit default-valued fields)</td></tr><tr><td><code>enum_output_mode</code></td><td><code>EnumOutputMode</code> (enum)</td><td><code>kEnumOutputName</code></td><td>Enum output mode:<br>- <code>kEnumOutputName</code>: Output enum names (e.g., &quot;STATUS_ACTIVE&quot;)<br>- <code>kEnumOutputNumber</code>: Output enum numbers (e.g., 1)</td></tr><tr><td><code>use_proto_field_name</code></td><td><code>bool</code></td><td><code>false</code></td><td>Whether to use Protobuf-defined field names (true: use proto names; false: use JSON-spec names, e.g., proto <code>user_name</code> → JSON <code>userName</code>)</td></tr><tr><td><code>pretty_print</code></td><td><code>bool</code></td><td><code>false</code></td><td>Whether to format JSON with indentation and line breaks (true: formatted; false: compact)</td></tr><tr><td><code>bytes_output_mode</code></td><td><code>BytesOutputMode</code> (enum)</td><td><code>kBytesOutputBase64</code></td><td>Output mode for Protobuf <code>bytes</code> fields:<br>- <code>kBytesOutputBase64</code>: Output as Base64 string<br>- <code>kBytesOutputRaw</code>: Output as raw byte string (may contain non-printable characters)</td></tr><tr><td><code>ignore_empty_repeated</code></td><td><code>bool</code></td><td><code>false</code></td><td>Whether to omit empty <code>repeated</code> fields (true: omit empty arrays; false: output empty arrays)</td></tr><tr><td><code>ignore_empty_map</code></td><td><code>bool</code></td><td><code>false</code></td><td>Whether to omit empty <code>map</code> fields (true: omit empty objects; false: output empty objects)</td></tr><tr><td><code>max_depth</code></td><td><code>int</code></td><td><code>100</code></td><td>Maximum nesting depth for nested messages (prevents recursion overflow; conversion fails if exceeded)</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="23-field-mapping-rules">2.3 Field Mapping Rules<a href="#23-field-mapping-rules" class="hash-link" aria-label="Direct link to 2.3 Field Mapping Rules" title="Direct link to 2.3 Field Mapping Rules" translate="no">​</a></h3>
<p>Mapping from Protobuf to JSON follows symmetric rules to JSON-to-PB. Key supplementary notes:</p>
<ul>
<li class=""><strong>Default Value Handling</strong>: Default-valued fields (e.g., <code>int32</code> = 0, <code>bool</code> = false, <code>string</code> = &quot;&quot;) are omitted by default; enable via <code>output_default_values</code>.</li>
<li class=""><strong>Repeated Fields</strong>: Protobuf <code>repeated</code> fields always map to JSON arrays (empty arrays are omitted or retained per <code>ignore_empty_repeated</code>).</li>
<li class=""><strong>Oneof Fields</strong>: Only the set field in the oneof is output (omitted if no field is set).</li>
<li class=""><strong>Map Fields</strong>: Protobuf <code>map&lt;K, V&gt;</code> maps to JSON objects, with keys as string representations of K (e.g., <code>int32</code> key 123 → &quot;123&quot;).</li>
<li class=""><strong>Enum Fields</strong>: Enum names are output by default (e.g., &quot;STATUS_ACTIVE&quot;); switch to numbers via <code>enum_output_mode</code>.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="24-error-handling">2.4 Error Handling<a href="#24-error-handling" class="hash-link" aria-label="Direct link to 2.4 Error Handling" title="Direct link to 2.4 Error Handling" translate="no">​</a></h3>
<p>For conversion failures, retrieve error information via:</p>
<ul>
<li class=""><code>const char* GetPbToJsonError()</code>: Returns error description (e.g., &quot;nested message depth exceeds max_depth&quot;).</li>
<li class=""><code>int GetPbToJsonErrorCode()</code>: Returns error code (corresponds to <code>PbToJsonErrorCode</code> enum, e.g., <code>kPbToJsonErrorMaxDepthExceeded</code>).</li>
</ul>
<p>Common Error Types:</p>
<ul>
<li class="">Nested message depth exceeds <code>max_depth</code> limit.</li>
<li class="">Protobuf message contains uninitialized required fields (checked only in debug mode).</li>
<li class=""><code>bytes</code> field contains invalid Base64 characters (when <code>bytes_output_mode</code> = <code>kBytesOutputBase64</code>).</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-advanced-features">3. Advanced Features<a href="#3-advanced-features" class="hash-link" aria-label="Direct link to 3. Advanced Features" title="Direct link to 3. Advanced Features" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="31-handling-dynamic-protobuf-messages">3.1 Handling Dynamic Protobuf Messages<a href="#31-handling-dynamic-protobuf-messages" class="hash-link" aria-label="Direct link to 3.1 Handling Dynamic Protobuf Messages" title="Direct link to 3.1 Handling Dynamic Protobuf Messages" translate="no">​</a></h3>
<p>Supports dynamic messages via Protobuf&#x27;s <code>Descriptor</code> and <code>Reflection</code> interfaces (no compiled <code>.proto</code> code required):</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;merak/proto/json_to_pb.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;google/protobuf/descriptor.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;google/protobuf/message.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Dynamic JSON-to-Protobuf conversion (Descriptor known)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">DynamicJsonToPb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> Document</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> google</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">protobuf</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Descriptor</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> desc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> google</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">protobuf</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Message</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> pb</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> merak</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">proto</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">JsonToPb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">json</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> desc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> pb</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> merak</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">proto</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">JsonToPbOptions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="32-custom-field-mapping">3.2 Custom Field Mapping<a href="#32-custom-field-mapping" class="hash-link" aria-label="Direct link to 3.2 Custom Field Mapping" title="Direct link to 3.2 Custom Field Mapping" translate="no">​</a></h3>
<p>Register callback functions to customize conversion logic for specific fields (e.g., special date formats, custom enum mappings):</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// Register field conversion callback (example: convert JSON date string to Protobuf int64 timestamp)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">merak</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">proto</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">RegisterJsonToPbFieldCallback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;example.User&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Full message type name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;create_time&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Field name</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> Value</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> json_val</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> google</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">protobuf</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Message</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> pb</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> google</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">protobuf</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">FieldDescriptor</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> field</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">!</span><span class="token plain">json_val</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">IsString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Custom logic: convert &quot;2024-01-01&quot; to timestamp</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">int64_t</span><span class="token plain"> timestamp </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">ParseDateToTimestamp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">json_val</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">GetString</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    pb</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">GetReflection</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token function" style="color:#d73a49">SetInt64</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">pb</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> field</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> timestamp</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="33-performance-optimization-tips">3.3 Performance Optimization Tips<a href="#33-performance-optimization-tips" class="hash-link" aria-label="Direct link to 3.3 Performance Optimization Tips" title="Direct link to 3.3 Performance Optimization Tips" translate="no">​</a></h3>
<ul>
<li class=""><strong>Reuse DOM Objects</strong>: For frequent conversions, reuse Merak <code>Document</code> objects (clear via <code>SetObject()</code>/<code>SetArray()</code>) to reduce memory allocation overhead.</li>
<li class=""><strong>Bulk Conversion</strong>: For large numbers of small messages, batch conversions and reuse <code>StringBuffer</code> to avoid repeated buffer creation.</li>
<li class=""><strong>Disable Unnecessary Checks</strong>: In production environments, set <code>ignore_unknown_fields = true</code> to reduce field validation overhead.</li>
<li class=""><strong>Use Compact JSON</strong>: Disable <code>pretty_print</code> for non-human-readable scenarios to reduce string concatenation overhead.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-api-reference">4. API Reference<a href="#4-api-reference" class="hash-link" aria-label="Direct link to 4. API Reference" title="Direct link to 4. API Reference" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="41-core-apis-in-json_to_pbh">4.1 Core APIs in <code>json_to_pb.h</code><a href="#41-core-apis-in-json_to_pbh" class="hash-link" aria-label="Direct link to 41-core-apis-in-json_to_pbh" title="Direct link to 41-core-apis-in-json_to_pbh" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-convert-json-string-to-protobuf-message">1. Convert JSON String to Protobuf Message<a href="#1-convert-json-string-to-protobuf-message" class="hash-link" aria-label="Direct link to 1. Convert JSON String to Protobuf Message" title="Direct link to 1. Convert JSON String to Protobuf Message" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">JsonToPb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> json_str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                  </span><span class="token comment" style="color:#999988;font-style:italic">// Input: JSON string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">protobuf</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Message</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> pb_msg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">// Output: Protobuf message (pre-initialized)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> JsonToPbOptions</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> options </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">JsonToPbOptions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Conversion options</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-convert-merak-dom-to-protobuf-message">2. Convert Merak DOM to Protobuf Message<a href="#2-convert-merak-dom-to-protobuf-message" class="hash-link" aria-label="Direct link to 2. Convert Merak DOM to Protobuf Message" title="Direct link to 2. Convert Merak DOM to Protobuf Message" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">JsonToPb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> Value</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> json_val</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                 </span><span class="token comment" style="color:#999988;font-style:italic">// Input: Merak JSON Value (Object type)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">protobuf</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Message</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> pb_msg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic">// Output: Protobuf message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> JsonToPbOptions</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> options </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">JsonToPbOptions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Conversion options</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-dynamic-message-conversion-via-descriptor">3. Dynamic Message Conversion (via Descriptor)<a href="#3-dynamic-message-conversion-via-descriptor" class="hash-link" aria-label="Direct link to 3. Dynamic Message Conversion (via Descriptor)" title="Direct link to 3. Dynamic Message Conversion (via Descriptor)" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">JsonToPb</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> Value</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> json_val</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> google</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">protobuf</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Descriptor</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> pb_desc</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Protobuf message descriptor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">protobuf</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Message</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> pb_msg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> JsonToPbOptions</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> options </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">JsonToPbOptions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-error-information-interfaces">4. Error Information Interfaces<a href="#4-error-information-interfaces" class="hash-link" aria-label="Direct link to 4. Error Information Interfaces" title="Direct link to 4. Error Information Interfaces" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetJsonToPbError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// Get description of last conversion error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetJsonToPbErrorCode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">              </span><span class="token comment" style="color:#999988;font-style:italic">// Get error code of last conversion (JsonToPbErrorCode)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="42-core-apis-in-pb_to_jsonh">4.2 Core APIs in <code>pb_to_json.h</code><a href="#42-core-apis-in-pb_to_jsonh" class="hash-link" aria-label="Direct link to 42-core-apis-in-pb_to_jsonh" title="Direct link to 42-core-apis-in-pb_to_jsonh" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-convert-protobuf-message-to-json-string">1. Convert Protobuf Message to JSON String<a href="#1-convert-protobuf-message-to-json-string" class="hash-link" aria-label="Direct link to 1. Convert Protobuf Message to JSON String" title="Direct link to 1. Convert Protobuf Message to JSON String" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">PbToJson</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> google</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">protobuf</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Message</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> pb_msg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Input: Protobuf message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">string</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> json_str</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                    </span><span class="token comment" style="color:#999988;font-style:italic">// Output: JSON string</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> PbToJsonOptions</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> options </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">PbToJsonOptions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Conversion options</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-convert-protobuf-message-to-merak-dom">2. Convert Protobuf Message to Merak DOM<a href="#2-convert-protobuf-message-to-merak-dom" class="hash-link" aria-label="Direct link to 2. Convert Protobuf Message to Merak DOM" title="Direct link to 2. Convert Protobuf Message to Merak DOM" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">bool</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">PbToJson</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> google</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">protobuf</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">Message</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> pb_msg</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Input: Protobuf message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Value</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> json_val</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">                          </span><span class="token comment" style="color:#999988;font-style:italic">// Output: Merak JSON Value (Object type)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> PbToJsonOptions</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> options </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">PbToJsonOptions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Conversion options</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-error-information-interfaces">3. Error Information Interfaces<a href="#3-error-information-interfaces" class="hash-link" aria-label="Direct link to 3. Error Information Interfaces" title="Direct link to 3. Error Information Interfaces" translate="no">​</a></h4>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">char</span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetPbToJsonError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic">// Get description of last conversion error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">GetPbToJsonErrorCode</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain">              </span><span class="token comment" style="color:#999988;font-style:italic">// Get error code of last conversion (PbToJsonErrorCode)</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="5-precautions">5. Precautions<a href="#5-precautions" class="hash-link" aria-label="Direct link to 5. Precautions" title="Direct link to 5. Precautions" translate="no">​</a></h2>
<ol>
<li class=""><strong>Protobuf Version Compatibility</strong>: Only supports Protobuf 3.0+. Behavior of <code>required</code>/<code>optional</code> keywords in Protobuf 2.x may not match expectations.</li>
<li class=""><strong>JSON Field Name Matching</strong>: By default, Protobuf field name <code>user_name</code> maps to JSON <code>userName</code> (camelCase). Force raw field names with <code>use_proto_field_name = true</code>.</li>
<li class=""><strong>Enum Compatibility</strong>: The default enum value (number 0) must exist (e.g., <code>STATUS_UNKNOWN = 0</code>), otherwise conversion may fail.</li>
<li class=""><strong>Large Data Handling</strong>: For extra-large Protobuf messages (e.g., 100MB+), use Merak&#x27;s <code>FileReadStream</code>/<code>FileWriteStream</code> for chunked processing to avoid memory overflow.</li>
<li class=""><strong>Thread Safety</strong>: Conversion interfaces are not thread-safe. Use separate calls per thread or add lock protection in multi-threaded environments.</li>
<li class=""><strong>Default Value Behavior</strong>: All fields in Protobuf 3 are optional by default. Default-valued fields (e.g., 0, false, empty string) are not included in JSON when <code>output_default_values = false</code>.</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="6-frequently-asked-questions-faqs">6. Frequently Asked Questions (FAQs)<a href="#6-frequently-asked-questions-faqs" class="hash-link" aria-label="Direct link to 6. Frequently Asked Questions (FAQs)" title="Direct link to 6. Frequently Asked Questions (FAQs)" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="q1-what-happens-if-a-required-protobuf-field-is-missing-in-json">Q1: What happens if a required Protobuf field is missing in JSON?<a href="#q1-what-happens-if-a-required-protobuf-field-is-missing-in-json" class="hash-link" aria-label="Direct link to Q1: What happens if a required Protobuf field is missing in JSON?" title="Direct link to Q1: What happens if a required Protobuf field is missing in JSON?" translate="no">​</a></h3>
<p>A1: By default (<code>strict_required_fields = true</code>), conversion fails with error &quot;required field &#x27;xxx&#x27; not found&quot;. Set <code>strict_required_fields = false</code> to allow missing fields (field uses default value in Protobuf message).</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="q2-how-are-protobuf-oneof-fields-represented-in-json">Q2: How are Protobuf <code>oneof</code> fields represented in JSON?<a href="#q2-how-are-protobuf-oneof-fields-represented-in-json" class="hash-link" aria-label="Direct link to q2-how-are-protobuf-oneof-fields-represented-in-json" title="Direct link to q2-how-are-protobuf-oneof-fields-represented-in-json" translate="no">​</a></h3>
<p>A2: Only one field from the oneof is allowed in JSON; conversion fails if multiple or none are present (JSON-to-PB). Only the set oneof field is output (PB-to-JSON).</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="q3-how-to-handle-protobuf-bytes-fields">Q3: How to handle Protobuf <code>bytes</code> fields?<a href="#q3-how-to-handle-protobuf-bytes-fields" class="hash-link" aria-label="Direct link to q3-how-to-handle-protobuf-bytes-fields" title="Direct link to q3-how-to-handle-protobuf-bytes-fields" translate="no">​</a></h3>
<p>A3: By default, <code>bytes</code> fields are represented as Base64 strings in JSON. Switch to raw bytes via <code>bytes_parse_mode</code> (JSON-to-PB) and <code>bytes_output_mode</code> (PB-to-JSON).</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="q4-does-meraks-in-situ-parsing-support-json-to-pb-conversion">Q4: Does Merak&#x27;s in situ parsing support JSON-to-PB conversion?<a href="#q4-does-meraks-in-situ-parsing-support-json-to-pb-conversion" class="hash-link" aria-label="Direct link to Q4: Does Merak&#x27;s in situ parsing support JSON-to-PB conversion?" title="Direct link to Q4: Does Merak&#x27;s in situ parsing support JSON-to-PB conversion?" translate="no">​</a></h3>
<p>A4: Yes. If the JSON string is parsed into Merak DOM via in situ parsing, conversion to PB requires no additional string copying—offering higher performance.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="q5-how-to-format-the-converted-json-output">Q5: How to format the converted JSON output?<a href="#q5-how-to-format-the-converted-json-output" class="hash-link" aria-label="Direct link to Q5: How to format the converted JSON output?" title="Direct link to Q5: How to format the converted JSON output?" translate="no">​</a></h3>
<p>A5: Serialize the DOM with Merak&#x27;s <code>PrettyWriter</code>, or set <code>PbToJsonOptions::pretty_print = true</code> to generate formatted JSON strings directly.</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/cppdev/docs/foundamentals/json/performance"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Performance</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cppdev/docs/rpc/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">RPC Overview</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a><ul><li><a href="#core-features" class="table-of-contents__link toc-highlight">Core Features</a></li><li><a href="#dependencies" class="table-of-contents__link toc-highlight">Dependencies</a></li></ul></li><li><a href="#1-json-to-protobuf-json_to_pbh" class="table-of-contents__link toc-highlight">1. JSON to Protobuf (<code>json_to_pb.h</code>)</a><ul><li><a href="#11-basic-usage" class="table-of-contents__link toc-highlight">1.1 Basic Usage</a></li><li><a href="#12-core-configuration-jsontopboptions" class="table-of-contents__link toc-highlight">1.2 Core Configuration: <code>JsonToPbOptions</code></a></li><li><a href="#13-field-mapping-rules" class="table-of-contents__link toc-highlight">1.3 Field Mapping Rules</a></li><li><a href="#14-error-handling" class="table-of-contents__link toc-highlight">1.4 Error Handling</a></li></ul></li><li><a href="#2-protobuf-to-json-pb_to_jsonh" class="table-of-contents__link toc-highlight">2. Protobuf to JSON (<code>pb_to_json.h</code>)</a><ul><li><a href="#21-basic-usage" class="table-of-contents__link toc-highlight">2.1 Basic Usage</a></li><li><a href="#22-core-configuration-pbtojsonoptions" class="table-of-contents__link toc-highlight">2.2 Core Configuration: <code>PbToJsonOptions</code></a></li><li><a href="#23-field-mapping-rules" class="table-of-contents__link toc-highlight">2.3 Field Mapping Rules</a></li><li><a href="#24-error-handling" class="table-of-contents__link toc-highlight">2.4 Error Handling</a></li></ul></li><li><a href="#3-advanced-features" class="table-of-contents__link toc-highlight">3. Advanced Features</a><ul><li><a href="#31-handling-dynamic-protobuf-messages" class="table-of-contents__link toc-highlight">3.1 Handling Dynamic Protobuf Messages</a></li><li><a href="#32-custom-field-mapping" class="table-of-contents__link toc-highlight">3.2 Custom Field Mapping</a></li><li><a href="#33-performance-optimization-tips" class="table-of-contents__link toc-highlight">3.3 Performance Optimization Tips</a></li></ul></li><li><a href="#4-api-reference" class="table-of-contents__link toc-highlight">4. API Reference</a><ul><li><a href="#41-core-apis-in-json_to_pbh" class="table-of-contents__link toc-highlight">4.1 Core APIs in <code>json_to_pb.h</code></a></li><li><a href="#42-core-apis-in-pb_to_jsonh" class="table-of-contents__link toc-highlight">4.2 Core APIs in <code>pb_to_json.h</code></a></li></ul></li><li><a href="#5-precautions" class="table-of-contents__link toc-highlight">5. Precautions</a></li><li><a href="#6-frequently-asked-questions-faqs" class="table-of-contents__link toc-highlight">6. Frequently Asked Questions (FAQs)</a><ul><li><a href="#q1-what-happens-if-a-required-protobuf-field-is-missing-in-json" class="table-of-contents__link toc-highlight">Q1: What happens if a required Protobuf field is missing in JSON?</a></li><li><a href="#q2-how-are-protobuf-oneof-fields-represented-in-json" class="table-of-contents__link toc-highlight">Q2: How are Protobuf <code>oneof</code> fields represented in JSON?</a></li><li><a href="#q3-how-to-handle-protobuf-bytes-fields" class="table-of-contents__link toc-highlight">Q3: How to handle Protobuf <code>bytes</code> fields?</a></li><li><a href="#q4-does-meraks-in-situ-parsing-support-json-to-pb-conversion" class="table-of-contents__link toc-highlight">Q4: Does Merak&#39;s in situ parsing support JSON-to-PB conversion?</a></li><li><a href="#q5-how-to-format-the-converted-json-output" class="table-of-contents__link toc-highlight">Q5: How to format the converted JSON output?</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/cppdev/docs/intro">Tutorial</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/jefflothar" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/cppdev/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/kumo-pub" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Kumo, Inc.</div></div></div></footer></div>
</body>
</html>