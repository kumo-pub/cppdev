<!doctype html>
<html lang="zh-cn" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-foundamentals/testing/gt/advanced" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Advanced GoogleTest Topics | Kumo Search</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/cppdev/zh-cn/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/cppdev/zh-cn/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/cppdev/zh-cn/docs/foundamentals/testing/gt/advanced"><meta data-rh="true" property="og:locale" content="zh_cn"><meta data-rh="true" property="og:locale:alternate" content="en_GB"><meta data-rh="true" name="docusaurus_locale" content="zh-cn"><meta data-rh="true" name="docsearch:language" content="zh-cn"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Advanced GoogleTest Topics | Kumo Search"><meta data-rh="true" name="description" content="Introduction"><meta data-rh="true" property="og:description" content="Introduction"><link data-rh="true" rel="icon" href="/cppdev/zh-cn/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/cppdev/zh-cn/docs/foundamentals/testing/gt/advanced"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/cppdev/docs/foundamentals/testing/gt/advanced" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/cppdev/zh-cn/docs/foundamentals/testing/gt/advanced" hreflang="zh-cn"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/cppdev/docs/foundamentals/testing/gt/advanced" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"基础开发","item":"https://your-docusaurus-site.example.com/cppdev/zh-cn/docs/category/foundamentals"},{"@type":"ListItem","position":2,"name":"性能测试与单元测试","item":"https://your-docusaurus-site.example.com/cppdev/zh-cn/docs/foundamentals/testing/"},{"@type":"ListItem","position":3,"name":"Google Test","item":"https://your-docusaurus-site.example.com/cppdev/zh-cn/docs/category/google-test"},{"@type":"ListItem","position":4,"name":"Advanced GoogleTest Topics","item":"https://your-docusaurus-site.example.com/cppdev/zh-cn/docs/foundamentals/testing/gt/advanced"}]}</script><link rel="alternate" type="application/rss+xml" href="/cppdev/zh-cn/blog/rss.xml" title="Kumo Search RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/cppdev/zh-cn/blog/atom.xml" title="Kumo Search Atom Feed"><link rel="stylesheet" href="/cppdev/zh-cn/assets/css/styles.582e0043.css">
<script src="/cppdev/zh-cn/assets/js/runtime~main.ab755061.js" defer="defer"></script>
<script src="/cppdev/zh-cn/assets/js/main.0dd454fe.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/cppdev/zh-cn/img/kumo-logo.svg"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cppdev/zh-cn/"><div class="navbar__logo"><img src="/cppdev/zh-cn/img/kumo-logo.svg" alt="Kumo logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/cppdev/zh-cn/img/kumo-logo.svg" alt="Kumo logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">开发导论</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cppdev/zh-cn/docs/intro">教程</a><a class="navbar__item navbar__link" href="/cppdev/zh-cn/docs/integration/overview">集成</a><a class="navbar__item navbar__link" href="/cppdev/zh-cn/blog">博客</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/kumose" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文（中国）</a><ul class="dropdown__menu"><li><a href="/cppdev/docs/foundamentals/testing/gt/advanced" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-GB">English</a></li><li><a href="/cppdev/zh-cn/docs/foundamentals/testing/gt/advanced" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-cn">中文（中国）</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cppdev/zh-cn/docs/intro"><span title="概览" class="linkLabel_WmDU">概览</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/cppdev/zh-cn/docs/category/foundamentals"><span title="基础开发" class="categoryLinkLabel_W154">基础开发</span></a><button aria-label="折叠侧边栏分类 &#x27;基础开发&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/testing/"><span title="性能测试与单元测试" class="categoryLinkLabel_W154">性能测试与单元测试</span></a><button aria-label="折叠侧边栏分类 &#x27;性能测试与单元测试&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/category/doctest-unit-testing"><span title="doctest单元测试" class="categoryLinkLabel_W154">doctest单元测试</span></a><button aria-label="展开侧边栏分类 &#x27;doctest单元测试&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/cppdev/zh-cn/docs/category/google-test"><span title="Google Test" class="categoryLinkLabel_W154">Google Test</span></a><button aria-label="折叠侧边栏分类 &#x27;Google Test&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/platforms"><span title="Supported Platforms" class="linkLabel_WmDU">Supported Platforms</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/quickstart-bazel"><span title="Quickstart: Building with Bazel" class="linkLabel_WmDU">Quickstart: Building with Bazel</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/quickstart-cmake"><span title="Quickstart: Building with CMake" class="linkLabel_WmDU">Quickstart: Building with CMake</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/primer"><span title="GoogleTest Primer" class="linkLabel_WmDU">GoogleTest Primer</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/advanced"><span title="Advanced GoogleTest Topics" class="linkLabel_WmDU">Advanced GoogleTest Topics</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/gmock_for_dummies"><span title="gMock for Dummies" class="linkLabel_WmDU">gMock for Dummies</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/gmock_cook_book"><span title="gMock Cookbook" class="linkLabel_WmDU">gMock Cookbook</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/gmock_cheat_sheet"><span title="gMock Cheat Sheet" class="linkLabel_WmDU">gMock Cheat Sheet</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/testing"><span title="Testing Reference" class="linkLabel_WmDU">Testing Reference</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/mocking"><span title="Mocking Reference" class="linkLabel_WmDU">Mocking Reference</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/assertions"><span title="Assertions Reference" class="linkLabel_WmDU">Assertions Reference</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/matchers"><span title="Matchers Reference" class="linkLabel_WmDU">Matchers Reference</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/actions"><span title="Actions Reference" class="linkLabel_WmDU">Actions Reference</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/faq"><span title="GoogleTest FAQ" class="linkLabel_WmDU">GoogleTest FAQ</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/gmock_faq"><span title="Legacy gMock FAQ" class="linkLabel_WmDU">Legacy gMock FAQ</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/samples"><span title="Googletest Samples" class="linkLabel_WmDU">Googletest Samples</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/pkgconfig"><span title="pkgconfig" class="linkLabel_WmDU">pkgconfig</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-4 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/community_created_documentation"><span title="Community-Created Documentation" class="linkLabel_WmDU">Community-Created Documentation</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/testing/benchmark/"><span title="benchmark" class="categoryLinkLabel_W154">benchmark</span></a><button aria-label="展开侧边栏分类 &#x27;benchmark&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/log/"><span title="日志" class="categoryLinkLabel_W154">日志</span></a><button aria-label="展开侧边栏分类 &#x27;日志&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/time"><span title="时间与日历" class="linkLabel_WmDU">时间与日历</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/category/standardized-errors-and-error-return-values"><span title="标准化错误与错误返回值" class="categoryLinkLabel_W154">标准化错误与错误返回值</span></a><button aria-label="展开侧边栏分类 &#x27;标准化错误与错误返回值&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/strings/"><span title="strings 操作" class="categoryLinkLabel_W154">strings 操作</span></a><button aria-label="展开侧边栏分类 &#x27;strings 操作&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/flags"><span title="Turbo 命令行标志（Turbo Flags）" class="linkLabel_WmDU">Turbo 命令行标志（Turbo Flags）</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/codec/"><span title="编码与解码" class="categoryLinkLabel_W154">编码与解码</span></a><button aria-label="展开侧边栏分类 &#x27;编码与解码&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/format/"><span title="格式化与输出（字符串格式化和输出）" class="linkLabel_WmDU">格式化与输出（字符串格式化和输出）</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/map/"><span title="map容器" class="categoryLinkLabel_W154">map容器</span></a><button aria-label="展开侧边栏分类 &#x27;map容器&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/compress/"><span title="压缩与解压缩" class="categoryLinkLabel_W154">压缩与解压缩</span></a><button aria-label="展开侧边栏分类 &#x27;压缩与解压缩&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/fibers/"><span title="Fiber And Future" class="categoryLinkLabel_W154">Fiber And Future</span></a><button aria-label="展开侧边栏分类 &#x27;Fiber And Future&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/monitor/"><span title="监控" class="categoryLinkLabel_W154">监控</span></a><button aria-label="展开侧边栏分类 &#x27;监控&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/filesystem/"><span title="文件系统" class="categoryLinkLabel_W154">文件系统</span></a><button aria-label="展开侧边栏分类 &#x27;文件系统&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/json/"><span title="json" class="categoryLinkLabel_W154">json</span></a><button aria-label="展开侧边栏分类 &#x27;json&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cppdev/zh-cn/docs/rpc/"><span title="rpc远程调用" class="categoryLinkLabel_W154">rpc远程调用</span></a><button aria-label="展开侧边栏分类 &#x27;rpc远程调用&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cppdev/zh-cn/docs/retrieve/"><span title="检索开发" class="categoryLinkLabel_W154">检索开发</span></a><button aria-label="展开侧边栏分类 &#x27;检索开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cppdev/zh-cn/docs/store/"><span title="存储" class="categoryLinkLabel_W154">存储</span></a><button aria-label="展开侧边栏分类 &#x27;存储&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cppdev/zh-cn/docs/ir/"><span title="IR" class="categoryLinkLabel_W154">IR</span></a><button aria-label="展开侧边栏分类 &#x27;IR&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cppdev/zh-cn/docs/advance/"><span title="进阶开发" class="categoryLinkLabel_W154">进阶开发</span></a><button aria-label="展开侧边栏分类 &#x27;进阶开发&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/cppdev/zh-cn/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/cppdev/zh-cn/docs/category/foundamentals"><span>基础开发</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/cppdev/zh-cn/docs/foundamentals/testing/"><span>性能测试与单元测试</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/cppdev/zh-cn/docs/category/google-test"><span>Google Test</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Advanced GoogleTest Topics</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Advanced GoogleTest Topics</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="introduction">Introduction<a href="#introduction" class="hash-link" aria-label="Introduction的直接链接" title="Introduction的直接链接" translate="no">​</a></h2>
<p>Now that you have read the <a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/primer">GoogleTest Primer</a> and learned how to
write tests using GoogleTest, it&#x27;s time to learn some new tricks. This document
will show you more assertions as well as how to construct complex failure
messages, propagate fatal failures, reuse and speed up your test fixtures, and
use various flags with your tests.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="more-assertions">More Assertions<a href="#more-assertions" class="hash-link" aria-label="More Assertions的直接链接" title="More Assertions的直接链接" translate="no">​</a></h2>
<p>This section covers some less frequently used, but still significant,
assertions.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="explicit-success-and-failure">Explicit Success and Failure<a href="#explicit-success-and-failure" class="hash-link" aria-label="Explicit Success and Failure的直接链接" title="Explicit Success and Failure的直接链接" translate="no">​</a></h3>
<p>See <a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/assertions#success-failure">Explicit Success and Failure</a> in
the Assertions Reference.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="exception-assertions">Exception Assertions<a href="#exception-assertions" class="hash-link" aria-label="Exception Assertions的直接链接" title="Exception Assertions的直接链接" translate="no">​</a></h3>
<p>See <a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/assertions#exceptions">Exception Assertions</a> in the Assertions
Reference.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="predicate-assertions-for-better-error-messages">Predicate Assertions for Better Error Messages<a href="#predicate-assertions-for-better-error-messages" class="hash-link" aria-label="Predicate Assertions for Better Error Messages的直接链接" title="Predicate Assertions for Better Error Messages的直接链接" translate="no">​</a></h3>
<p>Even though GoogleTest has a rich set of assertions, they can never be complete,
as it&#x27;s impossible (nor a good idea) to anticipate all scenarios a user might
run into. Therefore, sometimes a user has to use <code>EXPECT_TRUE()</code> to check a
complex expression, for lack of a better macro. This has the problem of not
showing you the values of the parts of the expression, making it hard to
understand what went wrong. As a workaround, some users choose to construct the
failure message by themselves, streaming it into <code>EXPECT_TRUE()</code>. However, this
is awkward especially when the expression has side-effects or is expensive to
evaluate.</p>
<p>GoogleTest gives you three different options to solve this problem:</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-an-existing-boolean-function">Using an Existing Boolean Function<a href="#using-an-existing-boolean-function" class="hash-link" aria-label="Using an Existing Boolean Function的直接链接" title="Using an Existing Boolean Function的直接链接" translate="no">​</a></h4>
<p>If you already have a function or functor that returns <code>bool</code> (or a type that
can be implicitly converted to <code>bool</code>), you can use it in a <em>predicate
assertion</em> to get the function arguments printed for free. See
<a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/assertions#EXPECT_PRED"><code>EXPECT_PRED*</code></a> in the Assertions
Reference for details.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-a-function-that-returns-an-assertionresult">Using a Function That Returns an AssertionResult<a href="#using-a-function-that-returns-an-assertionresult" class="hash-link" aria-label="Using a Function That Returns an AssertionResult的直接链接" title="Using a Function That Returns an AssertionResult的直接链接" translate="no">​</a></h4>
<p>While <code>EXPECT_PRED*()</code> and friends are handy for a quick job, the syntax is not
satisfactory: you have to use different macros for different arities, and it
feels more like Lisp than C++. The <code>::testing::AssertionResult</code> class solves
this problem.</p>
<p>An <code>AssertionResult</code> object represents the result of an assertion (whether it&#x27;s
a success or a failure, and an associated message). You can create an
<code>AssertionResult</code> using one of these factory functions:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace testing {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Returns an AssertionResult object to indicate that an assertion has</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// succeeded.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AssertionResult AssertionSuccess();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Returns an AssertionResult object to indicate that an assertion has</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// failed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">AssertionResult AssertionFailure();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>You can then use the <code>&lt;&lt;</code> operator to stream messages to the <code>AssertionResult</code>
object.</p>
<p>To provide more readable messages in Boolean assertions (e.g. <code>EXPECT_TRUE()</code>),
write a predicate function that returns <code>AssertionResult</code> instead of <code>bool</code>. For
example, if you define <code>IsEven()</code> as:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">testing::AssertionResult IsEven(int n) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if ((n % 2) == 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return testing::AssertionSuccess();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return testing::AssertionFailure() &lt;&lt; n &lt;&lt; &quot; is odd&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>instead of:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">bool IsEven(int n) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return (n % 2) == 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>the failed assertion <code>EXPECT_TRUE(IsEven(Fib(4)))</code> will print:</p>
<div class="language-none codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-none codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Value of: IsEven(Fib(4))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Actual: false (3 is odd)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Expected: true</span><br></span></code></pre></div></div>
<p>instead of a more opaque</p>
<div class="language-none codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-none codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Value of: IsEven(Fib(4))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Actual: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Expected: true</span><br></span></code></pre></div></div>
<p>If you want informative messages in <code>EXPECT_FALSE</code> and <code>ASSERT_FALSE</code> as well
(one third of Boolean assertions in the Google code base are negative ones), and
are fine with making the predicate slower in the success case, you can supply a
success message:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">testing::AssertionResult IsEven(int n) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if ((n % 2) == 0)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return testing::AssertionSuccess() &lt;&lt; n &lt;&lt; &quot; is even&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    return testing::AssertionFailure() &lt;&lt; n &lt;&lt; &quot; is odd&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Then the statement <code>EXPECT_FALSE(IsEven(Fib(6)))</code> will print</p>
<div class="language-none codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-none codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  Value of: IsEven(Fib(6))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">     Actual: true (8 is even)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Expected: false</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-a-predicate-formatter">Using a Predicate-Formatter<a href="#using-a-predicate-formatter" class="hash-link" aria-label="Using a Predicate-Formatter的直接链接" title="Using a Predicate-Formatter的直接链接" translate="no">​</a></h4>
<p>If you find the default message generated by
<a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/assertions#EXPECT_PRED"><code>EXPECT_PRED*</code></a> and
<a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/assertions#EXPECT_TRUE"><code>EXPECT_TRUE</code></a> unsatisfactory, or some
arguments to your predicate do not support streaming to <code>ostream</code>, you can
instead use <em>predicate-formatter assertions</em> to <em>fully</em> customize how the
message is formatted. See
<a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/assertions#EXPECT_PRED_FORMAT"><code>EXPECT_PRED_FORMAT*</code></a> in the
Assertions Reference for details.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="floating-point-comparison">Floating-Point Comparison<a href="#floating-point-comparison" class="hash-link" aria-label="Floating-Point Comparison的直接链接" title="Floating-Point Comparison的直接链接" translate="no">​</a></h3>
<p>See <a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/assertions#floating-point">Floating-Point Comparison</a> in the
Assertions Reference.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="floating-point-predicate-format-functions">Floating-Point Predicate-Format Functions<a href="#floating-point-predicate-format-functions" class="hash-link" aria-label="Floating-Point Predicate-Format Functions的直接链接" title="Floating-Point Predicate-Format Functions的直接链接" translate="no">​</a></h4>
<p>Some floating-point operations are useful, but not that often used. In order to
avoid an explosion of new macros, we provide them as predicate-format functions
that can be used in the predicate assertion macro
<a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/assertions#EXPECT_PRED_FORMAT"><code>EXPECT_PRED_FORMAT2</code></a>, for
example:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using ::testing::FloatLE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using ::testing::DoubleLE;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPECT_PRED_FORMAT2(FloatLE, val1, val2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPECT_PRED_FORMAT2(DoubleLE, val1, val2);</span><br></span></code></pre></div></div>
<p>The above code verifies that <code>val1</code> is less than, or approximately equal to,
<code>val2</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="asserting-using-gmock-matchers">Asserting Using gMock Matchers<a href="#asserting-using-gmock-matchers" class="hash-link" aria-label="Asserting Using gMock Matchers的直接链接" title="Asserting Using gMock Matchers的直接链接" translate="no">​</a></h3>
<p>See <a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/assertions#EXPECT_THAT"><code>EXPECT_THAT</code></a> in the Assertions
Reference.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="more-string-assertions">More String Assertions<a href="#more-string-assertions" class="hash-link" aria-label="More String Assertions的直接链接" title="More String Assertions的直接链接" translate="no">​</a></h3>
<p>(Please read the <a href="#asserting-using-gmock-matchers" class="">previous</a> section first if
you haven&#x27;t.)</p>
<p>You can use the gMock <a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/matchers#string-matchers">string matchers</a>
with <a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/assertions#EXPECT_THAT"><code>EXPECT_THAT</code></a> to do more string
comparison tricks (sub-string, prefix, suffix, regular expression, and etc). For
example,</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using ::testing::HasSubstr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using ::testing::MatchesRegex;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ASSERT_THAT(foo_string, HasSubstr(&quot;needle&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  EXPECT_THAT(bar_string, MatchesRegex(&quot;\\w*\\d+&quot;));</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="windows-hresult-assertions">Windows HRESULT assertions<a href="#windows-hresult-assertions" class="hash-link" aria-label="Windows HRESULT assertions的直接链接" title="Windows HRESULT assertions的直接链接" translate="no">​</a></h3>
<p>See <a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/assertions#HRESULT">Windows HRESULT Assertions</a> in the
Assertions Reference.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="type-assertions">Type Assertions<a href="#type-assertions" class="hash-link" aria-label="Type Assertions的直接链接" title="Type Assertions的直接链接" translate="no">​</a></h3>
<p>You can call the function</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">::testing::StaticAssertTypeEq&lt;T1, T2&gt;();</span><br></span></code></pre></div></div>
<p>to assert that types <code>T1</code> and <code>T2</code> are the same. The function does nothing if
the assertion is satisfied. If the types are different, the function call will
fail to compile, the compiler error message will say that <code>T1 and T2 are not the same type</code> and most likely (depending on the compiler) show you the actual
values of <code>T1</code> and <code>T2</code>. This is mainly useful inside template code.</p>
<p><strong>Caveat</strong>: When used inside a member function of a class template or a function
template, <code>StaticAssertTypeEq&lt;T1, T2&gt;()</code> is effective only if the function is
instantiated. For example, given:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">template &lt;typename T&gt; class Foo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void Bar() { testing::StaticAssertTypeEq&lt;int, T&gt;(); }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre></div></div>
<p>the code:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void Test1() { Foo&lt;bool&gt; foo; }</span><br></span></code></pre></div></div>
<p>will not generate a compiler error, as <code>Foo&lt;bool&gt;::Bar()</code> is never actually
instantiated. Instead, you need:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void Test2() { Foo&lt;bool&gt; foo; foo.Bar(); }</span><br></span></code></pre></div></div>
<p>to cause a compiler error.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="assertion-placement">Assertion Placement<a href="#assertion-placement" class="hash-link" aria-label="Assertion Placement的直接链接" title="Assertion Placement的直接链接" translate="no">​</a></h3>
<p>You can use assertions in any C++ function. In particular, it doesn&#x27;t have to be
a method of the test fixture class. The one constraint is that assertions that
generate a fatal failure (<code>FAIL*</code> and <code>ASSERT_*</code>) can only be used in
void-returning functions. This is a consequence of Google&#x27;s not using
exceptions. By placing it in a non-void function you&#x27;ll get a confusing compile
error like <code>&quot;error: void value not ignored as it ought to be&quot;</code> or <code>&quot;cannot initialize return object of type &#x27;bool&#x27; with an rvalue of type &#x27;void&#x27;&quot;</code> or
<code>&quot;error: no viable conversion from &#x27;void&#x27; to &#x27;string&#x27;&quot;</code>.</p>
<p>If you need to use fatal assertions in a function that returns non-void, one
option is to make the function return the value in an out parameter instead. For
example, you can rewrite <code>T2 Foo(T1 x)</code> to <code>void Foo(T1 x, T2* result)</code>. You
need to make sure that <code>*result</code> contains some sensible value even when the
function returns prematurely. As the function now returns <code>void</code>, you can use
any assertion inside of it.</p>
<p>If changing the function&#x27;s type is not an option, you should just use assertions
that generate non-fatal failures, such as <code>ADD_FAILURE*</code> and <code>EXPECT_*</code>.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>NOTE: Constructors and destructors are not considered void-returning functions,
according to the C++ language specification, and so you may not use fatal
assertions in them; you&#x27;ll get a compilation error if you try. Instead, either
call <code>abort</code> and crash the entire test executable, or put the fatal assertion in
a <code>SetUp</code>/<code>TearDown</code> function; see
<a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/faq#CtorVsSetUp">constructor/destructor vs. <code>SetUp</code>/<code>TearDown</code></a></p></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>WARNING: A fatal assertion in a helper function (private void-returning method)
called from a constructor or destructor does not terminate the current test, as
your intuition might suggest: it merely returns from the constructor or
destructor early, possibly leaving your object in a partially-constructed or
partially-destructed state! You almost certainly want to <code>abort</code> or use
<code>SetUp</code>/<code>TearDown</code> instead.</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="skipping-test-execution">Skipping test execution<a href="#skipping-test-execution" class="hash-link" aria-label="Skipping test execution的直接链接" title="Skipping test execution的直接链接" translate="no">​</a></h2>
<p>Related to the assertions <code>SUCCEED()</code> and <code>FAIL()</code>, you can prevent further test
execution at runtime with the <code>GTEST_SKIP()</code> macro. This is useful when you need
to check for preconditions of the system under test during runtime and skip
tests in a meaningful way.</p>
<p><code>GTEST_SKIP()</code> can be used in individual test cases or in the <code>SetUp()</code> methods
of classes derived from either <code>::testing::Environment</code> or <code>::testing::Test</code>.
For example:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TEST(SkipTest, DoesSkip) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  GTEST_SKIP() &lt;&lt; &quot;Skipping single test&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FAIL();  // Won&#x27;t fail; it won&#x27;t be executed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class SkipFixture : public ::testing::Test {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> protected:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void SetUp() override {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    GTEST_SKIP() &lt;&lt; &quot;Skipping all tests for this fixture&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Tests for SkipFixture won&#x27;t be executed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST_F(SkipFixture, SkipsOneTest) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FAIL();  // Won&#x27;t fail; it won&#x27;t be executed</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>As with assertion macros, you can stream a custom message into <code>GTEST_SKIP()</code>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="teaching-googletest-how-to-print-your-values">Teaching GoogleTest How to Print Your Values<a href="#teaching-googletest-how-to-print-your-values" class="hash-link" aria-label="Teaching GoogleTest How to Print Your Values的直接链接" title="Teaching GoogleTest How to Print Your Values的直接链接" translate="no">​</a></h2>
<p>When a test assertion such as <code>EXPECT_EQ</code> fails, GoogleTest prints the argument
values to help you debug. It does this using a user-extensible value printer.</p>
<p>This printer knows how to print built-in C++ types, native arrays, STL
containers, and any type that supports the <code>&lt;&lt;</code> operator. For other types, it
prints the raw bytes in the value and hopes that you the user can figure it out.</p>
<p>As mentioned earlier, the printer is <em>extensible</em>. That means you can teach it
to do a better job at printing your particular type than to dump the bytes. To
do that, define an <code>AbslStringify()</code> overload as a <code>friend</code> function template
for your type:</p>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">namespace</span><span class="token plain"> foo </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Point</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// We want GoogleTest to be able to print instances of this.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// Provide a friend overload.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">template</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">typename</span><span class="token plain"> </span><span class="token class-name">Sink</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">friend</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">AbslStringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Sink</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> sink</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> Point</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> point</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    absl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">Format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">sink</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;(%d, %d)&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> point</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> point</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">y</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> x</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> y</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// If you can&#x27;t declare the function in the class it&#x27;s important that the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// AbslStringify overload is defined in the SAME namespace that defines Point.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// C++&#x27;s look-up rules rely on that.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">enum</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">EnumWithStringify</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> kMany </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> kChoices </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">template</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">typename</span><span class="token plain"> </span><span class="token class-name">Sink</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">void</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">AbslStringify</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Sink</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> sink</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> EnumWithStringify e</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  absl</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">Format</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain">sink</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;%s&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> e </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> EnumWithStringify</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">kMany </span><span class="token operator" style="color:#393A34">?</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Many&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Choices&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// namespace foo</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>Note: <code>AbslStringify()</code> utilizes a generic &quot;sink&quot; buffer to construct its
string. For more information about supported operations on <code>AbslStringify()</code>&#x27;s
sink, see
<a href="https://abseil.io/docs/cpp/guides/abslstringify" target="_blank" rel="noopener noreferrer" class="">the <code>AbslStringify()</code> documentation</a>.</p></div></div>
<p><code>AbslStringify()</code> can also use <code>absl::StrFormat</code>&#x27;s catch-all <code>%v</code> type specifier
within its own format strings to perform type deduction. <code>Point</code> above could be
formatted as <code>&quot;(%v, %v)&quot;</code> for example, and deduce the <code>int</code> values as <code>%d</code>.</p>
<p>Sometimes, <code>AbslStringify()</code> might not be an option: your team may wish to print
types with extra debugging information for testing purposes only. If so, you can
instead define a <code>PrintTo()</code> function like this:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">#include &lt;ostream&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace foo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Point {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  friend void PrintTo(const Point&amp; point, std::ostream* os) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    *os &lt;&lt; &quot;(&quot; &lt;&lt; point.x &lt;&lt; &quot;,&quot; &lt;&lt; point.y &lt;&lt; &quot;)&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int x;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int y;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// If you can&#x27;t declare the function in the class it&#x27;s important that PrintTo()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// is defined in the SAME namespace that defines Point.  C++&#x27;s look-up rules</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// rely on that.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void PrintTo(const Point&amp; point, std::ostream* os) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    *os &lt;&lt; &quot;(&quot; &lt;&lt; point.x &lt;&lt; &quot;,&quot; &lt;&lt; point.y &lt;&lt; &quot;)&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}  // namespace foo</span><br></span></code></pre></div></div>
<p>If you have defined both <code>AbslStringify()</code> and <code>PrintTo()</code>, the latter will be
used by GoogleTest. This allows you to customize how the value appears in
GoogleTest&#x27;s output without affecting code that relies on the behavior of
<code>AbslStringify()</code>.</p>
<p>If you have an existing <code>&lt;&lt;</code> operator and would like to define an
<code>AbslStringify()</code>, the latter will be used for GoogleTest printing.</p>
<p>If you want to print a value <code>x</code> using GoogleTest&#x27;s value printer yourself, just
call <code>::testing::PrintToString(x)</code>, which returns an <code>std::string</code>:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">vector&lt;pair&lt;Point, int&gt; &gt; point_ints = GetPointIntVector();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPECT_TRUE(IsCorrectPointIntVector(point_ints))</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;&lt; &quot;point_ints = &quot; &lt;&lt; testing::PrintToString(point_ints);</span><br></span></code></pre></div></div>
<p>For more details regarding <code>AbslStringify()</code> and its integration with other
libraries, see
<a href="https://abseil.io/docs/cpp/guides/abslstringify" target="_blank" rel="noopener noreferrer" class="">the documentation</a>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="regular-expression-syntax">Regular Expression Syntax<a href="#regular-expression-syntax" class="hash-link" aria-label="Regular Expression Syntax的直接链接" title="Regular Expression Syntax的直接链接" translate="no">​</a></h2>
<p>When built with Bazel and using Abseil, GoogleTest uses the
<a href="https://github.com/google/re2/wiki/Syntax" target="_blank" rel="noopener noreferrer" class="">RE2</a> syntax. Otherwise, for POSIX
systems (Linux, Cygwin, Mac), GoogleTest uses the
<a href="https://pubs.opengroup.org/onlinepubs/009695399/basedefs/xbd_chap09.html#tag_09_04" target="_blank" rel="noopener noreferrer" class="">POSIX extended regular expression</a>
syntax. To learn about POSIX syntax, you may want to read this
<a href="https://en.wikipedia.org/wiki/Regular_expression#POSIX_extended" target="_blank" rel="noopener noreferrer" class="">Wikipedia entry</a>.</p>
<p>On Windows, GoogleTest uses its own simple regular expression implementation. It
lacks many features. For example, we don&#x27;t support union (<code>&quot;x|y&quot;</code>), grouping
(<code>&quot;(xy)&quot;</code>), brackets (<code>&quot;[xy]&quot;</code>), and repetition count (<code>&quot;x{5,7}&quot;</code>), among
others. Below is what we do support (<code>A</code> denotes a literal character, period
(<code>.</code>), or a single <code>\\ </code> escape sequence; <code>x</code> and <code>y</code> denote regular
expressions.):</p>
<table><thead><tr><th>Expression</th><th>Meaning</th></tr></thead><tbody><tr><td><code>c</code></td><td>matches any literal character <code>c</code></td></tr><tr><td><code>\\d</code></td><td>matches any decimal digit</td></tr><tr><td><code>\\D</code></td><td>matches any character that&#x27;s not a decimal digit</td></tr><tr><td><code>\\f</code></td><td>matches <code>\f</code></td></tr><tr><td><code>\\n</code></td><td>matches <code>\n</code></td></tr><tr><td><code>\\r</code></td><td>matches <code>\r</code></td></tr><tr><td><code>\\s</code></td><td>matches any ASCII whitespace, including <code>\n</code></td></tr><tr><td><code>\\S</code></td><td>matches any character that&#x27;s not a whitespace</td></tr><tr><td><code>\\t</code></td><td>matches <code>\t</code></td></tr><tr><td><code>\\v</code></td><td>matches <code>\v</code></td></tr><tr><td><code>\\w</code></td><td>matches any letter, <code>_</code>, or decimal digit</td></tr><tr><td><code>\\W</code></td><td>matches any character that <code>\\w</code> doesn&#x27;t match</td></tr><tr><td><code>\\c</code></td><td>matches any literal character <code>c</code>, which must be a punctuation</td></tr><tr><td><code>.</code></td><td>matches any single character except <code>\n</code></td></tr><tr><td><code>A?</code></td><td>matches 0 or 1 occurrences of <code>A</code></td></tr><tr><td><code>A*</code></td><td>matches 0 or many occurrences of <code>A</code></td></tr><tr><td><code>A+</code></td><td>matches 1 or many occurrences of <code>A</code></td></tr><tr><td><code>^</code></td><td>matches the beginning of a string (not that of each line)</td></tr><tr><td><code>$</code></td><td>matches the end of a string (not that of each line)</td></tr><tr><td><code>xy</code></td><td>matches <code>x</code> followed by <code>y</code></td></tr></tbody></table>
<p>To help you determine which capability is available on your system, GoogleTest
defines macros to govern which regular expression it is using. The macros are:
<code>GTEST_USES_SIMPLE_RE=1</code> or <code>GTEST_USES_POSIX_RE=1</code>. If you want your death
tests to work in all cases, you can either <code>#if</code> on these macros or use the more
limited syntax only.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="death-tests">Death Tests<a href="#death-tests" class="hash-link" aria-label="Death Tests的直接链接" title="Death Tests的直接链接" translate="no">​</a></h2>
<p>In many applications, there are assertions that can cause application failure if
a condition is not met. These consistency checks, which ensure that the program
is in a known good state, are there to fail at the earliest possible time after
some program state is corrupted. If the assertion checks the wrong condition,
then the program may proceed in an erroneous state, which could lead to memory
corruption, security holes, or worse. Hence it is vitally important to test that
such assertion statements work as expected.</p>
<p>Since these precondition checks cause the processes to die, we call such tests
<em>death tests</em>. More generally, any test that checks that a program terminates
(except by throwing an exception) in an expected fashion is also a death test.</p>
<p>Note that if a piece of code throws an exception, we don&#x27;t consider it &quot;death&quot;
for the purpose of death tests, as the caller of the code could catch the
exception and avoid the crash. If you want to verify exceptions thrown by your
code, see <a href="#exception-assertions" class="">Exception Assertions</a>.</p>
<p>If you want to test <code>EXPECT_*()/ASSERT_*()</code> failures in your test code, see
<a href="#catching-failures" class="">&quot;Catching&quot; Failures</a>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-write-a-death-test">How to Write a Death Test<a href="#how-to-write-a-death-test" class="hash-link" aria-label="How to Write a Death Test的直接链接" title="How to Write a Death Test的直接链接" translate="no">​</a></h3>
<p>GoogleTest provides assertion macros to support death tests. See
<a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/assertions#death">Death Assertions</a> in the Assertions Reference
for details.</p>
<p>To write a death test, simply use one of the macros inside your test function.
For example,</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TEST(MyDeathTest, Foo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // This death test uses a compound statement.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ASSERT_DEATH({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    int n = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    Foo(&amp;n);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }, &quot;Error on line .* of Foo()&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST(MyDeathTest, NormalExit) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  EXPECT_EXIT(NormalExit(), testing::ExitedWithCode(0), &quot;Success&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST(MyDeathTest, KillProcess) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  EXPECT_EXIT(KillProcess(), testing::KilledBySignal(SIGKILL),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              &quot;Sending myself unblockable signal&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>verifies that:</p>
<ul>
<li class="">calling <code>Foo(5)</code> causes the process to die with the given error message,</li>
<li class="">calling <code>NormalExit()</code> causes the process to print <code>&quot;Success&quot;</code> to stderr and
exit with exit code 0, and</li>
<li class="">calling <code>KillProcess()</code> kills the process with signal <code>SIGKILL</code>.</li>
</ul>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>Warning: If your death test contains mocks and is expecting a specific exit
code, then you must allow the mock objects to be leaked via <code>Mock::AllowLeak</code>.
This is because the mock leak detector will exit with its own error code if it
detects a leak.</p></div></div>
<p>The test function body may contain other assertions and statements as well, if
necessary.</p>
<p>Note that a death test only cares about three things:</p>
<ol>
<li class="">does <code>statement</code> abort or exit the process?</li>
<li class="">(in the case of <code>ASSERT_EXIT</code> and <code>EXPECT_EXIT</code>) does the exit status
satisfy <code>predicate</code>? Or (in the case of <code>ASSERT_DEATH</code> and <code>EXPECT_DEATH</code>)
is the exit status non-zero? And</li>
<li class="">does the stderr output match <code>matcher</code>?</li>
</ol>
<p>In particular, if <code>statement</code> generates an <code>ASSERT_*</code> or <code>EXPECT_*</code> failure, it
will <strong>not</strong> cause the death test to fail, as GoogleTest assertions don&#x27;t abort
the process.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="death-test-naming">Death Test Naming<a href="#death-test-naming" class="hash-link" aria-label="Death Test Naming的直接链接" title="Death Test Naming的直接链接" translate="no">​</a></h3>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>IMPORTANT: We strongly recommend you to follow the convention of naming your
<strong>test suite</strong> (not test) <code>*DeathTest</code> when it contains a death test, as
demonstrated in the above example. The
<a href="#death-tests-and-threads" class="">Death Tests And Threads</a> section below explains why.</p></div></div>
<p>If a test fixture class is shared by normal tests and death tests, you can use
<code>using</code> or <code>typedef</code> to introduce an alias for the fixture class and avoid
duplicating its code:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class FooTest : public testing::Test { ... };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">using FooDeathTest = FooTest;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST_F(FooTest, DoesThis) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // normal test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST_F(FooDeathTest, DoesThat) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // death test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-it-works">How It Works<a href="#how-it-works" class="hash-link" aria-label="How It Works的直接链接" title="How It Works的直接链接" translate="no">​</a></h3>
<p>See <a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/assertions#death">Death Assertions</a> in the Assertions
Reference.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="death-tests-and-threads">Death Tests And Threads<a href="#death-tests-and-threads" class="hash-link" aria-label="Death Tests And Threads的直接链接" title="Death Tests And Threads的直接链接" translate="no">​</a></h3>
<p>The reason for the two death test styles has to do with thread safety. Due to
well-known problems with forking in the presence of threads, death tests should
be run in a single-threaded context. Sometimes, however, it isn&#x27;t feasible to
arrange that kind of environment. For example, statically-initialized modules
may start threads before main is ever reached. Once threads have been created,
it may be difficult or impossible to clean them up.</p>
<p>GoogleTest has three features intended to raise awareness of threading issues.</p>
<ol>
<li class="">A warning is emitted if multiple threads are running when a death test is
encountered.</li>
<li class="">Test suites with a name ending in &quot;DeathTest&quot; are run before all other
tests.</li>
<li class="">It uses <code>clone()</code> instead of <code>fork()</code> to spawn the child process on Linux
(<code>clone()</code> is not available on Cygwin and Mac), as <code>fork()</code> is more likely
to cause the child to hang when the parent process has multiple threads.</li>
</ol>
<p>It&#x27;s perfectly fine to create threads inside a death test statement; they are
executed in a separate process and cannot affect the parent.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="death-test-styles">Death Test Styles<a href="#death-test-styles" class="hash-link" aria-label="Death Test Styles的直接链接" title="Death Test Styles的直接链接" translate="no">​</a></h3>
<p>The &quot;threadsafe&quot; death test style was introduced in order to help mitigate the
risks of testing in a possibly multithreaded environment. It trades increased
test execution time (potentially dramatically so) for improved thread safety.</p>
<p>The automated testing framework does not set the style flag. You can choose a
particular style of death tests by setting the flag programmatically:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GTEST_FLAG_SET(death_test_style, &quot;threadsafe&quot;);</span><br></span></code></pre></div></div>
<p>You can do this in <code>main()</code> to set the style for all death tests in the binary,
or in individual tests. Recall that flags are saved before running each test and
restored afterwards, so you need not do that yourself. For example:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int main(int argc, char** argv) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  testing::InitGoogleTest(&amp;argc, argv);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  GTEST_FLAG_SET(death_test_style, &quot;fast&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return RUN_ALL_TESTS();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST(MyDeathTest, TestOne) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  GTEST_FLAG_SET(death_test_style, &quot;threadsafe&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // This test is run in the &quot;threadsafe&quot; style:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ASSERT_DEATH(ThisShouldDie(), &quot;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST(MyDeathTest, TestTwo) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // This test is run in the &quot;fast&quot; style:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ASSERT_DEATH(ThisShouldDie(), &quot;&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="caveats">Caveats<a href="#caveats" class="hash-link" aria-label="Caveats的直接链接" title="Caveats的直接链接" translate="no">​</a></h3>
<p>The <code>statement</code> argument of <code>ASSERT_EXIT()</code> can be any valid C++ statement. If
it leaves the current function via a <code>return</code> statement or by throwing an
exception, the death test is considered to have failed. Some GoogleTest macros
may return from the current function (e.g. <code>ASSERT_TRUE()</code>), so be sure to avoid
them in <code>statement</code>.</p>
<p>Since <code>statement</code> runs in the child process, any in-memory side effect (e.g.
modifying a variable, releasing memory, etc) it causes will <em>not</em> be observable
in the parent process. In particular, if you release memory in a death test,
your program will fail the heap check as the parent process will never see the
memory reclaimed. To solve this problem, you can</p>
<ol>
<li class="">try not to free memory in a death test;</li>
<li class="">free the memory again in the parent process; or</li>
<li class="">do not use the heap checker in your program.</li>
</ol>
<p>Due to an implementation detail, you cannot place multiple death test assertions
on the same line; otherwise, compilation will fail with an unobvious error
message.</p>
<p>Despite the improved thread safety afforded by the &quot;threadsafe&quot; style of death
test, thread problems such as deadlock are still possible in the presence of
handlers registered with <code>pthread_atfork(3)</code>.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-assertions-in-sub-routines">Using Assertions in Sub-routines<a href="#using-assertions-in-sub-routines" class="hash-link" aria-label="Using Assertions in Sub-routines的直接链接" title="Using Assertions in Sub-routines的直接链接" translate="no">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>Note: If you want to put a series of test assertions in a subroutine to check
for a complex condition, consider using
<a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/gmock_cook_book#NewMatchers">a custom GMock matcher</a> instead. This lets you
provide a more readable error message in case of failure and avoid all of the
issues described below.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="adding-traces-to-assertions">Adding Traces to Assertions<a href="#adding-traces-to-assertions" class="hash-link" aria-label="Adding Traces to Assertions的直接链接" title="Adding Traces to Assertions的直接链接" translate="no">​</a></h3>
<p>If a test sub-routine is called from several places, when an assertion inside it
fails, it can be hard to tell which invocation of the sub-routine the failure is
from. You can alleviate this problem using extra logging or custom failure
messages, but that usually clutters up your tests. A better solution is to use
the <code>SCOPED_TRACE</code> macro or the <code>ScopedTrace</code> utility:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">SCOPED_TRACE(message);</span><br></span></code></pre></div></div>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ScopedTrace trace(&quot;file_path&quot;, line_number, message);</span><br></span></code></pre></div></div>
<p>where <code>message</code> can be anything streamable to <code>std::ostream</code>. <code>SCOPED_TRACE</code>
macro will cause the current file name, line number, and the given message to be
added in every failure message. <code>ScopedTrace</code> accepts explicit file name and
line number in arguments, which is useful for writing test helpers. The effect
will be undone when the control leaves the current lexical scope.</p>
<p>For example,</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">10: void Sub1(int n) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">11:   EXPECT_EQ(Bar(n), 1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">12:   EXPECT_EQ(Bar(n + 1), 2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">13: }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">14:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">15: TEST(FooTest, Bar) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">16:   {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">17:     SCOPED_TRACE(&quot;A&quot;);  // This trace point will be included in</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">18:                         // every failure in this scope.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">19:     Sub1(1);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">20:   }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">21:   // Now it won&#x27;t.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">22:   Sub1(9);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">23: }</span><br></span></code></pre></div></div>
<p>could result in messages like these:</p>
<div class="language-none codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-none codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">path/to/foo_test.cc:11: Failure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Value of: Bar(n)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Expected: 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Actual: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Google Test trace:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path/to/foo_test.cc:17: A</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">path/to/foo_test.cc:12: Failure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Value of: Bar(n + 1)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Expected: 2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Actual: 3</span><br></span></code></pre></div></div>
<p>Without the trace, it would&#x27;ve been difficult to know which invocation of
<code>Sub1()</code> the two failures come from respectively. (You could add an extra
message to each assertion in <code>Sub1()</code> to indicate the value of <code>n</code>, but that&#x27;s
tedious.)</p>
<p>Some tips on using <code>SCOPED_TRACE</code>:</p>
<ol>
<li class="">With a suitable message, it&#x27;s often enough to use <code>SCOPED_TRACE</code> at the
beginning of a sub-routine, instead of at each call site.</li>
<li class="">When calling sub-routines inside a loop, make the loop iterator part of the
message in <code>SCOPED_TRACE</code> such that you can know which iteration the failure
is from.</li>
<li class="">Sometimes the line number of the trace point is enough for identifying the
particular invocation of a sub-routine. In this case, you don&#x27;t have to
choose a unique message for <code>SCOPED_TRACE</code>. You can simply use <code>&quot;&quot;</code>.</li>
<li class="">You can use <code>SCOPED_TRACE</code> in an inner scope when there is one in the outer
scope. In this case, all active trace points will be included in the failure
messages, in reverse order they are encountered.</li>
<li class="">The trace dump is clickable in Emacs - hit <code>return</code> on a line number and
you&#x27;ll be taken to that line in the source file!</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="propagating-fatal-failures">Propagating Fatal Failures<a href="#propagating-fatal-failures" class="hash-link" aria-label="Propagating Fatal Failures的直接链接" title="Propagating Fatal Failures的直接链接" translate="no">​</a></h3>
<p>A common pitfall when using <code>ASSERT_*</code> and <code>FAIL*</code> is not understanding that
when they fail they only abort the <em>current function</em>, not the entire test. For
example, the following test will segfault:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">void Subroutine() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Generates a fatal failure and aborts the current function.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ASSERT_EQ(1, 2);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The following won&#x27;t be executed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST(FooTest, Bar) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Subroutine();  // The intended behavior is for the fatal failure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                 // in Subroutine() to abort the entire test.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The actual behavior: the function goes on after Subroutine() returns.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int* p = nullptr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  *p = 3;  // Segfault!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>To alleviate this, GoogleTest provides three different solutions. You could use
either exceptions, the <code>(ASSERT|EXPECT)_NO_FATAL_FAILURE</code> assertions or the
<code>HasFatalFailure()</code> function. They are described in the following two
subsections.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="asserting-on-subroutines-with-an-exception">Asserting on Subroutines with an exception<a href="#asserting-on-subroutines-with-an-exception" class="hash-link" aria-label="Asserting on Subroutines with an exception的直接链接" title="Asserting on Subroutines with an exception的直接链接" translate="no">​</a></h4>
<p>The following code can turn ASSERT-failure into an exception:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class ThrowListener : public testing::EmptyTestEventListener {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void OnTestPartResult(const testing::TestPartResult&amp; result) override {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    if (result.type() == testing::TestPartResult::kFatalFailure) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      throw testing::AssertionException(result);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int main(int argc, char** argv) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  testing::UnitTest::GetInstance()-&gt;listeners().Append(new ThrowListener);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return RUN_ALL_TESTS();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>This listener should be added after other listeners if you have any, otherwise
they won&#x27;t see failed <code>OnTestPartResult</code>.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="asserting-on-subroutines">Asserting on Subroutines<a href="#asserting-on-subroutines" class="hash-link" aria-label="Asserting on Subroutines的直接链接" title="Asserting on Subroutines的直接链接" translate="no">​</a></h4>
<p>As shown above, if your test calls a subroutine that has an <code>ASSERT_*</code> failure
in it, the test will continue after the subroutine returns. This may not be what
you want.</p>
<p>Often people want fatal failures to propagate like exceptions. For that
GoogleTest offers the following macros:</p>
<table><thead><tr><th>Fatal assertion</th><th>Nonfatal assertion</th><th>Verifies</th></tr></thead><tbody><tr><td><code>ASSERT_NO_FATAL_FAILURE(statement);</code></td><td><code>EXPECT_NO_FATAL_FAILURE(statement);</code></td><td><code>statement</code> doesn&#x27;t generate any new fatal failures in the current thread.</td></tr></tbody></table>
<p>Only failures in the thread that executes the assertion are checked to determine
the result of this type of assertions. If <code>statement</code> creates new threads,
failures in these threads are ignored.</p>
<p>Examples:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ASSERT_NO_FATAL_FAILURE(Foo());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int i;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">EXPECT_NO_FATAL_FAILURE({</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  i = Bar();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">});</span><br></span></code></pre></div></div>
<p>Assertions from multiple threads are currently not supported on Windows.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="checking-for-failures-in-the-current-test">Checking for Failures in the Current Test<a href="#checking-for-failures-in-the-current-test" class="hash-link" aria-label="Checking for Failures in the Current Test的直接链接" title="Checking for Failures in the Current Test的直接链接" translate="no">​</a></h4>
<p><code>HasFatalFailure()</code> in the <code>::testing::Test</code> class returns <code>true</code> if an
assertion in the current test has suffered a fatal failure. This allows
functions to catch fatal failures in a sub-routine and return early.</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Test {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static bool HasFatalFailure();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre></div></div>
<p>The typical usage, which basically simulates the behavior of a thrown exception,
is:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TEST(FooTest, Bar) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Subroutine();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Aborts if Subroutine() had a fatal failure.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  if (HasFatalFailure()) return;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // The following won&#x27;t be executed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>If <code>HasFatalFailure()</code> is used outside of <code>TEST()</code> , <code>TEST_F()</code> , or a test
fixture, you must add the <code>::testing::Test::</code> prefix, as in:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">if (testing::Test::HasFatalFailure()) return;</span><br></span></code></pre></div></div>
<p>Similarly, <code>HasNonfatalFailure()</code> returns <code>true</code> if the current test has at
least one non-fatal failure, and <code>HasFailure()</code> returns <code>true</code> if the current
test has at least one failure of either kind.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="logging-additional-information">Logging Additional Information<a href="#logging-additional-information" class="hash-link" aria-label="Logging Additional Information的直接链接" title="Logging Additional Information的直接链接" translate="no">​</a></h2>
<p>In your test code, you can call <code>RecordProperty(&quot;key&quot;, value)</code> to log additional
information, where <code>value</code> can be either a string or an <code>int</code>. The <em>last</em> value
recorded for a key will be emitted to the
<a href="#generating-an-xml-report" class="">XML output</a> if you specify one. For example, the
test</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TEST_F(WidgetUsageTest, MinAndMaxWidgets) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RecordProperty(&quot;MaximumWidgets&quot;, ComputeMaxUsage());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RecordProperty(&quot;MinimumWidgets&quot;, ComputeMinUsage());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>will output XML like this:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">testcase</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">MinAndMaxWidgets</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">file</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">test.cpp</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">line</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">1</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">status</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">run</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">time</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0.006</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">classname</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">WidgetUsageTest</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">MaximumWidgets</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">12</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">MinimumWidgets</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">9</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><blockquote>
<p>NOTE:</p>
<ul>
<li class=""><code>RecordProperty()</code> is a static member of the <code>Test</code> class. Therefore it
needs to be prefixed with <code>::testing::Test::</code> if used outside of the
<code>TEST</code> body and the test fixture class.</li>
<li class=""><em><code>key</code></em> must be a valid XML attribute name, and cannot conflict with the
ones already used by GoogleTest (<code>name</code>, <code>status</code>, <code>time</code>, <code>classname</code>,
<code>type_param</code>, and <code>value_param</code>).</li>
<li class="">Calling <code>RecordProperty()</code> outside of the lifespan of a test is allowed.
If it&#x27;s called outside of a test but between a test suite&#x27;s
<code>SetUpTestSuite()</code> and <code>TearDownTestSuite()</code> methods, it will be
attributed to the XML element for the test suite. If it&#x27;s called outside
of all test suites (e.g. in a test environment), it will be attributed to
the top-level XML element.</li>
</ul>
</blockquote></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="sharing-resources-between-tests-in-the-same-test-suite">Sharing Resources Between Tests in the Same Test Suite<a href="#sharing-resources-between-tests-in-the-same-test-suite" class="hash-link" aria-label="Sharing Resources Between Tests in the Same Test Suite的直接链接" title="Sharing Resources Between Tests in the Same Test Suite的直接链接" translate="no">​</a></h2>
<p>GoogleTest creates a new test fixture object for each test in order to make
tests independent and easier to debug. However, sometimes tests use resources
that are expensive to set up, making the one-copy-per-test model prohibitively
expensive.</p>
<p>If the tests don&#x27;t change the resource, there&#x27;s no harm in their sharing a
single resource copy. So, in addition to per-test set-up/tear-down, GoogleTest
also supports per-test-suite set-up/tear-down. To use it:</p>
<ol>
<li class="">In your test fixture class (say <code>FooTest</code> ), declare as <code>static</code> some member
variables to hold the shared resources.</li>
<li class="">Outside your test fixture class (typically just below it), define those
member variables, optionally giving them initial values.</li>
<li class="">In the same test fixture class, define a public member function <code>static void SetUpTestSuite()</code> (remember not to spell it as <strong><code>SetupTestSuite</code></strong> with a
small <code>u</code>!) to set up the shared resources and a <code>static void TearDownTestSuite()</code> function to tear them down.</li>
</ol>
<p>That&#x27;s it! GoogleTest automatically calls <code>SetUpTestSuite()</code> before running the
<em>first test</em> in the <code>FooTest</code> test suite (i.e. before creating the first
<code>FooTest</code> object), and calls <code>TearDownTestSuite()</code> after running the <em>last test</em>
in it (i.e. after deleting the last <code>FooTest</code> object). In between, the tests can
use the shared resources.</p>
<p>Remember that the test order is undefined, so your code can&#x27;t depend on a test
preceding or following another. Also, the tests must either not modify the state
of any shared resource, or, if they do modify the state, they must restore the
state to its original value before passing control to the next test.</p>
<p>Note that <code>SetUpTestSuite()</code> may be called multiple times for a test fixture
class that has derived classes, so you should not expect code in the function
body to be run only once. Also, derived classes still have access to shared
resources defined as static members, so careful consideration is needed when
managing shared resources to avoid memory leaks if shared resources are not
properly cleaned up in <code>TearDownTestSuite()</code>.</p>
<p>Here&#x27;s an example of per-test-suite set-up and tear-down:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class FooTest : public testing::Test {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> protected:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Per-test-suite set-up.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Called before the first test in this test suite.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Can be omitted if not needed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void SetUpTestSuite() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    shared_resource_ = new ...;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // If `shared_resource_` is **not deleted** in `TearDownTestSuite()`,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // reallocation should be prevented because `SetUpTestSuite()` may be called</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // in subclasses of FooTest and lead to memory leak.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // if (shared_resource_ == nullptr) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    //   shared_resource_ = new ...;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Per-test-suite tear-down.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Called after the last test in this test suite.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Can be omitted if not needed.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void TearDownTestSuite() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    delete shared_resource_;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    shared_resource_ = nullptr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // You can define per-test set-up logic as usual.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void SetUp() override { ... }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // You can define per-test tear-down logic as usual.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void TearDown() override { ... }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Some expensive resource shared by all tests.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static T* shared_resource_;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">T* FooTest::shared_resource_ = nullptr;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST_F(FooTest, Test1) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ... you can refer to shared_resource_ here ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST_F(FooTest, Test2) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ... you can refer to shared_resource_ here ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>NOTE: Though the above code declares <code>SetUpTestSuite()</code> protected, it may
sometimes be necessary to declare it public, such as when using it with
<code>TEST_P</code>.</p></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="global-set-up-and-tear-down">Global Set-Up and Tear-Down<a href="#global-set-up-and-tear-down" class="hash-link" aria-label="Global Set-Up and Tear-Down的直接链接" title="Global Set-Up and Tear-Down的直接链接" translate="no">​</a></h2>
<p>Just as you can do set-up and tear-down at the test level and the test suite
level, you can also do it at the test program level. Here&#x27;s how.</p>
<p>First, you subclass the <code>::testing::Environment</code> class to define a test
environment, which knows how to set-up and tear-down:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class Environment : public ::testing::Environment {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ~Environment() override {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Override this to define how to set up the environment.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void SetUp() override {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Override this to define how to tear down the environment.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void TearDown() override {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre></div></div>
<p>Then, you register an instance of your environment class with GoogleTest by
calling the <code>::testing::AddGlobalTestEnvironment()</code> function:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Environment* AddGlobalTestEnvironment(Environment* env);</span><br></span></code></pre></div></div>
<p>Now, when <code>RUN_ALL_TESTS()</code> is invoked, it first calls the <code>SetUp()</code> method. The
tests are then executed, provided that none of the environments have reported
fatal failures and <code>GTEST_SKIP()</code> has not been invoked. Finally, <code>TearDown()</code> is
called.</p>
<p>Note that <code>SetUp()</code> and <code>TearDown()</code> are only invoked if there is at least one
test to be performed. Importantly, <code>TearDown()</code> is executed even if the test is
not run due to a fatal failure or <code>GTEST_SKIP()</code>.</p>
<p>Calling <code>SetUp()</code> and <code>TearDown()</code> for each iteration depends on the flag
<code>gtest_recreate_environments_when_repeating</code>. <code>SetUp()</code> and <code>TearDown()</code> are
called for each environment object when the object is recreated for each
iteration. However, if test environments are not recreated for each iteration,
<code>SetUp()</code> is called only on the first iteration, and <code>TearDown()</code> is called only
on the last iteration.</p>
<p>It&#x27;s OK to register multiple environment objects. In this suite, their <code>SetUp()</code>
will be called in the order they are registered, and their <code>TearDown()</code> will be
called in the reverse order.</p>
<p>Note that GoogleTest takes ownership of the registered environment objects.
Therefore <strong>do not delete them</strong> by yourself.</p>
<p>You should call <code>AddGlobalTestEnvironment()</code> before <code>RUN_ALL_TESTS()</code> is called,
probably in <code>main()</code>. If you use <code>gtest_main</code>, you need to call this before
<code>main()</code> starts for it to take effect. One way to do this is to define a global
variable like this:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">testing::Environment* const foo_env =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    testing::AddGlobalTestEnvironment(new FooEnvironment);</span><br></span></code></pre></div></div>
<p>However, we strongly recommend you to write your own <code>main()</code> and call
<code>AddGlobalTestEnvironment()</code> there, as relying on initialization of global
variables makes the code harder to read and may cause problems when you register
multiple environments from different translation units and the environments have
dependencies among them (remember that the compiler doesn&#x27;t guarantee the order
in which global variables from different translation units are initialized).</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="value-parameterized-tests">Value-Parameterized Tests<a href="#value-parameterized-tests" class="hash-link" aria-label="Value-Parameterized Tests的直接链接" title="Value-Parameterized Tests的直接链接" translate="no">​</a></h2>
<p><em>Value-parameterized tests</em> allow you to test your code with different
parameters without writing multiple copies of the same test. This is useful in a
number of situations, for example:</p>
<ul>
<li class="">You have a piece of code whose behavior is affected by one or more
command-line flags. You want to make sure your code performs correctly for
various values of those flags.</li>
<li class="">You want to test different implementations of an OO interface.</li>
<li class="">You want to test your code over various inputs (a.k.a. data-driven testing).
This feature is easy to abuse, so please exercise your good sense when doing
it!</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-to-write-value-parameterized-tests">How to Write Value-Parameterized Tests<a href="#how-to-write-value-parameterized-tests" class="hash-link" aria-label="How to Write Value-Parameterized Tests的直接链接" title="How to Write Value-Parameterized Tests的直接链接" translate="no">​</a></h3>
<p>To write value-parameterized tests, first you should define a fixture class. It
must be derived from both <code>testing::Test</code> and <code>testing::WithParamInterface&lt;T&gt;</code>
(the latter is a pure interface), where <code>T</code> is the type of your parameter
values. For convenience, you can just derive the fixture class from
<code>testing::TestWithParam&lt;T&gt;</code>, which itself is derived from both <code>testing::Test</code>
and <code>testing::WithParamInterface&lt;T&gt;</code>. <code>T</code> can be any copyable type. If it&#x27;s a
raw pointer, you are responsible for managing the lifespan of the pointed
values.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>NOTE: If your test fixture defines <code>SetUpTestSuite()</code> or <code>TearDownTestSuite()</code>
they must be declared <strong>public</strong> rather than <strong>protected</strong> in order to use
<code>TEST_P</code>.</p></div></div>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class FooTest :</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    public testing::TestWithParam&lt;absl::string_view&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // You can implement all the usual fixture class members here.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // To access the test parameter, call GetParam() from class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // TestWithParam&lt;T&gt;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Or, when you want to add parameters to a pre-existing fixture class:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class BaseTest : public testing::Test {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class BarTest : public BaseTest,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                public testing::WithParamInterface&lt;absl::string_view&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre></div></div>
<p>Then, use the <code>TEST_P</code> macro to define as many test patterns using this fixture
as you want. The <code>_P</code> suffix is for &quot;parameterized&quot; or &quot;pattern&quot;, whichever you
prefer to think.</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TEST_P(FooTest, DoesBlah) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Inside a test, access the test parameter with the GetParam() method</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // of the TestWithParam&lt;T&gt; class:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  EXPECT_TRUE(foo.Blah(GetParam()));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST_P(FooTest, HasBlahBlah) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Finally, you can use the <code>INSTANTIATE_TEST_SUITE_P</code> macro to instantiate the
test suite with any set of parameters you want. GoogleTest defines a number of
functions for generating test parameters—see details at
<a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/testing#INSTANTIATE_TEST_SUITE_P"><code>INSTANTIATE_TEST_SUITE_P</code></a> in
the Testing Reference.</p>
<p>For example, the following statement will instantiate tests from the <code>FooTest</code>
test suite each with parameter values <code>&quot;meeny&quot;</code>, <code>&quot;miny&quot;</code>, and <code>&quot;moe&quot;</code> using the
<a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/testing#param-generators"><code>Values</code></a> parameter generator:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">INSTANTIATE_TEST_SUITE_P(MeenyMinyMoe,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         FooTest,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         testing::Values(&quot;meeny&quot;, &quot;miny&quot;, &quot;moe&quot;));</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>NOTE: The code above must be placed at global or namespace scope, not at
function scope.</p></div></div>
<p>The first argument to <code>INSTANTIATE_TEST_SUITE_P</code> is a unique name for the
instantiation of the test suite. The next argument is the name of the test
pattern, and the last is the
<a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/testing#param-generators">parameter generator</a>.</p>
<p>The parameter generator expression is not evaluated until GoogleTest is
initialized (via <code>InitGoogleTest()</code>). Any prior initialization done in the
<code>main</code> function will be accessible from the parameter generator, for example,
the results of flag parsing.</p>
<p>You can instantiate a test pattern more than once, so to distinguish different
instances of the pattern, the instantiation name is added as a prefix to the
actual test suite name. Remember to pick unique prefixes for different
instantiations. The tests from the instantiation above will have these names:</p>
<ul>
<li class=""><code>MeenyMinyMoe/FooTest.DoesBlah/0</code> for <code>&quot;meeny&quot;</code></li>
<li class=""><code>MeenyMinyMoe/FooTest.DoesBlah/1</code> for <code>&quot;miny&quot;</code></li>
<li class=""><code>MeenyMinyMoe/FooTest.DoesBlah/2</code> for <code>&quot;moe&quot;</code></li>
<li class=""><code>MeenyMinyMoe/FooTest.HasBlahBlah/0</code> for <code>&quot;meeny&quot;</code></li>
<li class=""><code>MeenyMinyMoe/FooTest.HasBlahBlah/1</code> for <code>&quot;miny&quot;</code></li>
<li class=""><code>MeenyMinyMoe/FooTest.HasBlahBlah/2</code> for <code>&quot;moe&quot;</code></li>
</ul>
<p>You can use these names in <a href="#running-a-subset-of-the-tests" class=""><code>--gtest_filter</code></a>.</p>
<p>The following statement will instantiate all tests from <code>FooTest</code> again, each
with parameter values <code>&quot;cat&quot;</code> and <code>&quot;dog&quot;</code> using the
<a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/testing#param-generators"><code>ValuesIn</code></a> parameter generator:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">constexpr absl::string_view kPets[] = {&quot;cat&quot;, &quot;dog&quot;};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INSTANTIATE_TEST_SUITE_P(Pets, FooTest, testing::ValuesIn(kPets));</span><br></span></code></pre></div></div>
<p>The tests from the instantiation above will have these names:</p>
<ul>
<li class=""><code>Pets/FooTest.DoesBlah/0</code> for <code>&quot;cat&quot;</code></li>
<li class=""><code>Pets/FooTest.DoesBlah/1</code> for <code>&quot;dog&quot;</code></li>
<li class=""><code>Pets/FooTest.HasBlahBlah/0</code> for <code>&quot;cat&quot;</code></li>
<li class=""><code>Pets/FooTest.HasBlahBlah/1</code> for <code>&quot;dog&quot;</code></li>
</ul>
<p>Please note that <code>INSTANTIATE_TEST_SUITE_P</code> will instantiate <em>all</em> tests in the
given test suite, whether their definitions come before or <em>after</em> the
<code>INSTANTIATE_TEST_SUITE_P</code> statement.</p>
<p>Additionally, by default, every <code>TEST_P</code> without a corresponding
<code>INSTANTIATE_TEST_SUITE_P</code> causes a failing test in test suite
<code>GoogleTestVerification</code>. If you have a test suite where that omission is not an
error, for example it is in a library that may be linked in for other reasons or
where the list of test cases is dynamic and may be empty, then this check can be
suppressed by tagging the test suite:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">GTEST_ALLOW_UNINSTANTIATED_PARAMETERIZED_TEST(FooTest);</span><br></span></code></pre></div></div>
<p>You can see <a href="https://github.com/google/googletest/blob/main/googletest/samples/sample7_unittest.cc" target="_blank" rel="noopener noreferrer" title="Parameterized Test example" class="">sample7_unittest.cc</a> and <a href="https://github.com/google/googletest/blob/main/googletest/samples/sample8_unittest.cc" target="_blank" rel="noopener noreferrer" title="Parameterized Test example with multiple parameters" class="">sample8_unittest.cc</a> for more examples.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="creating-value-parameterized-abstract-tests">Creating Value-Parameterized Abstract Tests<a href="#creating-value-parameterized-abstract-tests" class="hash-link" aria-label="Creating Value-Parameterized Abstract Tests的直接链接" title="Creating Value-Parameterized Abstract Tests的直接链接" translate="no">​</a></h3>
<p>In the above, we define and instantiate <code>FooTest</code> in the <em>same</em> source file.
Sometimes you may want to define value-parameterized tests in a library and let
other people instantiate them later. This pattern is known as <em>abstract tests</em>.
As an example of its application, when you are designing an interface you can
write a standard suite of abstract tests (perhaps using a factory function as
the test parameter) that all implementations of the interface are expected to
pass. When someone implements the interface, they can instantiate your suite to
get all the interface-conformance tests for free.</p>
<p>To define abstract tests, you should organize your code like this:</p>
<ol>
<li class="">Put the definition of the parameterized test fixture class (e.g. <code>FooTest</code>)
in a header file, say <code>foo_param_test.h</code>. Think of this as <em>declaring</em> your
abstract tests.</li>
<li class="">Put the <code>TEST_P</code> definitions in <code>foo_param_test.cc</code>, which includes
<code>foo_param_test.h</code>. Think of this as <em>implementing</em> your abstract tests.</li>
</ol>
<p>Once they are defined, you can instantiate them by including <code>foo_param_test.h</code>,
invoking <code>INSTANTIATE_TEST_SUITE_P()</code>, and depending on the library target that
contains <code>foo_param_test.cc</code>. You can instantiate the same abstract test suite
multiple times, possibly in different source files.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="specifying-names-for-value-parameterized-test-parameters">Specifying Names for Value-Parameterized Test Parameters<a href="#specifying-names-for-value-parameterized-test-parameters" class="hash-link" aria-label="Specifying Names for Value-Parameterized Test Parameters的直接链接" title="Specifying Names for Value-Parameterized Test Parameters的直接链接" translate="no">​</a></h3>
<p>The optional last argument to <code>INSTANTIATE_TEST_SUITE_P()</code> allows the user to
specify a function or functor that generates custom test name suffixes based on
the test parameters. The function should accept one argument of type
<code>testing::TestParamInfo&lt;class ParamType&gt;</code>, and return <code>std::string</code>.</p>
<p><code>testing::PrintToStringParamName</code> is a builtin test suffix generator that
returns the value of <code>testing::PrintToString(GetParam())</code>. It does not work for
<code>std::string</code> or C strings.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>NOTE: test names must be non-empty, unique, and may only contain ASCII
alphanumeric characters. In particular, they
<a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/faq#why-should-test-suite-names-and-test-names-not-contain-underscore">should not contain underscores</a></p></div></div>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class MyTestSuite : public testing::TestWithParam&lt;int&gt; {};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST_P(MyTestSuite, MyTest)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::cout &lt;&lt; &quot;Example Test Param: &quot; &lt;&lt; GetParam() &lt;&lt; std::endl;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INSTANTIATE_TEST_SUITE_P(MyGroup, MyTestSuite, testing::Range(0, 10),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                         testing::PrintToStringParamName());</span><br></span></code></pre></div></div>
<p>Providing a custom functor allows for more control over test parameter name
generation, especially for types where the automatic conversion does not
generate helpful parameter names (e.g. strings as demonstrated above). The
following example illustrates this for multiple parameters, an enumeration type
and a string, and also demonstrates how to combine generators. It uses a lambda
for conciseness:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">enum class MyType { MY_FOO = 0, MY_BAR = 1 };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class MyTestSuite : public testing::TestWithParam&lt;std::tuple&lt;MyType, std::string&gt;&gt; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INSTANTIATE_TEST_SUITE_P(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    MyGroup, MyTestSuite,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    testing::Combine(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        testing::Values(MyType::MY_FOO, MyType::MY_BAR),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        testing::Values(&quot;A&quot;, &quot;B&quot;)),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [](const testing::TestParamInfo&lt;MyTestSuite::ParamType&gt;&amp; info) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      std::string name = absl::StrCat(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          std::get&lt;0&gt;(info.param) == MyType::MY_FOO ? &quot;Foo&quot; : &quot;Bar&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          std::get&lt;1&gt;(info.param));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      absl::c_replace_if(name, [](char c) { return !std::isalnum(c); }, &#x27;_&#x27;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      return name;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    });</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="typed-tests">Typed Tests<a href="#typed-tests" class="hash-link" aria-label="Typed Tests的直接链接" title="Typed Tests的直接链接" translate="no">​</a></h2>
<p>Suppose you have multiple implementations of the same interface and want to make
sure that all of them satisfy some common requirements. Or, you may have defined
several types that are supposed to conform to the same &quot;concept&quot; and you want to
verify it. In both cases, you want the same test logic repeated for different
types.</p>
<p>While you can write one <code>TEST</code> or <code>TEST_F</code> for each type you want to test (and
you may even factor the test logic into a function template that you invoke from
the <code>TEST</code>), it&#x27;s tedious and doesn&#x27;t scale: if you want <code>m</code> tests over <code>n</code>
types, you&#x27;ll end up writing <code>m*n</code> <code>TEST</code>s.</p>
<p><em>Typed tests</em> allow you to repeat the same test logic over a list of types. You
only need to write the test logic once, although you must know the type list
when writing typed tests. Here&#x27;s how you do it:</p>
<p>First, define a fixture class template. It should be parameterized by a type.
Remember to derive it from <code>::testing::Test</code>:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">template &lt;typename T&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class FooTest : public testing::Test {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  using List = std::list&lt;T&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static T shared_;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  T value_;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre></div></div>
<p>Next, associate a list of types with the test suite, which will be repeated for
each type in the list:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using MyTypes = ::testing::Types&lt;char, int, unsigned int&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TYPED_TEST_SUITE(FooTest, MyTypes);</span><br></span></code></pre></div></div>
<p>The type alias (<code>using</code> or <code>typedef</code>) is necessary for the <code>TYPED_TEST_SUITE</code>
macro to parse correctly. Otherwise the compiler will think that each comma in
the type list introduces a new macro argument.</p>
<p>Then, use <code>TYPED_TEST()</code> instead of <code>TEST_F()</code> to define a typed test for this
test suite. You can repeat this as many times as you want:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TYPED_TEST(FooTest, DoesBlah) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Inside a test, refer to the special name TypeParam to get the type</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // parameter.  Since we are inside a derived class template, C++ requires</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // us to visit the members of FooTest via &#x27;this&#x27;.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TypeParam n = this-&gt;value_;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // To visit static members of the fixture, add the &#x27;TestFixture::&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // prefix.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  n += TestFixture::shared_;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // To refer to typedefs in the fixture, add the &#x27;typename TestFixture::&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // prefix.  The &#x27;typename&#x27; is required to satisfy the compiler.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  typename TestFixture::List values;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  values.push_back(n);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TYPED_TEST(FooTest, HasPropertyA) { ... }</span><br></span></code></pre></div></div>
<p>You can see <a href="https://github.com/google/googletest/blob/main/googletest/samples/sample6_unittest.cc" target="_blank" rel="noopener noreferrer" title="Typed Test example" class="">sample6_unittest.cc</a> for a complete example.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="type-parameterized-tests">Type-Parameterized Tests<a href="#type-parameterized-tests" class="hash-link" aria-label="Type-Parameterized Tests的直接链接" title="Type-Parameterized Tests的直接链接" translate="no">​</a></h2>
<p><em>Type-parameterized tests</em> are like typed tests, except that they don&#x27;t require
you to know the list of types ahead of time. Instead, you can define the test
logic first and instantiate it with different type lists later. You can even
instantiate it more than once in the same program.</p>
<p>If you are designing an interface or concept, you can define a suite of
type-parameterized tests to verify properties that any valid implementation of
the interface/concept should have. Then, the author of each implementation can
just instantiate the test suite with their type to verify that it conforms to
the requirements, without having to write similar tests repeatedly. Here&#x27;s an
example:</p>
<p>First, define a fixture class template, as we did with typed tests:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">template &lt;typename T&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class FooTest : public testing::Test {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void DoSomethingInteresting();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span></code></pre></div></div>
<p>Next, declare that you will define a type-parameterized test suite:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TYPED_TEST_SUITE_P(FooTest);</span><br></span></code></pre></div></div>
<p>Then, use <code>TYPED_TEST_P()</code> to define a type-parameterized test. You can repeat
this as many times as you want:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TYPED_TEST_P(FooTest, DoesBlah) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Inside a test, refer to TypeParam to get the type parameter.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TypeParam n = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // You will need to use `this` explicitly to refer to fixture members.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  this-&gt;DoSomethingInteresting()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TYPED_TEST_P(FooTest, HasPropertyA) { ... }</span><br></span></code></pre></div></div>
<p>Now the tricky part: you need to register all test patterns using the
<code>REGISTER_TYPED_TEST_SUITE_P</code> macro before you can instantiate them. The first
argument of the macro is the test suite name; the rest are the names of the
tests in this test suite:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">REGISTER_TYPED_TEST_SUITE_P(FooTest,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                            DoesBlah, HasPropertyA);</span><br></span></code></pre></div></div>
<p>Finally, you are free to instantiate the pattern with the types you want. If you
put the above code in a header file, you can <code>#include</code> it in multiple C++
source files and instantiate it multiple times.</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">using MyTypes = ::testing::Types&lt;char, int, unsigned int&gt;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">INSTANTIATE_TYPED_TEST_SUITE_P(My, FooTest, MyTypes);</span><br></span></code></pre></div></div>
<p>To distinguish different instances of the pattern, the first argument to the
<code>INSTANTIATE_TYPED_TEST_SUITE_P</code> macro is a prefix that will be added to the
actual test suite name. Remember to pick unique prefixes for different
instances.</p>
<p>In the special case where the type list contains only one type, you can write
that type directly without <code>::testing::Types&lt;...&gt;</code>, like this:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">INSTANTIATE_TYPED_TEST_SUITE_P(My, FooTest, int);</span><br></span></code></pre></div></div>
<p>You can see <a href="https://github.com/google/googletest/blob/main/googletest/samples/sample6_unittest.cc" target="_blank" rel="noopener noreferrer" title="Typed Test example" class="">sample6_unittest.cc</a> for a complete example.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="testing-private-code">Testing Private Code<a href="#testing-private-code" class="hash-link" aria-label="Testing Private Code的直接链接" title="Testing Private Code的直接链接" translate="no">​</a></h2>
<p>If you change your software&#x27;s internal implementation, your tests should not
break as long as the change is not observable by users. Therefore, <strong>per the
black-box testing principle, most of the time you should test your code through
its public interfaces.</strong></p>
<p><strong>If you still find yourself needing to test internal implementation code,
consider if there&#x27;s a better design.</strong> The desire to test internal
implementation is often a sign that the class is doing too much. Consider
extracting an implementation class, and testing it. Then use that implementation
class in the original class.</p>
<p>If you absolutely have to test non-public interface code though, you can. There
are two cases to consider:</p>
<ul>
<li class="">Static functions ( <em>not</em> the same as static member functions!) or unnamed
namespaces, and</li>
<li class="">Private or protected class members</li>
</ul>
<p>To test them, we use the following special techniques:</p>
<ul>
<li class="">Both static functions and definitions/declarations in an unnamed namespace
are only visible within the same translation unit. To test them, move the
private code into the <code>foo::internal</code> namespace, where <code>foo</code> is the
namespace your project normally uses, and put the private declarations in a
<code>*-internal.h</code> file. Your production <code>.cc</code> files and your tests are allowed
to include this internal header, but your clients are not. This way, you can
fully test your internal implementation without leaking it to your clients.</li>
</ul>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>NOTE: It is also technically <em>possible</em> to <code>#include</code> the entire <code>.cc</code> file
being tested in your <code>*_test.cc</code> file to test static functions and
definitions/declarations in an unnamed namespace. However, this technique is
<strong>not recommended</strong> by this documentation and it is only presented here for the
sake of completeness.</p></div></div>
<ul>
<li class="">
<p>Private class members are only accessible from within the class or by
friends. To access a class&#x27; private members, you can declare your test
fixture as a friend to the class and define accessors in your fixture. Tests
using the fixture can then access the private members of your production
class via the accessors in the fixture. Note that even though your fixture
is a friend to your production class, your tests are not automatically
friends to it, as they are technically defined in sub-classes of the
fixture.</p>
<p>Another way to test private members is to refactor them into an
implementation class, which is then declared in a <code>*-internal.h</code> file. Your
clients aren&#x27;t allowed to include this header but your tests can.</p>
<p>Or, you can declare an individual test as a friend of your class by adding
this line in the class body:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">    FRIEND_TEST(TestSuiteName, TestName);</span><br></span></code></pre></div></div>
<p>For example,</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// foo.h</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Foo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> private:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FRIEND_TEST(FooTest, BarReturnsZeroOnNull);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int Bar(void* x);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// foo_test.cc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST(FooTest, BarReturnsZeroOnNull) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Foo foo;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  EXPECT_EQ(foo.Bar(NULL), 0);  // Uses Foo&#x27;s private member Bar().</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>Pay special attention when your class is defined in a namespace. If you want
your test fixtures and tests to be friends of your class, then they must be
defined in the exact same namespace (no anonymous or inline namespaces).</p>
<p>For example, if the code to be tested looks like:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace my_namespace {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class Foo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  friend class FooTest;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FRIEND_TEST(FooTest, Bar);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FRIEND_TEST(FooTest, Baz);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ... definition of the class Foo ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}  // namespace my_namespace</span><br></span></code></pre></div></div>
<p>Your test code should be something like:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">namespace my_namespace {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class FooTest : public testing::Test {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> protected:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST_F(FooTest, Bar) { ... }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST_F(FooTest, Baz) { ... }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}  // namespace my_namespace</span><br></span></code></pre></div></div>
</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="catching-failures">&quot;Catching&quot; Failures<a href="#catching-failures" class="hash-link" aria-label="&quot;Catching&quot; Failures的直接链接" title="&quot;Catching&quot; Failures的直接链接" translate="no">​</a></h2>
<p>If you are building a testing utility on top of GoogleTest, you&#x27;ll want to test
your utility. What framework would you use to test it? GoogleTest, of course.</p>
<p>The challenge is to verify that your testing utility reports failures correctly.
In frameworks that report a failure by throwing an exception, you could catch
the exception and assert on it. But GoogleTest doesn&#x27;t use exceptions, so how do
we test that a piece of code generates an expected failure?</p>
<p><code>&quot;gtest/gtest-spi.h&quot;</code> contains some constructs to do this.
After #including this header, you can use</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  EXPECT_FATAL_FAILURE(statement, substring);</span><br></span></code></pre></div></div>
<p>to assert that <code>statement</code> generates a fatal (e.g. <code>ASSERT_*</code>) failure in the
current thread whose message contains the given <code>substring</code>, or use</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  EXPECT_NONFATAL_FAILURE(statement, substring);</span><br></span></code></pre></div></div>
<p>if you are expecting a non-fatal (e.g. <code>EXPECT_*</code>) failure.</p>
<p>Only failures in the current thread are checked to determine the result of this
type of expectations. If <code>statement</code> creates new threads, failures in these
threads are also ignored. If you want to catch failures in other threads as
well, use one of the following macros instead:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  EXPECT_FATAL_FAILURE_ON_ALL_THREADS(statement, substring);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  EXPECT_NONFATAL_FAILURE_ON_ALL_THREADS(statement, substring);</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>NOTE: Assertions from multiple threads are currently not supported on Windows.</p><p>For technical reasons, there are some caveats:</p><ol>
<li class="">
<p>You cannot stream a failure message to either macro.</p>
</li>
<li class="">
<p><code>statement</code> in <code>EXPECT_FATAL_FAILURE{_ON_ALL_THREADS}()</code> cannot reference
local non-static variables or non-static members of <code>this</code> object.</p>
</li>
<li class="">
<p><code>statement</code> in <code>EXPECT_FATAL_FAILURE{_ON_ALL_THREADS}()</code> cannot return a
value.</p>
</li>
</ol></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="registering-tests-programmatically">Registering tests programmatically<a href="#registering-tests-programmatically" class="hash-link" aria-label="Registering tests programmatically的直接链接" title="Registering tests programmatically的直接链接" translate="no">​</a></h2>
<p>The <code>TEST</code> macros handle the vast majority of all use cases, but there are few
where runtime registration logic is required. For those cases, the framework
provides the <code>::testing::RegisterTest</code> that allows callers to register arbitrary
tests dynamically.</p>
<p>This is an advanced API only to be used when the <code>TEST</code> macros are insufficient.
The macros should be preferred when possible, as they avoid most of the
complexity of calling this function.</p>
<p>It provides the following signature:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">template &lt;typename Factory&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TestInfo* RegisterTest(const char* test_suite_name, const char* test_name,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       const char* type_param, const char* value_param,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                       const char* file, int line, Factory factory);</span><br></span></code></pre></div></div>
<p>The <code>factory</code> argument is a factory callable (move-constructible) object or
function pointer that creates a new instance of the Test object. It handles
ownership to the caller. The signature of the callable is <code>Fixture*()</code>, where
<code>Fixture</code> is the test fixture class for the test. All tests registered with the
same <code>test_suite_name</code> must return the same fixture type. This is checked at
runtime.</p>
<p>The framework will infer the fixture class from the factory and will call the
<code>SetUpTestSuite</code> and <code>TearDownTestSuite</code> for it.</p>
<p>Must be called before <code>RUN_ALL_TESTS()</code> is invoked, otherwise behavior is
undefined.</p>
<p>Use case example:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">class MyFixture : public testing::Test {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // All of these optional, just like in regular macro usage.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void SetUpTestSuite() { ... }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  static void TearDownTestSuite() { ... }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void SetUp() override { ... }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void TearDown() override { ... }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class MyTest : public MyFixture {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> public:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  explicit MyTest(int data) : data_(data) {}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  void TestBody() override { ... }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> private:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int data_;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">};</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void RegisterMyTests(const std::vector&lt;int&gt;&amp; values) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  for (int v : values) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    testing::RegisterTest(</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;MyFixture&quot;, (&quot;Test&quot; + std::to_string(v)).c_str(), nullptr,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        std::to_string(v).c_str(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        __FILE__, __LINE__,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Important to use the fixture type as the return type here.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        [=]() -&gt; MyFixture* { return new MyTest(v); });</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">int main(int argc, char** argv) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  testing::InitGoogleTest(&amp;argc, argv);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  std::vector&lt;int&gt; values_to_test = LoadValuesFromConfig();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  RegisterMyTests(values_to_test);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return RUN_ALL_TESTS();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="getting-the-current-tests-name">Getting the Current Test&#x27;s Name<a href="#getting-the-current-tests-name" class="hash-link" aria-label="Getting the Current Test&#x27;s Name的直接链接" title="Getting the Current Test&#x27;s Name的直接链接" translate="no">​</a></h2>
<p>Sometimes a function may need to know the name of the currently running test.
For example, you may be using the <code>SetUp()</code> method of your test fixture to set
the golden file name based on which test is running. The
<a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/testing#TestInfo"><code>TestInfo</code></a> class has this information.</p>
<p>To obtain a <code>TestInfo</code> object for the currently running test, call
<code>current_test_info()</code> on the <a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/testing#UnitTest"><code>UnitTest</code></a>
singleton object:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  // Gets information about the currently running test.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Do NOT delete the returned object - it&#x27;s managed by the UnitTest class.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  const testing::TestInfo* const test_info =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      testing::UnitTest::GetInstance()-&gt;current_test_info();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  printf(&quot;We are in test %s of test suite %s.\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         test_info-&gt;name(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">         test_info-&gt;test_suite_name());</span><br></span></code></pre></div></div>
<p><code>current_test_info()</code> returns a null pointer if no test is running. In
particular, you cannot find the test suite name in <code>SetUpTestSuite()</code>,
<code>TearDownTestSuite()</code> (where you know the test suite name implicitly), or
functions called from them.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="extending-googletest-by-handling-test-events">Extending GoogleTest by Handling Test Events<a href="#extending-googletest-by-handling-test-events" class="hash-link" aria-label="Extending GoogleTest by Handling Test Events的直接链接" title="Extending GoogleTest by Handling Test Events的直接链接" translate="no">​</a></h2>
<p>GoogleTest provides an <strong>event listener API</strong> to let you receive notifications
about the progress of a test program and test failures. The events you can
listen to include the start and end of the test program, a test suite, or a test
method, among others. You may use this API to augment or replace the standard
console output, replace the XML output, or provide a completely different form
of output, such as a GUI or a database. You can also use test events as
checkpoints to implement a resource leak checker, for example.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="defining-event-listeners">Defining Event Listeners<a href="#defining-event-listeners" class="hash-link" aria-label="Defining Event Listeners的直接链接" title="Defining Event Listeners的直接链接" translate="no">​</a></h3>
<p>To define a event listener, you subclass either
<a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/testing#TestEventListener"><code>testing::TestEventListener</code></a> or
<a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/testing#EmptyTestEventListener"><code>testing::EmptyTestEventListener</code></a>
The former is an (abstract) interface, where <em>each pure virtual method can be
overridden to handle a test event</em> (For example, when a test starts, the
<code>OnTestStart()</code> method will be called.). The latter provides an empty
implementation of all methods in the interface, such that a subclass only needs
to override the methods it cares about.</p>
<p>When an event is fired, its context is passed to the handler function as an
argument. The following argument types are used:</p>
<ul>
<li class="">UnitTest reflects the state of the entire test program,</li>
<li class="">TestSuite has information about a test suite, which can contain one or more
tests,</li>
<li class="">TestInfo contains the state of a test, and</li>
<li class="">TestPartResult represents the result of a test assertion.</li>
</ul>
<p>An event handler function can examine the argument it receives to find out
interesting information about the event and the test program&#x27;s state.</p>
<p>Here&#x27;s an example:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  class MinimalistPrinter : public testing::EmptyTestEventListener {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Called before a test starts.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void OnTestStart(const testing::TestInfo&amp; test_info) override {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      printf(&quot;*** Test %s.%s starting.\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             test_info.test_suite_name(), test_info.name());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Called after a failed assertion or a SUCCESS().</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void OnTestPartResult(const testing::TestPartResult&amp; test_part_result) override {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      printf(&quot;%s in %s:%d\n%s\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             test_part_result.failed() ? &quot;*** Failure&quot; : &quot;Success&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             test_part_result.file_name(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             test_part_result.line_number(),</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             test_part_result.summary());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    // Called after a test ends.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    void OnTestEnd(const testing::TestInfo&amp; test_info) override {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      printf(&quot;*** Test %s.%s ending.\n&quot;,</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">             test_info.test_suite_name(), test_info.name());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  };</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="using-event-listeners">Using Event Listeners<a href="#using-event-listeners" class="hash-link" aria-label="Using Event Listeners的直接链接" title="Using Event Listeners的直接链接" translate="no">​</a></h3>
<p>To use the event listener you have defined, add an instance of it to the
GoogleTest event listener list (represented by class
<a class="" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/reference/testing#TestEventListeners"><code>TestEventListeners</code></a> - note the &quot;s&quot;
at the end of the name) in your <code>main()</code> function, before calling
<code>RUN_ALL_TESTS()</code>:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">int main(int argc, char** argv) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  testing::InitGoogleTest(&amp;argc, argv);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Gets hold of the event listener list.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  testing::TestEventListeners&amp; listeners =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      testing::UnitTest::GetInstance()-&gt;listeners();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  // Adds a listener to the end.  GoogleTest takes the ownership.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  listeners.Append(new MinimalistPrinter);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return RUN_ALL_TESTS();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>There&#x27;s only one problem: the default test result printer is still in effect, so
its output will mingle with the output from your minimalist printer. To suppress
the default printer, just release it from the event listener list and delete it.
You can do so by adding one line:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  delete listeners.Release(listeners.default_result_printer());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  listeners.Append(new MinimalistPrinter);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  return RUN_ALL_TESTS();</span><br></span></code></pre></div></div>
<p>Now, sit back and enjoy a completely different output from your tests. For more
details, see <a href="https://github.com/google/googletest/blob/main/googletest/samples/sample9_unittest.cc" target="_blank" rel="noopener noreferrer" title="Event listener example" class="">sample9_unittest.cc</a>.</p>
<p>You may append more than one listener to the list. When an <code>On*Start()</code> or
<code>OnTestPartResult()</code> event is fired, the listeners will receive it in the order
they appear in the list (since new listeners are added to the end of the list,
the default text printer and the default XML generator will receive the event
first). An <code>On*End()</code> event will be received by the listeners in the <em>reverse</em>
order. This allows output by listeners added later to be framed by output from
listeners added earlier.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="generating-failures-in-listeners">Generating Failures in Listeners<a href="#generating-failures-in-listeners" class="hash-link" aria-label="Generating Failures in Listeners的直接链接" title="Generating Failures in Listeners的直接链接" translate="no">​</a></h3>
<p>You may use failure-raising macros (<code>EXPECT_*()</code>, <code>ASSERT_*()</code>, <code>FAIL()</code>, etc)
when processing an event. There are some restrictions:</p>
<ol>
<li class="">You cannot generate any failure in <code>OnTestPartResult()</code> (otherwise it will
cause <code>OnTestPartResult()</code> to be called recursively).</li>
<li class="">A listener that handles <code>OnTestPartResult()</code> is not allowed to generate any
failure.</li>
</ol>
<p>When you add listeners to the listener list, you should put listeners that
handle <code>OnTestPartResult()</code> <em>before</em> listeners that can generate failures. This
ensures that failures generated by the latter are attributed to the right test
by the former.</p>
<p>See <a href="https://github.com/google/googletest/blob/main/googletest/samples/sample10_unittest.cc" target="_blank" rel="noopener noreferrer" title="Failure-raising listener example" class="">sample10_unittest.cc</a> for an example of a failure-raising listener.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-test-programs-advanced-options">Running Test Programs: Advanced Options<a href="#running-test-programs-advanced-options" class="hash-link" aria-label="Running Test Programs: Advanced Options的直接链接" title="Running Test Programs: Advanced Options的直接链接" translate="no">​</a></h2>
<p>GoogleTest test programs are ordinary executables. Once built, you can run them
directly and affect their behavior via the following environment variables
and/or command line flags. For the flags to work, your programs must call
<code>::testing::InitGoogleTest()</code> before calling <code>RUN_ALL_TESTS()</code>.</p>
<p>To see a list of supported flags and their usage, please run your test program
with the <code>--help</code> flag.</p>
<p>If an option is specified both by an environment variable and by a flag, the
latter takes precedence.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="selecting-tests">Selecting Tests<a href="#selecting-tests" class="hash-link" aria-label="Selecting Tests的直接链接" title="Selecting Tests的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="listing-test-names">Listing Test Names<a href="#listing-test-names" class="hash-link" aria-label="Listing Test Names的直接链接" title="Listing Test Names的直接链接" translate="no">​</a></h4>
<p>Sometimes it is necessary to list the available tests in a program before
running them so that a filter may be applied if needed. Including the flag
<code>--gtest_list_tests</code> overrides all other flags and lists tests in the following
format:</p>
<div class="language-none codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-none codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TestSuite1.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TestName1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TestName2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TestSuite2.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  TestName</span><br></span></code></pre></div></div>
<p>None of the tests listed are actually run if the flag is provided. There is no
corresponding environment variable for this flag.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="running-a-subset-of-the-tests">Running a Subset of the Tests<a href="#running-a-subset-of-the-tests" class="hash-link" aria-label="Running a Subset of the Tests的直接链接" title="Running a Subset of the Tests的直接链接" translate="no">​</a></h4>
<p>By default, a GoogleTest program runs all tests the user has defined. Sometimes,
you want to run only a subset of the tests (e.g. for debugging or quickly
verifying a change). If you set the <code>GTEST_FILTER</code> environment variable or the
<code>--gtest_filter</code> flag to a filter string, GoogleTest will only run the tests
whose full names (in the form of <code>TestSuiteName.TestName</code>) match the filter.</p>
<p>The format of a filter is a &#x27;<code>:</code>&#x27;-separated list of wildcard patterns (called
the <em>positive patterns</em>) optionally followed by a &#x27;<code>-</code>&#x27; and another
&#x27;<code>:</code>&#x27;-separated pattern list (called the <em>negative patterns</em>). A test matches
the filter if and only if it matches any of the positive patterns but does not
match any of the negative patterns.</p>
<p>A pattern may contain <code>&#x27;*&#x27;</code> (matches any string) or <code>&#x27;?&#x27;</code> (matches any single
character). For convenience, the filter <code>&#x27;*-NegativePatterns&#x27;</code> can be also
written as <code>&#x27;-NegativePatterns&#x27;</code>.</p>
<p>For example:</p>
<ul>
<li class=""><code>./foo_test</code> Has no flag, and thus runs all its tests.</li>
<li class=""><code>./foo_test --gtest_filter=*</code> Also runs everything, due to the single
match-everything <code>*</code> value.</li>
<li class=""><code>./foo_test --gtest_filter=FooTest.*</code> Runs everything in test suite
<code>FooTest</code> .</li>
<li class=""><code>./foo_test --gtest_filter=*Null*:*Constructor*</code> Runs any test whose full
name contains either <code>&quot;Null&quot;</code> or <code>&quot;Constructor&quot;</code> .</li>
<li class=""><code>./foo_test --gtest_filter=-*DeathTest.*</code> Runs all non-death tests.</li>
<li class=""><code>./foo_test --gtest_filter=FooTest.*-FooTest.Bar</code> Runs everything in test
suite <code>FooTest</code> except <code>FooTest.Bar</code>.</li>
<li class=""><code>./foo_test --gtest_filter=FooTest.*:BarTest.*-FooTest.Bar:BarTest.Foo</code> Runs
everything in test suite <code>FooTest</code> except <code>FooTest.Bar</code> and everything in
test suite <code>BarTest</code> except <code>BarTest.Foo</code>.</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="stop-test-execution-upon-first-failure">Stop test execution upon first failure<a href="#stop-test-execution-upon-first-failure" class="hash-link" aria-label="Stop test execution upon first failure的直接链接" title="Stop test execution upon first failure的直接链接" translate="no">​</a></h4>
<p>By default, a GoogleTest program runs all tests the user has defined. In some
cases (e.g. iterative test development &amp; execution) it may be desirable stop
test execution upon first failure (trading improved latency for completeness).
If <code>GTEST_FAIL_FAST</code> environment variable or <code>--gtest_fail_fast</code> flag is set,
the test runner will stop execution as soon as the first test failure is found.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="temporarily-disabling-tests">Temporarily Disabling Tests<a href="#temporarily-disabling-tests" class="hash-link" aria-label="Temporarily Disabling Tests的直接链接" title="Temporarily Disabling Tests的直接链接" translate="no">​</a></h4>
<p>If you have a broken test that you cannot fix right away, you can add the
<code>DISABLED_</code> prefix to its name. This will exclude it from execution. This is
better than commenting out the code or using <code>#if 0</code>, as disabled tests are
still compiled (and thus won&#x27;t rot).</p>
<p>If you need to disable all tests in a test suite, you can either add <code>DISABLED_</code>
to the front of the name of each test, or alternatively add it to the front of
the test suite name.</p>
<p>For example, the following tests won&#x27;t be run by GoogleTest, even though they
will still be compiled:</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">// Tests that Foo does Abc.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST(FooTest, DISABLED_DoesAbc) { ... }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">class DISABLED_BarTest : public testing::Test { ... };</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// Tests that Bar does Xyz.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST_F(DISABLED_BarTest, DoesXyz) { ... }</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>NOTE: This feature should only be used for temporary pain-relief. You still have
to fix the disabled tests at a later date. As a reminder, GoogleTest will print
a banner warning you if a test program contains any disabled tests.</p></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>信息</div><div class="admonitionContent_BuS1"><p>TIP: You can easily count the number of disabled tests you have using
<code>grep</code>. This number can be used as a metric for
improving your test quality.</p></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="temporarily-enabling-disabled-tests">Temporarily Enabling Disabled Tests<a href="#temporarily-enabling-disabled-tests" class="hash-link" aria-label="Temporarily Enabling Disabled Tests的直接链接" title="Temporarily Enabling Disabled Tests的直接链接" translate="no">​</a></h4>
<p>To include disabled tests in test execution, just invoke the test program with
the <code>--gtest_also_run_disabled_tests</code> flag or set the
<code>GTEST_ALSO_RUN_DISABLED_TESTS</code> environment variable to a value other than <code>0</code>.
You can combine this with the <code>--gtest_filter</code> flag to further select which
disabled tests to run.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="enforcing-having-at-least-one-test-case">Enforcing Having At Least One Test Case<a href="#enforcing-having-at-least-one-test-case" class="hash-link" aria-label="Enforcing Having At Least One Test Case的直接链接" title="Enforcing Having At Least One Test Case的直接链接" translate="no">​</a></h3>
<p>A not uncommon programmer mistake is to write a test program that has no test
case linked in. This can happen, for example, when you put test case definitions
in a library and the library is not marked as &quot;always link&quot;.</p>
<p>To catch such mistakes, run the test program with the
<code>--gtest_fail_if_no_test_linked</code> flag or set the <code>GTEST_FAIL_IF_NO_TEST_LINKED</code>
environment variable to a value other than <code>0</code>. Now the program will fail if no
test case is linked in.</p>
<p>Note that <em>any</em> test case linked in makes the program valid for the purpose of
this check. In particular, even a disabled test case suffices.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="enforcing-running-at-least-one-test-case">Enforcing Running At Least One Test Case<a href="#enforcing-running-at-least-one-test-case" class="hash-link" aria-label="Enforcing Running At Least One Test Case的直接链接" title="Enforcing Running At Least One Test Case的直接链接" translate="no">​</a></h3>
<p>In addition to enforcing that tests are defined in the binary with
<code>--gtest_fail_if_no_test_linked</code>, it is also possible to enforce that a test
case was actually executed to ensure that resources are not consumed by tests
that do nothing.</p>
<p>To catch such optimization opportunities, run the test program with the
<code>--gtest_fail_if_no_test_selected</code> flag or set the
<code>GTEST_FAIL_IF_NO_TEST_SELECTED</code> environment variable to a value other than <code>0</code>.</p>
<p>A test is considered selected if it begins to run, even if it is later skipped
via <code>GTEST_SKIP</code>. Thus, <code>DISABLED</code> tests do not count as selected and neither do
tests that are not matched by <code>--gtest_filter</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="repeating-the-tests">Repeating the Tests<a href="#repeating-the-tests" class="hash-link" aria-label="Repeating the Tests的直接链接" title="Repeating the Tests的直接链接" translate="no">​</a></h3>
<p>Once in a while you&#x27;ll run into a test whose result is hit-or-miss. Perhaps it
will fail only 1% of the time, making it rather hard to reproduce the bug under
a debugger. This can be a major source of frustration.</p>
<p>The <code>--gtest_repeat</code> flag allows you to repeat all (or selected) test methods in
a program many times. Hopefully, a flaky test will eventually fail and give you
a chance to debug. Here&#x27;s how to use it:</p>
<div class="language-none codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-none codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ foo_test --gtest_repeat=1000</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Repeat foo_test 1000 times and don&#x27;t stop at failures.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ foo_test --gtest_repeat=-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">A negative count means repeating forever.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ foo_test --gtest_repeat=1000 --gtest_break_on_failure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Repeat foo_test 1000 times, stopping at the first failure.  This</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">is especially useful when running under a debugger: when the test</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">fails, it will drop into the debugger and you can then inspect</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">variables and stacks.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ foo_test --gtest_repeat=1000 --gtest_filter=FooBar.*</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Repeat the tests whose name matches the filter 1000 times.</span><br></span></code></pre></div></div>
<p>If your test program contains
<a href="#global-set-up-and-tear-down" class="">global set-up/tear-down</a> code, it will be
repeated in each iteration as well, as the flakiness may be in it. To avoid
repeating global set-up/tear-down, specify
<code>--gtest_recreate_environments_when_repeating=false</code>.</p>
<p>You can also specify the repeat count by setting the <code>GTEST_REPEAT</code> environment
variable.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="shuffling-the-tests">Shuffling the Tests<a href="#shuffling-the-tests" class="hash-link" aria-label="Shuffling the Tests的直接链接" title="Shuffling the Tests的直接链接" translate="no">​</a></h3>
<p>You can specify the <code>--gtest_shuffle</code> flag (or set the <code>GTEST_SHUFFLE</code>
environment variable to <code>1</code>) to run the tests in a program in a random order.
This helps to reveal bad dependencies between tests.</p>
<p>By default, GoogleTest uses a random seed calculated from the current time.
Therefore you&#x27;ll get a different order every time. The console output includes
the random seed value, such that you can reproduce an order-related test failure
later. To specify the random seed explicitly, use the <code>--gtest_random_seed=SEED</code>
flag (or set the <code>GTEST_RANDOM_SEED</code> environment variable), where <code>SEED</code> is an
integer in the range [0, 99999]. The seed value 0 is special: it tells
GoogleTest to do the default behavior of calculating the seed from the current
time.</p>
<p>If you combine this with <code>--gtest_repeat=N</code>, GoogleTest will pick a different
random seed and re-shuffle the tests in each iteration.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="distributing-test-functions-to-multiple-machines">Distributing Test Functions to Multiple Machines<a href="#distributing-test-functions-to-multiple-machines" class="hash-link" aria-label="Distributing Test Functions to Multiple Machines的直接链接" title="Distributing Test Functions to Multiple Machines的直接链接" translate="no">​</a></h3>
<p>If you have more than one machine you can use to run a test program, you might
want to run the test functions in parallel and get the result faster. We call
this technique <em>sharding</em>, where each machine is called a <em>shard</em>.</p>
<p>GoogleTest is compatible with test sharding. To take advantage of this feature,
your test runner (not part of GoogleTest) needs to do the following:</p>
<ol>
<li class="">Allocate a number of machines (shards) to run the tests.</li>
<li class="">On each shard, set the <code>GTEST_TOTAL_SHARDS</code> environment variable to the total
number of shards. It must be the same for all shards.</li>
<li class="">On each shard, set the <code>GTEST_SHARD_INDEX</code> environment variable to the index
of the shard. Different shards must be assigned different indices, which
must be in the range <code>[0, GTEST_TOTAL_SHARDS - 1]</code>.</li>
<li class="">Run the same test program on all shards. When GoogleTest sees the above two
environment variables, it will select a subset of the test functions to run.
Across all shards, each test function in the program will be run exactly
once.</li>
<li class="">Wait for all shards to finish, then collect and report the results.</li>
</ol>
<p>Your project may have tests that were written without GoogleTest and thus don&#x27;t
understand this protocol. In order for your test runner to figure out which test
supports sharding, it can set the environment variable <code>GTEST_SHARD_STATUS_FILE</code>
to a non-existent file path. If a test program supports sharding, it will create
this file to acknowledge that fact; otherwise it will not create it. The actual
contents of the file are not important at this time, although we may put some
useful information in it in the future.</p>
<p>Here&#x27;s an example to make it clear. Suppose you have a test program <code>foo_test</code>
that contains the following 5 test functions:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TEST(A, V)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST(A, W)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST(B, X)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST(B, Y)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST(B, Z)</span><br></span></code></pre></div></div>
<p>Suppose you have 3 machines at your disposal. To run the test functions in
parallel, you would set <code>GTEST_TOTAL_SHARDS</code> to 3 on all machines, and set
<code>GTEST_SHARD_INDEX</code> to 0, 1, and 2 on the machines respectively. Then you would
run the same <code>foo_test</code> on each machine.</p>
<p>GoogleTest reserves the right to change how the work is distributed across the
shards, but here&#x27;s one possible scenario:</p>
<ul>
<li class="">Machine #0 runs <code>A.V</code> and <code>B.X</code>.</li>
<li class="">Machine #1 runs <code>A.W</code> and <code>B.Y</code>.</li>
<li class="">Machine #2 runs <code>B.Z</code>.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="controlling-test-output">Controlling Test Output<a href="#controlling-test-output" class="hash-link" aria-label="Controlling Test Output的直接链接" title="Controlling Test Output的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="colored-terminal-output">Colored Terminal Output<a href="#colored-terminal-output" class="hash-link" aria-label="Colored Terminal Output的直接链接" title="Colored Terminal Output的直接链接" translate="no">​</a></h4>
<p>GoogleTest can use colors in its terminal output to make it easier to spot the
important information:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">&lt;font color=&quot;green&quot;&gt;[----------]&lt;/font&gt; 1 test from FooTest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;font color=&quot;green&quot;&gt;[ RUN      ]&lt;/font&gt; FooTest.DoesAbc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;font color=&quot;green&quot;&gt;[       OK ]&lt;/font&gt; FooTest.DoesAbc</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;font color=&quot;green&quot;&gt;[----------]&lt;/font&gt; 2 tests from BarTest</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;font color=&quot;green&quot;&gt;[ RUN      ]&lt;/font&gt; BarTest.HasXyzProperty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;font color=&quot;green&quot;&gt;[       OK ]&lt;/font&gt; BarTest.HasXyzProperty</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;font color=&quot;green&quot;&gt;[ RUN      ]&lt;/font&gt; BarTest.ReturnsTrueOnSuccess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">... some error messages ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;font color=&quot;red&quot;&gt;[   FAILED ]&lt;/font&gt; BarTest.ReturnsTrueOnSuccess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;font color=&quot;green&quot;&gt;[==========]&lt;/font&gt; 30 tests from 14 test suites ran.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;font color=&quot;green&quot;&gt;[   PASSED ]&lt;/font&gt; 28 tests.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;font color=&quot;red&quot;&gt;[   FAILED ]&lt;/font&gt; 2 tests, listed below:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;font color=&quot;red&quot;&gt;[   FAILED ]&lt;/font&gt; BarTest.ReturnsTrueOnSuccess</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;font color=&quot;red&quot;&gt;[   FAILED ]&lt;/font&gt; AnotherTest.DoesXyz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> 2 FAILED TESTS</span><br></span></code></pre></div></div>
<p>You can set the <code>GTEST_COLOR</code> environment variable or the <code>--gtest_color</code>
command line flag to <code>yes</code>, <code>no</code>, or <code>auto</code> (the default) to enable colors,
disable colors, or let GoogleTest decide. When the value is <code>auto</code>, GoogleTest
will use colors if and only if the output goes to a terminal and (on non-Windows
platforms) the <code>TERM</code> environment variable is set to <code>xterm</code> or <code>xterm-color</code>.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="suppressing-test-passes">Suppressing test passes<a href="#suppressing-test-passes" class="hash-link" aria-label="Suppressing test passes的直接链接" title="Suppressing test passes的直接链接" translate="no">​</a></h4>
<p>By default, GoogleTest prints 1 line of output for each test, indicating if it
passed or failed. To show only test failures, run the test program with
<code>--gtest_brief=1</code>, or set the GTEST_BRIEF environment variable to <code>1</code>.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="suppressing-the-elapsed-time">Suppressing the Elapsed Time<a href="#suppressing-the-elapsed-time" class="hash-link" aria-label="Suppressing the Elapsed Time的直接链接" title="Suppressing the Elapsed Time的直接链接" translate="no">​</a></h4>
<p>By default, GoogleTest prints the time it takes to run each test. To disable
that, run the test program with the <code>--gtest_print_time=0</code> command line flag, or
set the GTEST_PRINT_TIME environment variable to <code>0</code>.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="suppressing-utf-8-text-output">Suppressing UTF-8 Text Output<a href="#suppressing-utf-8-text-output" class="hash-link" aria-label="Suppressing UTF-8 Text Output的直接链接" title="Suppressing UTF-8 Text Output的直接链接" translate="no">​</a></h4>
<p>In case of assertion failures, GoogleTest prints expected and actual values of
type <code>string</code> both as hex-encoded strings as well as in readable UTF-8 text if
they contain valid non-ASCII UTF-8 characters. If you want to suppress the UTF-8
text because, for example, you don&#x27;t have an UTF-8 compatible output medium, run
the test program with <code>--gtest_print_utf8=0</code> or set the <code>GTEST_PRINT_UTF8</code>
environment variable to <code>0</code>.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="generating-an-xml-report">Generating an XML Report<a href="#generating-an-xml-report" class="hash-link" aria-label="Generating an XML Report的直接链接" title="Generating an XML Report的直接链接" translate="no">​</a></h4>
<p>GoogleTest can emit a detailed XML report to a file in addition to its normal
textual output. The report contains the duration of each test, and thus can help
you identify slow tests.</p>
<p>To generate the XML report, set the <code>GTEST_OUTPUT</code> environment variable or the
<code>--gtest_output</code> flag to the string <code>&quot;xml:path_to_output_file&quot;</code>, which will
create the file at the given location. You can also just use the string <code>&quot;xml&quot;</code>,
in which case the output can be found in the <code>test_detail.xml</code> file in the
current directory.</p>
<p>If you specify a directory (for example, <code>&quot;xml:output/directory/&quot;</code> on Linux or
<code>&quot;xml:output\directory\&quot;</code> on Windows), GoogleTest will create the XML file in
that directory, named after the test executable (e.g. <code>foo_test.xml</code> for test
program <code>foo_test</code> or <code>foo_test.exe</code>). If the file already exists (perhaps left
over from a previous run), GoogleTest will pick a different name (e.g.
<code>foo_test_1.xml</code>) to avoid overwriting it.</p>
<p>The report is based on the <code>junitreport</code> Ant task. Since that format was
originally intended for Java, a little interpretation is required to make it
apply to GoogleTest tests, as shown here:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">testsuites</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">AllTests</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">...</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">testsuite</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">test_case_name</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">...</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">testcase</span><span class="token tag" style="color:#00009f">    </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">test_name</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">...</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">failure</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">message</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">...</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">failure</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">message</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">...</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">failure</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">message</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">...</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">/&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">testcase</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">testsuite</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">testsuites</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<ul>
<li class="">The root <code>&lt;testsuites&gt;</code> element corresponds to the entire test program.</li>
<li class=""><code>&lt;testsuite&gt;</code> elements correspond to GoogleTest test suites.</li>
<li class=""><code>&lt;testcase&gt;</code> elements correspond to GoogleTest test functions.</li>
</ul>
<p>For instance, the following program</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TEST(MathTest, Addition) { ... }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST(MathTest, Subtraction) { ... }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST(LogicTest, NonContradiction) { ... }</span><br></span></code></pre></div></div>
<p>could generate this report:</p>
<div class="language-xml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-xml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token prolog" style="color:#999988;font-style:italic">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">testsuites</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">tests</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">3</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">failures</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">1</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">errors</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">time</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0.035</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">timestamp</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">2011-10-31T18:52:42</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">AllTests</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">testsuite</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">MathTest</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">tests</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">2</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">failures</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">1</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">errors</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">time</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0.015</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">testcase</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">Addition</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">file</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">test.cpp</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">line</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">1</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">status</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">run</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">time</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0.007</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">classname</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">failure</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">message</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">Value of: add(1, 1)</span><span class="token tag attr-value entity" style="color:#36acaa">&amp;#x0A;</span><span class="token tag attr-value" style="color:#e3116c">  Actual: 3</span><span class="token tag attr-value entity" style="color:#36acaa">&amp;#x0A;</span><span class="token tag attr-value" style="color:#e3116c">Expected: 2</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">...</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">failure</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">failure</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">message</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">Value of: add(1, -1)</span><span class="token tag attr-value entity" style="color:#36acaa">&amp;#x0A;</span><span class="token tag attr-value" style="color:#e3116c">  Actual: 1</span><span class="token tag attr-value entity" style="color:#36acaa">&amp;#x0A;</span><span class="token tag attr-value" style="color:#e3116c">Expected: 0</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">type</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">...</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">failure</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">testcase</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">testcase</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">Subtraction</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">file</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">test.cpp</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">line</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">2</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">status</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">run</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">time</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0.005</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">classname</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">testcase</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">testsuite</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">testsuite</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">LogicTest</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">tests</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">1</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">failures</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">errors</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">time</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0.005</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">testcase</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">name</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">NonContradiction</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">file</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">test.cpp</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">line</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">3</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">status</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">run</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">time</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value" style="color:#e3116c">0.005</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag" style="color:#00009f"> </span><span class="token tag attr-name" style="color:#00a4db">classname</span><span class="token tag attr-value punctuation attr-equals" style="color:#393A34">=</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag attr-value punctuation" style="color:#393A34">&quot;</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">testcase</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">testsuite</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">testsuites</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><br></span></code></pre></div></div>
<p>Things to note:</p>
<ul>
<li class="">
<p>The <code>tests</code> attribute of a <code>&lt;testsuites&gt;</code> or <code>&lt;testsuite&gt;</code> element tells how
many test functions the GoogleTest program or test suite contains, while the
<code>failures</code> attribute tells how many of them failed.</p>
</li>
<li class="">
<p>The <code>time</code> attribute expresses the duration of the test, test suite, or
entire test program in seconds.</p>
</li>
<li class="">
<p>The <code>timestamp</code> attribute records the local date and time of the test
execution.</p>
</li>
<li class="">
<p>The <code>file</code> and <code>line</code> attributes record the source file location, where the
test was defined.</p>
</li>
<li class="">
<p>Each <code>&lt;failure&gt;</code> element corresponds to a single failed GoogleTest
assertion.</p>
</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="generating-a-json-report">Generating a JSON Report<a href="#generating-a-json-report" class="hash-link" aria-label="Generating a JSON Report的直接链接" title="Generating a JSON Report的直接链接" translate="no">​</a></h4>
<p>GoogleTest can also emit a JSON report as an alternative format to XML. To
generate the JSON report, set the <code>GTEST_OUTPUT</code> environment variable or the
<code>--gtest_output</code> flag to the string <code>&quot;json:path_to_output_file&quot;</code>, which will
create the file at the given location. You can also just use the string
<code>&quot;json&quot;</code>, in which case the output can be found in the <code>test_detail.json</code> file
in the current directory.</p>
<p>The report format conforms to the following JSON Schema:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;$schema&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://json-schema.org/schema#&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;object&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;definitions&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;TestCase&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;object&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;properties&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;string&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;tests&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;integer&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;failures&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;integer&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;disabled&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;integer&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;string&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;testsuite&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;array&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;items&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;$ref&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;#/definitions/TestInfo&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;TestInfo&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;object&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;properties&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;string&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;file&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;string&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;line&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;integer&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;string&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;enum&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;RUN&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;NOTRUN&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;string&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;classname&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;string&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;failures&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;array&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;items&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token property" style="color:#36acaa">&quot;$ref&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;#/definitions/Failure&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;Failure&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;object&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;properties&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;failures&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;string&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;string&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;properties&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;tests&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;integer&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;failures&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;integer&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;disabled&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;integer&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;integer&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;timestamp&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;string&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;format&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;date-time&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;string&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;string&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;testsuites&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;array&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;items&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token property" style="color:#36acaa">&quot;$ref&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;#/definitions/TestCase&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p>The report uses the format that conforms to the following Proto3 using the
<a href="https://developers.google.com/protocol-buffers/docs/proto3#json" target="_blank" rel="noopener noreferrer" class="">JSON encoding</a>:</p>
<div class="language-proto codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-proto codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">syntax = &quot;proto3&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">package googletest;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;google/protobuf/timestamp.proto&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">import &quot;google/protobuf/duration.proto&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message UnitTest {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 tests = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 failures = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 disabled = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 errors = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Timestamp timestamp = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Duration time = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string name = 7;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated TestCase testsuites = 8;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message TestCase {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string name = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 tests = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 failures = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 disabled = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 errors = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Duration time = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated TestInfo testsuite = 7;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">message TestInfo {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string name = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string file = 6;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  int32 line = 7;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  enum Status {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    RUN = 0;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    NOTRUN = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Status status = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  google.protobuf.Duration time = 3;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  string classname = 4;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  message Failure {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string failures = 1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    string type = 2;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  repeated Failure failures = 5;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre></div></div>
<p>For instance, the following program</p>
<div class="language-c++ codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-c++ codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">TEST(MathTest, Addition) { ... }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST(MathTest, Subtraction) { ... }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">TEST(LogicTest, NonContradiction) { ... }</span><br></span></code></pre></div></div>
<p>could generate this report:</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;tests&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;failures&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0.035s&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;timestamp&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;2011-10-31T18:52:42Z&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;AllTests&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;testsuites&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;MathTest&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;tests&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;failures&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0.015s&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;testsuite&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Addition&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;file&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;test.cpp&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;line&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;RUN&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0.007s&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;classname&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;failures&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Value of: add(1, 1)\n  Actual: 3\nExpected: 2&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token property" style="color:#36acaa">&quot;message&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Value of: add(1, -1)\n  Actual: 1\nExpected: 0&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">              </span><span class="token property" style="color:#36acaa">&quot;type&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;Subtraction&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;file&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;test.cpp&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;line&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;RUN&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0.005s&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;classname&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;LogicTest&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;tests&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;failures&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;errors&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0.005s&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token property" style="color:#36acaa">&quot;testsuite&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;NonContradiction&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;file&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;test.cpp&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;line&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">3</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;status&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;RUN&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;time&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0.005s&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token property" style="color:#36acaa">&quot;classname&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>注意</div><div class="admonitionContent_BuS1"><p>IMPORTANT: The exact format of the JSON document is subject to change.</p></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="controlling-how-failures-are-reported">Controlling How Failures Are Reported<a href="#controlling-how-failures-are-reported" class="hash-link" aria-label="Controlling How Failures Are Reported的直接链接" title="Controlling How Failures Are Reported的直接链接" translate="no">​</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="detecting-test-premature-exit">Detecting Test Premature Exit<a href="#detecting-test-premature-exit" class="hash-link" aria-label="Detecting Test Premature Exit的直接链接" title="Detecting Test Premature Exit的直接链接" translate="no">​</a></h4>
<p>Google Test implements the <em>premature-exit-file</em> protocol for test runners to
catch any kind of unexpected exits of test programs. Upon start, Google Test
creates the file which will be automatically deleted after all work has been
finished. Then, the test runner can check if this file exists. In case the file
remains undeleted, the inspected test has exited prematurely.</p>
<p>This feature is enabled only if the <code>TEST_PREMATURE_EXIT_FILE</code> environment
variable has been set.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="turning-assertion-failures-into-break-points">Turning Assertion Failures into Break-Points<a href="#turning-assertion-failures-into-break-points" class="hash-link" aria-label="Turning Assertion Failures into Break-Points的直接链接" title="Turning Assertion Failures into Break-Points的直接链接" translate="no">​</a></h4>
<p>When running test programs under a debugger, it&#x27;s very convenient if the
debugger can catch an assertion failure and automatically drop into interactive
mode. GoogleTest&#x27;s <em>break-on-failure</em> mode supports this behavior.</p>
<p>To enable it, set the <code>GTEST_BREAK_ON_FAILURE</code> environment variable to a value
other than <code>0</code>. Alternatively, you can use the <code>--gtest_break_on_failure</code>
command line flag.</p>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="disabling-catching-test-thrown-exceptions">Disabling Catching Test-Thrown Exceptions<a href="#disabling-catching-test-thrown-exceptions" class="hash-link" aria-label="Disabling Catching Test-Thrown Exceptions的直接链接" title="Disabling Catching Test-Thrown Exceptions的直接链接" translate="no">​</a></h4>
<p>GoogleTest can be used either with or without exceptions enabled. If a test
throws a C++ exception or (on Windows) a structured exception (SEH), by default
GoogleTest catches it, reports it as a test failure, and continues with the next
test method. This maximizes the coverage of a test run. Also, on Windows an
uncaught exception will cause a pop-up window, so catching the exceptions allows
you to run the tests automatically.</p>
<p>When debugging the test failures, however, you may instead want the exceptions
to be handled by the debugger, such that you can examine the call stack when an
exception is thrown. To achieve that, set the <code>GTEST_CATCH_EXCEPTIONS</code>
environment variable to <code>0</code>, or use the <code>--gtest_catch_exceptions=0</code> flag when
running the tests.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="sanitizer-integration">Sanitizer Integration<a href="#sanitizer-integration" class="hash-link" aria-label="Sanitizer Integration的直接链接" title="Sanitizer Integration的直接链接" translate="no">​</a></h3>
<p>The
<a href="https://clang.llvm.org/docs/UndefinedBehaviorSanitizer.html" target="_blank" rel="noopener noreferrer" class="">Undefined Behavior Sanitizer</a>,
<a href="https://github.com/google/sanitizers/wiki/AddressSanitizer" target="_blank" rel="noopener noreferrer" class="">Address Sanitizer</a>,
and
<a href="https://github.com/google/sanitizers/wiki/ThreadSanitizerCppManual" target="_blank" rel="noopener noreferrer" class="">Thread Sanitizer</a>
all provide weak functions that you can override to trigger explicit failures
when they detect sanitizer errors, such as creating a reference from <code>nullptr</code>.
To override these functions, place definitions for them in a source file that
you compile as part of your main binary:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">extern &quot;C&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void __ubsan_on_report() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FAIL() &lt;&lt; &quot;Encountered an undefined behavior sanitizer error&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void __asan_on_error() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FAIL() &lt;&lt; &quot;Encountered an address sanitizer error&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">void __tsan_on_report() {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  FAIL() &lt;&lt; &quot;Encountered a thread sanitizer error&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}  // extern &quot;C&quot;</span><br></span></code></pre></div></div>
<p>After compiling your project with one of the sanitizers enabled, if a particular
test triggers a sanitizer error, GoogleTest will report that it failed.</p></div></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/primer"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">GoogleTest Primer</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cppdev/zh-cn/docs/foundamentals/testing/gt/gmock_for_dummies"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">gMock for Dummies</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link toc-highlight">Introduction</a></li><li><a href="#more-assertions" class="table-of-contents__link toc-highlight">More Assertions</a><ul><li><a href="#explicit-success-and-failure" class="table-of-contents__link toc-highlight">Explicit Success and Failure</a></li><li><a href="#exception-assertions" class="table-of-contents__link toc-highlight">Exception Assertions</a></li><li><a href="#predicate-assertions-for-better-error-messages" class="table-of-contents__link toc-highlight">Predicate Assertions for Better Error Messages</a></li><li><a href="#floating-point-comparison" class="table-of-contents__link toc-highlight">Floating-Point Comparison</a></li><li><a href="#asserting-using-gmock-matchers" class="table-of-contents__link toc-highlight">Asserting Using gMock Matchers</a></li><li><a href="#more-string-assertions" class="table-of-contents__link toc-highlight">More String Assertions</a></li><li><a href="#windows-hresult-assertions" class="table-of-contents__link toc-highlight">Windows HRESULT assertions</a></li><li><a href="#type-assertions" class="table-of-contents__link toc-highlight">Type Assertions</a></li><li><a href="#assertion-placement" class="table-of-contents__link toc-highlight">Assertion Placement</a></li></ul></li><li><a href="#skipping-test-execution" class="table-of-contents__link toc-highlight">Skipping test execution</a></li><li><a href="#teaching-googletest-how-to-print-your-values" class="table-of-contents__link toc-highlight">Teaching GoogleTest How to Print Your Values</a></li><li><a href="#regular-expression-syntax" class="table-of-contents__link toc-highlight">Regular Expression Syntax</a></li><li><a href="#death-tests" class="table-of-contents__link toc-highlight">Death Tests</a><ul><li><a href="#how-to-write-a-death-test" class="table-of-contents__link toc-highlight">How to Write a Death Test</a></li><li><a href="#death-test-naming" class="table-of-contents__link toc-highlight">Death Test Naming</a></li><li><a href="#how-it-works" class="table-of-contents__link toc-highlight">How It Works</a></li><li><a href="#death-tests-and-threads" class="table-of-contents__link toc-highlight">Death Tests And Threads</a></li><li><a href="#death-test-styles" class="table-of-contents__link toc-highlight">Death Test Styles</a></li><li><a href="#caveats" class="table-of-contents__link toc-highlight">Caveats</a></li></ul></li><li><a href="#using-assertions-in-sub-routines" class="table-of-contents__link toc-highlight">Using Assertions in Sub-routines</a><ul><li><a href="#adding-traces-to-assertions" class="table-of-contents__link toc-highlight">Adding Traces to Assertions</a></li><li><a href="#propagating-fatal-failures" class="table-of-contents__link toc-highlight">Propagating Fatal Failures</a></li></ul></li><li><a href="#logging-additional-information" class="table-of-contents__link toc-highlight">Logging Additional Information</a></li><li><a href="#sharing-resources-between-tests-in-the-same-test-suite" class="table-of-contents__link toc-highlight">Sharing Resources Between Tests in the Same Test Suite</a></li><li><a href="#global-set-up-and-tear-down" class="table-of-contents__link toc-highlight">Global Set-Up and Tear-Down</a></li><li><a href="#value-parameterized-tests" class="table-of-contents__link toc-highlight">Value-Parameterized Tests</a><ul><li><a href="#how-to-write-value-parameterized-tests" class="table-of-contents__link toc-highlight">How to Write Value-Parameterized Tests</a></li><li><a href="#creating-value-parameterized-abstract-tests" class="table-of-contents__link toc-highlight">Creating Value-Parameterized Abstract Tests</a></li><li><a href="#specifying-names-for-value-parameterized-test-parameters" class="table-of-contents__link toc-highlight">Specifying Names for Value-Parameterized Test Parameters</a></li></ul></li><li><a href="#typed-tests" class="table-of-contents__link toc-highlight">Typed Tests</a></li><li><a href="#type-parameterized-tests" class="table-of-contents__link toc-highlight">Type-Parameterized Tests</a></li><li><a href="#testing-private-code" class="table-of-contents__link toc-highlight">Testing Private Code</a></li><li><a href="#catching-failures" class="table-of-contents__link toc-highlight">&quot;Catching&quot; Failures</a></li><li><a href="#registering-tests-programmatically" class="table-of-contents__link toc-highlight">Registering tests programmatically</a></li><li><a href="#getting-the-current-tests-name" class="table-of-contents__link toc-highlight">Getting the Current Test&#39;s Name</a></li><li><a href="#extending-googletest-by-handling-test-events" class="table-of-contents__link toc-highlight">Extending GoogleTest by Handling Test Events</a><ul><li><a href="#defining-event-listeners" class="table-of-contents__link toc-highlight">Defining Event Listeners</a></li><li><a href="#using-event-listeners" class="table-of-contents__link toc-highlight">Using Event Listeners</a></li><li><a href="#generating-failures-in-listeners" class="table-of-contents__link toc-highlight">Generating Failures in Listeners</a></li></ul></li><li><a href="#running-test-programs-advanced-options" class="table-of-contents__link toc-highlight">Running Test Programs: Advanced Options</a><ul><li><a href="#selecting-tests" class="table-of-contents__link toc-highlight">Selecting Tests</a></li><li><a href="#enforcing-having-at-least-one-test-case" class="table-of-contents__link toc-highlight">Enforcing Having At Least One Test Case</a></li><li><a href="#enforcing-running-at-least-one-test-case" class="table-of-contents__link toc-highlight">Enforcing Running At Least One Test Case</a></li><li><a href="#repeating-the-tests" class="table-of-contents__link toc-highlight">Repeating the Tests</a></li><li><a href="#shuffling-the-tests" class="table-of-contents__link toc-highlight">Shuffling the Tests</a></li><li><a href="#distributing-test-functions-to-multiple-machines" class="table-of-contents__link toc-highlight">Distributing Test Functions to Multiple Machines</a></li><li><a href="#controlling-test-output" class="table-of-contents__link toc-highlight">Controlling Test Output</a></li><li><a href="#controlling-how-failures-are-reported" class="table-of-contents__link toc-highlight">Controlling How Failures Are Reported</a></li><li><a href="#sanitizer-integration" class="table-of-contents__link toc-highlight">Sanitizer Integration</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/cppdev/zh-cn/docs/intro">Tutorial</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/jefflothar" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/cppdev/zh-cn/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/kumo-pub" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2026 Kumo, Inc.</div></div></div></footer></div>
</body>
</html>