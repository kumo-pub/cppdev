<!doctype html>
<html lang="zh-cn" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-foundamentals/map/pmap" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Introduction to parallel-hashmap: High-Performance, Thread-Safe, Memory-Efficient Hash Tables and B-Trees | Kumo Foundamental</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://your-docusaurus-site.example.com/cppdev/zh-cn/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://your-docusaurus-site.example.com/cppdev/zh-cn/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://your-docusaurus-site.example.com/cppdev/zh-cn/docs/foundamentals/map/pmap"><meta data-rh="true" property="og:locale" content="zh_cn"><meta data-rh="true" property="og:locale:alternate" content="en_GB"><meta data-rh="true" name="docusaurus_locale" content="zh-cn"><meta data-rh="true" name="docsearch:language" content="zh-cn"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Introduction to parallel-hashmap: High-Performance, Thread-Safe, Memory-Efficient Hash Tables and B-Trees | Kumo Foundamental"><meta data-rh="true" name="description" content="1. Background"><meta data-rh="true" property="og:description" content="1. Background"><link data-rh="true" rel="icon" href="/cppdev/zh-cn/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://your-docusaurus-site.example.com/cppdev/zh-cn/docs/foundamentals/map/pmap"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/cppdev/docs/foundamentals/map/pmap" hreflang="en-GB"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/cppdev/zh-cn/docs/foundamentals/map/pmap" hreflang="zh-cn"><link data-rh="true" rel="alternate" href="https://your-docusaurus-site.example.com/cppdev/docs/foundamentals/map/pmap" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Foundamentals","item":"https://your-docusaurus-site.example.com/cppdev/zh-cn/docs/category/foundamentals"},{"@type":"ListItem","position":2,"name":"Map Containers","item":"https://your-docusaurus-site.example.com/cppdev/zh-cn/docs/foundamentals/map/"},{"@type":"ListItem","position":3,"name":"Introduction to parallel-hashmap: High-Performance, Thread-Safe, Memory-Efficient Hash Tables and B-Trees","item":"https://your-docusaurus-site.example.com/cppdev/zh-cn/docs/foundamentals/map/pmap"}]}</script><link rel="alternate" type="application/rss+xml" href="/cppdev/zh-cn/blog/rss.xml" title="Kumo Foundamental RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/cppdev/zh-cn/blog/atom.xml" title="Kumo Foundamental Atom Feed"><link rel="stylesheet" href="/cppdev/zh-cn/assets/css/styles.a7490ef4.css">
<script src="/cppdev/zh-cn/assets/js/runtime~main.84ee4f51.js" defer="defer"></script>
<script src="/cppdev/zh-cn/assets/js/main.3113f152.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/cppdev/zh-cn/img/kumo-logo.svg"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cppdev/zh-cn/"><div class="navbar__logo"><img src="/cppdev/zh-cn/img/kumo-logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/cppdev/zh-cn/img/kumo-logo.svg" alt="My Site Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">My Site</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cppdev/zh-cn/docs/intro">教程</a><a class="navbar__item navbar__link" href="/cppdev/zh-cn/docs/integration/overview">Integration</a><a class="navbar__item navbar__link" href="/cppdev/zh-cn/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>中文（中国）</a><ul class="dropdown__menu"><li><a href="/cppdev/docs/foundamentals/map/pmap" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="en-GB">English</a></li><li><a href="/cppdev/zh-cn/docs/foundamentals/map/pmap" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="zh-cn">中文（中国）</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cppdev/zh-cn/docs/intro"><span title="介绍" class="linkLabel_WmDU">介绍</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" href="/cppdev/zh-cn/docs/category/foundamentals"><span title="Foundamentals" class="categoryLinkLabel_W154">Foundamentals</span></a><button aria-label="折叠侧边栏分类 &#x27;Foundamentals&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/testing/"><span title="Performance Testing and Unit Testing" class="categoryLinkLabel_W154">Performance Testing and Unit Testing</span></a><button aria-label="展开侧边栏分类 &#x27;Performance Testing and Unit Testing&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/log/"><span title="Log Section" class="categoryLinkLabel_W154">Log Section</span></a><button aria-label="展开侧边栏分类 &#x27;Log Section&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/time"><span title="Time and Calendar" class="linkLabel_WmDU">Time and Calendar</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/category/standardized-errors-and-error-return-values"><span title="Standardized Errors and Error Return Values" class="categoryLinkLabel_W154">Standardized Errors and Error Return Values</span></a><button aria-label="展开侧边栏分类 &#x27;Standardized Errors and Error Return Values&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/strings/"><span title="strings operations" class="categoryLinkLabel_W154">strings operations</span></a><button aria-label="展开侧边栏分类 &#x27;strings operations&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/flags"><span title="Turbo Command-Line Flags (Turbo Flags)" class="linkLabel_WmDU">Turbo Command-Line Flags (Turbo Flags)</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/codec/"><span title="Codec" class="categoryLinkLabel_W154">Codec</span></a><button aria-label="展开侧边栏分类 &#x27;Codec&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/format/"><span title="Format &amp; Output (String Formatting and Output)" class="linkLabel_WmDU">Format &amp; Output (String Formatting and Output)</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--active" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/map/"><span title="Map Containers" class="categoryLinkLabel_W154">Map Containers</span></a><button aria-label="折叠侧边栏分类 &#x27;Map Containers&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/map/turbo_hash"><span title="Turbo Hash Containers" class="linkLabel_WmDU">Turbo Hash Containers</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/map/concurrent_hash_map"><span title="concurrent_hash_map" class="linkLabel_WmDU">concurrent_hash_map</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/map/pmap"><span title="Introduction to parallel-hashmap: High-Performance, Thread-Safe, Memory-Efficient Hash Tables and B-Trees" class="linkLabel_WmDU">Introduction to parallel-hashmap: High-Performance, Thread-Safe, Memory-Efficient Hash Tables and B-Trees</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/map/benchmark"><span title="C++ Hashmap Benchmark" class="linkLabel_WmDU">C++ Hashmap Benchmark</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/compress/"><span title="Compression" class="categoryLinkLabel_W154">Compression</span></a><button aria-label="展开侧边栏分类 &#x27;Compression&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/fibers/"><span title="Fiber And Future" class="categoryLinkLabel_W154">Fiber And Future</span></a><button aria-label="展开侧边栏分类 &#x27;Fiber And Future&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/monitor/"><span title="monitor" class="categoryLinkLabel_W154">monitor</span></a><button aria-label="展开侧边栏分类 &#x27;monitor&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/filesystem/"><span title="filesystem" class="categoryLinkLabel_W154">filesystem</span></a><button aria-label="展开侧边栏分类 &#x27;filesystem&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/cppdev/zh-cn/docs/foundamentals/json/"><span title="json" class="categoryLinkLabel_W154">json</span></a><button aria-label="展开侧边栏分类 &#x27;json&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cppdev/zh-cn/docs/rpc/"><span title="rpc" class="categoryLinkLabel_W154">rpc</span></a><button aria-label="展开侧边栏分类 &#x27;rpc&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cppdev/zh-cn/docs/retrieve/"><span title="Retrieve" class="categoryLinkLabel_W154">Retrieve</span></a><button aria-label="展开侧边栏分类 &#x27;Retrieve&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cppdev/zh-cn/docs/store/"><span title="store" class="categoryLinkLabel_W154">store</span></a><button aria-label="展开侧边栏分类 &#x27;store&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cppdev/zh-cn/docs/ir/"><span title="IR" class="categoryLinkLabel_W154">IR</span></a><button aria-label="展开侧边栏分类 &#x27;IR&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" href="/cppdev/zh-cn/docs/advance/"><span title="advance" class="categoryLinkLabel_W154">advance</span></a><button aria-label="展开侧边栏分类 &#x27;advance&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/cppdev/zh-cn/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/cppdev/zh-cn/docs/category/foundamentals"><span>Foundamentals</span></a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/cppdev/zh-cn/docs/foundamentals/map/"><span>Map Containers</span></a></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Introduction to parallel-hashmap: High-Performance, Thread-Safe, Memory-Efficient Hash Tables and B-Trees</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Introduction to parallel-hashmap: High-Performance, Thread-Safe, Memory-Efficient Hash Tables and B-Trees</h1></header>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-background">1. Background<a href="#1-background" class="hash-link" aria-label="1. Background的直接链接" title="1. Background的直接链接" translate="no">​</a></h2>
<p>In backend development, thread-safe, high-performance container data structures are a common requirement. The open-source library <a href="https://github.com/kumose/collie" target="_blank" rel="noopener noreferrer" class="">parallel-hashmap</a> is an enhancement of Google&#x27;s abseil-cpp library, which can be directly used in development.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-overview">2. Overview<a href="#2-overview" class="hash-link" aria-label="2. Overview的直接链接" title="2. Overview的直接链接" translate="no">​</a></h2>
<p>parallel-hashmap provides a set of high-quality hash map implementations, as well as btree implementations that can replace <code>std::map</code> and <code>std::set</code>. Its core features are as follows:</p>
<ul>
<li class="">Header only: No linking required; simply include the header files in your code to use.</li>
<li class="">Seamlessly replaces <code>std::unordered_map</code>, <code>std::unordered_set</code>, <code>std::map</code>, and <code>std::set</code> with full compatibility with standard STL container APIs.</li>
<li class="">Requires a C++11-compliant compiler, while also providing C++14 and C++17 APIs (e.g., <code>try_emplace</code>).</li>
<li class="">Exceptional efficiency: Significantly faster than compiler-default unordered map/set, Boost implementations, and sparsepp. Benchmarks show insertion speed is 1x faster and lookup speed is 3x faster than <code>std::unordered_map</code> (Reference: <a href="https://martin.ankerl.com/2019/04/01/hashmap-benchmarks-01-overview/" target="_blank" rel="noopener noreferrer" class="">https://martin.ankerl.com/2019/04/01/hashmap-benchmarks-01-overview/</a>).</li>
<li class="">Memory-efficient: Low memory footprint, slightly higher than sparsepp; in 64-bit mode, <code>std::set&lt;int32_t&gt;</code> allocates 40 bytes per value, while <code>absl::btree_set&lt;int32_t&gt;</code> allocates only ~4.3 to ~5.1 bytes (Reference: Abseil data - <a href="https://abseil.io/about/design/btree" target="_blank" rel="noopener noreferrer" class="">https://abseil.io/about/design/btree</a>).</li>
<li class="">Supports heterogeneous lookup.</li>
<li class="">Easy forward declaration: Include <code>phmap_fwd_decl.h</code> in the header file (Note: Not applicable for hash tables with pointers as keys).</li>
<li class="">Dump/load functionality: When flat hash tables store <code>std::trivially_copyable</code> data, they can be directly dumped to disk and efficiently restored without recalculating hashes. This is 10x faster than serializing elements one by one, with an additional 10% - 60% disk space overhead (Applicable only to flat hash map/set; see <code>examples/serialize.cc</code>).</li>
<li class="">Multi-platform tested: Windows (vs2015/2017/2019, Intel compiler 18/19), Linux (g++ 4.8.4/5/6/7/8, clang++ 3.9/4.0/5.0), MacOS (g++、clang++).</li>
<li class="">Automatically supports Boost&#x27;s <code>hash_value()</code> method and provides hash function implementations for <code>std::pair</code> and <code>std::tuple</code>.</li>
<li class="">Supports Visual Studio natvis visualization (for hash map/set only).</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-fast-and-memory-efficient">3. Fast and Memory-Efficient<a href="#3-fast-and-memory-efficient" class="hash-link" aria-label="3. Fast and Memory-Efficient的直接链接" title="3. Fast and Memory-Efficient的直接链接" translate="no">​</a></h2>
<p>Google Abseil&#x27;s flat_hash_map uses a 2x memory growth resize strategy, which causes memory peaks and requires 3x temporary memory for data migration.</p>
<p>parallel-hashmap&#x27;s optimization approach splits a large flat_hash_map into a number of sub-hash tables that is a power of 2 (e.g., 16), which not only reduces the memory peak (to 1/16 of the original) but also facilitates concurrency.</p>
<p>The library&#x27;s hash maps and btrees are based on Abseil&#x27;s open-source implementation, adopting closed hashing where data is directly stored in memory arrays to avoid indirect memory access. Through concurrent SSE2 instructions, it can search 16 slots in parallel, maintaining high speed even with a load factor of 87.5%.</p>
<blockquote>
<p>Important Note: This repository draws on and modifies code from abseil-cpp. Its behavior may differ from the original version, and no guarantees are provided for independent use. For the official Abseil library, visit abseil-cpp.</p>
</blockquote>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-installation">4. Installation<a href="#4-installation" class="hash-link" aria-label="4. Installation的直接链接" title="4. Installation的直接链接" translate="no">​</a></h2>
<p>No installation required; simply include the header files in your code to use.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="5-example">5. Example<a href="#5-example" class="hash-link" aria-label="5. Example的直接链接" title="5. Example的直接链接" translate="no">​</a></h2>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;iostream&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;string&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;parallel_hashmap/phmap.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">using</span><span class="token plain"> phmap</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">flat_hash_map</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Create an unordered_map to store string mappings</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    flat_hash_map</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">string</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">string</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> email </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;tom&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;tom@gmail.com&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;jeff&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;jk@gmail.com&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;jim&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token string" style="color:#e3116c">&quot;jimg@microsoft.com&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Iterate and print key-value pairs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">auto</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> n </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> email</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">cout </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">first </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&#x27;s email is: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> n</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">second </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;\n&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Add a new entry</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    email</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;bill&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bg@whatever.com&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Print the new entry</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">cout </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;bill&#x27;s email is: &quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> email</span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&quot;bill&quot;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;\n&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="6-various-hash-tables-provided-and-their-pros-and-cons">6. Various Hash Tables Provided and Their Pros and Cons<a href="#6-various-hash-tables-provided-and-their-pros-and-cons" class="hash-link" aria-label="6. Various Hash Tables Provided and Their Pros and Cons的直接链接" title="6. Various Hash Tables Provided and Their Pros and Cons的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="61-hash-table-types-header-file-parallel_hashmapphmaph">6.1 Hash Table Types (Header file: <code>parallel_hashmap/phmap.h</code>)<a href="#61-hash-table-types-header-file-parallel_hashmapphmaph" class="hash-link" aria-label="61-hash-table-types-header-file-parallel_hashmapphmaph的直接链接" title="61-hash-table-types-header-file-parallel_hashmapphmaph的直接链接" translate="no">​</a></h3>
<p>A total of 8 hash table types are provided:</p>
<ul>
<li class="">phmap::flat_hash_set</li>
<li class="">phmap::flat_hash_map</li>
<li class="">phmap::node_hash_set</li>
<li class="">phmap::node_hash_map</li>
<li class="">phmap::parallel_flat_hash_set</li>
<li class="">phmap::parallel_flat_hash_map</li>
<li class="">phmap::parallel_node_hash_set</li>
<li class="">phmap::parallel_node_hash_map</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="62-b-tree-ordered-containers-header-file-parallel_hashmapbtreeh">6.2 B-Tree Ordered Containers (Header file: <code>parallel_hashmap/btree.h</code>)<a href="#62-b-tree-ordered-containers-header-file-parallel_hashmapbtreeh" class="hash-link" aria-label="62-b-tree-ordered-containers-header-file-parallel_hashmapbtreeh的直接链接" title="62-b-tree-ordered-containers-header-file-parallel_hashmapbtreeh的直接链接" translate="no">​</a></h3>
<ul>
<li class="">phmap::btree_set</li>
<li class="">phmap::btree_map</li>
<li class="">phmap::btree_multiset</li>
<li class="">phmap::btree_multimap</li>
</ul>
<p>B-tree containers are directly ported from Abseil and perform essentially the same as Abseil. Minor differences include support for <code>std::string_view</code> instead of <code>absl::string_view</code>, and support for forward declaration.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="63-key-design-points-of-hash-containers">6.3 Key Design Points of Hash Containers<a href="#63-key-design-points-of-hash-containers" class="hash-link" aria-label="6.3 Key Design Points of Hash Containers的直接链接" title="6.3 Key Design Points of Hash Containers的直接链接" translate="no">​</a></h3>
<ul>
<li class="">Flat series: Internally moves keys and values, so external pointers to elements may become dangling when the container is modified; offers lower memory usage and faster speed, so it is preferred. Exception: When the value size exceeds 100 bytes (high movement cost), use the node series instead.</li>
<li class="">Node series: Does not internally move keys and values, suitable for scenarios where external pointers need to be preserved.</li>
<li class="">Parallel series: Suitable for a small number of hash tables storing a large number of values; non-parallel series are suitable for a large number of hash tables storing a small number of elements.</li>
<li class="">Advantages of the parallel series:
a. Reduces memory peaks during resizing.
b. Supports multi-threading (internally split into multiple sub-hash tables for thread-safe concurrency).</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="64-key-design-points-of-b-tree-containers">6.4 Key Design Points of B-Tree Containers<a href="#64-key-design-points-of-b-tree-containers" class="hash-link" aria-label="6.4 Key Design Points of B-Tree Containers的直接链接" title="6.4 Key Design Points of B-Tree Containers的直接链接" translate="no">​</a></h3>
<ul>
<li class="">Ordered containers that can replace STL red-black tree containers (<code>std::map</code>/<code>std::set</code>).</li>
<li class="">Each tree node stores multiple values, which is cache-friendly and significantly reduces memory usage.</li>
<li class="">Preferred scenarios: No requirements for pointer/iterator stability, low value movement cost.</li>
<li class="">Not recommended scenarios:
a. Requirements for pointer or iterator stability.
b. Large value types with high movement cost.</li>
<li class="">When order is not required, hash table containers are superior to b-tree containers.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="7-modifications-to-abseils-hash-tables">7. Modifications to Abseil’s Hash Tables<a href="#7-modifications-to-abseils-hash-tables" class="hash-link" aria-label="7. Modifications to Abseil’s Hash Tables的直接链接" title="7. Modifications to Abseil’s Hash Tables的直接链接" translate="no">​</a></h2>
<ul>
<li class="">Default hash: Changed from <code>absl::hash</code> to <code>std::hash</code>; can switch by defining the macro <code>PHMAP_USE_ABSL_HASH</code>.</li>
<li class="">Erase method: <code>erase(iterator)</code> and <code>erase(const_iterator)</code> return the iterator following the erased element (consistent with <code>std::unordered_map</code>), and a non-standard <code>void _erase(iterator)</code> is provided (for scenarios where no return value is needed).</li>
<li class="">String view support: Does not provide <code>absl::string_view</code>, but supports all types compatible with <code>std::hash&lt;&gt;</code> (also compatible with <code>std::string_view</code> when the compiler supports it).</li>
<li class="">Hash seed: Random initialization is disabled by default (facilitates debugging); can be enabled by defining the macro <code>#define PHMAP_NON_DETERMINISTIC 1</code> (Reference: raw_hash_set_test.cc) to prevent DoS attacks.</li>
<li class="">Hash value mixing: Internally implements hash value mixing to avoid performance degradation when the user&#x27;s hash function has poor entropy distribution, with extremely low overhead.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="8-memory-usage">8. Memory Usage<a href="#8-memory-usage" class="hash-link" aria-label="8. Memory Usage的直接链接" title="8. Memory Usage的直接链接" translate="no">​</a></h2>
<table><thead><tr><th>type</th><th>memory usage</th><th>additional peak memory usage when resizing</th></tr></thead><tbody><tr><td>flat tables</td><td><code>sizeof(C::value_type) + 1</code></td><td>0.5x the size of the old bucket array</td></tr><tr><td>node tables</td><td><code>sizeof(void *) + 1</code></td><td>0.5x the size of the old bucket array</td></tr><tr><td>parallel flat tables</td><td><code>sizeof(C::value_type) + 1</code></td><td>Approximately 0.03 (0.5 / number of sub-hash tables)</td></tr><tr><td>parallel node tables</td><td><code>sizeof(void *) + 1</code></td><td>Approximately 0.03 (0.5 / number of sub-hash tables)</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="supplementary-notes">Supplementary Notes<a href="#supplementary-notes" class="hash-link" aria-label="Supplementary Notes的直接链接" title="Supplementary Notes的直接链接" translate="no">​</a></h3>
<ul>
<li class="">size(): Returns the number of values in the container.</li>
<li class="">load_factor(): Load factor, i.e., <code>size() / bucket_count()</code>, which fluctuates between 0.4375 (immediately after resizing) and 0.875 (before resizing).</li>
<li class="">Bucket array size: Doubles with each resize.</li>
<li class="">Parallel hash tables: When the template parameter N=4, 16 sub-hash tables are created; only one sub-hash table is resized at a time in single-threaded mode.</li>
</ul>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="9-iterator-invalidation-for-hash-table-containers">9. Iterator Invalidation for Hash Table Containers<a href="#9-iterator-invalidation-for-hash-table-containers" class="hash-link" aria-label="9. Iterator Invalidation for Hash Table Containers的直接链接" title="9. Iterator Invalidation for Hash Table Containers的直接链接" translate="no">​</a></h2>
<p>Follows the same rules as <code>std::unordered_map</code>:</p>
<table><thead><tr><th>Operations</th><th>Invalidated</th></tr></thead><tbody><tr><td>All read-only operations, swap, std::swap</td><td>Never invalidated</td></tr><tr><td>clear, rehash, reserve, operator=</td><td>Always invalidated</td></tr><tr><td>insert, emplace, emplace_hint, operator[]</td><td>Invalidated only when rehash is triggered</td></tr><tr><td>erase</td><td>Only the erased element is invalidated</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="10-iterator-invalidation-for-b-tree-containers">10. Iterator Invalidation for B-Tree Containers<a href="#10-iterator-invalidation-for-b-tree-containers" class="hash-link" aria-label="10. Iterator Invalidation for B-Tree Containers的直接链接" title="10. Iterator Invalidation for B-Tree Containers的直接链接" translate="no">​</a></h2>
<p>Unlike <code>std::map</code>/<code>std::set</code>, any modification operation may invalidate surviving iterators:</p>
<table><thead><tr><th>Operations</th><th>Invalidated</th></tr></thead><tbody><tr><td>All read-only operations, swap, std::swap</td><td>Never invalidated</td></tr><tr><td>clear, operator=</td><td>Always invalidated</td></tr><tr><td>insert, emplace, emplace_hint, operator[]</td><td>Invalidated</td></tr><tr><td>erase</td><td>Invalidated</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="11-providing-hash-functions-for-user-defined-classes">11. Providing Hash Functions for User-Defined Classes<a href="#11-providing-hash-functions-for-user-defined-classes" class="hash-link" aria-label="11. Providing Hash Functions for User-Defined Classes的直接链接" title="11. Providing Hash Functions for User-Defined Classes的直接链接" translate="no">​</a></h2>
<p>When using flat_hash_set or flat_hash_map, user-defined classes need to provide hash functions. Two implementation methods are available:</p>
<ol>
<li class="">Provide a hash function via the HashFcn template parameter.</li>
<li class="">When using Boost, add a <code>hash_value()</code> friend function to the user-defined class.</li>
</ol>
<p>For detailed examples, refer to the official documentation.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="12-thread-safety">12. Thread Safety<a href="#12-thread-safety" class="hash-link" aria-label="12. Thread Safety的直接链接" title="12. Thread Safety的直接链接" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="121-basic-thread-safety-rules-follows-c-standard-library">12.1 Basic Thread Safety Rules (Follows C++ Standard Library)<a href="#121-basic-thread-safety-rules-follows-c-standard-library" class="hash-link" aria-label="12.1 Basic Thread Safety Rules (Follows C++ Standard Library)的直接链接" title="12.1 Basic Thread Safety Rules (Follows C++ Standard Library)的直接链接" translate="no">​</a></h3>
<ul>
<li class="">Multi-threaded reading of a single hash table: Safe.</li>
<li class="">Single-threaded writing while other threads read/write the same hash table: Unsafe; requires protection.</li>
<li class="">Multi-threaded reading/writing of different instances of the same type: Safe.</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="122-thread-safety-extensions-for-parallel-series-hash-tables">12.2 Thread Safety Extensions for Parallel Series Hash Tables<a href="#122-thread-safety-extensions-for-parallel-series-hash-tables" class="hash-link" aria-label="12.2 Thread Safety Extensions for Parallel Series Hash Tables的直接链接" title="12.2 Thread Safety Extensions for Parallel Series Hash Tables的直接链接" translate="no">​</a></h3>
<p>Internal thread safety can be achieved by specifying a synchronization type (e.g., <code>std::shared_mutex</code>, <code>boost::shared_mutex</code>, <code>std::mutex</code>) as the last template parameter. High concurrency is achieved through locking per sub-hash table internally:</p>
<ul>
<li class="">Read operations: Safely performed via <code>if_contains()</code>, which holds the sub-hash table lock and passes a reference to the value to the callback function.</li>
<li class="">Write operations: Safely performed via <code>modify_if()</code> or <code>try_emplace_l()</code>.</li>
<li class="">Note: Iterators or references returned by standard APIs are not protected by mutexes and are unreliable in multi-threaded modification scenarios.</li>
</ul>
<p>It is recommended to use C++17&#x27;s <code>std::shared_mutex</code>, which has been tested to deliver the best performance. For more examples of using different mutex types, refer to <code>examples/bench.cc</code>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="123-thread-safe-functions-for-parallel-series-containers">12.3 Thread-Safe Functions for Parallel Series Containers<a href="#123-thread-safe-functions-for-parallel-series-containers" class="hash-link" aria-label="12.3 Thread-Safe Functions for Parallel Series Containers的直接链接" title="12.3 Thread-Safe Functions for Parallel Series Containers的直接链接" translate="no">​</a></h3>
<ul>
<li class="">insert()</li>
<li class="">emplace()</li>
<li class="">lazy_emplace()</li>
<li class="">erase()</li>
<li class="">merge()</li>
<li class="">swap()</li>
<li class="">rehash()</li>
<li class="">find()</li>
<li class="">bucket_count()</li>
<li class="">has_element()</li>
<li class="">if_contains()</li>
<li class="">modify_if()</li>
<li class="">try_emplace_l()</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="124-multi-thread-example">12.4 Multi-Thread Example<a href="#124-multi-thread-example" class="hash-link" aria-label="12.4 Multi-Thread Example的直接链接" title="12.4 Multi-Thread Example的直接链接" translate="no">​</a></h3>
<div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;assert.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;stdint.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;map&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;shared_mutex&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;thread&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;unordered_map&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&lt;vector&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token macro property directive-hash" style="color:#36acaa">#</span><span class="token macro property directive keyword" style="color:#00009f">include</span><span class="token macro property" style="color:#36acaa"> </span><span class="token macro property string" style="color:#e3116c">&quot;parallel-hashmap/parallel_hashmap/phmap.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Replacement for std::unordered_map&lt;uint64_t, uint32_t&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">typedef</span><span class="token plain"> phmap</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">parallel_flat_hash_map</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">uint64_t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">uint32_t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> phmap</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">priv</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">hash_default_hash</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">uint64_t</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                     phmap</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">priv</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">hash_default_eq</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">uint64_t</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                                     std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">allocator</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">pair</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">uint64_t</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">uint32_t</span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">4</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">shared_mutex</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   MapT</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">main</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   MapT index</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">uint32_t</span><span class="token plain"> key_num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10000</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">static</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> thread_num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">uint64_t</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> key_num</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       index</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">try_emplace_l</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">uint32_t</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> val </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">vector</span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token plain">thread</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> thread_list</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">int</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> i </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> thread_num</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">i</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       thread_list</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">push_back</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">std</span><span class="token double-colon punctuation" style="color:#393A34">::</span><span class="token function" style="color:#d73a49">thread</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">uint64_t</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> key_num </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">               index</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">modify_if</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">uint32_t</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">val</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">auto</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> t </span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> thread_list</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       t</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">join</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">uint32_t</span><span class="token plain"> hit_num </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">uint64_t</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> key </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> key_num </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       index</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">if_contains</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">key</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">uint32_t</span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">thread_num </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> val</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">           </span><span class="token operator" style="color:#393A34">++</span><span class="token plain">hit_num</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token function" style="color:#d73a49">assert</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">hit_num </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> key_num</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/foundamentals/map/pmap.mdx" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/cppdev/zh-cn/docs/foundamentals/map/concurrent_hash_map"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">concurrent_hash_map</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cppdev/zh-cn/docs/foundamentals/map/benchmark"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">C++ Hashmap Benchmark</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1-background" class="table-of-contents__link toc-highlight">1. Background</a></li><li><a href="#2-overview" class="table-of-contents__link toc-highlight">2. Overview</a></li><li><a href="#3-fast-and-memory-efficient" class="table-of-contents__link toc-highlight">3. Fast and Memory-Efficient</a></li><li><a href="#4-installation" class="table-of-contents__link toc-highlight">4. Installation</a></li><li><a href="#5-example" class="table-of-contents__link toc-highlight">5. Example</a></li><li><a href="#6-various-hash-tables-provided-and-their-pros-and-cons" class="table-of-contents__link toc-highlight">6. Various Hash Tables Provided and Their Pros and Cons</a><ul><li><a href="#61-hash-table-types-header-file-parallel_hashmapphmaph" class="table-of-contents__link toc-highlight">6.1 Hash Table Types (Header file: <code>parallel_hashmap/phmap.h</code>)</a></li><li><a href="#62-b-tree-ordered-containers-header-file-parallel_hashmapbtreeh" class="table-of-contents__link toc-highlight">6.2 B-Tree Ordered Containers (Header file: <code>parallel_hashmap/btree.h</code>)</a></li><li><a href="#63-key-design-points-of-hash-containers" class="table-of-contents__link toc-highlight">6.3 Key Design Points of Hash Containers</a></li><li><a href="#64-key-design-points-of-b-tree-containers" class="table-of-contents__link toc-highlight">6.4 Key Design Points of B-Tree Containers</a></li></ul></li><li><a href="#7-modifications-to-abseils-hash-tables" class="table-of-contents__link toc-highlight">7. Modifications to Abseil’s Hash Tables</a></li><li><a href="#8-memory-usage" class="table-of-contents__link toc-highlight">8. Memory Usage</a><ul><li><a href="#supplementary-notes" class="table-of-contents__link toc-highlight">Supplementary Notes</a></li></ul></li><li><a href="#9-iterator-invalidation-for-hash-table-containers" class="table-of-contents__link toc-highlight">9. Iterator Invalidation for Hash Table Containers</a></li><li><a href="#10-iterator-invalidation-for-b-tree-containers" class="table-of-contents__link toc-highlight">10. Iterator Invalidation for B-Tree Containers</a></li><li><a href="#11-providing-hash-functions-for-user-defined-classes" class="table-of-contents__link toc-highlight">11. Providing Hash Functions for User-Defined Classes</a></li><li><a href="#12-thread-safety" class="table-of-contents__link toc-highlight">12. Thread Safety</a><ul><li><a href="#121-basic-thread-safety-rules-follows-c-standard-library" class="table-of-contents__link toc-highlight">12.1 Basic Thread Safety Rules (Follows C++ Standard Library)</a></li><li><a href="#122-thread-safety-extensions-for-parallel-series-hash-tables" class="table-of-contents__link toc-highlight">12.2 Thread Safety Extensions for Parallel Series Hash Tables</a></li><li><a href="#123-thread-safe-functions-for-parallel-series-containers" class="table-of-contents__link toc-highlight">12.3 Thread-Safe Functions for Parallel Series Containers</a></li><li><a href="#124-multi-thread-example" class="table-of-contents__link toc-highlight">12.4 Multi-Thread Example</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/cppdev/zh-cn/docs/intro">Tutorial</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://x.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">X<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/cppdev/zh-cn/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/kumo-pub" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2025 Kumo, Inc.</div></div></div></footer></div>
</body>
</html>