"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[1547],{8:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"testing/gt/advanced","title":"Advanced GoogleTest Topics","description":"Introduction","source":"@site/docs/testing/gt/advanced.md","sourceDirName":"testing/gt","slug":"/testing/gt/advanced","permalink":"/zh-cn/docs/testing/gt/advanced","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/testing/gt/advanced.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"GoogleTest Primer","permalink":"/zh-cn/docs/testing/gt/primer"},"next":{"title":"gMock for Dummies","permalink":"/zh-cn/docs/testing/gt/gmock_for_dummies"}}');var i=t(4848),r=t(8453);const o={},a="Advanced GoogleTest Topics",l={},c=[{value:"Introduction",id:"introduction",level:2},{value:"More Assertions",id:"more-assertions",level:2},{value:"Explicit Success and Failure",id:"explicit-success-and-failure",level:3},{value:"Exception Assertions",id:"exception-assertions",level:3},{value:"Predicate Assertions for Better Error Messages",id:"predicate-assertions-for-better-error-messages",level:3},{value:"Using an Existing Boolean Function",id:"using-an-existing-boolean-function",level:4},{value:"Using a Function That Returns an AssertionResult",id:"using-a-function-that-returns-an-assertionresult",level:4},{value:"Using a Predicate-Formatter",id:"using-a-predicate-formatter",level:4},{value:"Floating-Point Comparison",id:"floating-point-comparison",level:3},{value:"Floating-Point Predicate-Format Functions",id:"floating-point-predicate-format-functions",level:4},{value:"Asserting Using gMock Matchers",id:"asserting-using-gmock-matchers",level:3},{value:"More String Assertions",id:"more-string-assertions",level:3},{value:"Windows HRESULT assertions",id:"windows-hresult-assertions",level:3},{value:"Type Assertions",id:"type-assertions",level:3},{value:"Assertion Placement",id:"assertion-placement",level:3},{value:"Skipping test execution",id:"skipping-test-execution",level:2},{value:"Teaching GoogleTest How to Print Your Values",id:"teaching-googletest-how-to-print-your-values",level:2},{value:"Regular Expression Syntax",id:"regular-expression-syntax",level:2},{value:"Death Tests",id:"death-tests",level:2},{value:"How to Write a Death Test",id:"how-to-write-a-death-test",level:3},{value:"Death Test Naming",id:"death-test-naming",level:3},{value:"How It Works",id:"how-it-works",level:3},{value:"Death Tests And Threads",id:"death-tests-and-threads",level:3},{value:"Death Test Styles",id:"death-test-styles",level:3},{value:"Caveats",id:"caveats",level:3},{value:"Using Assertions in Sub-routines",id:"using-assertions-in-sub-routines",level:2},{value:"Adding Traces to Assertions",id:"adding-traces-to-assertions",level:3},{value:"Propagating Fatal Failures",id:"propagating-fatal-failures",level:3},{value:"Asserting on Subroutines with an exception",id:"asserting-on-subroutines-with-an-exception",level:4},{value:"Asserting on Subroutines",id:"asserting-on-subroutines",level:4},{value:"Checking for Failures in the Current Test",id:"checking-for-failures-in-the-current-test",level:4},{value:"Logging Additional Information",id:"logging-additional-information",level:2},{value:"Sharing Resources Between Tests in the Same Test Suite",id:"sharing-resources-between-tests-in-the-same-test-suite",level:2},{value:"Global Set-Up and Tear-Down",id:"global-set-up-and-tear-down",level:2},{value:"Value-Parameterized Tests",id:"value-parameterized-tests",level:2},{value:"How to Write Value-Parameterized Tests",id:"how-to-write-value-parameterized-tests",level:3},{value:"Creating Value-Parameterized Abstract Tests",id:"creating-value-parameterized-abstract-tests",level:3},{value:"Specifying Names for Value-Parameterized Test Parameters",id:"specifying-names-for-value-parameterized-test-parameters",level:3},{value:"Typed Tests",id:"typed-tests",level:2},{value:"Type-Parameterized Tests",id:"type-parameterized-tests",level:2},{value:"Testing Private Code",id:"testing-private-code",level:2},{value:"&quot;Catching&quot; Failures",id:"catching-failures",level:2},{value:"Registering tests programmatically",id:"registering-tests-programmatically",level:2},{value:"Getting the Current Test&#39;s Name",id:"getting-the-current-tests-name",level:2},{value:"Extending GoogleTest by Handling Test Events",id:"extending-googletest-by-handling-test-events",level:2},{value:"Defining Event Listeners",id:"defining-event-listeners",level:3},{value:"Using Event Listeners",id:"using-event-listeners",level:3},{value:"Generating Failures in Listeners",id:"generating-failures-in-listeners",level:3},{value:"Running Test Programs: Advanced Options",id:"running-test-programs-advanced-options",level:2},{value:"Selecting Tests",id:"selecting-tests",level:3},{value:"Listing Test Names",id:"listing-test-names",level:4},{value:"Running a Subset of the Tests",id:"running-a-subset-of-the-tests",level:4},{value:"Stop test execution upon first failure",id:"stop-test-execution-upon-first-failure",level:4},{value:"Temporarily Disabling Tests",id:"temporarily-disabling-tests",level:4},{value:"Temporarily Enabling Disabled Tests",id:"temporarily-enabling-disabled-tests",level:4},{value:"Enforcing Having At Least One Test Case",id:"enforcing-having-at-least-one-test-case",level:3},{value:"Enforcing Running At Least One Test Case",id:"enforcing-running-at-least-one-test-case",level:3},{value:"Repeating the Tests",id:"repeating-the-tests",level:3},{value:"Shuffling the Tests",id:"shuffling-the-tests",level:3},{value:"Distributing Test Functions to Multiple Machines",id:"distributing-test-functions-to-multiple-machines",level:3},{value:"Controlling Test Output",id:"controlling-test-output",level:3},{value:"Colored Terminal Output",id:"colored-terminal-output",level:4},{value:"Suppressing test passes",id:"suppressing-test-passes",level:4},{value:"Suppressing the Elapsed Time",id:"suppressing-the-elapsed-time",level:4},{value:"Suppressing UTF-8 Text Output",id:"suppressing-utf-8-text-output",level:4},{value:"Generating an XML Report",id:"generating-an-xml-report",level:4},{value:"Generating a JSON Report",id:"generating-a-json-report",level:4},{value:"Controlling How Failures Are Reported",id:"controlling-how-failures-are-reported",level:3},{value:"Detecting Test Premature Exit",id:"detecting-test-premature-exit",level:4},{value:"Turning Assertion Failures into Break-Points",id:"turning-assertion-failures-into-break-points",level:4},{value:"Disabling Catching Test-Thrown Exceptions",id:"disabling-catching-test-thrown-exceptions",level:4},{value:"Sanitizer Integration",id:"sanitizer-integration",level:3}];function d(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"advanced-googletest-topics",children:"Advanced GoogleTest Topics"})}),"\n",(0,i.jsx)(n.h2,{id:"introduction",children:"Introduction"}),"\n",(0,i.jsxs)(n.p,{children:["Now that you have read the ",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/primer",children:"GoogleTest Primer"})," and learned how to\nwrite tests using GoogleTest, it's time to learn some new tricks. This document\nwill show you more assertions as well as how to construct complex failure\nmessages, propagate fatal failures, reuse and speed up your test fixtures, and\nuse various flags with your tests."]}),"\n",(0,i.jsx)(n.h2,{id:"more-assertions",children:"More Assertions"}),"\n",(0,i.jsx)(n.p,{children:"This section covers some less frequently used, but still significant,\nassertions."}),"\n",(0,i.jsx)(n.h3,{id:"explicit-success-and-failure",children:"Explicit Success and Failure"}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/assertions#success-failure",children:"Explicit Success and Failure"})," in\nthe Assertions Reference."]}),"\n",(0,i.jsx)(n.h3,{id:"exception-assertions",children:"Exception Assertions"}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/assertions#exceptions",children:"Exception Assertions"})," in the Assertions\nReference."]}),"\n",(0,i.jsx)(n.h3,{id:"predicate-assertions-for-better-error-messages",children:"Predicate Assertions for Better Error Messages"}),"\n",(0,i.jsxs)(n.p,{children:["Even though GoogleTest has a rich set of assertions, they can never be complete,\nas it's impossible (nor a good idea) to anticipate all scenarios a user might\nrun into. Therefore, sometimes a user has to use ",(0,i.jsx)(n.code,{children:"EXPECT_TRUE()"})," to check a\ncomplex expression, for lack of a better macro. This has the problem of not\nshowing you the values of the parts of the expression, making it hard to\nunderstand what went wrong. As a workaround, some users choose to construct the\nfailure message by themselves, streaming it into ",(0,i.jsx)(n.code,{children:"EXPECT_TRUE()"}),". However, this\nis awkward especially when the expression has side-effects or is expensive to\nevaluate."]}),"\n",(0,i.jsx)(n.p,{children:"GoogleTest gives you three different options to solve this problem:"}),"\n",(0,i.jsx)(n.h4,{id:"using-an-existing-boolean-function",children:"Using an Existing Boolean Function"}),"\n",(0,i.jsxs)(n.p,{children:["If you already have a function or functor that returns ",(0,i.jsx)(n.code,{children:"bool"})," (or a type that\ncan be implicitly converted to ",(0,i.jsx)(n.code,{children:"bool"}),"), you can use it in a ",(0,i.jsx)(n.em,{children:"predicate\nassertion"})," to get the function arguments printed for free. See\n",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/assertions#EXPECT_PRED",children:(0,i.jsx)(n.code,{children:"EXPECT_PRED*"})})," in the Assertions\nReference for details."]}),"\n",(0,i.jsx)(n.h4,{id:"using-a-function-that-returns-an-assertionresult",children:"Using a Function That Returns an AssertionResult"}),"\n",(0,i.jsxs)(n.p,{children:["While ",(0,i.jsx)(n.code,{children:"EXPECT_PRED*()"})," and friends are handy for a quick job, the syntax is not\nsatisfactory: you have to use different macros for different arities, and it\nfeels more like Lisp than C++. The ",(0,i.jsx)(n.code,{children:"::testing::AssertionResult"})," class solves\nthis problem."]}),"\n",(0,i.jsxs)(n.p,{children:["An ",(0,i.jsx)(n.code,{children:"AssertionResult"})," object represents the result of an assertion (whether it's\na success or a failure, and an associated message). You can create an\n",(0,i.jsx)(n.code,{children:"AssertionResult"})," using one of these factory functions:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"namespace testing {\n\n// Returns an AssertionResult object to indicate that an assertion has\n// succeeded.\nAssertionResult AssertionSuccess();\n\n// Returns an AssertionResult object to indicate that an assertion has\n// failed.\nAssertionResult AssertionFailure();\n\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can then use the ",(0,i.jsx)(n.code,{children:"<<"})," operator to stream messages to the ",(0,i.jsx)(n.code,{children:"AssertionResult"}),"\nobject."]}),"\n",(0,i.jsxs)(n.p,{children:["To provide more readable messages in Boolean assertions (e.g. ",(0,i.jsx)(n.code,{children:"EXPECT_TRUE()"}),"),\nwrite a predicate function that returns ",(0,i.jsx)(n.code,{children:"AssertionResult"})," instead of ",(0,i.jsx)(n.code,{children:"bool"}),". For\nexample, if you define ",(0,i.jsx)(n.code,{children:"IsEven()"})," as:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:'testing::AssertionResult IsEven(int n) {\n  if ((n % 2) == 0)\n    return testing::AssertionSuccess();\n  else\n    return testing::AssertionFailure() << n << " is odd";\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"instead of:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"bool IsEven(int n) {\n  return (n % 2) == 0;\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["the failed assertion ",(0,i.jsx)(n.code,{children:"EXPECT_TRUE(IsEven(Fib(4)))"})," will print:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-none",children:"Value of: IsEven(Fib(4))\n  Actual: false (3 is odd)\nExpected: true\n"})}),"\n",(0,i.jsx)(n.p,{children:"instead of a more opaque"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-none",children:"Value of: IsEven(Fib(4))\n  Actual: false\nExpected: true\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If you want informative messages in ",(0,i.jsx)(n.code,{children:"EXPECT_FALSE"})," and ",(0,i.jsx)(n.code,{children:"ASSERT_FALSE"})," as well\n(one third of Boolean assertions in the Google code base are negative ones), and\nare fine with making the predicate slower in the success case, you can supply a\nsuccess message:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:'testing::AssertionResult IsEven(int n) {\n  if ((n % 2) == 0)\n    return testing::AssertionSuccess() << n << " is even";\n  else\n    return testing::AssertionFailure() << n << " is odd";\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["Then the statement ",(0,i.jsx)(n.code,{children:"EXPECT_FALSE(IsEven(Fib(6)))"})," will print"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-none",children:"  Value of: IsEven(Fib(6))\n     Actual: true (8 is even)\n  Expected: false\n"})}),"\n",(0,i.jsx)(n.h4,{id:"using-a-predicate-formatter",children:"Using a Predicate-Formatter"}),"\n",(0,i.jsxs)(n.p,{children:["If you find the default message generated by\n",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/assertions#EXPECT_PRED",children:(0,i.jsx)(n.code,{children:"EXPECT_PRED*"})})," and\n",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/assertions#EXPECT_TRUE",children:(0,i.jsx)(n.code,{children:"EXPECT_TRUE"})})," unsatisfactory, or some\narguments to your predicate do not support streaming to ",(0,i.jsx)(n.code,{children:"ostream"}),", you can\ninstead use ",(0,i.jsx)(n.em,{children:"predicate-formatter assertions"})," to ",(0,i.jsx)(n.em,{children:"fully"})," customize how the\nmessage is formatted. See\n",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/assertions#EXPECT_PRED_FORMAT",children:(0,i.jsx)(n.code,{children:"EXPECT_PRED_FORMAT*"})})," in the\nAssertions Reference for details."]}),"\n",(0,i.jsx)(n.h3,{id:"floating-point-comparison",children:"Floating-Point Comparison"}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/assertions#floating-point",children:"Floating-Point Comparison"})," in the\nAssertions Reference."]}),"\n",(0,i.jsx)(n.h4,{id:"floating-point-predicate-format-functions",children:"Floating-Point Predicate-Format Functions"}),"\n",(0,i.jsxs)(n.p,{children:["Some floating-point operations are useful, but not that often used. In order to\navoid an explosion of new macros, we provide them as predicate-format functions\nthat can be used in the predicate assertion macro\n",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/assertions#EXPECT_PRED_FORMAT",children:(0,i.jsx)(n.code,{children:"EXPECT_PRED_FORMAT2"})}),", for\nexample:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"using ::testing::FloatLE;\nusing ::testing::DoubleLE;\n...\nEXPECT_PRED_FORMAT2(FloatLE, val1, val2);\nEXPECT_PRED_FORMAT2(DoubleLE, val1, val2);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The above code verifies that ",(0,i.jsx)(n.code,{children:"val1"})," is less than, or approximately equal to,\n",(0,i.jsx)(n.code,{children:"val2"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"asserting-using-gmock-matchers",children:"Asserting Using gMock Matchers"}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/assertions#EXPECT_THAT",children:(0,i.jsx)(n.code,{children:"EXPECT_THAT"})})," in the Assertions\nReference."]}),"\n",(0,i.jsx)(n.h3,{id:"more-string-assertions",children:"More String Assertions"}),"\n",(0,i.jsxs)(n.p,{children:["(Please read the ",(0,i.jsx)(n.a,{href:"#asserting-using-gmock-matchers",children:"previous"})," section first if\nyou haven't.)"]}),"\n",(0,i.jsxs)(n.p,{children:["You can use the gMock ",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/matchers#string-matchers",children:"string matchers"}),"\nwith ",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/assertions#EXPECT_THAT",children:(0,i.jsx)(n.code,{children:"EXPECT_THAT"})})," to do more string\ncomparison tricks (sub-string, prefix, suffix, regular expression, and etc). For\nexample,"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:'using ::testing::HasSubstr;\nusing ::testing::MatchesRegex;\n...\n  ASSERT_THAT(foo_string, HasSubstr("needle"));\n  EXPECT_THAT(bar_string, MatchesRegex("\\\\w*\\\\d+"));\n'})}),"\n",(0,i.jsx)(n.h3,{id:"windows-hresult-assertions",children:"Windows HRESULT assertions"}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/assertions#HRESULT",children:"Windows HRESULT Assertions"})," in the\nAssertions Reference."]}),"\n",(0,i.jsx)(n.h3,{id:"type-assertions",children:"Type Assertions"}),"\n",(0,i.jsx)(n.p,{children:"You can call the function"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"::testing::StaticAssertTypeEq<T1, T2>();\n"})}),"\n",(0,i.jsxs)(n.p,{children:["to assert that types ",(0,i.jsx)(n.code,{children:"T1"})," and ",(0,i.jsx)(n.code,{children:"T2"})," are the same. The function does nothing if\nthe assertion is satisfied. If the types are different, the function call will\nfail to compile, the compiler error message will say that ",(0,i.jsx)(n.code,{children:"T1 and T2 are not the same type"})," and most likely (depending on the compiler) show you the actual\nvalues of ",(0,i.jsx)(n.code,{children:"T1"})," and ",(0,i.jsx)(n.code,{children:"T2"}),". This is mainly useful inside template code."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Caveat"}),": When used inside a member function of a class template or a function\ntemplate, ",(0,i.jsx)(n.code,{children:"StaticAssertTypeEq<T1, T2>()"})," is effective only if the function is\ninstantiated. For example, given:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"template <typename T> class Foo {\n public:\n  void Bar() { testing::StaticAssertTypeEq<int, T>(); }\n};\n"})}),"\n",(0,i.jsx)(n.p,{children:"the code:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"void Test1() { Foo<bool> foo; }\n"})}),"\n",(0,i.jsxs)(n.p,{children:["will not generate a compiler error, as ",(0,i.jsx)(n.code,{children:"Foo<bool>::Bar()"})," is never actually\ninstantiated. Instead, you need:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"void Test2() { Foo<bool> foo; foo.Bar(); }\n"})}),"\n",(0,i.jsx)(n.p,{children:"to cause a compiler error."}),"\n",(0,i.jsx)(n.h3,{id:"assertion-placement",children:"Assertion Placement"}),"\n",(0,i.jsxs)(n.p,{children:["You can use assertions in any C++ function. In particular, it doesn't have to be\na method of the test fixture class. The one constraint is that assertions that\ngenerate a fatal failure (",(0,i.jsx)(n.code,{children:"FAIL*"})," and ",(0,i.jsx)(n.code,{children:"ASSERT_*"}),") can only be used in\nvoid-returning functions. This is a consequence of Google's not using\nexceptions. By placing it in a non-void function you'll get a confusing compile\nerror like ",(0,i.jsx)(n.code,{children:'"error: void value not ignored as it ought to be"'})," or ",(0,i.jsx)(n.code,{children:"\"cannot initialize return object of type 'bool' with an rvalue of type 'void'\""})," or\n",(0,i.jsx)(n.code,{children:"\"error: no viable conversion from 'void' to 'string'\""}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["If you need to use fatal assertions in a function that returns non-void, one\noption is to make the function return the value in an out parameter instead. For\nexample, you can rewrite ",(0,i.jsx)(n.code,{children:"T2 Foo(T1 x)"})," to ",(0,i.jsx)(n.code,{children:"void Foo(T1 x, T2* result)"}),". You\nneed to make sure that ",(0,i.jsx)(n.code,{children:"*result"})," contains some sensible value even when the\nfunction returns prematurely. As the function now returns ",(0,i.jsx)(n.code,{children:"void"}),", you can use\nany assertion inside of it."]}),"\n",(0,i.jsxs)(n.p,{children:["If changing the function's type is not an option, you should just use assertions\nthat generate non-fatal failures, such as ",(0,i.jsx)(n.code,{children:"ADD_FAILURE*"})," and ",(0,i.jsx)(n.code,{children:"EXPECT_*"}),"."]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["NOTE: Constructors and destructors are not considered void-returning functions,\naccording to the C++ language specification, and so you may not use fatal\nassertions in them; you'll get a compilation error if you try. Instead, either\ncall ",(0,i.jsx)(n.code,{children:"abort"})," and crash the entire test executable, or put the fatal assertion in\na ",(0,i.jsx)(n.code,{children:"SetUp"}),"/",(0,i.jsx)(n.code,{children:"TearDown"})," function; see\n",(0,i.jsxs)(n.a,{href:"/zh-cn/docs/testing/gt/faq#CtorVsSetUp",children:["constructor/destructor vs. ",(0,i.jsx)(n.code,{children:"SetUp"}),"/",(0,i.jsx)(n.code,{children:"TearDown"})]})]})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["WARNING: A fatal assertion in a helper function (private void-returning method)\ncalled from a constructor or destructor does not terminate the current test, as\nyour intuition might suggest: it merely returns from the constructor or\ndestructor early, possibly leaving your object in a partially-constructed or\npartially-destructed state! You almost certainly want to ",(0,i.jsx)(n.code,{children:"abort"})," or use\n",(0,i.jsx)(n.code,{children:"SetUp"}),"/",(0,i.jsx)(n.code,{children:"TearDown"})," instead."]})}),"\n",(0,i.jsx)(n.h2,{id:"skipping-test-execution",children:"Skipping test execution"}),"\n",(0,i.jsxs)(n.p,{children:["Related to the assertions ",(0,i.jsx)(n.code,{children:"SUCCEED()"})," and ",(0,i.jsx)(n.code,{children:"FAIL()"}),", you can prevent further test\nexecution at runtime with the ",(0,i.jsx)(n.code,{children:"GTEST_SKIP()"})," macro. This is useful when you need\nto check for preconditions of the system under test during runtime and skip\ntests in a meaningful way."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"GTEST_SKIP()"})," can be used in individual test cases or in the ",(0,i.jsx)(n.code,{children:"SetUp()"})," methods\nof classes derived from either ",(0,i.jsx)(n.code,{children:"::testing::Environment"})," or ",(0,i.jsx)(n.code,{children:"::testing::Test"}),".\nFor example:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"TEST(SkipTest, DoesSkip) {\n  GTEST_SKIP() << \"Skipping single test\";\n  FAIL();  // Won't fail; it won't be executed\n}\n\nclass SkipFixture : public ::testing::Test {\n protected:\n  void SetUp() override {\n    GTEST_SKIP() << \"Skipping all tests for this fixture\";\n  }\n};\n\n// Tests for SkipFixture won't be executed.\nTEST_F(SkipFixture, SkipsOneTest) {\n  FAIL();  // Won't fail; it won't be executed\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["As with assertion macros, you can stream a custom message into ",(0,i.jsx)(n.code,{children:"GTEST_SKIP()"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"teaching-googletest-how-to-print-your-values",children:"Teaching GoogleTest How to Print Your Values"}),"\n",(0,i.jsxs)(n.p,{children:["When a test assertion such as ",(0,i.jsx)(n.code,{children:"EXPECT_EQ"})," fails, GoogleTest prints the argument\nvalues to help you debug. It does this using a user-extensible value printer."]}),"\n",(0,i.jsxs)(n.p,{children:["This printer knows how to print built-in C++ types, native arrays, STL\ncontainers, and any type that supports the ",(0,i.jsx)(n.code,{children:"<<"})," operator. For other types, it\nprints the raw bytes in the value and hopes that you the user can figure it out."]}),"\n",(0,i.jsxs)(n.p,{children:["As mentioned earlier, the printer is ",(0,i.jsx)(n.em,{children:"extensible"}),". That means you can teach it\nto do a better job at printing your particular type than to dump the bytes. To\ndo that, define an ",(0,i.jsx)(n.code,{children:"AbslStringify()"})," overload as a ",(0,i.jsx)(n.code,{children:"friend"})," function template\nfor your type:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:'namespace foo {\n\nclass Point {  // We want GoogleTest to be able to print instances of this.\n  ...\n  // Provide a friend overload.\n  template <typename Sink>\n  friend void AbslStringify(Sink& sink, const Point& point) {\n    absl::Format(&sink, "(%d, %d)", point.x, point.y);\n  }\n\n  int x;\n  int y;\n};\n\n// If you can\'t declare the function in the class it\'s important that the\n// AbslStringify overload is defined in the SAME namespace that defines Point.\n// C++\'s look-up rules rely on that.\nenum class EnumWithStringify { kMany = 0, kChoices = 1 };\n\ntemplate <typename Sink>\nvoid AbslStringify(Sink& sink, EnumWithStringify e) {\n  absl::Format(&sink, "%s", e == EnumWithStringify::kMany ? "Many" : "Choices");\n}\n\n}  // namespace foo\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["Note: ",(0,i.jsx)(n.code,{children:"AbslStringify()"}),' utilizes a generic "sink" buffer to construct its\nstring. For more information about supported operations on ',(0,i.jsx)(n.code,{children:"AbslStringify()"}),"'s\nsink, see\n",(0,i.jsxs)(n.a,{href:"https://abseil.io/docs/cpp/guides/abslstringify",children:["the ",(0,i.jsx)(n.code,{children:"AbslStringify()"})," documentation"]}),"."]})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"AbslStringify()"})," can also use ",(0,i.jsx)(n.code,{children:"absl::StrFormat"}),"'s catch-all ",(0,i.jsx)(n.code,{children:"%v"})," type specifier\nwithin its own format strings to perform type deduction. ",(0,i.jsx)(n.code,{children:"Point"})," above could be\nformatted as ",(0,i.jsx)(n.code,{children:'"(%v, %v)"'})," for example, and deduce the ",(0,i.jsx)(n.code,{children:"int"})," values as ",(0,i.jsx)(n.code,{children:"%d"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Sometimes, ",(0,i.jsx)(n.code,{children:"AbslStringify()"})," might not be an option: your team may wish to print\ntypes with extra debugging information for testing purposes only. If so, you can\ninstead define a ",(0,i.jsx)(n.code,{children:"PrintTo()"})," function like this:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:'#include <ostream>\n\nnamespace foo {\n\nclass Point {\n  ...\n  friend void PrintTo(const Point& point, std::ostream* os) {\n    *os << "(" << point.x << "," << point.y << ")";\n  }\n\n  int x;\n  int y;\n};\n\n// If you can\'t declare the function in the class it\'s important that PrintTo()\n// is defined in the SAME namespace that defines Point.  C++\'s look-up rules\n// rely on that.\nvoid PrintTo(const Point& point, std::ostream* os) {\n    *os << "(" << point.x << "," << point.y << ")";\n}\n\n}  // namespace foo\n'})}),"\n",(0,i.jsxs)(n.p,{children:["If you have defined both ",(0,i.jsx)(n.code,{children:"AbslStringify()"})," and ",(0,i.jsx)(n.code,{children:"PrintTo()"}),", the latter will be\nused by GoogleTest. This allows you to customize how the value appears in\nGoogleTest's output without affecting code that relies on the behavior of\n",(0,i.jsx)(n.code,{children:"AbslStringify()"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["If you have an existing ",(0,i.jsx)(n.code,{children:"<<"})," operator and would like to define an\n",(0,i.jsx)(n.code,{children:"AbslStringify()"}),", the latter will be used for GoogleTest printing."]}),"\n",(0,i.jsxs)(n.p,{children:["If you want to print a value ",(0,i.jsx)(n.code,{children:"x"})," using GoogleTest's value printer yourself, just\ncall ",(0,i.jsx)(n.code,{children:"::testing::PrintToString(x)"}),", which returns an ",(0,i.jsx)(n.code,{children:"std::string"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:'vector<pair<Point, int> > point_ints = GetPointIntVector();\n\nEXPECT_TRUE(IsCorrectPointIntVector(point_ints))\n    << "point_ints = " << testing::PrintToString(point_ints);\n'})}),"\n",(0,i.jsxs)(n.p,{children:["For more details regarding ",(0,i.jsx)(n.code,{children:"AbslStringify()"})," and its integration with other\nlibraries, see\n",(0,i.jsx)(n.a,{href:"https://abseil.io/docs/cpp/guides/abslstringify",children:"the documentation"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"regular-expression-syntax",children:"Regular Expression Syntax"}),"\n",(0,i.jsxs)(n.p,{children:["When built with Bazel and using Abseil, GoogleTest uses the\n",(0,i.jsx)(n.a,{href:"https://github.com/google/re2/wiki/Syntax",children:"RE2"})," syntax. Otherwise, for POSIX\nsystems (Linux, Cygwin, Mac), GoogleTest uses the\n",(0,i.jsx)(n.a,{href:"https://pubs.opengroup.org/onlinepubs/009695399/basedefs/xbd_chap09.html#tag_09_04",children:"POSIX extended regular expression"}),"\nsyntax. To learn about POSIX syntax, you may want to read this\n",(0,i.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Regular_expression#POSIX_extended",children:"Wikipedia entry"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["On Windows, GoogleTest uses its own simple regular expression implementation. It\nlacks many features. For example, we don't support union (",(0,i.jsx)(n.code,{children:'"x|y"'}),"), grouping\n(",(0,i.jsx)(n.code,{children:'"(xy)"'}),"), brackets (",(0,i.jsx)(n.code,{children:'"[xy]"'}),"), and repetition count (",(0,i.jsx)(n.code,{children:'"x{5,7}"'}),"), among\nothers. Below is what we do support (",(0,i.jsx)(n.code,{children:"A"})," denotes a literal character, period\n(",(0,i.jsx)(n.code,{children:"."}),"), or a single ",(0,i.jsx)(n.code,{children:"\\\\ "})," escape sequence; ",(0,i.jsx)(n.code,{children:"x"})," and ",(0,i.jsx)(n.code,{children:"y"})," denote regular\nexpressions.):"]}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Expression"}),(0,i.jsx)(n.th,{children:"Meaning"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"c"})}),(0,i.jsxs)(n.td,{children:["matches any literal character ",(0,i.jsx)(n.code,{children:"c"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"\\\\d"})}),(0,i.jsx)(n.td,{children:"matches any decimal digit"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"\\\\D"})}),(0,i.jsx)(n.td,{children:"matches any character that's not a decimal digit"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"\\\\f"})}),(0,i.jsxs)(n.td,{children:["matches ",(0,i.jsx)(n.code,{children:"\\f"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"\\\\n"})}),(0,i.jsxs)(n.td,{children:["matches ",(0,i.jsx)(n.code,{children:"\\n"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"\\\\r"})}),(0,i.jsxs)(n.td,{children:["matches ",(0,i.jsx)(n.code,{children:"\\r"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"\\\\s"})}),(0,i.jsxs)(n.td,{children:["matches any ASCII whitespace, including ",(0,i.jsx)(n.code,{children:"\\n"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"\\\\S"})}),(0,i.jsx)(n.td,{children:"matches any character that's not a whitespace"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"\\\\t"})}),(0,i.jsxs)(n.td,{children:["matches ",(0,i.jsx)(n.code,{children:"\\t"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"\\\\v"})}),(0,i.jsxs)(n.td,{children:["matches ",(0,i.jsx)(n.code,{children:"\\v"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"\\\\w"})}),(0,i.jsxs)(n.td,{children:["matches any letter, ",(0,i.jsx)(n.code,{children:"_"}),", or decimal digit"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"\\\\W"})}),(0,i.jsxs)(n.td,{children:["matches any character that ",(0,i.jsx)(n.code,{children:"\\\\w"})," doesn't match"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"\\\\c"})}),(0,i.jsxs)(n.td,{children:["matches any literal character ",(0,i.jsx)(n.code,{children:"c"}),", which must be a punctuation"]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"."})}),(0,i.jsxs)(n.td,{children:["matches any single character except ",(0,i.jsx)(n.code,{children:"\\n"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"A?"})}),(0,i.jsxs)(n.td,{children:["matches 0 or 1 occurrences of ",(0,i.jsx)(n.code,{children:"A"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"A*"})}),(0,i.jsxs)(n.td,{children:["matches 0 or many occurrences of ",(0,i.jsx)(n.code,{children:"A"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"A+"})}),(0,i.jsxs)(n.td,{children:["matches 1 or many occurrences of ",(0,i.jsx)(n.code,{children:"A"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"^"})}),(0,i.jsx)(n.td,{children:"matches the beginning of a string (not that of each line)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"$"})}),(0,i.jsx)(n.td,{children:"matches the end of a string (not that of each line)"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"xy"})}),(0,i.jsxs)(n.td,{children:["matches ",(0,i.jsx)(n.code,{children:"x"})," followed by ",(0,i.jsx)(n.code,{children:"y"})]})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["To help you determine which capability is available on your system, GoogleTest\ndefines macros to govern which regular expression it is using. The macros are:\n",(0,i.jsx)(n.code,{children:"GTEST_USES_SIMPLE_RE=1"})," or ",(0,i.jsx)(n.code,{children:"GTEST_USES_POSIX_RE=1"}),". If you want your death\ntests to work in all cases, you can either ",(0,i.jsx)(n.code,{children:"#if"})," on these macros or use the more\nlimited syntax only."]}),"\n",(0,i.jsx)(n.h2,{id:"death-tests",children:"Death Tests"}),"\n",(0,i.jsx)(n.p,{children:"In many applications, there are assertions that can cause application failure if\na condition is not met. These consistency checks, which ensure that the program\nis in a known good state, are there to fail at the earliest possible time after\nsome program state is corrupted. If the assertion checks the wrong condition,\nthen the program may proceed in an erroneous state, which could lead to memory\ncorruption, security holes, or worse. Hence it is vitally important to test that\nsuch assertion statements work as expected."}),"\n",(0,i.jsxs)(n.p,{children:["Since these precondition checks cause the processes to die, we call such tests\n",(0,i.jsx)(n.em,{children:"death tests"}),". More generally, any test that checks that a program terminates\n(except by throwing an exception) in an expected fashion is also a death test."]}),"\n",(0,i.jsxs)(n.p,{children:['Note that if a piece of code throws an exception, we don\'t consider it "death"\nfor the purpose of death tests, as the caller of the code could catch the\nexception and avoid the crash. If you want to verify exceptions thrown by your\ncode, see ',(0,i.jsx)(n.a,{href:"#ExceptionAssertions",children:"Exception Assertions"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["If you want to test ",(0,i.jsx)(n.code,{children:"EXPECT_*()/ASSERT_*()"})," failures in your test code, see\n",(0,i.jsx)(n.a,{href:"#catching-failures",children:'"Catching" Failures'}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"how-to-write-a-death-test",children:"How to Write a Death Test"}),"\n",(0,i.jsxs)(n.p,{children:["GoogleTest provides assertion macros to support death tests. See\n",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/assertions#death",children:"Death Assertions"})," in the Assertions Reference\nfor details."]}),"\n",(0,i.jsx)(n.p,{children:"To write a death test, simply use one of the macros inside your test function.\nFor example,"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:'TEST(MyDeathTest, Foo) {\n  // This death test uses a compound statement.\n  ASSERT_DEATH({\n    int n = 5;\n    Foo(&n);\n  }, "Error on line .* of Foo()");\n}\n\nTEST(MyDeathTest, NormalExit) {\n  EXPECT_EXIT(NormalExit(), testing::ExitedWithCode(0), "Success");\n}\n\nTEST(MyDeathTest, KillProcess) {\n  EXPECT_EXIT(KillProcess(), testing::KilledBySignal(SIGKILL),\n              "Sending myself unblockable signal");\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"verifies that:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["calling ",(0,i.jsx)(n.code,{children:"Foo(5)"})," causes the process to die with the given error message,"]}),"\n",(0,i.jsxs)(n.li,{children:["calling ",(0,i.jsx)(n.code,{children:"NormalExit()"})," causes the process to print ",(0,i.jsx)(n.code,{children:'"Success"'})," to stderr and\nexit with exit code 0, and"]}),"\n",(0,i.jsxs)(n.li,{children:["calling ",(0,i.jsx)(n.code,{children:"KillProcess()"})," kills the process with signal ",(0,i.jsx)(n.code,{children:"SIGKILL"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["Warning: If your death test contains mocks and is expecting a specific exit\ncode, then you must allow the mock objects to be leaked via ",(0,i.jsx)(n.code,{children:"Mock::AllowLeak"}),".\nThis is because the mock leak detector will exit with its own error code if it\ndetects a leak."]})}),"\n",(0,i.jsx)(n.p,{children:"The test function body may contain other assertions and statements as well, if\nnecessary."}),"\n",(0,i.jsx)(n.p,{children:"Note that a death test only cares about three things:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["does ",(0,i.jsx)(n.code,{children:"statement"})," abort or exit the process?"]}),"\n",(0,i.jsxs)(n.li,{children:["(in the case of ",(0,i.jsx)(n.code,{children:"ASSERT_EXIT"})," and ",(0,i.jsx)(n.code,{children:"EXPECT_EXIT"}),") does the exit status\nsatisfy ",(0,i.jsx)(n.code,{children:"predicate"}),"? Or (in the case of ",(0,i.jsx)(n.code,{children:"ASSERT_DEATH"})," and ",(0,i.jsx)(n.code,{children:"EXPECT_DEATH"}),")\nis the exit status non-zero? And"]}),"\n",(0,i.jsxs)(n.li,{children:["does the stderr output match ",(0,i.jsx)(n.code,{children:"matcher"}),"?"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["In particular, if ",(0,i.jsx)(n.code,{children:"statement"})," generates an ",(0,i.jsx)(n.code,{children:"ASSERT_*"})," or ",(0,i.jsx)(n.code,{children:"EXPECT_*"})," failure, it\nwill ",(0,i.jsx)(n.strong,{children:"not"})," cause the death test to fail, as GoogleTest assertions don't abort\nthe process."]}),"\n",(0,i.jsx)(n.h3,{id:"death-test-naming",children:"Death Test Naming"}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["IMPORTANT: We strongly recommend you to follow the convention of naming your\n",(0,i.jsx)(n.strong,{children:"test suite"})," (not test) ",(0,i.jsx)(n.code,{children:"*DeathTest"})," when it contains a death test, as\ndemonstrated in the above example. The\n",(0,i.jsx)(n.a,{href:"#death-tests-and-threads",children:"Death Tests And Threads"})," section below explains why."]})}),"\n",(0,i.jsxs)(n.p,{children:["If a test fixture class is shared by normal tests and death tests, you can use\n",(0,i.jsx)(n.code,{children:"using"})," or ",(0,i.jsx)(n.code,{children:"typedef"})," to introduce an alias for the fixture class and avoid\nduplicating its code:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"class FooTest : public testing::Test { ... };\n\nusing FooDeathTest = FooTest;\n\nTEST_F(FooTest, DoesThis) {\n  // normal test\n}\n\nTEST_F(FooDeathTest, DoesThat) {\n  // death test\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"how-it-works",children:"How It Works"}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/assertions#death",children:"Death Assertions"})," in the Assertions\nReference."]}),"\n",(0,i.jsx)(n.h3,{id:"death-tests-and-threads",children:"Death Tests And Threads"}),"\n",(0,i.jsx)(n.p,{children:"The reason for the two death test styles has to do with thread safety. Due to\nwell-known problems with forking in the presence of threads, death tests should\nbe run in a single-threaded context. Sometimes, however, it isn't feasible to\narrange that kind of environment. For example, statically-initialized modules\nmay start threads before main is ever reached. Once threads have been created,\nit may be difficult or impossible to clean them up."}),"\n",(0,i.jsx)(n.p,{children:"GoogleTest has three features intended to raise awareness of threading issues."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"A warning is emitted if multiple threads are running when a death test is\nencountered."}),"\n",(0,i.jsx)(n.li,{children:'Test suites with a name ending in "DeathTest" are run before all other\ntests.'}),"\n",(0,i.jsxs)(n.li,{children:["It uses ",(0,i.jsx)(n.code,{children:"clone()"})," instead of ",(0,i.jsx)(n.code,{children:"fork()"})," to spawn the child process on Linux\n(",(0,i.jsx)(n.code,{children:"clone()"})," is not available on Cygwin and Mac), as ",(0,i.jsx)(n.code,{children:"fork()"})," is more likely\nto cause the child to hang when the parent process has multiple threads."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"It's perfectly fine to create threads inside a death test statement; they are\nexecuted in a separate process and cannot affect the parent."}),"\n",(0,i.jsx)(n.h3,{id:"death-test-styles",children:"Death Test Styles"}),"\n",(0,i.jsx)(n.p,{children:'The "threadsafe" death test style was introduced in order to help mitigate the\nrisks of testing in a possibly multithreaded environment. It trades increased\ntest execution time (potentially dramatically so) for improved thread safety.'}),"\n",(0,i.jsx)(n.p,{children:"The automated testing framework does not set the style flag. You can choose a\nparticular style of death tests by setting the flag programmatically:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:'GTEST_FLAG_SET(death_test_style, "threadsafe");\n'})}),"\n",(0,i.jsxs)(n.p,{children:["You can do this in ",(0,i.jsx)(n.code,{children:"main()"})," to set the style for all death tests in the binary,\nor in individual tests. Recall that flags are saved before running each test and\nrestored afterwards, so you need not do that yourself. For example:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:'int main(int argc, char** argv) {\n  testing::InitGoogleTest(&argc, argv);\n  GTEST_FLAG_SET(death_test_style, "fast");\n  return RUN_ALL_TESTS();\n}\n\nTEST(MyDeathTest, TestOne) {\n  GTEST_FLAG_SET(death_test_style, "threadsafe");\n  // This test is run in the "threadsafe" style:\n  ASSERT_DEATH(ThisShouldDie(), "");\n}\n\nTEST(MyDeathTest, TestTwo) {\n  // This test is run in the "fast" style:\n  ASSERT_DEATH(ThisShouldDie(), "");\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"caveats",children:"Caveats"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"statement"})," argument of ",(0,i.jsx)(n.code,{children:"ASSERT_EXIT()"})," can be any valid C++ statement. If\nit leaves the current function via a ",(0,i.jsx)(n.code,{children:"return"})," statement or by throwing an\nexception, the death test is considered to have failed. Some GoogleTest macros\nmay return from the current function (e.g. ",(0,i.jsx)(n.code,{children:"ASSERT_TRUE()"}),"), so be sure to avoid\nthem in ",(0,i.jsx)(n.code,{children:"statement"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Since ",(0,i.jsx)(n.code,{children:"statement"})," runs in the child process, any in-memory side effect (e.g.\nmodifying a variable, releasing memory, etc) it causes will ",(0,i.jsx)(n.em,{children:"not"})," be observable\nin the parent process. In particular, if you release memory in a death test,\nyour program will fail the heap check as the parent process will never see the\nmemory reclaimed. To solve this problem, you can"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"try not to free memory in a death test;"}),"\n",(0,i.jsx)(n.li,{children:"free the memory again in the parent process; or"}),"\n",(0,i.jsx)(n.li,{children:"do not use the heap checker in your program."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Due to an implementation detail, you cannot place multiple death test assertions\non the same line; otherwise, compilation will fail with an unobvious error\nmessage."}),"\n",(0,i.jsxs)(n.p,{children:['Despite the improved thread safety afforded by the "threadsafe" style of death\ntest, thread problems such as deadlock are still possible in the presence of\nhandlers registered with ',(0,i.jsx)(n.code,{children:"pthread_atfork(3)"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"using-assertions-in-sub-routines",children:"Using Assertions in Sub-routines"}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["Note: If you want to put a series of test assertions in a subroutine to check\nfor a complex condition, consider using\n",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/gmock_cook_book#NewMatchers",children:"a custom GMock matcher"})," instead. This lets you\nprovide a more readable error message in case of failure and avoid all of the\nissues described below."]})}),"\n",(0,i.jsx)(n.h3,{id:"adding-traces-to-assertions",children:"Adding Traces to Assertions"}),"\n",(0,i.jsxs)(n.p,{children:["If a test sub-routine is called from several places, when an assertion inside it\nfails, it can be hard to tell which invocation of the sub-routine the failure is\nfrom. You can alleviate this problem using extra logging or custom failure\nmessages, but that usually clutters up your tests. A better solution is to use\nthe ",(0,i.jsx)(n.code,{children:"SCOPED_TRACE"})," macro or the ",(0,i.jsx)(n.code,{children:"ScopedTrace"})," utility:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"SCOPED_TRACE(message);\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:'ScopedTrace trace("file_path", line_number, message);\n'})}),"\n",(0,i.jsxs)(n.p,{children:["where ",(0,i.jsx)(n.code,{children:"message"})," can be anything streamable to ",(0,i.jsx)(n.code,{children:"std::ostream"}),". ",(0,i.jsx)(n.code,{children:"SCOPED_TRACE"}),"\nmacro will cause the current file name, line number, and the given message to be\nadded in every failure message. ",(0,i.jsx)(n.code,{children:"ScopedTrace"})," accepts explicit file name and\nline number in arguments, which is useful for writing test helpers. The effect\nwill be undone when the control leaves the current lexical scope."]}),"\n",(0,i.jsx)(n.p,{children:"For example,"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:'10: void Sub1(int n) {\n11:   EXPECT_EQ(Bar(n), 1);\n12:   EXPECT_EQ(Bar(n + 1), 2);\n13: }\n14:\n15: TEST(FooTest, Bar) {\n16:   {\n17:     SCOPED_TRACE("A");  // This trace point will be included in\n18:                         // every failure in this scope.\n19:     Sub1(1);\n20:   }\n21:   // Now it won\'t.\n22:   Sub1(9);\n23: }\n'})}),"\n",(0,i.jsx)(n.p,{children:"could result in messages like these:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-none",children:"path/to/foo_test.cc:11: Failure\nValue of: Bar(n)\nExpected: 1\n  Actual: 2\nGoogle Test trace:\npath/to/foo_test.cc:17: A\n\npath/to/foo_test.cc:12: Failure\nValue of: Bar(n + 1)\nExpected: 2\n  Actual: 3\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Without the trace, it would've been difficult to know which invocation of\n",(0,i.jsx)(n.code,{children:"Sub1()"})," the two failures come from respectively. (You could add an extra\nmessage to each assertion in ",(0,i.jsx)(n.code,{children:"Sub1()"})," to indicate the value of ",(0,i.jsx)(n.code,{children:"n"}),", but that's\ntedious.)"]}),"\n",(0,i.jsxs)(n.p,{children:["Some tips on using ",(0,i.jsx)(n.code,{children:"SCOPED_TRACE"}),":"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["With a suitable message, it's often enough to use ",(0,i.jsx)(n.code,{children:"SCOPED_TRACE"})," at the\nbeginning of a sub-routine, instead of at each call site."]}),"\n",(0,i.jsxs)(n.li,{children:["When calling sub-routines inside a loop, make the loop iterator part of the\nmessage in ",(0,i.jsx)(n.code,{children:"SCOPED_TRACE"})," such that you can know which iteration the failure\nis from."]}),"\n",(0,i.jsxs)(n.li,{children:["Sometimes the line number of the trace point is enough for identifying the\nparticular invocation of a sub-routine. In this case, you don't have to\nchoose a unique message for ",(0,i.jsx)(n.code,{children:"SCOPED_TRACE"}),". You can simply use ",(0,i.jsx)(n.code,{children:'""'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["You can use ",(0,i.jsx)(n.code,{children:"SCOPED_TRACE"})," in an inner scope when there is one in the outer\nscope. In this case, all active trace points will be included in the failure\nmessages, in reverse order they are encountered."]}),"\n",(0,i.jsxs)(n.li,{children:["The trace dump is clickable in Emacs - hit ",(0,i.jsx)(n.code,{children:"return"})," on a line number and\nyou'll be taken to that line in the source file!"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"propagating-fatal-failures",children:"Propagating Fatal Failures"}),"\n",(0,i.jsxs)(n.p,{children:["A common pitfall when using ",(0,i.jsx)(n.code,{children:"ASSERT_*"})," and ",(0,i.jsx)(n.code,{children:"FAIL*"})," is not understanding that\nwhen they fail they only abort the ",(0,i.jsx)(n.em,{children:"current function"}),", not the entire test. For\nexample, the following test will segfault:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"void Subroutine() {\n  // Generates a fatal failure and aborts the current function.\n  ASSERT_EQ(1, 2);\n\n  // The following won't be executed.\n  ...\n}\n\nTEST(FooTest, Bar) {\n  Subroutine();  // The intended behavior is for the fatal failure\n                 // in Subroutine() to abort the entire test.\n\n  // The actual behavior: the function goes on after Subroutine() returns.\n  int* p = nullptr;\n  *p = 3;  // Segfault!\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["To alleviate this, GoogleTest provides three different solutions. You could use\neither exceptions, the ",(0,i.jsx)(n.code,{children:"(ASSERT|EXPECT)_NO_FATAL_FAILURE"})," assertions or the\n",(0,i.jsx)(n.code,{children:"HasFatalFailure()"})," function. They are described in the following two\nsubsections."]}),"\n",(0,i.jsx)(n.h4,{id:"asserting-on-subroutines-with-an-exception",children:"Asserting on Subroutines with an exception"}),"\n",(0,i.jsx)(n.p,{children:"The following code can turn ASSERT-failure into an exception:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"class ThrowListener : public testing::EmptyTestEventListener {\n  void OnTestPartResult(const testing::TestPartResult& result) override {\n    if (result.type() == testing::TestPartResult::kFatalFailure) {\n      throw testing::AssertionException(result);\n    }\n  }\n};\nint main(int argc, char** argv) {\n  ...\n  testing::UnitTest::GetInstance()->listeners().Append(new ThrowListener);\n  return RUN_ALL_TESTS();\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["This listener should be added after other listeners if you have any, otherwise\nthey won't see failed ",(0,i.jsx)(n.code,{children:"OnTestPartResult"}),"."]}),"\n",(0,i.jsx)(n.h4,{id:"asserting-on-subroutines",children:"Asserting on Subroutines"}),"\n",(0,i.jsxs)(n.p,{children:["As shown above, if your test calls a subroutine that has an ",(0,i.jsx)(n.code,{children:"ASSERT_*"})," failure\nin it, the test will continue after the subroutine returns. This may not be what\nyou want."]}),"\n",(0,i.jsx)(n.p,{children:"Often people want fatal failures to propagate like exceptions. For that\nGoogleTest offers the following macros:"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Fatal assertion"}),(0,i.jsx)(n.th,{children:"Nonfatal assertion"}),(0,i.jsx)(n.th,{children:"Verifies"})]})}),(0,i.jsx)(n.tbody,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"ASSERT_NO_FATAL_FAILURE(statement);"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"EXPECT_NO_FATAL_FAILURE(statement);"})}),(0,i.jsxs)(n.td,{children:[(0,i.jsx)(n.code,{children:"statement"})," doesn't generate any new fatal failures in the current thread."]})]})})]}),"\n",(0,i.jsxs)(n.p,{children:["Only failures in the thread that executes the assertion are checked to determine\nthe result of this type of assertions. If ",(0,i.jsx)(n.code,{children:"statement"})," creates new threads,\nfailures in these threads are ignored."]}),"\n",(0,i.jsx)(n.p,{children:"Examples:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"ASSERT_NO_FATAL_FAILURE(Foo());\n\nint i;\nEXPECT_NO_FATAL_FAILURE({\n  i = Bar();\n});\n"})}),"\n",(0,i.jsx)(n.p,{children:"Assertions from multiple threads are currently not supported on Windows."}),"\n",(0,i.jsx)(n.h4,{id:"checking-for-failures-in-the-current-test",children:"Checking for Failures in the Current Test"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"HasFatalFailure()"})," in the ",(0,i.jsx)(n.code,{children:"::testing::Test"})," class returns ",(0,i.jsx)(n.code,{children:"true"})," if an\nassertion in the current test has suffered a fatal failure. This allows\nfunctions to catch fatal failures in a sub-routine and return early."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"class Test {\n public:\n  ...\n  static bool HasFatalFailure();\n};\n"})}),"\n",(0,i.jsx)(n.p,{children:"The typical usage, which basically simulates the behavior of a thrown exception,\nis:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"TEST(FooTest, Bar) {\n  Subroutine();\n  // Aborts if Subroutine() had a fatal failure.\n  if (HasFatalFailure()) return;\n\n  // The following won't be executed.\n  ...\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If ",(0,i.jsx)(n.code,{children:"HasFatalFailure()"})," is used outside of ",(0,i.jsx)(n.code,{children:"TEST()"})," , ",(0,i.jsx)(n.code,{children:"TEST_F()"})," , or a test\nfixture, you must add the ",(0,i.jsx)(n.code,{children:"::testing::Test::"})," prefix, as in:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"if (testing::Test::HasFatalFailure()) return;\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Similarly, ",(0,i.jsx)(n.code,{children:"HasNonfatalFailure()"})," returns ",(0,i.jsx)(n.code,{children:"true"})," if the current test has at\nleast one non-fatal failure, and ",(0,i.jsx)(n.code,{children:"HasFailure()"})," returns ",(0,i.jsx)(n.code,{children:"true"})," if the current\ntest has at least one failure of either kind."]}),"\n",(0,i.jsx)(n.h2,{id:"logging-additional-information",children:"Logging Additional Information"}),"\n",(0,i.jsxs)(n.p,{children:["In your test code, you can call ",(0,i.jsx)(n.code,{children:'RecordProperty("key", value)'})," to log additional\ninformation, where ",(0,i.jsx)(n.code,{children:"value"})," can be either a string or an ",(0,i.jsx)(n.code,{children:"int"}),". The ",(0,i.jsx)(n.em,{children:"last"})," value\nrecorded for a key will be emitted to the\n",(0,i.jsx)(n.a,{href:"#generating-an-xml-report",children:"XML output"})," if you specify one. For example, the\ntest"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:'TEST_F(WidgetUsageTest, MinAndMaxWidgets) {\n  RecordProperty("MaximumWidgets", ComputeMaxUsage());\n  RecordProperty("MinimumWidgets", ComputeMinUsage());\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"will output XML like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'  ...\n    <testcase name="MinAndMaxWidgets" file="test.cpp" line="1" status="run" time="0.006" classname="WidgetUsageTest" MaximumWidgets="12" MinimumWidgets="9" />\n  ...\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"NOTE:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"RecordProperty()"})," is a static member of the ",(0,i.jsx)(n.code,{children:"Test"})," class. Therefore it\nneeds to be prefixed with ",(0,i.jsx)(n.code,{children:"::testing::Test::"})," if used outside of the\n",(0,i.jsx)(n.code,{children:"TEST"})," body and the test fixture class."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.em,{children:(0,i.jsx)(n.code,{children:"key"})})," must be a valid XML attribute name, and cannot conflict with the\nones already used by GoogleTest (",(0,i.jsx)(n.code,{children:"name"}),", ",(0,i.jsx)(n.code,{children:"status"}),", ",(0,i.jsx)(n.code,{children:"time"}),", ",(0,i.jsx)(n.code,{children:"classname"}),",\n",(0,i.jsx)(n.code,{children:"type_param"}),", and ",(0,i.jsx)(n.code,{children:"value_param"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["Calling ",(0,i.jsx)(n.code,{children:"RecordProperty()"})," outside of the lifespan of a test is allowed.\nIf it's called outside of a test but between a test suite's\n",(0,i.jsx)(n.code,{children:"SetUpTestSuite()"})," and ",(0,i.jsx)(n.code,{children:"TearDownTestSuite()"})," methods, it will be\nattributed to the XML element for the test suite. If it's called outside\nof all test suites (e.g. in a test environment), it will be attributed to\nthe top-level XML element."]}),"\n"]}),"\n"]})}),"\n",(0,i.jsx)(n.h2,{id:"sharing-resources-between-tests-in-the-same-test-suite",children:"Sharing Resources Between Tests in the Same Test Suite"}),"\n",(0,i.jsx)(n.p,{children:"GoogleTest creates a new test fixture object for each test in order to make\ntests independent and easier to debug. However, sometimes tests use resources\nthat are expensive to set up, making the one-copy-per-test model prohibitively\nexpensive."}),"\n",(0,i.jsx)(n.p,{children:"If the tests don't change the resource, there's no harm in their sharing a\nsingle resource copy. So, in addition to per-test set-up/tear-down, GoogleTest\nalso supports per-test-suite set-up/tear-down. To use it:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["In your test fixture class (say ",(0,i.jsx)(n.code,{children:"FooTest"})," ), declare as ",(0,i.jsx)(n.code,{children:"static"})," some member\nvariables to hold the shared resources."]}),"\n",(0,i.jsx)(n.li,{children:"Outside your test fixture class (typically just below it), define those\nmember variables, optionally giving them initial values."}),"\n",(0,i.jsxs)(n.li,{children:["In the same test fixture class, define a public member function ",(0,i.jsx)(n.code,{children:"static void SetUpTestSuite()"})," (remember not to spell it as ",(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"SetupTestSuite"})})," with a\nsmall ",(0,i.jsx)(n.code,{children:"u"}),"!) to set up the shared resources and a ",(0,i.jsx)(n.code,{children:"static void TearDownTestSuite()"})," function to tear them down."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["That's it! GoogleTest automatically calls ",(0,i.jsx)(n.code,{children:"SetUpTestSuite()"})," before running the\n",(0,i.jsx)(n.em,{children:"first test"})," in the ",(0,i.jsx)(n.code,{children:"FooTest"})," test suite (i.e. before creating the first\n",(0,i.jsx)(n.code,{children:"FooTest"})," object), and calls ",(0,i.jsx)(n.code,{children:"TearDownTestSuite()"})," after running the ",(0,i.jsx)(n.em,{children:"last test"}),"\nin it (i.e. after deleting the last ",(0,i.jsx)(n.code,{children:"FooTest"})," object). In between, the tests can\nuse the shared resources."]}),"\n",(0,i.jsx)(n.p,{children:"Remember that the test order is undefined, so your code can't depend on a test\npreceding or following another. Also, the tests must either not modify the state\nof any shared resource, or, if they do modify the state, they must restore the\nstate to its original value before passing control to the next test."}),"\n",(0,i.jsxs)(n.p,{children:["Note that ",(0,i.jsx)(n.code,{children:"SetUpTestSuite()"})," may be called multiple times for a test fixture\nclass that has derived classes, so you should not expect code in the function\nbody to be run only once. Also, derived classes still have access to shared\nresources defined as static members, so careful consideration is needed when\nmanaging shared resources to avoid memory leaks if shared resources are not\nproperly cleaned up in ",(0,i.jsx)(n.code,{children:"TearDownTestSuite()"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"Here's an example of per-test-suite set-up and tear-down:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"class FooTest : public testing::Test {\n protected:\n  // Per-test-suite set-up.\n  // Called before the first test in this test suite.\n  // Can be omitted if not needed.\n  static void SetUpTestSuite() {\n    shared_resource_ = new ...;\n\n    // If `shared_resource_` is **not deleted** in `TearDownTestSuite()`,\n    // reallocation should be prevented because `SetUpTestSuite()` may be called\n    // in subclasses of FooTest and lead to memory leak.\n    //\n    // if (shared_resource_ == nullptr) {\n    //   shared_resource_ = new ...;\n    // }\n  }\n\n  // Per-test-suite tear-down.\n  // Called after the last test in this test suite.\n  // Can be omitted if not needed.\n  static void TearDownTestSuite() {\n    delete shared_resource_;\n    shared_resource_ = nullptr;\n  }\n\n  // You can define per-test set-up logic as usual.\n  void SetUp() override { ... }\n\n  // You can define per-test tear-down logic as usual.\n  void TearDown() override { ... }\n\n  // Some expensive resource shared by all tests.\n  static T* shared_resource_;\n};\n\nT* FooTest::shared_resource_ = nullptr;\n\nTEST_F(FooTest, Test1) {\n  ... you can refer to shared_resource_ here ...\n}\n\nTEST_F(FooTest, Test2) {\n  ... you can refer to shared_resource_ here ...\n}\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["NOTE: Though the above code declares ",(0,i.jsx)(n.code,{children:"SetUpTestSuite()"})," protected, it may\nsometimes be necessary to declare it public, such as when using it with\n",(0,i.jsx)(n.code,{children:"TEST_P"}),"."]})}),"\n",(0,i.jsx)(n.h2,{id:"global-set-up-and-tear-down",children:"Global Set-Up and Tear-Down"}),"\n",(0,i.jsx)(n.p,{children:"Just as you can do set-up and tear-down at the test level and the test suite\nlevel, you can also do it at the test program level. Here's how."}),"\n",(0,i.jsxs)(n.p,{children:["First, you subclass the ",(0,i.jsx)(n.code,{children:"::testing::Environment"})," class to define a test\nenvironment, which knows how to set-up and tear-down:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"class Environment : public ::testing::Environment {\n public:\n  ~Environment() override {}\n\n  // Override this to define how to set up the environment.\n  void SetUp() override {}\n\n  // Override this to define how to tear down the environment.\n  void TearDown() override {}\n};\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Then, you register an instance of your environment class with GoogleTest by\ncalling the ",(0,i.jsx)(n.code,{children:"::testing::AddGlobalTestEnvironment()"})," function:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"Environment* AddGlobalTestEnvironment(Environment* env);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Now, when ",(0,i.jsx)(n.code,{children:"RUN_ALL_TESTS()"})," is invoked, it first calls the ",(0,i.jsx)(n.code,{children:"SetUp()"})," method. The\ntests are then executed, provided that none of the environments have reported\nfatal failures and ",(0,i.jsx)(n.code,{children:"GTEST_SKIP()"})," has not been invoked. Finally, ",(0,i.jsx)(n.code,{children:"TearDown()"})," is\ncalled."]}),"\n",(0,i.jsxs)(n.p,{children:["Note that ",(0,i.jsx)(n.code,{children:"SetUp()"})," and ",(0,i.jsx)(n.code,{children:"TearDown()"})," are only invoked if there is at least one\ntest to be performed. Importantly, ",(0,i.jsx)(n.code,{children:"TearDown()"})," is executed even if the test is\nnot run due to a fatal failure or ",(0,i.jsx)(n.code,{children:"GTEST_SKIP()"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["Calling ",(0,i.jsx)(n.code,{children:"SetUp()"})," and ",(0,i.jsx)(n.code,{children:"TearDown()"})," for each iteration depends on the flag\n",(0,i.jsx)(n.code,{children:"gtest_recreate_environments_when_repeating"}),". ",(0,i.jsx)(n.code,{children:"SetUp()"})," and ",(0,i.jsx)(n.code,{children:"TearDown()"})," are\ncalled for each environment object when the object is recreated for each\niteration. However, if test environments are not recreated for each iteration,\n",(0,i.jsx)(n.code,{children:"SetUp()"})," is called only on the first iteration, and ",(0,i.jsx)(n.code,{children:"TearDown()"})," is called only\non the last iteration."]}),"\n",(0,i.jsxs)(n.p,{children:["It's OK to register multiple environment objects. In this suite, their ",(0,i.jsx)(n.code,{children:"SetUp()"}),"\nwill be called in the order they are registered, and their ",(0,i.jsx)(n.code,{children:"TearDown()"})," will be\ncalled in the reverse order."]}),"\n",(0,i.jsxs)(n.p,{children:["Note that GoogleTest takes ownership of the registered environment objects.\nTherefore ",(0,i.jsx)(n.strong,{children:"do not delete them"})," by yourself."]}),"\n",(0,i.jsxs)(n.p,{children:["You should call ",(0,i.jsx)(n.code,{children:"AddGlobalTestEnvironment()"})," before ",(0,i.jsx)(n.code,{children:"RUN_ALL_TESTS()"})," is called,\nprobably in ",(0,i.jsx)(n.code,{children:"main()"}),". If you use ",(0,i.jsx)(n.code,{children:"gtest_main"}),", you need to call this before\n",(0,i.jsx)(n.code,{children:"main()"})," starts for it to take effect. One way to do this is to define a global\nvariable like this:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"testing::Environment* const foo_env =\n    testing::AddGlobalTestEnvironment(new FooEnvironment);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["However, we strongly recommend you to write your own ",(0,i.jsx)(n.code,{children:"main()"})," and call\n",(0,i.jsx)(n.code,{children:"AddGlobalTestEnvironment()"})," there, as relying on initialization of global\nvariables makes the code harder to read and may cause problems when you register\nmultiple environments from different translation units and the environments have\ndependencies among them (remember that the compiler doesn't guarantee the order\nin which global variables from different translation units are initialized)."]}),"\n",(0,i.jsx)(n.h2,{id:"value-parameterized-tests",children:"Value-Parameterized Tests"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.em,{children:"Value-parameterized tests"})," allow you to test your code with different\nparameters without writing multiple copies of the same test. This is useful in a\nnumber of situations, for example:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"You have a piece of code whose behavior is affected by one or more\ncommand-line flags. You want to make sure your code performs correctly for\nvarious values of those flags."}),"\n",(0,i.jsx)(n.li,{children:"You want to test different implementations of an OO interface."}),"\n",(0,i.jsx)(n.li,{children:"You want to test your code over various inputs (a.k.a. data-driven testing).\nThis feature is easy to abuse, so please exercise your good sense when doing\nit!"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"how-to-write-value-parameterized-tests",children:"How to Write Value-Parameterized Tests"}),"\n",(0,i.jsxs)(n.p,{children:["To write value-parameterized tests, first you should define a fixture class. It\nmust be derived from both ",(0,i.jsx)(n.code,{children:"testing::Test"})," and ",(0,i.jsx)(n.code,{children:"testing::WithParamInterface<T>"}),"\n(the latter is a pure interface), where ",(0,i.jsx)(n.code,{children:"T"})," is the type of your parameter\nvalues. For convenience, you can just derive the fixture class from\n",(0,i.jsx)(n.code,{children:"testing::TestWithParam<T>"}),", which itself is derived from both ",(0,i.jsx)(n.code,{children:"testing::Test"}),"\nand ",(0,i.jsx)(n.code,{children:"testing::WithParamInterface<T>"}),". ",(0,i.jsx)(n.code,{children:"T"})," can be any copyable type. If it's a\nraw pointer, you are responsible for managing the lifespan of the pointed\nvalues."]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["NOTE: If your test fixture defines ",(0,i.jsx)(n.code,{children:"SetUpTestSuite()"})," or ",(0,i.jsx)(n.code,{children:"TearDownTestSuite()"}),"\nthey must be declared ",(0,i.jsx)(n.strong,{children:"public"})," rather than ",(0,i.jsx)(n.strong,{children:"protected"})," in order to use\n",(0,i.jsx)(n.code,{children:"TEST_P"}),"."]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"class FooTest :\n    public testing::TestWithParam<absl::string_view> {\n  // You can implement all the usual fixture class members here.\n  // To access the test parameter, call GetParam() from class\n  // TestWithParam<T>.\n};\n\n// Or, when you want to add parameters to a pre-existing fixture class:\nclass BaseTest : public testing::Test {\n  ...\n};\nclass BarTest : public BaseTest,\n                public testing::WithParamInterface<absl::string_view> {\n  ...\n};\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Then, use the ",(0,i.jsx)(n.code,{children:"TEST_P"})," macro to define as many test patterns using this fixture\nas you want. The ",(0,i.jsx)(n.code,{children:"_P"}),' suffix is for "parameterized" or "pattern", whichever you\nprefer to think.']}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"TEST_P(FooTest, DoesBlah) {\n  // Inside a test, access the test parameter with the GetParam() method\n  // of the TestWithParam<T> class:\n  EXPECT_TRUE(foo.Blah(GetParam()));\n  ...\n}\n\nTEST_P(FooTest, HasBlahBlah) {\n  ...\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Finally, you can use the ",(0,i.jsx)(n.code,{children:"INSTANTIATE_TEST_SUITE_P"})," macro to instantiate the\ntest suite with any set of parameters you want. GoogleTest defines a number of\nfunctions for generating test parameters\u2014see details at\n",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/testing#INSTANTIATE_TEST_SUITE_P",children:(0,i.jsx)(n.code,{children:"INSTANTIATE_TEST_SUITE_P"})})," in\nthe Testing Reference."]}),"\n",(0,i.jsxs)(n.p,{children:["For example, the following statement will instantiate tests from the ",(0,i.jsx)(n.code,{children:"FooTest"}),"\ntest suite each with parameter values ",(0,i.jsx)(n.code,{children:'"meeny"'}),", ",(0,i.jsx)(n.code,{children:'"miny"'}),", and ",(0,i.jsx)(n.code,{children:'"moe"'})," using the\n",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/testing#param-generators",children:(0,i.jsx)(n.code,{children:"Values"})})," parameter generator:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:'INSTANTIATE_TEST_SUITE_P(MeenyMinyMoe,\n                         FooTest,\n                         testing::Values("meeny", "miny", "moe"));\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"NOTE: The code above must be placed at global or namespace scope, not at\nfunction scope."})}),"\n",(0,i.jsxs)(n.p,{children:["The first argument to ",(0,i.jsx)(n.code,{children:"INSTANTIATE_TEST_SUITE_P"})," is a unique name for the\ninstantiation of the test suite. The next argument is the name of the test\npattern, and the last is the\n",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/testing#param-generators",children:"parameter generator"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["The parameter generator expression is not evaluated until GoogleTest is\ninitialized (via ",(0,i.jsx)(n.code,{children:"InitGoogleTest()"}),"). Any prior initialization done in the\n",(0,i.jsx)(n.code,{children:"main"})," function will be accessible from the parameter generator, for example,\nthe results of flag parsing."]}),"\n",(0,i.jsx)(n.p,{children:"You can instantiate a test pattern more than once, so to distinguish different\ninstances of the pattern, the instantiation name is added as a prefix to the\nactual test suite name. Remember to pick unique prefixes for different\ninstantiations. The tests from the instantiation above will have these names:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"MeenyMinyMoe/FooTest.DoesBlah/0"})," for ",(0,i.jsx)(n.code,{children:'"meeny"'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"MeenyMinyMoe/FooTest.DoesBlah/1"})," for ",(0,i.jsx)(n.code,{children:'"miny"'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"MeenyMinyMoe/FooTest.DoesBlah/2"})," for ",(0,i.jsx)(n.code,{children:'"moe"'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"MeenyMinyMoe/FooTest.HasBlahBlah/0"})," for ",(0,i.jsx)(n.code,{children:'"meeny"'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"MeenyMinyMoe/FooTest.HasBlahBlah/1"})," for ",(0,i.jsx)(n.code,{children:'"miny"'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"MeenyMinyMoe/FooTest.HasBlahBlah/2"})," for ",(0,i.jsx)(n.code,{children:'"moe"'})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["You can use these names in ",(0,i.jsx)(n.a,{href:"#running-a-subset-of-the-tests",children:(0,i.jsx)(n.code,{children:"--gtest_filter"})}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["The following statement will instantiate all tests from ",(0,i.jsx)(n.code,{children:"FooTest"})," again, each\nwith parameter values ",(0,i.jsx)(n.code,{children:'"cat"'})," and ",(0,i.jsx)(n.code,{children:'"dog"'})," using the\n",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/testing#param-generators",children:(0,i.jsx)(n.code,{children:"ValuesIn"})})," parameter generator:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:'constexpr absl::string_view kPets[] = {"cat", "dog"};\nINSTANTIATE_TEST_SUITE_P(Pets, FooTest, testing::ValuesIn(kPets));\n'})}),"\n",(0,i.jsx)(n.p,{children:"The tests from the instantiation above will have these names:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Pets/FooTest.DoesBlah/0"})," for ",(0,i.jsx)(n.code,{children:'"cat"'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Pets/FooTest.DoesBlah/1"})," for ",(0,i.jsx)(n.code,{children:'"dog"'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Pets/FooTest.HasBlahBlah/0"})," for ",(0,i.jsx)(n.code,{children:'"cat"'})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Pets/FooTest.HasBlahBlah/1"})," for ",(0,i.jsx)(n.code,{children:'"dog"'})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Please note that ",(0,i.jsx)(n.code,{children:"INSTANTIATE_TEST_SUITE_P"})," will instantiate ",(0,i.jsx)(n.em,{children:"all"})," tests in the\ngiven test suite, whether their definitions come before or ",(0,i.jsx)(n.em,{children:"after"})," the\n",(0,i.jsx)(n.code,{children:"INSTANTIATE_TEST_SUITE_P"})," statement."]}),"\n",(0,i.jsxs)(n.p,{children:["Additionally, by default, every ",(0,i.jsx)(n.code,{children:"TEST_P"})," without a corresponding\n",(0,i.jsx)(n.code,{children:"INSTANTIATE_TEST_SUITE_P"})," causes a failing test in test suite\n",(0,i.jsx)(n.code,{children:"GoogleTestVerification"}),". If you have a test suite where that omission is not an\nerror, for example it is in a library that may be linked in for other reasons or\nwhere the list of test cases is dynamic and may be empty, then this check can be\nsuppressed by tagging the test suite:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"GTEST_ALLOW_UNINSTANTIATED_PARAMETERIZED_TEST(FooTest);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can see ",(0,i.jsx)(n.a,{href:"https://github.com/google/googletest/blob/main/googletest/samples/sample7_unittest.cc",title:"Parameterized Test example",children:"sample7_unittest.cc"})," and ",(0,i.jsx)(n.a,{href:"https://github.com/google/googletest/blob/main/googletest/samples/sample8_unittest.cc",title:"Parameterized Test example with multiple parameters",children:"sample8_unittest.cc"})," for more examples."]}),"\n",(0,i.jsx)(n.h3,{id:"creating-value-parameterized-abstract-tests",children:"Creating Value-Parameterized Abstract Tests"}),"\n",(0,i.jsxs)(n.p,{children:["In the above, we define and instantiate ",(0,i.jsx)(n.code,{children:"FooTest"})," in the ",(0,i.jsx)(n.em,{children:"same"})," source file.\nSometimes you may want to define value-parameterized tests in a library and let\nother people instantiate them later. This pattern is known as ",(0,i.jsx)(n.em,{children:"abstract tests"}),".\nAs an example of its application, when you are designing an interface you can\nwrite a standard suite of abstract tests (perhaps using a factory function as\nthe test parameter) that all implementations of the interface are expected to\npass. When someone implements the interface, they can instantiate your suite to\nget all the interface-conformance tests for free."]}),"\n",(0,i.jsx)(n.p,{children:"To define abstract tests, you should organize your code like this:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Put the definition of the parameterized test fixture class (e.g. ",(0,i.jsx)(n.code,{children:"FooTest"}),")\nin a header file, say ",(0,i.jsx)(n.code,{children:"foo_param_test.h"}),". Think of this as ",(0,i.jsx)(n.em,{children:"declaring"})," your\nabstract tests."]}),"\n",(0,i.jsxs)(n.li,{children:["Put the ",(0,i.jsx)(n.code,{children:"TEST_P"})," definitions in ",(0,i.jsx)(n.code,{children:"foo_param_test.cc"}),", which includes\n",(0,i.jsx)(n.code,{children:"foo_param_test.h"}),". Think of this as ",(0,i.jsx)(n.em,{children:"implementing"})," your abstract tests."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Once they are defined, you can instantiate them by including ",(0,i.jsx)(n.code,{children:"foo_param_test.h"}),",\ninvoking ",(0,i.jsx)(n.code,{children:"INSTANTIATE_TEST_SUITE_P()"}),", and depending on the library target that\ncontains ",(0,i.jsx)(n.code,{children:"foo_param_test.cc"}),". You can instantiate the same abstract test suite\nmultiple times, possibly in different source files."]}),"\n",(0,i.jsx)(n.h3,{id:"specifying-names-for-value-parameterized-test-parameters",children:"Specifying Names for Value-Parameterized Test Parameters"}),"\n",(0,i.jsxs)(n.p,{children:["The optional last argument to ",(0,i.jsx)(n.code,{children:"INSTANTIATE_TEST_SUITE_P()"})," allows the user to\nspecify a function or functor that generates custom test name suffixes based on\nthe test parameters. The function should accept one argument of type\n",(0,i.jsx)(n.code,{children:"testing::TestParamInfo<class ParamType>"}),", and return ",(0,i.jsx)(n.code,{children:"std::string"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"testing::PrintToStringParamName"})," is a builtin test suffix generator that\nreturns the value of ",(0,i.jsx)(n.code,{children:"testing::PrintToString(GetParam())"}),". It does not work for\n",(0,i.jsx)(n.code,{children:"std::string"})," or C strings."]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["NOTE: test names must be non-empty, unique, and may only contain ASCII\nalphanumeric characters. In particular, they\n",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/faq#why-should-test-suite-names-and-test-names-not-contain-underscore",children:"should not contain underscores"})]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:'class MyTestSuite : public testing::TestWithParam<int> {};\n\nTEST_P(MyTestSuite, MyTest)\n{\n  std::cout << "Example Test Param: " << GetParam() << std::endl;\n}\n\nINSTANTIATE_TEST_SUITE_P(MyGroup, MyTestSuite, testing::Range(0, 10),\n                         testing::PrintToStringParamName());\n'})}),"\n",(0,i.jsx)(n.p,{children:"Providing a custom functor allows for more control over test parameter name\ngeneration, especially for types where the automatic conversion does not\ngenerate helpful parameter names (e.g. strings as demonstrated above). The\nfollowing example illustrates this for multiple parameters, an enumeration type\nand a string, and also demonstrates how to combine generators. It uses a lambda\nfor conciseness:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:'enum class MyType { MY_FOO = 0, MY_BAR = 1 };\n\nclass MyTestSuite : public testing::TestWithParam<std::tuple<MyType, std::string>> {\n};\n\nINSTANTIATE_TEST_SUITE_P(\n    MyGroup, MyTestSuite,\n    testing::Combine(\n        testing::Values(MyType::MY_FOO, MyType::MY_BAR),\n        testing::Values("A", "B")),\n    [](const testing::TestParamInfo<MyTestSuite::ParamType>& info) {\n      std::string name = absl::StrCat(\n          std::get<0>(info.param) == MyType::MY_FOO ? "Foo" : "Bar",\n          std::get<1>(info.param));\n      absl::c_replace_if(name, [](char c) { return !std::isalnum(c); }, \'_\');\n      return name;\n    });\n'})}),"\n",(0,i.jsx)(n.h2,{id:"typed-tests",children:"Typed Tests"}),"\n",(0,i.jsx)(n.p,{children:'Suppose you have multiple implementations of the same interface and want to make\nsure that all of them satisfy some common requirements. Or, you may have defined\nseveral types that are supposed to conform to the same "concept" and you want to\nverify it. In both cases, you want the same test logic repeated for different\ntypes.'}),"\n",(0,i.jsxs)(n.p,{children:["While you can write one ",(0,i.jsx)(n.code,{children:"TEST"})," or ",(0,i.jsx)(n.code,{children:"TEST_F"})," for each type you want to test (and\nyou may even factor the test logic into a function template that you invoke from\nthe ",(0,i.jsx)(n.code,{children:"TEST"}),"), it's tedious and doesn't scale: if you want ",(0,i.jsx)(n.code,{children:"m"})," tests over ",(0,i.jsx)(n.code,{children:"n"}),"\ntypes, you'll end up writing ",(0,i.jsx)(n.code,{children:"m*n"})," ",(0,i.jsx)(n.code,{children:"TEST"}),"s."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.em,{children:"Typed tests"})," allow you to repeat the same test logic over a list of types. You\nonly need to write the test logic once, although you must know the type list\nwhen writing typed tests. Here's how you do it:"]}),"\n",(0,i.jsxs)(n.p,{children:["First, define a fixture class template. It should be parameterized by a type.\nRemember to derive it from ",(0,i.jsx)(n.code,{children:"::testing::Test"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"template <typename T>\nclass FooTest : public testing::Test {\n public:\n  ...\n  using List = std::list<T>;\n  static T shared_;\n  T value_;\n};\n"})}),"\n",(0,i.jsx)(n.p,{children:"Next, associate a list of types with the test suite, which will be repeated for\neach type in the list:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"using MyTypes = ::testing::Types<char, int, unsigned int>;\nTYPED_TEST_SUITE(FooTest, MyTypes);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The type alias (",(0,i.jsx)(n.code,{children:"using"})," or ",(0,i.jsx)(n.code,{children:"typedef"}),") is necessary for the ",(0,i.jsx)(n.code,{children:"TYPED_TEST_SUITE"}),"\nmacro to parse correctly. Otherwise the compiler will think that each comma in\nthe type list introduces a new macro argument."]}),"\n",(0,i.jsxs)(n.p,{children:["Then, use ",(0,i.jsx)(n.code,{children:"TYPED_TEST()"})," instead of ",(0,i.jsx)(n.code,{children:"TEST_F()"})," to define a typed test for this\ntest suite. You can repeat this as many times as you want:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"TYPED_TEST(FooTest, DoesBlah) {\n  // Inside a test, refer to the special name TypeParam to get the type\n  // parameter.  Since we are inside a derived class template, C++ requires\n  // us to visit the members of FooTest via 'this'.\n  TypeParam n = this->value_;\n\n  // To visit static members of the fixture, add the 'TestFixture::'\n  // prefix.\n  n += TestFixture::shared_;\n\n  // To refer to typedefs in the fixture, add the 'typename TestFixture::'\n  // prefix.  The 'typename' is required to satisfy the compiler.\n  typename TestFixture::List values;\n\n  values.push_back(n);\n  ...\n}\n\nTYPED_TEST(FooTest, HasPropertyA) { ... }\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can see ",(0,i.jsx)(n.a,{href:"https://github.com/google/googletest/blob/main/googletest/samples/sample6_unittest.cc",title:"Typed Test example",children:"sample6_unittest.cc"})," for a complete example."]}),"\n",(0,i.jsx)(n.h2,{id:"type-parameterized-tests",children:"Type-Parameterized Tests"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.em,{children:"Type-parameterized tests"})," are like typed tests, except that they don't require\nyou to know the list of types ahead of time. Instead, you can define the test\nlogic first and instantiate it with different type lists later. You can even\ninstantiate it more than once in the same program."]}),"\n",(0,i.jsx)(n.p,{children:"If you are designing an interface or concept, you can define a suite of\ntype-parameterized tests to verify properties that any valid implementation of\nthe interface/concept should have. Then, the author of each implementation can\njust instantiate the test suite with their type to verify that it conforms to\nthe requirements, without having to write similar tests repeatedly. Here's an\nexample:"}),"\n",(0,i.jsx)(n.p,{children:"First, define a fixture class template, as we did with typed tests:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"template <typename T>\nclass FooTest : public testing::Test {\n  void DoSomethingInteresting();\n  ...\n};\n"})}),"\n",(0,i.jsx)(n.p,{children:"Next, declare that you will define a type-parameterized test suite:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"TYPED_TEST_SUITE_P(FooTest);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Then, use ",(0,i.jsx)(n.code,{children:"TYPED_TEST_P()"})," to define a type-parameterized test. You can repeat\nthis as many times as you want:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"TYPED_TEST_P(FooTest, DoesBlah) {\n  // Inside a test, refer to TypeParam to get the type parameter.\n  TypeParam n = 0;\n\n  // You will need to use `this` explicitly to refer to fixture members.\n  this->DoSomethingInteresting()\n  ...\n}\n\nTYPED_TEST_P(FooTest, HasPropertyA) { ... }\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Now the tricky part: you need to register all test patterns using the\n",(0,i.jsx)(n.code,{children:"REGISTER_TYPED_TEST_SUITE_P"})," macro before you can instantiate them. The first\nargument of the macro is the test suite name; the rest are the names of the\ntests in this test suite:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"REGISTER_TYPED_TEST_SUITE_P(FooTest,\n                            DoesBlah, HasPropertyA);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Finally, you are free to instantiate the pattern with the types you want. If you\nput the above code in a header file, you can ",(0,i.jsx)(n.code,{children:"#include"})," it in multiple C++\nsource files and instantiate it multiple times."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"using MyTypes = ::testing::Types<char, int, unsigned int>;\nINSTANTIATE_TYPED_TEST_SUITE_P(My, FooTest, MyTypes);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["To distinguish different instances of the pattern, the first argument to the\n",(0,i.jsx)(n.code,{children:"INSTANTIATE_TYPED_TEST_SUITE_P"})," macro is a prefix that will be added to the\nactual test suite name. Remember to pick unique prefixes for different\ninstances."]}),"\n",(0,i.jsxs)(n.p,{children:["In the special case where the type list contains only one type, you can write\nthat type directly without ",(0,i.jsx)(n.code,{children:"::testing::Types<...>"}),", like this:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"INSTANTIATE_TYPED_TEST_SUITE_P(My, FooTest, int);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["You can see ",(0,i.jsx)(n.a,{href:"https://github.com/google/googletest/blob/main/googletest/samples/sample6_unittest.cc",title:"Typed Test example",children:"sample6_unittest.cc"})," for a complete example."]}),"\n",(0,i.jsx)(n.h2,{id:"testing-private-code",children:"Testing Private Code"}),"\n",(0,i.jsxs)(n.p,{children:["If you change your software's internal implementation, your tests should not\nbreak as long as the change is not observable by users. Therefore, ",(0,i.jsx)(n.strong,{children:"per the\nblack-box testing principle, most of the time you should test your code through\nits public interfaces."})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"If you still find yourself needing to test internal implementation code,\nconsider if there's a better design."})," The desire to test internal\nimplementation is often a sign that the class is doing too much. Consider\nextracting an implementation class, and testing it. Then use that implementation\nclass in the original class."]}),"\n",(0,i.jsx)(n.p,{children:"If you absolutely have to test non-public interface code though, you can. There\nare two cases to consider:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Static functions ( ",(0,i.jsx)(n.em,{children:"not"})," the same as static member functions!) or unnamed\nnamespaces, and"]}),"\n",(0,i.jsx)(n.li,{children:"Private or protected class members"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"To test them, we use the following special techniques:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Both static functions and definitions/declarations in an unnamed namespace\nare only visible within the same translation unit. To test them, move the\nprivate code into the ",(0,i.jsx)(n.code,{children:"foo::internal"})," namespace, where ",(0,i.jsx)(n.code,{children:"foo"})," is the\nnamespace your project normally uses, and put the private declarations in a\n",(0,i.jsx)(n.code,{children:"*-internal.h"})," file. Your production ",(0,i.jsx)(n.code,{children:".cc"})," files and your tests are allowed\nto include this internal header, but your clients are not. This way, you can\nfully test your internal implementation without leaking it to your clients."]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["NOTE: It is also technically ",(0,i.jsx)(n.em,{children:"possible"})," to ",(0,i.jsx)(n.code,{children:"#include"})," the entire ",(0,i.jsx)(n.code,{children:".cc"})," file\nbeing tested in your ",(0,i.jsx)(n.code,{children:"*_test.cc"})," file to test static functions and\ndefinitions/declarations in an unnamed namespace. However, this technique is\n",(0,i.jsx)(n.strong,{children:"not recommended"})," by this documentation and it is only presented here for the\nsake of completeness."]})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"Private class members are only accessible from within the class or by\nfriends. To access a class' private members, you can declare your test\nfixture as a friend to the class and define accessors in your fixture. Tests\nusing the fixture can then access the private members of your production\nclass via the accessors in the fixture. Note that even though your fixture\nis a friend to your production class, your tests are not automatically\nfriends to it, as they are technically defined in sub-classes of the\nfixture."}),"\n",(0,i.jsxs)(n.p,{children:["Another way to test private members is to refactor them into an\nimplementation class, which is then declared in a ",(0,i.jsx)(n.code,{children:"*-internal.h"})," file. Your\nclients aren't allowed to include this header but your tests can."]}),"\n",(0,i.jsx)(n.p,{children:"Or, you can declare an individual test as a friend of your class by adding\nthis line in the class body:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"    FRIEND_TEST(TestSuiteName, TestName);\n"})}),"\n",(0,i.jsx)(n.p,{children:"For example,"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"// foo.h\nclass Foo {\n  ...\n private:\n  FRIEND_TEST(FooTest, BarReturnsZeroOnNull);\n\n  int Bar(void* x);\n};\n\n// foo_test.cc\n...\nTEST(FooTest, BarReturnsZeroOnNull) {\n  Foo foo;\n  EXPECT_EQ(foo.Bar(NULL), 0);  // Uses Foo's private member Bar().\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Pay special attention when your class is defined in a namespace. If you want\nyour test fixtures and tests to be friends of your class, then they must be\ndefined in the exact same namespace (no anonymous or inline namespaces)."}),"\n",(0,i.jsx)(n.p,{children:"For example, if the code to be tested looks like:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"namespace my_namespace {\n\nclass Foo {\n  friend class FooTest;\n  FRIEND_TEST(FooTest, Bar);\n  FRIEND_TEST(FooTest, Baz);\n  ... definition of the class Foo ...\n};\n\n}  // namespace my_namespace\n"})}),"\n",(0,i.jsx)(n.p,{children:"Your test code should be something like:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"namespace my_namespace {\n\nclass FooTest : public testing::Test {\n protected:\n  ...\n};\n\nTEST_F(FooTest, Bar) { ... }\nTEST_F(FooTest, Baz) { ... }\n\n}  // namespace my_namespace\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"catching-failures",children:'"Catching" Failures'}),"\n",(0,i.jsx)(n.p,{children:"If you are building a testing utility on top of GoogleTest, you'll want to test\nyour utility. What framework would you use to test it? GoogleTest, of course."}),"\n",(0,i.jsx)(n.p,{children:"The challenge is to verify that your testing utility reports failures correctly.\nIn frameworks that report a failure by throwing an exception, you could catch\nthe exception and assert on it. But GoogleTest doesn't use exceptions, so how do\nwe test that a piece of code generates an expected failure?"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:'"gtest/gtest-spi.h"'})," contains some constructs to do this.\nAfter #including this header, you can use"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"  EXPECT_FATAL_FAILURE(statement, substring);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["to assert that ",(0,i.jsx)(n.code,{children:"statement"})," generates a fatal (e.g. ",(0,i.jsx)(n.code,{children:"ASSERT_*"}),") failure in the\ncurrent thread whose message contains the given ",(0,i.jsx)(n.code,{children:"substring"}),", or use"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"  EXPECT_NONFATAL_FAILURE(statement, substring);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["if you are expecting a non-fatal (e.g. ",(0,i.jsx)(n.code,{children:"EXPECT_*"}),") failure."]}),"\n",(0,i.jsxs)(n.p,{children:["Only failures in the current thread are checked to determine the result of this\ntype of expectations. If ",(0,i.jsx)(n.code,{children:"statement"})," creates new threads, failures in these\nthreads are also ignored. If you want to catch failures in other threads as\nwell, use one of the following macros instead:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"  EXPECT_FATAL_FAILURE_ON_ALL_THREADS(statement, substring);\n  EXPECT_NONFATAL_FAILURE_ON_ALL_THREADS(statement, substring);\n"})}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsx)(n.p,{children:"NOTE: Assertions from multiple threads are currently not supported on Windows."}),(0,i.jsx)(n.p,{children:"For technical reasons, there are some caveats:"}),(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsx)(n.p,{children:"You cannot stream a failure message to either macro."}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"statement"})," in ",(0,i.jsx)(n.code,{children:"EXPECT_FATAL_FAILURE{_ON_ALL_THREADS}()"})," cannot reference\nlocal non-static variables or non-static members of ",(0,i.jsx)(n.code,{children:"this"})," object."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"statement"})," in ",(0,i.jsx)(n.code,{children:"EXPECT_FATAL_FAILURE{_ON_ALL_THREADS}()"})," cannot return a\nvalue."]}),"\n"]}),"\n"]})]}),"\n",(0,i.jsx)(n.h2,{id:"registering-tests-programmatically",children:"Registering tests programmatically"}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"TEST"})," macros handle the vast majority of all use cases, but there are few\nwhere runtime registration logic is required. For those cases, the framework\nprovides the ",(0,i.jsx)(n.code,{children:"::testing::RegisterTest"})," that allows callers to register arbitrary\ntests dynamically."]}),"\n",(0,i.jsxs)(n.p,{children:["This is an advanced API only to be used when the ",(0,i.jsx)(n.code,{children:"TEST"})," macros are insufficient.\nThe macros should be preferred when possible, as they avoid most of the\ncomplexity of calling this function."]}),"\n",(0,i.jsx)(n.p,{children:"It provides the following signature:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"template <typename Factory>\nTestInfo* RegisterTest(const char* test_suite_name, const char* test_name,\n                       const char* type_param, const char* value_param,\n                       const char* file, int line, Factory factory);\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"factory"})," argument is a factory callable (move-constructible) object or\nfunction pointer that creates a new instance of the Test object. It handles\nownership to the caller. The signature of the callable is ",(0,i.jsx)(n.code,{children:"Fixture*()"}),", where\n",(0,i.jsx)(n.code,{children:"Fixture"})," is the test fixture class for the test. All tests registered with the\nsame ",(0,i.jsx)(n.code,{children:"test_suite_name"})," must return the same fixture type. This is checked at\nruntime."]}),"\n",(0,i.jsxs)(n.p,{children:["The framework will infer the fixture class from the factory and will call the\n",(0,i.jsx)(n.code,{children:"SetUpTestSuite"})," and ",(0,i.jsx)(n.code,{children:"TearDownTestSuite"})," for it."]}),"\n",(0,i.jsxs)(n.p,{children:["Must be called before ",(0,i.jsx)(n.code,{children:"RUN_ALL_TESTS()"})," is invoked, otherwise behavior is\nundefined."]}),"\n",(0,i.jsx)(n.p,{children:"Use case example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:'class MyFixture : public testing::Test {\n public:\n  // All of these optional, just like in regular macro usage.\n  static void SetUpTestSuite() { ... }\n  static void TearDownTestSuite() { ... }\n  void SetUp() override { ... }\n  void TearDown() override { ... }\n};\n\nclass MyTest : public MyFixture {\n public:\n  explicit MyTest(int data) : data_(data) {}\n  void TestBody() override { ... }\n\n private:\n  int data_;\n};\n\nvoid RegisterMyTests(const std::vector<int>& values) {\n  for (int v : values) {\n    testing::RegisterTest(\n        "MyFixture", ("Test" + std::to_string(v)).c_str(), nullptr,\n        std::to_string(v).c_str(),\n        __FILE__, __LINE__,\n        // Important to use the fixture type as the return type here.\n        [=]() -> MyFixture* { return new MyTest(v); });\n  }\n}\n...\nint main(int argc, char** argv) {\n  testing::InitGoogleTest(&argc, argv);\n  std::vector<int> values_to_test = LoadValuesFromConfig();\n  RegisterMyTests(values_to_test);\n  ...\n  return RUN_ALL_TESTS();\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"getting-the-current-tests-name",children:"Getting the Current Test's Name"}),"\n",(0,i.jsxs)(n.p,{children:["Sometimes a function may need to know the name of the currently running test.\nFor example, you may be using the ",(0,i.jsx)(n.code,{children:"SetUp()"})," method of your test fixture to set\nthe golden file name based on which test is running. The\n",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/testing#TestInfo",children:(0,i.jsx)(n.code,{children:"TestInfo"})})," class has this information."]}),"\n",(0,i.jsxs)(n.p,{children:["To obtain a ",(0,i.jsx)(n.code,{children:"TestInfo"})," object for the currently running test, call\n",(0,i.jsx)(n.code,{children:"current_test_info()"})," on the ",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/testing#UnitTest",children:(0,i.jsx)(n.code,{children:"UnitTest"})}),"\nsingleton object:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:'  // Gets information about the currently running test.\n  // Do NOT delete the returned object - it\'s managed by the UnitTest class.\n  const testing::TestInfo* const test_info =\n      testing::UnitTest::GetInstance()->current_test_info();\n\n  printf("We are in test %s of test suite %s.\\n",\n         test_info->name(),\n         test_info->test_suite_name());\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"current_test_info()"})," returns a null pointer if no test is running. In\nparticular, you cannot find the test suite name in ",(0,i.jsx)(n.code,{children:"SetUpTestSuite()"}),",\n",(0,i.jsx)(n.code,{children:"TearDownTestSuite()"})," (where you know the test suite name implicitly), or\nfunctions called from them."]}),"\n",(0,i.jsx)(n.h2,{id:"extending-googletest-by-handling-test-events",children:"Extending GoogleTest by Handling Test Events"}),"\n",(0,i.jsxs)(n.p,{children:["GoogleTest provides an ",(0,i.jsx)(n.strong,{children:"event listener API"})," to let you receive notifications\nabout the progress of a test program and test failures. The events you can\nlisten to include the start and end of the test program, a test suite, or a test\nmethod, among others. You may use this API to augment or replace the standard\nconsole output, replace the XML output, or provide a completely different form\nof output, such as a GUI or a database. You can also use test events as\ncheckpoints to implement a resource leak checker, for example."]}),"\n",(0,i.jsx)(n.h3,{id:"defining-event-listeners",children:"Defining Event Listeners"}),"\n",(0,i.jsxs)(n.p,{children:["To define a event listener, you subclass either\n",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/testing#TestEventListener",children:(0,i.jsx)(n.code,{children:"testing::TestEventListener"})})," or\n",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/testing#EmptyTestEventListener",children:(0,i.jsx)(n.code,{children:"testing::EmptyTestEventListener"})}),"\nThe former is an (abstract) interface, where ",(0,i.jsx)(n.em,{children:"each pure virtual method can be\noverridden to handle a test event"})," (For example, when a test starts, the\n",(0,i.jsx)(n.code,{children:"OnTestStart()"})," method will be called.). The latter provides an empty\nimplementation of all methods in the interface, such that a subclass only needs\nto override the methods it cares about."]}),"\n",(0,i.jsx)(n.p,{children:"When an event is fired, its context is passed to the handler function as an\nargument. The following argument types are used:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"UnitTest reflects the state of the entire test program,"}),"\n",(0,i.jsx)(n.li,{children:"TestSuite has information about a test suite, which can contain one or more\ntests,"}),"\n",(0,i.jsx)(n.li,{children:"TestInfo contains the state of a test, and"}),"\n",(0,i.jsx)(n.li,{children:"TestPartResult represents the result of a test assertion."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"An event handler function can examine the argument it receives to find out\ninteresting information about the event and the test program's state."}),"\n",(0,i.jsx)(n.p,{children:"Here's an example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:'  class MinimalistPrinter : public testing::EmptyTestEventListener {\n    // Called before a test starts.\n    void OnTestStart(const testing::TestInfo& test_info) override {\n      printf("*** Test %s.%s starting.\\n",\n             test_info.test_suite_name(), test_info.name());\n    }\n\n    // Called after a failed assertion or a SUCCESS().\n    void OnTestPartResult(const testing::TestPartResult& test_part_result) override {\n      printf("%s in %s:%d\\n%s\\n",\n             test_part_result.failed() ? "*** Failure" : "Success",\n             test_part_result.file_name(),\n             test_part_result.line_number(),\n             test_part_result.summary());\n    }\n\n    // Called after a test ends.\n    void OnTestEnd(const testing::TestInfo& test_info) override {\n      printf("*** Test %s.%s ending.\\n",\n             test_info.test_suite_name(), test_info.name());\n    }\n  };\n'})}),"\n",(0,i.jsx)(n.h3,{id:"using-event-listeners",children:"Using Event Listeners"}),"\n",(0,i.jsxs)(n.p,{children:["To use the event listener you have defined, add an instance of it to the\nGoogleTest event listener list (represented by class\n",(0,i.jsx)(n.a,{href:"/zh-cn/docs/testing/gt/reference/testing#TestEventListeners",children:(0,i.jsx)(n.code,{children:"TestEventListeners"})}),' - note the "s"\nat the end of the name) in your ',(0,i.jsx)(n.code,{children:"main()"})," function, before calling\n",(0,i.jsx)(n.code,{children:"RUN_ALL_TESTS()"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"int main(int argc, char** argv) {\n  testing::InitGoogleTest(&argc, argv);\n  // Gets hold of the event listener list.\n  testing::TestEventListeners& listeners =\n      testing::UnitTest::GetInstance()->listeners();\n  // Adds a listener to the end.  GoogleTest takes the ownership.\n  listeners.Append(new MinimalistPrinter);\n  return RUN_ALL_TESTS();\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"There's only one problem: the default test result printer is still in effect, so\nits output will mingle with the output from your minimalist printer. To suppress\nthe default printer, just release it from the event listener list and delete it.\nYou can do so by adding one line:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"  ...\n  delete listeners.Release(listeners.default_result_printer());\n  listeners.Append(new MinimalistPrinter);\n  return RUN_ALL_TESTS();\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Now, sit back and enjoy a completely different output from your tests. For more\ndetails, see ",(0,i.jsx)(n.a,{href:"https://github.com/google/googletest/blob/main/googletest/samples/sample9_unittest.cc",title:"Event listener example",children:"sample9_unittest.cc"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["You may append more than one listener to the list. When an ",(0,i.jsx)(n.code,{children:"On*Start()"})," or\n",(0,i.jsx)(n.code,{children:"OnTestPartResult()"})," event is fired, the listeners will receive it in the order\nthey appear in the list (since new listeners are added to the end of the list,\nthe default text printer and the default XML generator will receive the event\nfirst). An ",(0,i.jsx)(n.code,{children:"On*End()"})," event will be received by the listeners in the ",(0,i.jsx)(n.em,{children:"reverse"}),"\norder. This allows output by listeners added later to be framed by output from\nlisteners added earlier."]}),"\n",(0,i.jsx)(n.h3,{id:"generating-failures-in-listeners",children:"Generating Failures in Listeners"}),"\n",(0,i.jsxs)(n.p,{children:["You may use failure-raising macros (",(0,i.jsx)(n.code,{children:"EXPECT_*()"}),", ",(0,i.jsx)(n.code,{children:"ASSERT_*()"}),", ",(0,i.jsx)(n.code,{children:"FAIL()"}),", etc)\nwhen processing an event. There are some restrictions:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["You cannot generate any failure in ",(0,i.jsx)(n.code,{children:"OnTestPartResult()"})," (otherwise it will\ncause ",(0,i.jsx)(n.code,{children:"OnTestPartResult()"})," to be called recursively)."]}),"\n",(0,i.jsxs)(n.li,{children:["A listener that handles ",(0,i.jsx)(n.code,{children:"OnTestPartResult()"})," is not allowed to generate any\nfailure."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["When you add listeners to the listener list, you should put listeners that\nhandle ",(0,i.jsx)(n.code,{children:"OnTestPartResult()"})," ",(0,i.jsx)(n.em,{children:"before"})," listeners that can generate failures. This\nensures that failures generated by the latter are attributed to the right test\nby the former."]}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"https://github.com/google/googletest/blob/main/googletest/samples/sample10_unittest.cc",title:"Failure-raising listener example",children:"sample10_unittest.cc"})," for an example of a failure-raising listener."]}),"\n",(0,i.jsx)(n.h2,{id:"running-test-programs-advanced-options",children:"Running Test Programs: Advanced Options"}),"\n",(0,i.jsxs)(n.p,{children:["GoogleTest test programs are ordinary executables. Once built, you can run them\ndirectly and affect their behavior via the following environment variables\nand/or command line flags. For the flags to work, your programs must call\n",(0,i.jsx)(n.code,{children:"::testing::InitGoogleTest()"})," before calling ",(0,i.jsx)(n.code,{children:"RUN_ALL_TESTS()"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["To see a list of supported flags and their usage, please run your test program\nwith the ",(0,i.jsx)(n.code,{children:"--help"})," flag."]}),"\n",(0,i.jsx)(n.p,{children:"If an option is specified both by an environment variable and by a flag, the\nlatter takes precedence."}),"\n",(0,i.jsx)(n.h3,{id:"selecting-tests",children:"Selecting Tests"}),"\n",(0,i.jsx)(n.h4,{id:"listing-test-names",children:"Listing Test Names"}),"\n",(0,i.jsxs)(n.p,{children:["Sometimes it is necessary to list the available tests in a program before\nrunning them so that a filter may be applied if needed. Including the flag\n",(0,i.jsx)(n.code,{children:"--gtest_list_tests"})," overrides all other flags and lists tests in the following\nformat:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-none",children:"TestSuite1.\n  TestName1\n  TestName2\nTestSuite2.\n  TestName\n"})}),"\n",(0,i.jsx)(n.p,{children:"None of the tests listed are actually run if the flag is provided. There is no\ncorresponding environment variable for this flag."}),"\n",(0,i.jsx)(n.h4,{id:"running-a-subset-of-the-tests",children:"Running a Subset of the Tests"}),"\n",(0,i.jsxs)(n.p,{children:["By default, a GoogleTest program runs all tests the user has defined. Sometimes,\nyou want to run only a subset of the tests (e.g. for debugging or quickly\nverifying a change). If you set the ",(0,i.jsx)(n.code,{children:"GTEST_FILTER"})," environment variable or the\n",(0,i.jsx)(n.code,{children:"--gtest_filter"})," flag to a filter string, GoogleTest will only run the tests\nwhose full names (in the form of ",(0,i.jsx)(n.code,{children:"TestSuiteName.TestName"}),") match the filter."]}),"\n",(0,i.jsxs)(n.p,{children:["The format of a filter is a '",(0,i.jsx)(n.code,{children:":"}),"'-separated list of wildcard patterns (called\nthe ",(0,i.jsx)(n.em,{children:"positive patterns"}),") optionally followed by a '",(0,i.jsx)(n.code,{children:"-"}),"' and another\n'",(0,i.jsx)(n.code,{children:":"}),"'-separated pattern list (called the ",(0,i.jsx)(n.em,{children:"negative patterns"}),"). A test matches\nthe filter if and only if it matches any of the positive patterns but does not\nmatch any of the negative patterns."]}),"\n",(0,i.jsxs)(n.p,{children:["A pattern may contain ",(0,i.jsx)(n.code,{children:"'*'"})," (matches any string) or ",(0,i.jsx)(n.code,{children:"'?'"})," (matches any single\ncharacter). For convenience, the filter ",(0,i.jsx)(n.code,{children:"'*-NegativePatterns'"})," can be also\nwritten as ",(0,i.jsx)(n.code,{children:"'-NegativePatterns'"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"For example:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"./foo_test"})," Has no flag, and thus runs all its tests."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"./foo_test --gtest_filter=*"})," Also runs everything, due to the single\nmatch-everything ",(0,i.jsx)(n.code,{children:"*"})," value."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"./foo_test --gtest_filter=FooTest.*"})," Runs everything in test suite\n",(0,i.jsx)(n.code,{children:"FooTest"})," ."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"./foo_test --gtest_filter=*Null*:*Constructor*"})," Runs any test whose full\nname contains either ",(0,i.jsx)(n.code,{children:'"Null"'})," or ",(0,i.jsx)(n.code,{children:'"Constructor"'})," ."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"./foo_test --gtest_filter=-*DeathTest.*"})," Runs all non-death tests."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"./foo_test --gtest_filter=FooTest.*-FooTest.Bar"})," Runs everything in test\nsuite ",(0,i.jsx)(n.code,{children:"FooTest"})," except ",(0,i.jsx)(n.code,{children:"FooTest.Bar"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"./foo_test --gtest_filter=FooTest.*:BarTest.*-FooTest.Bar:BarTest.Foo"})," Runs\neverything in test suite ",(0,i.jsx)(n.code,{children:"FooTest"})," except ",(0,i.jsx)(n.code,{children:"FooTest.Bar"})," and everything in\ntest suite ",(0,i.jsx)(n.code,{children:"BarTest"})," except ",(0,i.jsx)(n.code,{children:"BarTest.Foo"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"stop-test-execution-upon-first-failure",children:"Stop test execution upon first failure"}),"\n",(0,i.jsxs)(n.p,{children:["By default, a GoogleTest program runs all tests the user has defined. In some\ncases (e.g. iterative test development & execution) it may be desirable stop\ntest execution upon first failure (trading improved latency for completeness).\nIf ",(0,i.jsx)(n.code,{children:"GTEST_FAIL_FAST"})," environment variable or ",(0,i.jsx)(n.code,{children:"--gtest_fail_fast"})," flag is set,\nthe test runner will stop execution as soon as the first test failure is found."]}),"\n",(0,i.jsx)(n.h4,{id:"temporarily-disabling-tests",children:"Temporarily Disabling Tests"}),"\n",(0,i.jsxs)(n.p,{children:["If you have a broken test that you cannot fix right away, you can add the\n",(0,i.jsx)(n.code,{children:"DISABLED_"})," prefix to its name. This will exclude it from execution. This is\nbetter than commenting out the code or using ",(0,i.jsx)(n.code,{children:"#if 0"}),", as disabled tests are\nstill compiled (and thus won't rot)."]}),"\n",(0,i.jsxs)(n.p,{children:["If you need to disable all tests in a test suite, you can either add ",(0,i.jsx)(n.code,{children:"DISABLED_"}),"\nto the front of the name of each test, or alternatively add it to the front of\nthe test suite name."]}),"\n",(0,i.jsx)(n.p,{children:"For example, the following tests won't be run by GoogleTest, even though they\nwill still be compiled:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"// Tests that Foo does Abc.\nTEST(FooTest, DISABLED_DoesAbc) { ... }\n\nclass DISABLED_BarTest : public testing::Test { ... };\n\n// Tests that Bar does Xyz.\nTEST_F(DISABLED_BarTest, DoesXyz) { ... }\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"NOTE: This feature should only be used for temporary pain-relief. You still have\nto fix the disabled tests at a later date. As a reminder, GoogleTest will print\na banner warning you if a test program contains any disabled tests."})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["TIP: You can easily count the number of disabled tests you have using\n",(0,i.jsx)(n.code,{children:"grep"}),". This number can be used as a metric for\nimproving your test quality."]})}),"\n",(0,i.jsx)(n.h4,{id:"temporarily-enabling-disabled-tests",children:"Temporarily Enabling Disabled Tests"}),"\n",(0,i.jsxs)(n.p,{children:["To include disabled tests in test execution, just invoke the test program with\nthe ",(0,i.jsx)(n.code,{children:"--gtest_also_run_disabled_tests"})," flag or set the\n",(0,i.jsx)(n.code,{children:"GTEST_ALSO_RUN_DISABLED_TESTS"})," environment variable to a value other than ",(0,i.jsx)(n.code,{children:"0"}),".\nYou can combine this with the ",(0,i.jsx)(n.code,{children:"--gtest_filter"})," flag to further select which\ndisabled tests to run."]}),"\n",(0,i.jsx)(n.h3,{id:"enforcing-having-at-least-one-test-case",children:"Enforcing Having At Least One Test Case"}),"\n",(0,i.jsx)(n.p,{children:'A not uncommon programmer mistake is to write a test program that has no test\ncase linked in. This can happen, for example, when you put test case definitions\nin a library and the library is not marked as "always link".'}),"\n",(0,i.jsxs)(n.p,{children:["To catch such mistakes, run the test program with the\n",(0,i.jsx)(n.code,{children:"--gtest_fail_if_no_test_linked"})," flag or set the ",(0,i.jsx)(n.code,{children:"GTEST_FAIL_IF_NO_TEST_LINKED"}),"\nenvironment variable to a value other than ",(0,i.jsx)(n.code,{children:"0"}),". Now the program will fail if no\ntest case is linked in."]}),"\n",(0,i.jsxs)(n.p,{children:["Note that ",(0,i.jsx)(n.em,{children:"any"})," test case linked in makes the program valid for the purpose of\nthis check. In particular, even a disabled test case suffices."]}),"\n",(0,i.jsx)(n.h3,{id:"enforcing-running-at-least-one-test-case",children:"Enforcing Running At Least One Test Case"}),"\n",(0,i.jsxs)(n.p,{children:["In addition to enforcing that tests are defined in the binary with\n",(0,i.jsx)(n.code,{children:"--gtest_fail_if_no_test_linked"}),", it is also possible to enforce that a test\ncase was actually executed to ensure that resources are not consumed by tests\nthat do nothing."]}),"\n",(0,i.jsxs)(n.p,{children:["To catch such optimization opportunities, run the test program with the\n",(0,i.jsx)(n.code,{children:"--gtest_fail_if_no_test_selected"})," flag or set the\n",(0,i.jsx)(n.code,{children:"GTEST_FAIL_IF_NO_TEST_SELECTED"})," environment variable to a value other than ",(0,i.jsx)(n.code,{children:"0"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["A test is considered selected if it begins to run, even if it is later skipped\nvia ",(0,i.jsx)(n.code,{children:"GTEST_SKIP"}),". Thus, ",(0,i.jsx)(n.code,{children:"DISABLED"})," tests do not count as selected and neither do\ntests that are not matched by ",(0,i.jsx)(n.code,{children:"--gtest_filter"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"repeating-the-tests",children:"Repeating the Tests"}),"\n",(0,i.jsx)(n.p,{children:"Once in a while you'll run into a test whose result is hit-or-miss. Perhaps it\nwill fail only 1% of the time, making it rather hard to reproduce the bug under\na debugger. This can be a major source of frustration."}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"--gtest_repeat"})," flag allows you to repeat all (or selected) test methods in\na program many times. Hopefully, a flaky test will eventually fail and give you\na chance to debug. Here's how to use it:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-none",children:"$ foo_test --gtest_repeat=1000\nRepeat foo_test 1000 times and don't stop at failures.\n\n$ foo_test --gtest_repeat=-1\nA negative count means repeating forever.\n\n$ foo_test --gtest_repeat=1000 --gtest_break_on_failure\nRepeat foo_test 1000 times, stopping at the first failure.  This\nis especially useful when running under a debugger: when the test\nfails, it will drop into the debugger and you can then inspect\nvariables and stacks.\n\n$ foo_test --gtest_repeat=1000 --gtest_filter=FooBar.*\nRepeat the tests whose name matches the filter 1000 times.\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If your test program contains\n",(0,i.jsx)(n.a,{href:"#global-set-up-and-tear-down",children:"global set-up/tear-down"})," code, it will be\nrepeated in each iteration as well, as the flakiness may be in it. To avoid\nrepeating global set-up/tear-down, specify\n",(0,i.jsx)(n.code,{children:"--gtest_recreate_environments_when_repeating=false"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:["You can also specify the repeat count by setting the ",(0,i.jsx)(n.code,{children:"GTEST_REPEAT"})," environment\nvariable."]}),"\n",(0,i.jsx)(n.h3,{id:"shuffling-the-tests",children:"Shuffling the Tests"}),"\n",(0,i.jsxs)(n.p,{children:["You can specify the ",(0,i.jsx)(n.code,{children:"--gtest_shuffle"})," flag (or set the ",(0,i.jsx)(n.code,{children:"GTEST_SHUFFLE"}),"\nenvironment variable to ",(0,i.jsx)(n.code,{children:"1"}),") to run the tests in a program in a random order.\nThis helps to reveal bad dependencies between tests."]}),"\n",(0,i.jsxs)(n.p,{children:["By default, GoogleTest uses a random seed calculated from the current time.\nTherefore you'll get a different order every time. The console output includes\nthe random seed value, such that you can reproduce an order-related test failure\nlater. To specify the random seed explicitly, use the ",(0,i.jsx)(n.code,{children:"--gtest_random_seed=SEED"}),"\nflag (or set the ",(0,i.jsx)(n.code,{children:"GTEST_RANDOM_SEED"})," environment variable), where ",(0,i.jsx)(n.code,{children:"SEED"})," is an\ninteger in the range [0, 99999]. The seed value 0 is special: it tells\nGoogleTest to do the default behavior of calculating the seed from the current\ntime."]}),"\n",(0,i.jsxs)(n.p,{children:["If you combine this with ",(0,i.jsx)(n.code,{children:"--gtest_repeat=N"}),", GoogleTest will pick a different\nrandom seed and re-shuffle the tests in each iteration."]}),"\n",(0,i.jsx)(n.h3,{id:"distributing-test-functions-to-multiple-machines",children:"Distributing Test Functions to Multiple Machines"}),"\n",(0,i.jsxs)(n.p,{children:["If you have more than one machine you can use to run a test program, you might\nwant to run the test functions in parallel and get the result faster. We call\nthis technique ",(0,i.jsx)(n.em,{children:"sharding"}),", where each machine is called a ",(0,i.jsx)(n.em,{children:"shard"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"GoogleTest is compatible with test sharding. To take advantage of this feature,\nyour test runner (not part of GoogleTest) needs to do the following:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Allocate a number of machines (shards) to run the tests."}),"\n",(0,i.jsxs)(n.li,{children:["On each shard, set the ",(0,i.jsx)(n.code,{children:"GTEST_TOTAL_SHARDS"})," environment variable to the total\nnumber of shards. It must be the same for all shards."]}),"\n",(0,i.jsxs)(n.li,{children:["On each shard, set the ",(0,i.jsx)(n.code,{children:"GTEST_SHARD_INDEX"})," environment variable to the index\nof the shard. Different shards must be assigned different indices, which\nmust be in the range ",(0,i.jsx)(n.code,{children:"[0, GTEST_TOTAL_SHARDS - 1]"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"Run the same test program on all shards. When GoogleTest sees the above two\nenvironment variables, it will select a subset of the test functions to run.\nAcross all shards, each test function in the program will be run exactly\nonce."}),"\n",(0,i.jsx)(n.li,{children:"Wait for all shards to finish, then collect and report the results."}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Your project may have tests that were written without GoogleTest and thus don't\nunderstand this protocol. In order for your test runner to figure out which test\nsupports sharding, it can set the environment variable ",(0,i.jsx)(n.code,{children:"GTEST_SHARD_STATUS_FILE"}),"\nto a non-existent file path. If a test program supports sharding, it will create\nthis file to acknowledge that fact; otherwise it will not create it. The actual\ncontents of the file are not important at this time, although we may put some\nuseful information in it in the future."]}),"\n",(0,i.jsxs)(n.p,{children:["Here's an example to make it clear. Suppose you have a test program ",(0,i.jsx)(n.code,{children:"foo_test"}),"\nthat contains the following 5 test functions:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"TEST(A, V)\nTEST(A, W)\nTEST(B, X)\nTEST(B, Y)\nTEST(B, Z)\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Suppose you have 3 machines at your disposal. To run the test functions in\nparallel, you would set ",(0,i.jsx)(n.code,{children:"GTEST_TOTAL_SHARDS"})," to 3 on all machines, and set\n",(0,i.jsx)(n.code,{children:"GTEST_SHARD_INDEX"})," to 0, 1, and 2 on the machines respectively. Then you would\nrun the same ",(0,i.jsx)(n.code,{children:"foo_test"})," on each machine."]}),"\n",(0,i.jsx)(n.p,{children:"GoogleTest reserves the right to change how the work is distributed across the\nshards, but here's one possible scenario:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Machine #0 runs ",(0,i.jsx)(n.code,{children:"A.V"})," and ",(0,i.jsx)(n.code,{children:"B.X"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Machine #1 runs ",(0,i.jsx)(n.code,{children:"A.W"})," and ",(0,i.jsx)(n.code,{children:"B.Y"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Machine #2 runs ",(0,i.jsx)(n.code,{children:"B.Z"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"controlling-test-output",children:"Controlling Test Output"}),"\n",(0,i.jsx)(n.h4,{id:"colored-terminal-output",children:"Colored Terminal Output"}),"\n",(0,i.jsx)(n.p,{children:"GoogleTest can use colors in its terminal output to make it easier to spot the\nimportant information:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'<font color="green">[----------]</font> 1 test from FooTest\n<font color="green">[ RUN      ]</font> FooTest.DoesAbc\n<font color="green">[       OK ]</font> FooTest.DoesAbc\n<font color="green">[----------]</font> 2 tests from BarTest\n<font color="green">[ RUN      ]</font> BarTest.HasXyzProperty\n<font color="green">[       OK ]</font> BarTest.HasXyzProperty\n<font color="green">[ RUN      ]</font> BarTest.ReturnsTrueOnSuccess\n... some error messages ...\n<font color="red">[   FAILED ]</font> BarTest.ReturnsTrueOnSuccess\n...\n<font color="green">[==========]</font> 30 tests from 14 test suites ran.\n<font color="green">[   PASSED ]</font> 28 tests.\n<font color="red">[   FAILED ]</font> 2 tests, listed below:\n<font color="red">[   FAILED ]</font> BarTest.ReturnsTrueOnSuccess\n<font color="red">[   FAILED ]</font> AnotherTest.DoesXyz\n\n 2 FAILED TESTS\n'})}),"\n",(0,i.jsxs)(n.p,{children:["You can set the ",(0,i.jsx)(n.code,{children:"GTEST_COLOR"})," environment variable or the ",(0,i.jsx)(n.code,{children:"--gtest_color"}),"\ncommand line flag to ",(0,i.jsx)(n.code,{children:"yes"}),", ",(0,i.jsx)(n.code,{children:"no"}),", or ",(0,i.jsx)(n.code,{children:"auto"})," (the default) to enable colors,\ndisable colors, or let GoogleTest decide. When the value is ",(0,i.jsx)(n.code,{children:"auto"}),", GoogleTest\nwill use colors if and only if the output goes to a terminal and (on non-Windows\nplatforms) the ",(0,i.jsx)(n.code,{children:"TERM"})," environment variable is set to ",(0,i.jsx)(n.code,{children:"xterm"})," or ",(0,i.jsx)(n.code,{children:"xterm-color"}),"."]}),"\n",(0,i.jsx)(n.h4,{id:"suppressing-test-passes",children:"Suppressing test passes"}),"\n",(0,i.jsxs)(n.p,{children:["By default, GoogleTest prints 1 line of output for each test, indicating if it\npassed or failed. To show only test failures, run the test program with\n",(0,i.jsx)(n.code,{children:"--gtest_brief=1"}),", or set the GTEST_BRIEF environment variable to ",(0,i.jsx)(n.code,{children:"1"}),"."]}),"\n",(0,i.jsx)(n.h4,{id:"suppressing-the-elapsed-time",children:"Suppressing the Elapsed Time"}),"\n",(0,i.jsxs)(n.p,{children:["By default, GoogleTest prints the time it takes to run each test. To disable\nthat, run the test program with the ",(0,i.jsx)(n.code,{children:"--gtest_print_time=0"})," command line flag, or\nset the GTEST_PRINT_TIME environment variable to ",(0,i.jsx)(n.code,{children:"0"}),"."]}),"\n",(0,i.jsx)(n.h4,{id:"suppressing-utf-8-text-output",children:"Suppressing UTF-8 Text Output"}),"\n",(0,i.jsxs)(n.p,{children:["In case of assertion failures, GoogleTest prints expected and actual values of\ntype ",(0,i.jsx)(n.code,{children:"string"})," both as hex-encoded strings as well as in readable UTF-8 text if\nthey contain valid non-ASCII UTF-8 characters. If you want to suppress the UTF-8\ntext because, for example, you don't have an UTF-8 compatible output medium, run\nthe test program with ",(0,i.jsx)(n.code,{children:"--gtest_print_utf8=0"})," or set the ",(0,i.jsx)(n.code,{children:"GTEST_PRINT_UTF8"}),"\nenvironment variable to ",(0,i.jsx)(n.code,{children:"0"}),"."]}),"\n",(0,i.jsx)(n.h4,{id:"generating-an-xml-report",children:"Generating an XML Report"}),"\n",(0,i.jsx)(n.p,{children:"GoogleTest can emit a detailed XML report to a file in addition to its normal\ntextual output. The report contains the duration of each test, and thus can help\nyou identify slow tests."}),"\n",(0,i.jsxs)(n.p,{children:["To generate the XML report, set the ",(0,i.jsx)(n.code,{children:"GTEST_OUTPUT"})," environment variable or the\n",(0,i.jsx)(n.code,{children:"--gtest_output"})," flag to the string ",(0,i.jsx)(n.code,{children:'"xml:path_to_output_file"'}),", which will\ncreate the file at the given location. You can also just use the string ",(0,i.jsx)(n.code,{children:'"xml"'}),",\nin which case the output can be found in the ",(0,i.jsx)(n.code,{children:"test_detail.xml"})," file in the\ncurrent directory."]}),"\n",(0,i.jsxs)(n.p,{children:["If you specify a directory (for example, ",(0,i.jsx)(n.code,{children:'"xml:output/directory/"'})," on Linux or\n",(0,i.jsx)(n.code,{children:'"xml:output\\directory\\"'})," on Windows), GoogleTest will create the XML file in\nthat directory, named after the test executable (e.g. ",(0,i.jsx)(n.code,{children:"foo_test.xml"})," for test\nprogram ",(0,i.jsx)(n.code,{children:"foo_test"})," or ",(0,i.jsx)(n.code,{children:"foo_test.exe"}),"). If the file already exists (perhaps left\nover from a previous run), GoogleTest will pick a different name (e.g.\n",(0,i.jsx)(n.code,{children:"foo_test_1.xml"}),") to avoid overwriting it."]}),"\n",(0,i.jsxs)(n.p,{children:["The report is based on the ",(0,i.jsx)(n.code,{children:"junitreport"})," Ant task. Since that format was\noriginally intended for Java, a little interpretation is required to make it\napply to GoogleTest tests, as shown here:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<testsuites name="AllTests" ...>\n  <testsuite name="test_case_name" ...>\n    <testcase    name="test_name" ...>\n      <failure message="..."/>\n      <failure message="..."/>\n      <failure message="..."/>\n    </testcase>\n  </testsuite>\n</testsuites>\n'})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["The root ",(0,i.jsx)(n.code,{children:"<testsuites>"})," element corresponds to the entire test program."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"<testsuite>"})," elements correspond to GoogleTest test suites."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"<testcase>"})," elements correspond to GoogleTest test functions."]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"For instance, the following program"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"TEST(MathTest, Addition) { ... }\nTEST(MathTest, Subtraction) { ... }\nTEST(LogicTest, NonContradiction) { ... }\n"})}),"\n",(0,i.jsx)(n.p,{children:"could generate this report:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:'<?xml version="1.0" encoding="UTF-8"?>\n<testsuites tests="3" failures="1" errors="0" time="0.035" timestamp="2011-10-31T18:52:42" name="AllTests">\n  <testsuite name="MathTest" tests="2" failures="1" errors="0" time="0.015">\n    <testcase name="Addition" file="test.cpp" line="1" status="run" time="0.007" classname="">\n      <failure message="Value of: add(1, 1)&#x0A;  Actual: 3&#x0A;Expected: 2" type="">...</failure>\n      <failure message="Value of: add(1, -1)&#x0A;  Actual: 1&#x0A;Expected: 0" type="">...</failure>\n    </testcase>\n    <testcase name="Subtraction" file="test.cpp" line="2" status="run" time="0.005" classname="">\n    </testcase>\n  </testsuite>\n  <testsuite name="LogicTest" tests="1" failures="0" errors="0" time="0.005">\n    <testcase name="NonContradiction" file="test.cpp" line="3" status="run" time="0.005" classname="">\n    </testcase>\n  </testsuite>\n</testsuites>\n'})}),"\n",(0,i.jsx)(n.p,{children:"Things to note:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"tests"})," attribute of a ",(0,i.jsx)(n.code,{children:"<testsuites>"})," or ",(0,i.jsx)(n.code,{children:"<testsuite>"})," element tells how\nmany test functions the GoogleTest program or test suite contains, while the\n",(0,i.jsx)(n.code,{children:"failures"})," attribute tells how many of them failed."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"time"})," attribute expresses the duration of the test, test suite, or\nentire test program in seconds."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"timestamp"})," attribute records the local date and time of the test\nexecution."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"file"})," and ",(0,i.jsx)(n.code,{children:"line"})," attributes record the source file location, where the\ntest was defined."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:["Each ",(0,i.jsx)(n.code,{children:"<failure>"})," element corresponds to a single failed GoogleTest\nassertion."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"generating-a-json-report",children:"Generating a JSON Report"}),"\n",(0,i.jsxs)(n.p,{children:["GoogleTest can also emit a JSON report as an alternative format to XML. To\ngenerate the JSON report, set the ",(0,i.jsx)(n.code,{children:"GTEST_OUTPUT"})," environment variable or the\n",(0,i.jsx)(n.code,{children:"--gtest_output"})," flag to the string ",(0,i.jsx)(n.code,{children:'"json:path_to_output_file"'}),", which will\ncreate the file at the given location. You can also just use the string\n",(0,i.jsx)(n.code,{children:'"json"'}),", in which case the output can be found in the ",(0,i.jsx)(n.code,{children:"test_detail.json"})," file\nin the current directory."]}),"\n",(0,i.jsx)(n.p,{children:"The report format conforms to the following JSON Schema:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "$schema": "https://json-schema.org/schema#",\n  "type": "object",\n  "definitions": {\n    "TestCase": {\n      "type": "object",\n      "properties": {\n        "name": { "type": "string" },\n        "tests": { "type": "integer" },\n        "failures": { "type": "integer" },\n        "disabled": { "type": "integer" },\n        "time": { "type": "string" },\n        "testsuite": {\n          "type": "array",\n          "items": {\n            "$ref": "#/definitions/TestInfo"\n          }\n        }\n      }\n    },\n    "TestInfo": {\n      "type": "object",\n      "properties": {\n        "name": { "type": "string" },\n        "file": { "type": "string" },\n        "line": { "type": "integer" },\n        "status": {\n          "type": "string",\n          "enum": ["RUN", "NOTRUN"]\n        },\n        "time": { "type": "string" },\n        "classname": { "type": "string" },\n        "failures": {\n          "type": "array",\n          "items": {\n            "$ref": "#/definitions/Failure"\n          }\n        }\n      }\n    },\n    "Failure": {\n      "type": "object",\n      "properties": {\n        "failures": { "type": "string" },\n        "type": { "type": "string" }\n      }\n    }\n  },\n  "properties": {\n    "tests": { "type": "integer" },\n    "failures": { "type": "integer" },\n    "disabled": { "type": "integer" },\n    "errors": { "type": "integer" },\n    "timestamp": {\n      "type": "string",\n      "format": "date-time"\n    },\n    "time": { "type": "string" },\n    "name": { "type": "string" },\n    "testsuites": {\n      "type": "array",\n      "items": {\n        "$ref": "#/definitions/TestCase"\n      }\n    }\n  }\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The report uses the format that conforms to the following Proto3 using the\n",(0,i.jsx)(n.a,{href:"https://developers.google.com/protocol-buffers/docs/proto3#json",children:"JSON encoding"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-proto",children:'syntax = "proto3";\n\npackage googletest;\n\nimport "google/protobuf/timestamp.proto";\nimport "google/protobuf/duration.proto";\n\nmessage UnitTest {\n  int32 tests = 1;\n  int32 failures = 2;\n  int32 disabled = 3;\n  int32 errors = 4;\n  google.protobuf.Timestamp timestamp = 5;\n  google.protobuf.Duration time = 6;\n  string name = 7;\n  repeated TestCase testsuites = 8;\n}\n\nmessage TestCase {\n  string name = 1;\n  int32 tests = 2;\n  int32 failures = 3;\n  int32 disabled = 4;\n  int32 errors = 5;\n  google.protobuf.Duration time = 6;\n  repeated TestInfo testsuite = 7;\n}\n\nmessage TestInfo {\n  string name = 1;\n  string file = 6;\n  int32 line = 7;\n  enum Status {\n    RUN = 0;\n    NOTRUN = 1;\n  }\n  Status status = 2;\n  google.protobuf.Duration time = 3;\n  string classname = 4;\n  message Failure {\n    string failures = 1;\n    string type = 2;\n  }\n  repeated Failure failures = 5;\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"For instance, the following program"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-c++",children:"TEST(MathTest, Addition) { ... }\nTEST(MathTest, Subtraction) { ... }\nTEST(LogicTest, NonContradiction) { ... }\n"})}),"\n",(0,i.jsx)(n.p,{children:"could generate this report:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "tests": 3,\n  "failures": 1,\n  "errors": 0,\n  "time": "0.035s",\n  "timestamp": "2011-10-31T18:52:42Z",\n  "name": "AllTests",\n  "testsuites": [\n    {\n      "name": "MathTest",\n      "tests": 2,\n      "failures": 1,\n      "errors": 0,\n      "time": "0.015s",\n      "testsuite": [\n        {\n          "name": "Addition",\n          "file": "test.cpp",\n          "line": 1,\n          "status": "RUN",\n          "time": "0.007s",\n          "classname": "",\n          "failures": [\n            {\n              "message": "Value of: add(1, 1)\\n  Actual: 3\\nExpected: 2",\n              "type": ""\n            },\n            {\n              "message": "Value of: add(1, -1)\\n  Actual: 1\\nExpected: 0",\n              "type": ""\n            }\n          ]\n        },\n        {\n          "name": "Subtraction",\n          "file": "test.cpp",\n          "line": 2,\n          "status": "RUN",\n          "time": "0.005s",\n          "classname": ""\n        }\n      ]\n    },\n    {\n      "name": "LogicTest",\n      "tests": 1,\n      "failures": 0,\n      "errors": 0,\n      "time": "0.005s",\n      "testsuite": [\n        {\n          "name": "NonContradiction",\n          "file": "test.cpp",\n          "line": 3,\n          "status": "RUN",\n          "time": "0.005s",\n          "classname": ""\n        }\n      ]\n    }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsx)(n.p,{children:"IMPORTANT: The exact format of the JSON document is subject to change."})}),"\n",(0,i.jsx)(n.h3,{id:"controlling-how-failures-are-reported",children:"Controlling How Failures Are Reported"}),"\n",(0,i.jsx)(n.h4,{id:"detecting-test-premature-exit",children:"Detecting Test Premature Exit"}),"\n",(0,i.jsxs)(n.p,{children:["Google Test implements the ",(0,i.jsx)(n.em,{children:"premature-exit-file"})," protocol for test runners to\ncatch any kind of unexpected exits of test programs. Upon start, Google Test\ncreates the file which will be automatically deleted after all work has been\nfinished. Then, the test runner can check if this file exists. In case the file\nremains undeleted, the inspected test has exited prematurely."]}),"\n",(0,i.jsxs)(n.p,{children:["This feature is enabled only if the ",(0,i.jsx)(n.code,{children:"TEST_PREMATURE_EXIT_FILE"})," environment\nvariable has been set."]}),"\n",(0,i.jsx)(n.h4,{id:"turning-assertion-failures-into-break-points",children:"Turning Assertion Failures into Break-Points"}),"\n",(0,i.jsxs)(n.p,{children:["When running test programs under a debugger, it's very convenient if the\ndebugger can catch an assertion failure and automatically drop into interactive\nmode. GoogleTest's ",(0,i.jsx)(n.em,{children:"break-on-failure"})," mode supports this behavior."]}),"\n",(0,i.jsxs)(n.p,{children:["To enable it, set the ",(0,i.jsx)(n.code,{children:"GTEST_BREAK_ON_FAILURE"})," environment variable to a value\nother than ",(0,i.jsx)(n.code,{children:"0"}),". Alternatively, you can use the ",(0,i.jsx)(n.code,{children:"--gtest_break_on_failure"}),"\ncommand line flag."]}),"\n",(0,i.jsx)(n.h4,{id:"disabling-catching-test-thrown-exceptions",children:"Disabling Catching Test-Thrown Exceptions"}),"\n",(0,i.jsx)(n.p,{children:"GoogleTest can be used either with or without exceptions enabled. If a test\nthrows a C++ exception or (on Windows) a structured exception (SEH), by default\nGoogleTest catches it, reports it as a test failure, and continues with the next\ntest method. This maximizes the coverage of a test run. Also, on Windows an\nuncaught exception will cause a pop-up window, so catching the exceptions allows\nyou to run the tests automatically."}),"\n",(0,i.jsxs)(n.p,{children:["When debugging the test failures, however, you may instead want the exceptions\nto be handled by the debugger, such that you can examine the call stack when an\nexception is thrown. To achieve that, set the ",(0,i.jsx)(n.code,{children:"GTEST_CATCH_EXCEPTIONS"}),"\nenvironment variable to ",(0,i.jsx)(n.code,{children:"0"}),", or use the ",(0,i.jsx)(n.code,{children:"--gtest_catch_exceptions=0"})," flag when\nrunning the tests."]}),"\n",(0,i.jsx)(n.h3,{id:"sanitizer-integration",children:"Sanitizer Integration"}),"\n",(0,i.jsxs)(n.p,{children:["The\n",(0,i.jsx)(n.a,{href:"https://clang.llvm.org/docs/UndefinedBehaviorSanitizer.html",children:"Undefined Behavior Sanitizer"}),",\n",(0,i.jsx)(n.a,{href:"https://github.com/google/sanitizers/wiki/AddressSanitizer",children:"Address Sanitizer"}),",\nand\n",(0,i.jsx)(n.a,{href:"https://github.com/google/sanitizers/wiki/ThreadSanitizerCppManual",children:"Thread Sanitizer"}),"\nall provide weak functions that you can override to trigger explicit failures\nwhen they detect sanitizer errors, such as creating a reference from ",(0,i.jsx)(n.code,{children:"nullptr"}),".\nTo override these functions, place definitions for them in a source file that\nyou compile as part of your main binary:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'extern "C" {\nvoid __ubsan_on_report() {\n  FAIL() << "Encountered an undefined behavior sanitizer error";\n}\nvoid __asan_on_error() {\n  FAIL() << "Encountered an address sanitizer error";\n}\nvoid __tsan_on_report() {\n  FAIL() << "Encountered a thread sanitizer error";\n}\n}  // extern "C"\n'})}),"\n",(0,i.jsx)(n.p,{children:"After compiling your project with one of the sanitizers enabled, if a particular\ntest triggers a sanitizer error, GoogleTest will report that it failed."})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var s=t(6540);const i={},r=s.createContext(i);function o(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);