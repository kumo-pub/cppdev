"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[3500],{7160:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>a,frontMatter:()=>d,metadata:()=>t,toc:()=>u});const t=JSON.parse('{"id":"foundamentals/status/status","title":"\u6807\u51c6\u5316\u8fd4\u56de\u503c\uff08Standardized Return Values\uff09","description":"Turbo \u5728 turbo/utility \u76ee\u5f55\u4e0b\u5305\u542b\u4e24\u4e2a Status \u5e93\uff1a","source":"@site/i18n/zh-cn/docusaurus-plugin-content-docs/current/foundamentals/status/status.mdx","sourceDirName":"foundamentals/status","slug":"/foundamentals/status/","permalink":"/cppdev/zh-cn/docs/foundamentals/status/","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u6807\u51c6\u5316\u9519\u8bef\u7801","permalink":"/cppdev/zh-cn/docs/foundamentals/status/status-codes"},"next":{"title":"stings","permalink":"/cppdev/zh-cn/docs/foundamentals/strings/"}}');var r=s(4848),l=s(8453);const d={},c="\u6807\u51c6\u5316\u8fd4\u56de\u503c\uff08Standardized Return Values\uff09",i={},u=[{value:"<code>turbo::Status</code> \u6982\u89c8",id:"overview",level:2},{value:"\u4f7f\u7528 Status \u8fd4\u56de\u9519\u8bef",id:"\u4f7f\u7528-status-\u8fd4\u56de\u9519\u8bef",level:2},{value:"\u6807\u51c6\u9519\u8bef\u7801",id:"canonical_errors",level:2},{value:"\u9519\u8bef\u68c0\u67e5",id:"check-errors",level:2},{value:"\u8fd4\u56de Status \u6216\u503c",id:"\u8fd4\u56de-status-\u6216\u503c",level:2},{value:"\u5ffd\u7565 Status \u7ed3\u679c",id:"\u5ffd\u7565-status-\u7ed3\u679c",level:2},{value:"\u8bb0\u5f55\u9996\u4e2a\u9519\u8bef",id:"\u8bb0\u5f55\u9996\u4e2a\u9519\u8bef",level:2},{value:"\u68c0\u67e5\u5b8f",id:"\u68c0\u67e5\u5b8f",level:2}];function o(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"\u6807\u51c6\u5316\u8fd4\u56de\u503cstandardized-return-values",children:"\u6807\u51c6\u5316\u8fd4\u56de\u503c\uff08Standardized Return Values\uff09"})}),"\n",(0,r.jsxs)(n.p,{children:["Turbo \u5728 ",(0,r.jsx)(n.code,{children:"turbo/utility"})," \u76ee\u5f55\u4e0b\u5305\u542b\u4e24\u4e2a Status \u5e93\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:['\u4e00\u4e2a "status" \u5e93\uff0c\u5305\u542b ',(0,r.jsx)(n.code,{children:"turbo::Status"})," \u7c7b\uff08\u7528\u4e8e\u5b58\u50a8\u9519\u8bef\u4fe1\u606f\uff09\u3001\u6807\u51c6\u5316\u7684 ",(0,r.jsx)(n.code,{children:"turbo::StatusCode"})," \u9519\u8bef\u7801\uff0c\u4ee5\u53ca\u751f\u6210\u548c\u4f20\u64ad\u72b6\u6001\u7801\u7684\u76f8\u5173\u5de5\u5177\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:['\u4e00\u4e2a "statusor" \u5e93\uff0c\u5305\u542b ',(0,r.jsx)(n.code,{children:"turbo::Result<T>"})," \u6a21\u677f\u7c7b\uff0c\u53ef\u8fd4\u56de ",(0,r.jsx)(n.code,{children:"turbo::Status"})," \u9519\u8bef\u6216\u7c7b\u578b\u4e3a ",(0,r.jsx)(n.code,{children:"T"})," \u7684\u5bf9\u8c61\u3002",(0,r.jsx)(n.code,{children:"Result<T>"})," \u7c7b\u4f3c\u4e8e ",(0,r.jsxs)(n.a,{href:"https://en.cppreference.com/w/cpp/utility/expected",children:["C++23 \u7684 ",(0,r.jsx)(n.code,{children:"std::expected"})]}),"\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.h2,{id:"overview",children:[(0,r.jsx)(n.code,{children:"turbo::Status"})," \u6982\u89c8"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 Kumo \u4e2d\uff0c",(0,r.jsx)(n.code,{children:"turbo::Status"})," \u662f\u8de8 API \u8fb9\u754c\uff08\u5c24\u5176\u662f\u8de8 RPC\uff09\u4f18\u96c5\u5904\u7406\u9519\u8bef\u7684\u4e3b\u8981\u673a\u5236\u3002\u90e8\u5206\u9519\u8bef\u53ef\u6062\u590d\uff0c\u90e8\u5206\u4e0d\u53ef\u6062\u590d\u3002"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u51fd\u6570\u53ef\u80fd\u4ea7\u751f\u53ef\u6062\u590d\u9519\u8bef\u65f6\uff0c\u5e94\u8fd4\u56de ",(0,r.jsx)(n.code,{children:"turbo::Status"})," \u6216 ",(0,r.jsx)(n.code,{children:"turbo::Result<T>"}),"\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Status"})," \u7528\u4e8e\u8fd4\u56de\u64cd\u4f5c\u7ed3\u679c\uff1a\u6210\u529f\uff08",(0,r.jsx)(n.code,{children:"OK"}),"\uff09\u6216\u7279\u5b9a\u9519\u8bef\u7801\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"StatusCode"})," \u9519\u8bef\u7801\u5728\u6574\u4e2a\u4ee3\u7801\u5e93\u4e2d\u7edf\u4e00\u4f7f\u7528\uff0c\u53ef\u8de8 API/RPC \u8fb9\u754c\u4f20\u9012\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u8fd4\u56de Status \u7684\u51fd\u6570\u5fc5\u987b\u663e\u5f0f\u5904\u7406\u7ed3\u679c\uff08\u6807\u8bb0 ",(0,r.jsx)(n.code,{children:"TURBO_MUST_USE_RESULT"}),"\uff09\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u4f7f\u7528-status-\u8fd4\u56de\u9519\u8bef",children:"\u4f7f\u7528 Status \u8fd4\u56de\u9519\u8bef"}),"\n",(0,r.jsxs)(n.p,{children:["\u64cd\u4f5c\u6210\u529f\u65f6\u8fd4\u56de ",(0,r.jsx)(n.code,{children:"OK"}),"\uff08",(0,r.jsx)(n.code,{children:"turbo::StatusCode::kOk"}),"\uff09\uff0c\u5426\u5219\u8fd4\u56de\u7279\u5b9a\u9519\u8bef\u7801\uff08\u5982 ",(0,r.jsx)(n.code,{children:"kInvalidArgument"}),"\uff09\u3002Turbo \u63d0\u4f9b\u4fbf\u6377\u6784\u9020\u51fd\u6570\u751f\u6210\u6807\u51c6\u9519\u8bef\u7801\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u793a\u4f8b\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c++",children:'turbo::Status Open(turbo::string_view filename, turbo::string_view mode, ...) {\n  if (...) return turbo::OkStatus();  // \u6210\u529f\n  if (...) return turbo::InvalidArgumentError("bad mode");\n\n  turbo::Status result;  // \u9ed8\u8ba4 OK\n  if (...) {\n    result = turbo::NotFoundError(turbo::StrCat(filename, " is missing"));\n  } else {\n    ...\n  }\n  return result;  // \u8fd4\u56de OK \u6216 NOT_FOUND\n}\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"\u975e OK \u72b6\u6001\u901a\u5e38\u5305\u542b\uff1a"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u9519\u8bef\u7801\uff08\u5982 ",(0,r.jsx)(n.code,{children:"kNotFound"}),"\uff09"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u9519\u8bef\u4fe1\u606f\uff08\u5982 ",(0,r.jsx)(n.code,{children:'"file.txt is missing"'}),"\uff09"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsx)(n.p,{children:"\u4f4e\u7ea7 API\uff08\u5982\u6587\u4ef6\u64cd\u4f5c\uff09\u901a\u5e38\u4e0d\u76f4\u63a5\u8bb0\u5f55\u65e5\u5fd7\uff0c\u800c\u662f\u5c06 Status \u8fd4\u56de\u7ed9\u8c03\u7528\u8005\uff0c\u7531\u8c03\u7528\u8005\u5904\u7406\u3002"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"canonical_errors",children:"\u6807\u51c6\u9519\u8bef\u7801"}),"\n",(0,r.jsx)(n.p,{children:"Turbo \u63d0\u4f9b\u901a\u7528\u6807\u51c6\u9519\u8bef\u7801\uff0c\u7528\u4e8e\u7edf\u4e00\u5904\u7406\u9519\u8bef\u3002\u6784\u9020 Status \u65f6\uff0c\u53ef\u5728\u6d88\u606f\u4e2d\u63d0\u4f9b\u4e0a\u4e0b\u6587\u4fe1\u606f\u3002"}),"\n",(0,r.jsxs)(n.p,{children:["\u5b8c\u6574\u9519\u8bef\u7801\u5217\u8868\u8bf7\u53c2\u8003\uff1a",(0,r.jsx)(n.a,{href:"/cppdev/zh-cn/docs/foundamentals/status/status-codes",children:"Standardized Error Codes"}),"\u3002"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"check-errors",children:"\u9519\u8bef\u68c0\u67e5"}),"\n",(0,r.jsxs)(n.p,{children:["\u8c03\u7528\u8005\u5fc5\u987b\u68c0\u67e5 Status\uff0c\u5224\u65ad\u64cd\u4f5c\u662f\u5426\u6210\u529f\uff08",(0,r.jsx)(n.code,{children:"OK"}),"\uff09\uff0c\u5931\u8d25\u65f6\u51b3\u5b9a\u5904\u7406\u65b9\u5f0f\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u63a8\u8350\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"Status::ok()"}),"\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c++",children:'turbo::Status my_status = DoSomething();\n// \u4e0d\u5efa\u8bae\uff1a\n// if (my_status.code() == turbo::StatusCode::kOk) { ... }\n\nif (!my_status.ok()) {\n  LOG(WARNING) << "Unexpected error " << my_status;\n}\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u53ef\u4f7f\u7528\u8f85\u52a9\u51fd\u6570\u68c0\u67e5\u7279\u5b9a\u9519\u8bef\u7801\uff0c\u5982 ",(0,r.jsx)(n.code,{children:"turbo::IsInvalidArgument(status)"}),"\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:["\u591a\u9519\u8bef\u7801\u53ef\u7528 ",(0,r.jsx)(n.code,{children:"switch"})," \u5904\u7406\uff0c\u53ea\u5904\u7406\u53ef\u5904\u7406\u9519\u8bef\uff1b\u4e0d\u53ef\u5904\u7406\u7684\u9519\u8bef\u5e94\u8bb0\u5f55\u6216\u5411\u4e0a\u4f20\u64ad\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"switch"})," \u5e94\u63d0\u4f9b ",(0,r.jsx)(n.code,{children:"default:"}),"\uff0c\u9632\u6b62\u65b0\u589e\u9519\u8bef\u7801\u5bfc\u81f4\u5f02\u5e38\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u793a\u4f8b\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c++",children:'turbo::Status s = Open(filename, "r");\nif (turbo::IsNotFound(s)) {\n  s = Create(...);\n}\nif (!s.ok()) {\n  LOG(WARNING) << "Unexpected error " << s;\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u8fd4\u56de-status-\u6216\u503c",children:"\u8fd4\u56de Status \u6216\u503c"}),"\n",(0,r.jsxs)(n.p,{children:["\u51fd\u6570\u65e2\u53ef\u80fd\u8fd4\u56de\u503c\u53c8\u53ef\u80fd\u8fd4\u56de\u9519\u8bef\u65f6\uff0c\u53ef\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"turbo::Result<T>"}),"\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Result<T>"})," \u5305\u542b\u5bf9\u8c61 ",(0,r.jsx)(n.code,{children:"T"})," \u6216 ",(0,r.jsx)(n.code,{children:"Status"})]}),"\n",(0,r.jsx)(n.li,{children:"\u6210\u529f\u65f6\u6301\u6709\u5bf9\u8c61\uff0c\u5931\u8d25\u65f6\u6301\u6709 Status"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u793a\u4f8b\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c++",children:"Result<Foo> result = Calculation();\nif (result.ok()) {\n  result->DoSomethingCool();\n} else {\n  LOG(ERROR) << result.status();\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u8bbf\u95ee\u5bf9\u8c61\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c++",children:"turbo::Result<int> i = GetCount();\nif (i.ok()) {\n  updated_total += *i;\n}\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"Result<T*>"})," \u53ef\u4e3a nullptr\uff0c",(0,r.jsx)(n.code,{children:"ok()"})," \u8fd4\u56de true\uff0c",(0,r.jsx)(n.code,{children:"value()"})," \u8fd4\u56de nullptr"]}),"\n",(0,r.jsx)(n.li,{children:"\u68c0\u67e5\u6307\u9488\u65f6\u9700\u6ce8\u610f\uff1a"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c++",children:'Result<std::unique_ptr<Foo>> result = FooFactory::MakeNewFoo(arg);\nif (!result.ok()) {\n  LOG(ERROR) << result.status();\n} else if (*result == nullptr) {\n  LOG(ERROR) << "Unexpected null pointer";\n} else {\n  (*result)->DoSomethingCool();\n}\n'})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u5ffd\u7565-status-\u7ed3\u679c",children:"\u5ffd\u7565 Status \u7ed3\u679c"}),"\n",(0,r.jsxs)(n.p,{children:["\u5ffd\u7565 Status \u53ef\u80fd\u662f\u9519\u8bef\u884c\u4e3a\u3002\u5982\u786e\u5b9e\u9700\u8981\uff0c\u53ef\u7528 ",(0,r.jsx)(n.code,{children:"ignore_error()"}),"\uff1a"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c++",children:"// \u7f13\u5b58\u9519\u8bef\u4e0d\u5f71\u54cd\u54cd\u5e94\nStoreInCache(request, response).ignore_error();\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u8bb0\u5f55\u9996\u4e2a\u9519\u8bef",children:"\u8bb0\u5f55\u9996\u4e2a\u9519\u8bef"}),"\n",(0,r.jsxs)(n.p,{children:["\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"Status::update()"})," \u8bb0\u5f55\u5e8f\u5217\u4e2d\u9996\u6b21\u51fa\u73b0\u7684\u975e OK \u9519\u8bef\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4f1a\u8986\u76d6 OK \u72b6\u6001"}),"\n",(0,r.jsx)(n.li,{children:"\u4e0d\u4f1a\u8986\u76d6\u5df2\u6709\u9519\u8bef"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u793a\u4f8b\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c++",children:"turbo::Status s = Operation1();\ns.update(Operation2());  // \u4fdd\u7559\u7b2c\u4e00\u4e2a\u9519\u8bef\u4fe1\u606f\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"\u68c0\u67e5\u5b8f",children:"\u68c0\u67e5\u5b8f"}),"\n",(0,r.jsx)(n.p,{children:"Turbo \u63d0\u4f9b\u5b8f\u5feb\u901f\u68c0\u67e5 Status\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c++",children:'turbo::Status good_func() {\n    return turbo::Status();\n}\n\nturbo::Status not_found_func() {\n    return turbo::Status(turbo::StatusCode::kNotFound,"bad");\n}\n\nturbo::Status call_func() {\n    STATUS_RETURN_IF_ERROR(some_func());\n    std::cout<<"this should display"<<std::endl;\n    STATUS_RETURN_IF_ERROR(some_func());\n    std::cout<<"this should not display"<<std::endl;\n    return turbo::Status();\n}\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5b8f\u5728 Status \u975e OK \u65f6\u76f4\u63a5\u8fd4\u56de\uff0c\u51cf\u5c11\u91cd\u590d\u9519\u8bef\u68c0\u67e5\u3002"}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>c});var t=s(6540);const r={},l=t.createContext(r);function d(e){const n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);