"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[3517],{571:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>r,contentTitle:()=>a,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"foundamentals/testing/gt/quickstart-bazel","title":"Quickstart: Building with Bazel","description":"This tutorial aims to get you up and running with GoogleTest using the Bazel","source":"@site/i18n/zh-cn/docusaurus-plugin-content-docs/current/foundamentals/testing/gt/quickstart-bazel.md","sourceDirName":"foundamentals/testing/gt","slug":"/foundamentals/testing/gt/quickstart-bazel","permalink":"/cppdev/zh-cn/docs/foundamentals/testing/gt/quickstart-bazel","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Supported Platforms","permalink":"/cppdev/zh-cn/docs/foundamentals/testing/gt/platforms"},"next":{"title":"Quickstart: Building with CMake","permalink":"/cppdev/zh-cn/docs/foundamentals/testing/gt/quickstart-cmake"}}');var o=n(4848),i=n(8453);const l={},a="Quickstart: Building with Bazel",r={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Set up a Bazel workspace",id:"set-up-a-bazel-workspace",level:2},{value:"Create and run a binary",id:"create-and-run-a-binary",level:2},{value:"Next steps",id:"next-steps",level:2}];function d(e){const t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"quickstart-building-with-bazel",children:"Quickstart: Building with Bazel"})}),"\n",(0,o.jsx)(t.p,{children:"This tutorial aims to get you up and running with GoogleTest using the Bazel\nbuild system. If you're using GoogleTest for the first time or need a refresher,\nwe recommend this tutorial as a starting point."}),"\n",(0,o.jsx)(t.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,o.jsx)(t.p,{children:"To complete this tutorial, you'll need:"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"A compatible operating system (e.g. Linux, macOS, Windows)."}),"\n",(0,o.jsx)(t.li,{children:"A compatible C++ compiler that supports at least C++17."}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"https://bazel.build/",children:"Bazel"})," 7.0 or higher, the preferred build system used\nby the GoogleTest team."]}),"\n"]}),"\n",(0,o.jsxs)(t.p,{children:["See ",(0,o.jsx)(t.a,{href:"/cppdev/zh-cn/docs/foundamentals/testing/gt/platforms",children:"Supported Platforms"})," for more information about platforms\ncompatible with GoogleTest."]}),"\n",(0,o.jsxs)(t.p,{children:["If you don't already have Bazel installed, see the\n",(0,o.jsx)(t.a,{href:"https://bazel.build/install",children:"Bazel installation guide"}),"."]}),"\n",(0,o.jsx)(t.admonition,{type:"info",children:(0,o.jsx)(t.p,{children:"Note: The terminal commands in this tutorial show a Unix\nshell prompt, but the commands work on the Windows command line as well."})}),"\n",(0,o.jsx)(t.h2,{id:"set-up-a-bazel-workspace",children:"Set up a Bazel workspace"}),"\n",(0,o.jsxs)(t.p,{children:["A\n",(0,o.jsx)(t.a,{href:"https://docs.bazel.build/versions/main/build-ref.html#workspace",children:"Bazel workspace"}),"\nis a directory on your filesystem that you use to manage source files for the\nsoftware you want to build. Each workspace directory has a text file named\n",(0,o.jsx)(t.code,{children:"MODULE.bazel"})," which may be empty, or may contain references to external\ndependencies required to build the outputs."]}),"\n",(0,o.jsx)(t.p,{children:"First, create a directory for your workspace:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:"$ mkdir my_workspace && cd my_workspace\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Next, you\u2019ll create the ",(0,o.jsx)(t.code,{children:"MODULE.bazel"})," file to specify dependencies. As of Bazel\n7.0, the recommended way to consume GoogleTest is through the\n",(0,o.jsx)(t.a,{href:"https://registry.bazel.build/modules/googletest",children:"Bazel Central Registry"}),". To do\nthis, create a ",(0,o.jsx)(t.code,{children:"MODULE.bazel"})," file in the root directory of your Bazel workspace\nwith the following content:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'# MODULE.bazel\n\n# Choose the most recent version available at\n# https://registry.bazel.build/modules/googletest\nbazel_dep(name = "googletest", version = "1.17.0")\n'})}),"\n",(0,o.jsx)(t.p,{children:"Now you're ready to build C++ code that uses GoogleTest."}),"\n",(0,o.jsx)(t.h2,{id:"create-and-run-a-binary",children:"Create and run a binary"}),"\n",(0,o.jsx)(t.p,{children:"With your Bazel workspace set up, you can now use GoogleTest code within your\nown project."}),"\n",(0,o.jsxs)(t.p,{children:["As an example, create a file named ",(0,o.jsx)(t.code,{children:"hello_test.cc"})," in your ",(0,o.jsx)(t.code,{children:"my_workspace"}),"\ndirectory with the following contents:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-cpp",children:'#include <gtest/gtest.h>\n\n// Demonstrate some basic assertions.\nTEST(HelloTest, BasicAssertions) {\n  // Expect two strings not to be equal.\n  EXPECT_STRNE("hello", "world");\n  // Expect equality.\n  EXPECT_EQ(7 * 6, 42);\n}\n'})}),"\n",(0,o.jsxs)(t.p,{children:["GoogleTest provides ",(0,o.jsx)(t.a,{href:"/cppdev/zh-cn/docs/foundamentals/testing/gt/primer#assertions",children:"assertions"})," that you use to test the\nbehavior of your code. The above sample includes the main GoogleTest header file\nand demonstrates some basic assertions."]}),"\n",(0,o.jsxs)(t.p,{children:["To build the code, create a file named ",(0,o.jsx)(t.code,{children:"BUILD"})," in the same directory with the\nfollowing contents:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{children:'cc_test(\n    name = "hello_test",\n    size = "small",\n    srcs = ["hello_test.cc"],\n    deps = [\n        "@googletest//:gtest",\n        "@googletest//:gtest_main",\n    ],\n)\n'})}),"\n",(0,o.jsxs)(t.p,{children:["This ",(0,o.jsx)(t.code,{children:"cc_test"})," rule declares the C++ test binary you want to build, and links to\nthe GoogleTest library (",(0,o.jsx)(t.code,{children:'@googletest//:gtest"'}),") and the GoogleTest ",(0,o.jsx)(t.code,{children:"main()"}),"\nfunction (",(0,o.jsx)(t.code,{children:"@googletest//:gtest_main"}),"). For more information about Bazel ",(0,o.jsx)(t.code,{children:"BUILD"}),"\nfiles, see the\n",(0,o.jsx)(t.a,{href:"https://docs.bazel.build/versions/main/tutorial/cpp.html",children:"Bazel C++ Tutorial"}),"."]}),"\n",(0,o.jsx)(t.admonition,{type:"info",children:(0,o.jsxs)(t.p,{children:["NOTE: In the example below, we assume Clang or GCC and set ",(0,o.jsx)(t.code,{children:"--cxxopt=-std=c++17"}),"\nto ensure that GoogleTest is compiled as C++17 instead of the compiler's default\nsetting. For MSVC, the equivalent would be ",(0,o.jsx)(t.code,{children:"--cxxopt=/std:c++17"}),". See\n",(0,o.jsx)(t.a,{href:"/cppdev/zh-cn/docs/foundamentals/testing/gt/platforms",children:"Supported Platforms"})," for more details on supported language\nversions."]})}),"\n",(0,o.jsx)(t.p,{children:"Now you can build and run your test:"}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-bash",children:"<strong>$ bazel test --cxxopt=-std=c++17 --test_output=all //:hello_test</strong>\nINFO: Analyzed target //:hello_test (26 packages loaded, 362 targets configured).\nINFO: Found 1 test target...\nINFO: From Testing //:hello_test:\n==================== Test output for //:hello_test:\nRunning main() from gmock_main.cc\n[==========] Running 1 test from 1 test suite.\n[----------] Global test environment set-up.\n[----------] 1 test from HelloTest\n[ RUN      ] HelloTest.BasicAssertions\n[       OK ] HelloTest.BasicAssertions (0 ms)\n[----------] 1 test from HelloTest (0 ms total)\n\n[----------] Global test environment tear-down\n[==========] 1 test from 1 test suite ran. (0 ms total)\n[  PASSED  ] 1 test.\n================================================================================\nTarget //:hello_test up-to-date:\n  bazel-bin/hello_test\nINFO: Elapsed time: 4.190s, Critical Path: 3.05s\nINFO: 27 processes: 8 internal, 19 linux-sandbox.\nINFO: Build completed successfully, 27 total actions\n//:hello_test                                                     PASSED in 0.1s\n\nINFO: Build completed successfully, 27 total actions\n"})}),"\n",(0,o.jsx)(t.p,{children:"Congratulations! You've successfully built and run a test binary using\nGoogleTest."}),"\n",(0,o.jsx)(t.h2,{id:"next-steps",children:"Next steps"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"/cppdev/zh-cn/docs/foundamentals/testing/gt/primer",children:"Check out the Primer"})," to start learning how to write simple\ntests."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.a,{href:"/cppdev/zh-cn/docs/foundamentals/testing/gt/samples",children:"See the code samples"})," for more examples showing how to use a\nvariety of GoogleTest features."]}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>a});var s=n(6540);const o={},i=s.createContext(o);function l(e){const t=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);