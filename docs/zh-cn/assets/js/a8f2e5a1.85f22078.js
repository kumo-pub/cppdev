"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[2152],{6877:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>t,contentTitle:()=>d,default:()=>x,frontMatter:()=>c,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"rpc/brpc","title":"BRPC","description":"BRPC \u662f\u4e00\u4e2a\u9ad8\u6027\u80fd RPC \u6846\u67b6\uff0c\u5728 C++ \u540e\u7aef\u670d\u52a1\u4e2d\u88ab\u5e7f\u6cdb\u4f7f\u7528\u3002\u5728 Kumo \u751f\u6001\u4e2d\uff0c\u5b83\u662f\u5185\u90e8 KRPC \u6846\u67b6\u7684\u57fa\u7840\u3002","source":"@site/i18n/zh-cn/docusaurus-plugin-content-docs/current/rpc/brpc.mdx","sourceDirName":"rpc","slug":"/rpc/brpc","permalink":"/cppdev/zh-cn/docs/rpc/brpc","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"BRPC"},"sidebar":"tutorialSidebar","previous":{"title":"gRPC","permalink":"/cppdev/zh-cn/docs/rpc/grpc"},"next":{"title":"ACL \u5e93\u6982\u89c8","permalink":"/cppdev/zh-cn/docs/rpc/acl"}}');var l=r(4848),i=r(8453);const c={title:"BRPC"},d="BRPC \u6982\u89c8",t={},h=[{value:"1. \u9ad8\u6027\u80fd\u540e\u7aef RPC",id:"1-\u9ad8\u6027\u80fd\u540e\u7aef-rpc",level:2},{value:"2. Kumo \u6f14\u8fdb\uff1aKRPC",id:"2-kumo-\u6f14\u8fdbkrpc",level:2},{value:"3. BRPC \u7684\u4fdd\u7559\u4ef7\u503c",id:"3-brpc-\u7684\u4fdd\u7559\u4ef7\u503c",level:2},{value:"4. \u751f\u6001\u4e0e\u96c6\u6210",id:"4-\u751f\u6001\u4e0e\u96c6\u6210",level:2},{value:"5. \u8fd0\u7ef4\u6ce8\u610f\u4e8b\u9879",id:"5-\u8fd0\u7ef4\u6ce8\u610f\u4e8b\u9879",level:2},{value:"6. \u9002\u7528\u573a\u666f",id:"6-\u9002\u7528\u573a\u666f",level:2},{value:"7. \u793a\u4f8b\u4ee3\u7801\uff08C++ \u540e\u7aef\u670d\u52a1\uff09",id:"7-\u793a\u4f8b\u4ee3\u7801c-\u540e\u7aef\u670d\u52a1",level:2}];function o(n){const e={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(e.header,{children:(0,l.jsx)(e.h1,{id:"brpc-\u6982\u89c8",children:"BRPC \u6982\u89c8"})}),"\n",(0,l.jsxs)(e.p,{children:["BRPC \u662f\u4e00\u4e2a\u9ad8\u6027\u80fd RPC \u6846\u67b6\uff0c\u5728 C++ \u540e\u7aef\u670d\u52a1\u4e2d\u88ab\u5e7f\u6cdb\u4f7f\u7528\u3002\u5728 Kumo \u751f\u6001\u4e2d\uff0c\u5b83\u662f\u5185\u90e8 ",(0,l.jsx)(e.strong,{children:"KRPC"})," \u6846\u67b6\u7684\u57fa\u7840\u3002"]}),"\n",(0,l.jsx)(e.h2,{id:"1-\u9ad8\u6027\u80fd\u540e\u7aef-rpc",children:"1. \u9ad8\u6027\u80fd\u540e\u7aef RPC"}),"\n",(0,l.jsxs)(e.p,{children:["BRPC \u9002\u7528\u4e8e ",(0,l.jsx)(e.strong,{children:"\u5355\u673a\u9ad8 QPS\u3001\u5ef6\u8fdf\u654f\u611f\u4e14\u9700\u63a7\u5236 CPU \u4f7f\u7528\u7684\u540e\u7aef\u6838\u5fc3\u670d\u52a1"}),"\u3002"]}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u5178\u578b\u540e\u7aef\u573a\u666f\uff1a"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u5185\u90e8\u5b58\u50a8\u670d\u52a1"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u641c\u7d22\u670d\u52a1"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u7f13\u5b58\u5c42"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u5206\u5e03\u5f0f\u8ba1\u7b97\u8282\u70b9"}),"\n"]}),"\n",(0,l.jsxs)(e.li,{children:["\n",(0,l.jsx)(e.p,{children:"\u652f\u6301\u5f02\u6b65 I/O\u3001\u7ebf\u7a0b\u6c60\u8c03\u5ea6\u548c\u9ad8\u6548\u5bf9\u8c61\u6c60\u3002"}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"2-kumo-\u6f14\u8fdbkrpc",children:"2. Kumo \u6f14\u8fdb\uff1aKRPC"}),"\n",(0,l.jsxs)(e.p,{children:["Kumo \u5728 BRPC \u57fa\u7840\u4e0a\u5f00\u53d1\u4e86 ",(0,l.jsx)(e.strong,{children:"KRPC"}),"\uff0c\u4e3b\u8981\u76ee\u6807\uff1a"]}),"\n",(0,l.jsxs)(e.ol,{children:["\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.strong,{children:"\u63d0\u5347\u6027\u80fd"})}),"\n",(0,l.jsx)(e.li,{children:(0,l.jsx)(e.strong,{children:"\u6539\u5584\u8fd0\u7ef4\u53cb\u597d\u6027"})}),"\n"]}),"\n",(0,l.jsxs)(e.p,{children:["KRPC \u5b8c\u5168\u8986\u76d6 BRPC \u529f\u80fd\u3002\u5bf9\u4e8e\u5927\u591a\u6570\u4e1a\u52a1\u5c42\uff0c",(0,l.jsx)(e.strong,{children:"\u63a8\u8350\u4f7f\u7528 KRPC"})," \u4ee5\u964d\u4f4e\u8fd0\u7ef4\u590d\u6742\u5ea6\u3002"]}),"\n",(0,l.jsx)(e.h2,{id:"3-brpc-\u7684\u4fdd\u7559\u4ef7\u503c",children:"3. BRPC \u7684\u4fdd\u7559\u4ef7\u503c"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u5f53\u5185\u90e8\u6846\u67b6\u9009\u62e9\u53d7\u9650\u65f6\uff0c\u4f18\u5148\u4f7f\u7528 KRPC\u3002"}),"\n",(0,l.jsxs)(e.li,{children:[(0,l.jsx)(e.strong,{children:"\u5fc5\u8981\u573a\u666f"}),"\uff1a\u82e5\u7cfb\u7edf\u9700\u4f7f\u7528 BRAFT\uff08Raft \u5b9e\u73b0\uff09\uff0c\u5fc5\u987b\u4f7f\u7528 BRPC\uff0c\u56e0\u4e3a KRPC \u5f53\u524d\u4e0d\u539f\u751f\u652f\u6301 Raft\u3002"]}),"\n",(0,l.jsx)(e.li,{children:"BRPC \u4ecd\u53ef\u72ec\u7acb\u4f7f\u7528\uff0c\u5c24\u5176\u9002\u5408\u9ad8 QPS \u540e\u7aef\u6216\u7279\u5b9a\u534f\u8bae\u9700\u6c42\u3002"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"4-\u751f\u6001\u4e0e\u96c6\u6210",children:"4. \u751f\u6001\u4e0e\u96c6\u6210"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u652f\u6301 HTTP/HTTPS\u3001protobuf\u3001Thrift\u3001JSON \u7b49\u534f\u8bae\u3002"}),"\n",(0,l.jsxs)(e.li,{children:["\u751f\u6001\u4e3b\u8981\u9762\u5411 ",(0,l.jsx)(e.strong,{children:"C++ \u540e\u7aef"}),"\u3002"]}),"\n",(0,l.jsx)(e.li,{children:"\u96c6\u6210\u590d\u6742\u5ea6\u7565\u4f4e\u4e8e gRPC\uff0c\u9002\u5408\u540c\u56e2\u961f\u6216\u540c\u8bed\u8a00\u8c03\u7528\u3002"}),"\n",(0,l.jsx)(e.li,{children:"\u529f\u80fd\u8986\u76d6\u548c\u751f\u6001\u652f\u6301\u8db3\u591f\u6ee1\u8db3\u540e\u7aef\u670d\u52a1\u9700\u6c42\u3002"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"5-\u8fd0\u7ef4\u6ce8\u610f\u4e8b\u9879",children:"5. \u8fd0\u7ef4\u6ce8\u610f\u4e8b\u9879"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsx)(e.li,{children:"\u63d0\u4f9b\u8c03\u8bd5\u3001\u6027\u80fd\u6307\u6807\u3001\u7ebf\u7a0b\u8c03\u5ea6\u5de5\u5177\uff0c\u4f46\u8fd0\u7ef4\u6210\u672c\u76f8\u5bf9\u8f83\u9ad8\u3002"}),"\n",(0,l.jsxs)(e.li,{children:["\u9ad8 QPS \u670d\u52a1\u5e94\u63a7\u5236 CPU \u4f7f\u7528\u5728 ",(0,l.jsx)(e.strong,{children:"50%-70%"})," \u8303\u56f4\uff0c\u4ee5\u907f\u514d\u7ebf\u7a0b\u8c03\u5ea6\u74f6\u9888\u6216\u961f\u5217\u963b\u585e\u3002"]}),"\n",(0,l.jsx)(e.li,{children:"\u5185\u5b58\u6c60\u7ba1\u7406\u5e94\u5408\u7406\uff0c\u907f\u514d\u957f\u671f\u8fd0\u884c\u51fa\u73b0\u788e\u7247\u5316\u6216\u5ef6\u8fdf\u6296\u52a8\u3002"}),"\n"]}),"\n",(0,l.jsx)(e.h2,{id:"6-\u9002\u7528\u573a\u666f",children:"6. \u9002\u7528\u573a\u666f"}),"\n",(0,l.jsxs)(e.table,{children:[(0,l.jsx)(e.thead,{children:(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.th,{children:"\u5c42\u7ea7"}),(0,l.jsx)(e.th,{children:"\u63a8\u8350\u65b9\u6848"}),(0,l.jsx)(e.th,{children:"\u8bf4\u660e"})]})}),(0,l.jsxs)(e.tbody,{children:[(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u4e1a\u52a1\u5165\u53e3\u5c42"}),(0,l.jsx)(e.td,{children:"gRPC"}),(0,l.jsx)(e.td,{children:"\u66f4\u91cd\u89c6\u751f\u6001\u96c6\u6210\uff0cQPS \u8981\u6c42\u4e2d\u7b49"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u540e\u7aef\u6838\u5fc3\u5c42"}),(0,l.jsx)(e.td,{children:"KRPC \u6216 BRPC"}),(0,l.jsx)(e.td,{children:"\u8ffd\u6c42\u5355\u673a\u6027\u80fd\u548c\u4f4e\u5ef6\u8fdf"})]}),(0,l.jsxs)(e.tr,{children:[(0,l.jsx)(e.td,{children:"\u5728\u7ebf\u670d\u52a1"}),(0,l.jsx)(e.td,{children:"gRPC (< 30k QPS)"}),(0,l.jsx)(e.td,{children:"QPS \u8f83\u9ad8\u7684\u540e\u7aef \u2192 KRPC/BRPC"})]})]})]}),"\n",(0,l.jsx)(e.h2,{id:"7-\u793a\u4f8b\u4ee3\u7801c-\u540e\u7aef\u670d\u52a1",children:"7. \u793a\u4f8b\u4ee3\u7801\uff08C++ \u540e\u7aef\u670d\u52a1\uff09"}),"\n",(0,l.jsx)(e.pre,{children:(0,l.jsx)(e.code,{className:"language-cpp",children:'#include <brpc/server.h>\n#include "example.pb.h"\n#include "example.pb.cc"\n\nclass ExampleServiceImpl : public ExampleService {\npublic:\n    void Echo(google::protobuf::RpcController* cntl_base,\n              const EchoRequest* request,\n              EchoResponse* response,\n              google::protobuf::Closure* done) override {\n        brpc::ClosureGuard done_guard(done);\n        response->set_message(request->message());\n    }\n};\n\nint main() {\n    brpc::Server server;\n\n    ExampleServiceImpl service_impl;\n    if (server.AddService(&service_impl, brpc::SERVER_DOESNT_OWN_SERVICE) != 0) {\n        LOG(ERROR) << "Fail to add service";\n        return -1;\n    }\n\n    brpc::ServerOptions options;\n    if (server.Start(8000, &options) != 0) {\n        LOG(ERROR) << "Fail to start server";\n        return -1;\n    }\n\n    server.RunUntilAskedToQuit();\n    return 0;\n}\n'})}),"\n",(0,l.jsxs)(e.blockquote,{children:["\n",(0,l.jsx)(e.p,{children:"\u5173\u952e\u70b9\uff1a"}),"\n",(0,l.jsxs)(e.ul,{children:["\n",(0,l.jsxs)(e.li,{children:["BRPC \u5f3a\u8c03 ",(0,l.jsx)(e.strong,{children:"\u5355\u673a\u6027\u80fd\u3001\u5f02\u6b65\u8c03\u5ea6\u548c\u4f4e\u5ef6\u8fdf"}),"\u3002"]}),"\n",(0,l.jsx)(e.li,{children:"KRPC \u8986\u76d6 BRPC \u529f\u80fd\u5e76\u6539\u5584\u8fd0\u7ef4\u53cb\u597d\u6027\uff0c\u662f\u5185\u90e8\u9ed8\u8ba4\u63a8\u8350\u6846\u67b6\u3002"}),"\n",(0,l.jsx)(e.li,{children:"\u4f7f\u7528 BRAFT \u65f6\u5fc5\u987b\u4f7f\u7528 BRPC\u3002"}),"\n"]}),"\n"]})]})}function x(n={}){const{wrapper:e}={...(0,i.R)(),...n.components};return e?(0,l.jsx)(e,{...n,children:(0,l.jsx)(o,{...n})}):o(n)}},8453:(n,e,r)=>{r.d(e,{R:()=>c,x:()=>d});var s=r(6540);const l={},i=s.createContext(l);function c(n){const e=s.useContext(i);return s.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:c(n.components),s.createElement(i.Provider,{value:e},n.children)}}}]);