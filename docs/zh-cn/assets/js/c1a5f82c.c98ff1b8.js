"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[1738],{8453:(e,n,l)=>{l.d(n,{R:()=>r,x:()=>h});var s=l(6540);const d={},i=s.createContext(d);function r(e){const n=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function h(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:r(e.components),s.createElement(i.Provider,{value:n},e.children)}},9984:(e,n,l)=>{l.r(n),l.d(n,{assets:()=>c,contentTitle:()=>h,default:()=>x,frontMatter:()=>r,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"foundamentals/map/pmap","title":"parallel-hashmap \u4f7f\u7528\u6307\u5357\uff1a\u9ad8\u6027\u80fd\u3001\u7ebf\u7a0b\u5b89\u5168\u3001\u5185\u5b58\u9ad8\u6548\u7684\u54c8\u5e0c\u8868\u4e0e B \u6811","description":"1. \u80cc\u666f","source":"@site/i18n/zh-cn/docusaurus-plugin-content-docs/current/foundamentals/map/pmap.mdx","sourceDirName":"foundamentals/map","slug":"/foundamentals/map/pmap","permalink":"/cppdev/zh-cn/docs/foundamentals/map/pmap","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Melon AtomicHashMap \u7b80\u4ecb","permalink":"/cppdev/zh-cn/docs/foundamentals/map/concurrent_hash_map"},"next":{"title":"C++ \u54c8\u5e0c\u8868\u6027\u80fd\u57fa\u51c6\u6d4b\u8bd5","permalink":"/cppdev/zh-cn/docs/foundamentals/map/benchmark"}}');var d=l(4848),i=l(8453);const r={},h="parallel-hashmap \u4f7f\u7528\u6307\u5357\uff1a\u9ad8\u6027\u80fd\u3001\u7ebf\u7a0b\u5b89\u5168\u3001\u5185\u5b58\u9ad8\u6548\u7684\u54c8\u5e0c\u8868\u4e0e B \u6811",c={},a=[{value:"1. \u80cc\u666f",id:"1-\u80cc\u666f",level:2},{value:"2. \u6982\u89c8",id:"2-\u6982\u89c8",level:2},{value:"3. \u9ad8\u901f\u4e0e\u5185\u5b58\u4f18\u5316",id:"3-\u9ad8\u901f\u4e0e\u5185\u5b58\u4f18\u5316",level:2},{value:"4. \u5b89\u88c5",id:"4-\u5b89\u88c5",level:2},{value:"5. \u793a\u4f8b",id:"5-\u793a\u4f8b",level:2},{value:"6. \u63d0\u4f9b\u7684\u5bb9\u5668\u7c7b\u578b\u53ca\u7279\u70b9",id:"6-\u63d0\u4f9b\u7684\u5bb9\u5668\u7c7b\u578b\u53ca\u7279\u70b9",level:2},{value:"6.1 Hash \u8868\uff08<code>parallel_hashmap/phmap.h</code>\uff09",id:"61-hash-\u8868parallel_hashmapphmaph",level:3},{value:"6.2 B \u6811\uff08<code>parallel_hashmap/btree.h</code>\uff09",id:"62-b-\u6811parallel_hashmapbtreeh",level:3},{value:"6.3 Hash \u5bb9\u5668\u8bbe\u8ba1\u8981\u70b9",id:"63-hash-\u5bb9\u5668\u8bbe\u8ba1\u8981\u70b9",level:3},{value:"6.4 B \u6811\u8bbe\u8ba1\u8981\u70b9",id:"64-b-\u6811\u8bbe\u8ba1\u8981\u70b9",level:3},{value:"7. \u5bf9 Abseil Hash \u8868\u7684\u4fee\u6539",id:"7-\u5bf9-abseil-hash-\u8868\u7684\u4fee\u6539",level:2},{value:"8. \u5185\u5b58\u5360\u7528",id:"8-\u5185\u5b58\u5360\u7528",level:2},{value:"9. \u54c8\u5e0c\u8868\u8fed\u4ee3\u5668\u5931\u6548\u89c4\u5219",id:"9-\u54c8\u5e0c\u8868\u8fed\u4ee3\u5668\u5931\u6548\u89c4\u5219",level:2},{value:"10. B \u6811\u8fed\u4ee3\u5668\u5931\u6548\u89c4\u5219",id:"10-b-\u6811\u8fed\u4ee3\u5668\u5931\u6548\u89c4\u5219",level:2},{value:"11. \u81ea\u5b9a\u4e49\u7c7b\u54c8\u5e0c\u51fd\u6570",id:"11-\u81ea\u5b9a\u4e49\u7c7b\u54c8\u5e0c\u51fd\u6570",level:2},{value:"12. \u7ebf\u7a0b\u5b89\u5168",id:"12-\u7ebf\u7a0b\u5b89\u5168",level:2},{value:"12.1 \u57fa\u672c\u89c4\u5219\uff08C++ STL \u6807\u51c6\uff09",id:"121-\u57fa\u672c\u89c4\u5219c-stl-\u6807\u51c6",level:3},{value:"12.2 Parallel \u7cfb\u5217\u6269\u5c55",id:"122-parallel-\u7cfb\u5217\u6269\u5c55",level:3},{value:"12.3 \u63a8\u8350\u9501",id:"123-\u63a8\u8350\u9501",level:3},{value:"12.4 \u5e76\u53d1\u793a\u4f8b",id:"124-\u5e76\u53d1\u793a\u4f8b",level:3}];function t(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"parallel-hashmap-\u4f7f\u7528\u6307\u5357\u9ad8\u6027\u80fd\u7ebf\u7a0b\u5b89\u5168\u5185\u5b58\u9ad8\u6548\u7684\u54c8\u5e0c\u8868\u4e0e-b-\u6811",children:"parallel-hashmap \u4f7f\u7528\u6307\u5357\uff1a\u9ad8\u6027\u80fd\u3001\u7ebf\u7a0b\u5b89\u5168\u3001\u5185\u5b58\u9ad8\u6548\u7684\u54c8\u5e0c\u8868\u4e0e B \u6811"})}),"\n",(0,d.jsx)(n.h2,{id:"1-\u80cc\u666f",children:"1. \u80cc\u666f"}),"\n",(0,d.jsxs)(n.p,{children:["\u5728\u540e\u7aef\u5f00\u53d1\u4e2d\uff0c\u7ebf\u7a0b\u5b89\u5168\u4e14\u9ad8\u6027\u80fd\u7684\u5bb9\u5668\u6570\u636e\u7ed3\u6784\u662f\u5e38\u89c1\u9700\u6c42\u3002\u5f00\u6e90\u5e93 ",(0,d.jsx)(n.a,{href:"https://github.com/kumose/collie",children:"parallel-hashmap"})," \u57fa\u4e8e Google \u7684 Abseil-C++ \u5b9e\u73b0\u8fdb\u884c\u4e86\u589e\u5f3a\uff0c\u53ef\u76f4\u63a5\u7528\u4e8e\u5f00\u53d1\u3002"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"2-\u6982\u89c8",children:"2. \u6982\u89c8"}),"\n",(0,d.jsxs)(n.p,{children:["parallel-hashmap \u63d0\u4f9b\u9ad8\u6027\u80fd\u54c8\u5e0c\u8868\u5b9e\u73b0\u548c B \u6811\u5b9e\u73b0\uff0c\u53ef\u66ff\u4ee3 ",(0,d.jsx)(n.code,{children:"std::unordered_map/set"})," \u4e0e ",(0,d.jsx)(n.code,{children:"std::map/set"}),"\u3002\u6838\u5fc3\u7279\u70b9\uff1a"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Header-only"}),"\uff1a\u65e0\u9700\u94fe\u63a5\uff0c\u5305\u542b\u5934\u6587\u4ef6\u5373\u53ef\u4f7f\u7528\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"STL API \u517c\u5bb9"}),"\uff1a\u53ef\u65e0\u7f1d\u66ff\u6362 ",(0,d.jsx)(n.code,{children:"std::unordered_map/set"})," \u4e0e ",(0,d.jsx)(n.code,{children:"std::map/set"}),"\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"C++11+ \u652f\u6301"}),"\uff1a\u63d0\u4f9b C++14/17 API\uff0c\u5982 ",(0,d.jsx)(n.code,{children:"try_emplace"}),"\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u9ad8\u6548"}),"\uff1a\u63d2\u5165\u901f\u5ea6\u6bd4 ",(0,d.jsx)(n.code,{children:"std::unordered_map"})," \u5feb\u7ea6 1 \u500d\uff0c\u67e5\u627e\u901f\u5ea6\u5feb\u7ea6 3 \u500d\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u4f4e\u5185\u5b58\u5360\u7528"}),"\uff1aflat_hash_map/set \u5185\u5b58\u5360\u7528\u63a5\u8fd1 sparsepp\uff0cB \u6811\u6bd4 ",(0,d.jsx)(n.code,{children:"std::set"})," \u8282\u7701 ~90% \u5185\u5b58\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u5f02\u6784\u67e5\u627e"}),"\u3001\u524d\u5411\u58f0\u660e\u3001\u78c1\u76d8 dump/load\uff08flat hash \u8868\uff09\u652f\u6301\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u8de8\u5e73\u53f0"}),"\uff1aWindows\u3001Linux\u3001MacOS\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"\u652f\u6301 Boost hash_value()"}),"\uff0c\u4ee5\u53ca ",(0,d.jsx)(n.code,{children:"std::pair"})," / ",(0,d.jsx)(n.code,{children:"std::tuple"})," \u54c8\u5e0c\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Visual Studio Natvis \u53ef\u89c6\u5316"}),"\uff08\u4ec5 hash map/set\uff09\u3002"]}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"3-\u9ad8\u901f\u4e0e\u5185\u5b58\u4f18\u5316",children:"3. \u9ad8\u901f\u4e0e\u5185\u5b58\u4f18\u5316"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"Flat hash \u8868\u57fa\u4e8e\u95ed\u5408\u5bfb\u5740\uff0c\u5c06\u6570\u636e\u76f4\u63a5\u5b58\u50a8\u5728\u6570\u7ec4\u4e2d\uff0c\u907f\u514d\u95f4\u63a5\u8bbf\u95ee\u3002"}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"SSE2 \u5e76\u884c\u641c\u7d22 16 \u4e2a\u69fd\u4f4d\uff0c\u5373\u4f7f\u8d1f\u8f7d\u56e0\u5b50 87.5%\uff0c\u4e5f\u80fd\u4fdd\u6301\u9ad8\u901f\u3002"}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"\u5bf9 Abseil flat_hash_map \u7684\u6539\u8fdb\uff1a"}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"\u5c06\u5927 hash \u8868\u62c6\u5206\u4e3a 2 \u7684\u5e42\u6b21\u5b50\u8868\uff08\u5982 16 \u4e2a\uff09\uff0c\u964d\u4f4e\u6269\u5bb9\u5cf0\u503c\u5185\u5b58\u5230\u539f\u6765\u7684 1/16\u3002"}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"\u5e76\u53d1\u652f\u6301\uff1a\u6bcf\u4e2a\u5b50\u8868\u53ef\u5355\u72ec\u52a0\u9501\uff0c\u5b9e\u73b0\u7ebf\u7a0b\u5b89\u5168\u3002"}),"\n"]}),"\n"]}),"\n",(0,d.jsxs)(n.blockquote,{children:["\n",(0,d.jsx)(n.p,{children:"\u6ce8\u610f\uff1a\u672c\u5e93\u6e90\u81ea\u5e76\u4fee\u6539 Abseil-C++\uff0c\u884c\u4e3a\u53ef\u80fd\u4e0e\u539f\u7248\u4e0d\u540c\uff0c\u72ec\u7acb\u4f7f\u7528\u4e0d\u4fdd\u8bc1\u5b8c\u5168\u4e00\u81f4\u3002"}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"4-\u5b89\u88c5",children:"4. \u5b89\u88c5"}),"\n",(0,d.jsx)(n.p,{children:"\u65e0\u9700\u5b89\u88c5\uff0c\u5305\u542b\u5934\u6587\u4ef6\u5373\u53ef\u4f7f\u7528\u3002"}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"5-\u793a\u4f8b",children:"5. \u793a\u4f8b"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-cpp",children:'#include <iostream>\n#include <string>\n#include <parallel_hashmap/phmap.h>\n\nusing phmap::flat_hash_map;\n\nint main() {\n    flat_hash_map<std::string, std::string> email = {\n        { "tom",  "tom@gmail.com"},\n        { "jeff", "jk@gmail.com"},\n        { "jim",  "jimg@microsoft.com"}\n    };\n\n    for (const auto& n : email)\n        std::cout << n.first << "\'s email is: " << n.second << "\\n";\n\n    email["bill"] = "bg@whatever.com";\n    std::cout << "bill\'s email is: " << email["bill"] << "\\n";\n\n    return 0;\n}\n'})}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"6-\u63d0\u4f9b\u7684\u5bb9\u5668\u7c7b\u578b\u53ca\u7279\u70b9",children:"6. \u63d0\u4f9b\u7684\u5bb9\u5668\u7c7b\u578b\u53ca\u7279\u70b9"}),"\n",(0,d.jsxs)(n.h3,{id:"61-hash-\u8868parallel_hashmapphmaph",children:["6.1 Hash \u8868\uff08",(0,d.jsx)(n.code,{children:"parallel_hashmap/phmap.h"}),"\uff09"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"flat_hash_set"})," / ",(0,d.jsx)(n.code,{children:"flat_hash_map"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"node_hash_set"})," / ",(0,d.jsx)(n.code,{children:"node_hash_map"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"parallel_flat_hash_set"})," / ",(0,d.jsx)(n.code,{children:"parallel_flat_hash_map"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"parallel_node_hash_set"})," / ",(0,d.jsx)(n.code,{children:"parallel_node_hash_map"})]}),"\n"]}),"\n",(0,d.jsxs)(n.h3,{id:"62-b-\u6811parallel_hashmapbtreeh",children:["6.2 B \u6811\uff08",(0,d.jsx)(n.code,{children:"parallel_hashmap/btree.h"}),"\uff09"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"btree_set"})," / ",(0,d.jsx)(n.code,{children:"btree_map"})]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"btree_multiset"})," / ",(0,d.jsx)(n.code,{children:"btree_multimap"})]}),"\n",(0,d.jsx)(n.li,{children:"\u7279\u70b9\uff1a\u6bcf\u4e2a\u8282\u70b9\u5b58\u50a8\u591a\u4e2a\u503c\uff0c\u7f13\u5b58\u53cb\u597d\uff0c\u4f4e\u5185\u5b58\u5360\u7528\u3002"}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"63-hash-\u5bb9\u5668\u8bbe\u8ba1\u8981\u70b9",children:"6.3 Hash \u5bb9\u5668\u8bbe\u8ba1\u8981\u70b9"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Flat \u7cfb\u5217"}),"\uff1a\u5185\u90e8\u79fb\u52a8\u952e\u503c\uff0c\u901f\u5ea6\u5feb\u3001\u5185\u5b58\u4f4e\uff1b\u5916\u90e8\u6307\u9488\u53ef\u80fd\u60ac\u7a7a\u3002\u503c\u5927\u4e8e 100 \u5b57\u8282\u5efa\u8bae\u4f7f\u7528 Node \u7cfb\u5217\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Node \u7cfb\u5217"}),"\uff1a\u8282\u70b9\u72ec\u7acb\uff0c\u5916\u90e8\u6307\u9488\u5b89\u5168\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Parallel \u7cfb\u5217"}),"\uff1a\u9002\u5408\u5c11\u91cf\u5927\u8868\uff0c\u9ad8\u5e76\u53d1\uff1b\u975e parallel \u9002\u5408\u5927\u91cf\u5c0f\u8868\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.strong,{children:"Parallel \u7cfb\u5217\u4f18\u70b9"}),"\uff1a"]}),"\n"]}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"\u6269\u5bb9\u5cf0\u503c\u5185\u5b58\u4f4e\u3002"}),"\n",(0,d.jsx)(n.li,{children:"\u652f\u6301\u591a\u7ebf\u7a0b\u5b89\u5168\u5e76\u53d1\u3002"}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"64-b-\u6811\u8bbe\u8ba1\u8981\u70b9",children:"6.4 B \u6811\u8bbe\u8ba1\u8981\u70b9"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u66ff\u4ee3\u7ea2\u9ed1\u6811\u5bb9\u5668\uff0c\u7f13\u5b58\u53cb\u597d\u3002"}),"\n",(0,d.jsx)(n.li,{children:"\u4e0d\u9002\u7528\u4e8e\uff1a"}),"\n"]}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsx)(n.li,{children:"\u8fed\u4ee3\u5668/\u6307\u9488\u7a33\u5b9a\u6027\u8981\u6c42\u9ad8\u3002"}),"\n",(0,d.jsx)(n.li,{children:"\u5927\u5bf9\u8c61\u9ad8\u79fb\u52a8\u6210\u672c\u3002"}),"\n"]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u82e5\u4e0d\u9700\u8981\u987a\u5e8f\uff0c\u54c8\u5e0c\u8868\u6027\u80fd\u66f4\u4f18\u3002"}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"7-\u5bf9-abseil-hash-\u8868\u7684\u4fee\u6539",children:"7. \u5bf9 Abseil Hash \u8868\u7684\u4fee\u6539"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\u9ed8\u8ba4\u54c8\u5e0c\u6539\u4e3a ",(0,d.jsx)(n.code,{children:"std::hash"}),"\uff0c\u53ef\u901a\u8fc7\u5b8f ",(0,d.jsx)(n.code,{children:"PHMAP_USE_ABSL_HASH"})," \u5207\u6362\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"erase(iterator)"})," / ",(0,d.jsx)(n.code,{children:"erase(const_iterator)"})," \u8fd4\u56de\u4e0b\u4e00\u4e2a\u8fed\u4ee3\u5668\uff0c\u63d0\u4f9b ",(0,d.jsx)(n.code,{children:"_erase(iterator)"})," \u65e0\u8fd4\u56de\u7248\u672c\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:["\u652f\u6301 ",(0,d.jsx)(n.code,{children:"std::string_view"}),"\uff0c\u4e0d\u4f9d\u8d56 ",(0,d.jsx)(n.code,{children:"absl::string_view"}),"\u3002"]}),"\n",(0,d.jsx)(n.li,{children:"\u54c8\u5e0c\u79cd\u5b50\u9ed8\u8ba4\u56fa\u5b9a\uff0c\u53ef\u901a\u8fc7\u5b8f\u542f\u7528\u968f\u673a\u5316\uff08\u9632 DoS\uff09\u3002"}),"\n",(0,d.jsx)(n.li,{children:"\u5185\u90e8\u54c8\u5e0c\u503c\u6df7\u5408\uff0c\u907f\u514d\u4f4e\u71b5\u54c8\u5e0c\u6027\u80fd\u4e0b\u964d\u3002"}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"8-\u5185\u5b58\u5360\u7528",children:"8. \u5185\u5b58\u5360\u7528"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u7c7b\u578b"}),(0,d.jsx)(n.th,{children:"\u5185\u5b58\u5360\u7528"}),(0,d.jsx)(n.th,{children:"\u6269\u5bb9\u5cf0\u503c\u5185\u5b58"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"flat"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"sizeof(C::value_type) + 1"})}),(0,d.jsx)(n.td,{children:"0.5 \u500d\u6876\u6570\u7ec4"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"node"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"sizeof(void*) + 1"})}),(0,d.jsx)(n.td,{children:"0.5 \u500d\u6876\u6570\u7ec4"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"parallel flat"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"sizeof(C::value_type) + 1"})}),(0,d.jsx)(n.td,{children:"~0.03\uff080.5 / \u5b50\u8868\u6570\uff09"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"parallel node"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"sizeof(void*) + 1"})}),(0,d.jsx)(n.td,{children:"~0.03\uff080.5 / \u5b50\u8868\u6570\uff09"})]})]})]}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"size()"}),": \u5143\u7d20\u6570\u91cf"]}),"\n",(0,d.jsxs)(n.li,{children:[(0,d.jsx)(n.code,{children:"load_factor()"}),": ",(0,d.jsx)(n.code,{children:"size() / bucket_count()"}),"\uff0c\u5728 0.4375 ~ 0.875 \u4e4b\u95f4"]}),"\n",(0,d.jsx)(n.li,{children:"\u5e76\u884c\u54c8\u5e0c\u8868\uff1a\u6a21\u677f\u53c2\u6570 N=4 \u65f6\uff0c16 \u4e2a\u5b50\u8868\uff0c\u5355\u7ebf\u7a0b\u6269\u5bb9\u65f6\u4ec5\u6269\u5bb9\u4e00\u4e2a\u5b50\u8868\u3002"}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"9-\u54c8\u5e0c\u8868\u8fed\u4ee3\u5668\u5931\u6548\u89c4\u5219",children:"9. \u54c8\u5e0c\u8868\u8fed\u4ee3\u5668\u5931\u6548\u89c4\u5219"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u64cd\u4f5c"}),(0,d.jsx)(n.th,{children:"\u8fed\u4ee3\u5668\u5931\u6548"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u53ea\u8bfb\u64cd\u4f5c / swap"}),(0,d.jsx)(n.td,{children:"\u6c38\u4e0d\u5931\u6548"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"clear / rehash / reserve / operator="}),(0,d.jsx)(n.td,{children:"\u603b\u662f\u5931\u6548"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"insert / emplace / operator[]"}),(0,d.jsx)(n.td,{children:"\u4ec5\u5728\u89e6\u53d1 rehash \u65f6\u5931\u6548"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"erase"}),(0,d.jsx)(n.td,{children:"\u4ec5\u88ab\u5220\u9664\u5143\u7d20\u5931\u6548"})]})]})]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"10-b-\u6811\u8fed\u4ee3\u5668\u5931\u6548\u89c4\u5219",children:"10. B \u6811\u8fed\u4ee3\u5668\u5931\u6548\u89c4\u5219"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"\u64cd\u4f5c"}),(0,d.jsx)(n.th,{children:"\u8fed\u4ee3\u5668\u5931\u6548"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"\u53ea\u8bfb / swap"}),(0,d.jsx)(n.td,{children:"\u6c38\u4e0d\u5931\u6548"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"clear / operator="}),(0,d.jsx)(n.td,{children:"\u603b\u662f\u5931\u6548"})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"insert / emplace / operator[] / erase"}),(0,d.jsx)(n.td,{children:"\u90fd\u4f1a\u5931\u6548"})]})]})]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"11-\u81ea\u5b9a\u4e49\u7c7b\u54c8\u5e0c\u51fd\u6570",children:"11. \u81ea\u5b9a\u4e49\u7c7b\u54c8\u5e0c\u51fd\u6570"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"Flat \u7cfb\u5217\u9700\u8981\u63d0\u4f9b\u54c8\u5e0c\u51fd\u6570\uff1a"}),"\n"]}),"\n",(0,d.jsxs)(n.ol,{children:["\n",(0,d.jsxs)(n.li,{children:["\u901a\u8fc7\u6a21\u677f\u53c2\u6570 ",(0,d.jsx)(n.code,{children:"HashFcn"}),"\u3002"]}),"\n",(0,d.jsxs)(n.li,{children:["\u4f7f\u7528 Boost \u65f6\u6dfb\u52a0 ",(0,d.jsx)(n.code,{children:"hash_value()"}),"\u3002"]}),"\n"]}),"\n",(0,d.jsx)(n.hr,{}),"\n",(0,d.jsx)(n.h2,{id:"12-\u7ebf\u7a0b\u5b89\u5168",children:"12. \u7ebf\u7a0b\u5b89\u5168"}),"\n",(0,d.jsx)(n.h3,{id:"121-\u57fa\u672c\u89c4\u5219c-stl-\u6807\u51c6",children:"12.1 \u57fa\u672c\u89c4\u5219\uff08C++ STL \u6807\u51c6\uff09"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsx)(n.li,{children:"\u591a\u7ebf\u7a0b\u8bfb\u53d6\u540c\u4e00\u54c8\u5e0c\u8868\uff1a\u5b89\u5168"}),"\n",(0,d.jsx)(n.li,{children:"\u5355\u7ebf\u7a0b\u5199 + \u5176\u4ed6\u7ebf\u7a0b\u8bfb\u5199\u540c\u4e00\u8868\uff1a\u4e0d\u5b89\u5168\uff0c\u9700\u4fdd\u62a4"}),"\n",(0,d.jsx)(n.li,{children:"\u591a\u7ebf\u7a0b\u64cd\u4f5c\u4e0d\u540c\u5b9e\u4f8b\uff1a\u5b89\u5168"}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"122-parallel-\u7cfb\u5217\u6269\u5c55",children:"12.2 Parallel \u7cfb\u5217\u6269\u5c55"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["\u6a21\u677f\u53c2\u6570\u53ef\u6307\u5b9a\u9501\u7c7b\u578b\uff08",(0,d.jsx)(n.code,{children:"std::shared_mutex"})," / ",(0,d.jsx)(n.code,{children:"std::mutex"})," / ",(0,d.jsx)(n.code,{children:"boost::shared_mutex"}),"\uff09"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"\u5185\u90e8\u6bcf\u4e2a\u5b50\u8868\u72ec\u7acb\u52a0\u9501\uff1a"}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["\u8bfb\uff1a",(0,d.jsx)(n.code,{children:"if_contains()"})," \u5b89\u5168\u83b7\u53d6\u5f15\u7528"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsxs)(n.p,{children:["\u5199\uff1a",(0,d.jsx)(n.code,{children:"modify_if()"})," \u6216 ",(0,d.jsx)(n.code,{children:"try_emplace_l()"})," \u5b89\u5168\u4fee\u6539"]}),"\n"]}),"\n",(0,d.jsxs)(n.li,{children:["\n",(0,d.jsx)(n.p,{children:"\u6ce8\u610f\uff1a\u6807\u51c6\u8fed\u4ee3\u5668/\u5f15\u7528\u4e0d\u53d7\u4fdd\u62a4\uff0c\u591a\u7ebf\u7a0b\u4fee\u6539\u65f6\u4e0d\u53ef\u4f9d\u8d56"}),"\n"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"123-\u63a8\u8350\u9501",children:"12.3 \u63a8\u8350\u9501"}),"\n",(0,d.jsxs)(n.ul,{children:["\n",(0,d.jsxs)(n.li,{children:["C++17 ",(0,d.jsx)(n.code,{children:"std::shared_mutex"})," \u6027\u80fd\u6700\u4f73"]}),"\n"]}),"\n",(0,d.jsx)(n.h3,{id:"124-\u5e76\u53d1\u793a\u4f8b",children:"12.4 \u5e76\u53d1\u793a\u4f8b"}),"\n",(0,d.jsx)(n.pre,{children:(0,d.jsx)(n.code,{className:"language-cpp",children:'#include <assert.h>\n#include <stdint.h>\n#include <thread>\n#include <vector>\n#include "parallel-hashmap/parallel_hashmap/phmap.h"\n\ntypedef phmap::parallel_flat_hash_map<uint64_t, uint32_t,\n    phmap::priv::hash_default_hash<uint64_t>,\n    phmap::priv::hash_default_eq<uint64_t>,\n    std::allocator<std::pair<const uint64_t, uint32_t>>, 4, std::shared_mutex> MapT;\n\nint main() {\n    MapT index;\n    const uint32_t key_num = 10000;\n    const int thread_num = 10;\n\n    for (uint64_t key = 0; key < key_num; ++key)\n        index.try_emplace_l(key, [](uint32_t& val){ val = 0; }, 0);\n\n    std::vector<std::thread> threads;\n    for (int i = 0; i < thread_num; ++i)\n        threads.emplace_back([&](){\n            for (uint64_t key = 0; key < key_num * 10; ++key)\n                index.modify_if(key, [](uint32_t& val){ ++val; });\n        });\n\n    for (auto& t : threads) t.join();\n\n    uint32_t hit_num = 0;\n    for (uint64_t key = 0; key < key_num * 10; ++key)\n        index.if_contains(key, [&](const uint32_t& val){\n            assert(thread_num == val);\n            ++hit_num;\n        });\n\n    assert(hit_num == key_num);\n    return 0;\n}\n'})})]})}function x(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(t,{...e})}):t(e)}}}]);