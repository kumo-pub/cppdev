"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[9228],{4:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>c,default:()=>x,frontMatter:()=>r,metadata:()=>d,toc:()=>h});const d=JSON.parse('{"id":"foundamentals/testing/doct/benchmarks","title":"Framework Performance","description":"Overview","source":"@site/i18n/zh-cn/docusaurus-plugin-content-docs/current/foundamentals/testing/doct/benchmarks.mdx","sourceDirName":"foundamentals/testing/doct","slug":"/foundamentals/testing/doct/benchmarks","permalink":"/cppdev/zh-cn/docs/foundamentals/testing/doct/benchmarks","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Integration and Building","permalink":"/cppdev/zh-cn/docs/foundamentals/testing/doct/build-systems"},"next":{"title":"Features","permalink":"/cppdev/zh-cn/docs/foundamentals/testing/doct/features"}}');var i=n(4848),t=n(8453);const r={},c="Framework Performance",l={},h=[{value:"Overview",id:"overview",level:2},{value:"Compile-Time Benchmarks",id:"compile-time-benchmarks",level:2},{value:"Cost of Including the Header",id:"cost-of-including-the-header",level:3},{value:"Conclusion",id:"conclusion",level:4},{value:"doctest",id:"doctest",level:5},{value:"Catch",id:"catch",level:5},{value:"Therefore, if &quot;doctest.h&quot; costs 11 ms on MSVC and &quot;catch.hpp&quot; costs 400 ms \u2013 the <strong>doctest</strong> header is <code>&gt;&gt;</code> <strong>36</strong><code>&lt;&lt;</code> times lighter (for MSVC)!",id:"therefore-if-doctesth-costs-11-ms-on-msvc-and-catchhpp-costs-400-ms--the-doctest-header-is--36-times-lighter-for-msvc",level:2},{value:"Cost of an Assertion Macro",id:"cost-of-an-assertion-macro",level:3},{value:"Conclusion",id:"conclusion-1",level:4},{value:"Runtime Benchmarks",id:"runtime-benchmarks",level:3},{value:"Conclusion",id:"conclusion-2",level:4}];function o(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.header,{children:(0,i.jsx)(s.h1,{id:"framework-performance",children:"Framework Performance"})}),"\n",(0,i.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsxs)(s.p,{children:["Benchmarking was conducted using CMake via the ",(0,i.jsx)(s.a,{href:"https://github.com/doctest/doctest/blob/master/scripts/bench/bench.py",children:(0,i.jsx)(s.strong,{children:"this"})})," script. There are 3 benchmark scenarios:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#cost-of-including-the-header",children:"Cost of Including the Header"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#cost-of-an-assertion-macro",children:"Cost of an Assertion Macro"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.a,{href:"#runtime-benchmarks",children:"Runtime Speed with a Large Number of Assertions"})}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Compilers used:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Windows: Microsoft Visual Studio Community 2017 - Version 15.8.1+28010.2003"}),"\n",(0,i.jsx)(s.li,{children:"Windows: gcc 8.1.0 (x86_64-posix-seh-rev0, Built by MinGW-W64 project)"}),"\n",(0,i.jsx)(s.li,{children:"Linux: gcc 6.3.0 20170406 (Ubuntu 6.3.0-12ubuntu2)"}),"\n",(0,i.jsx)(s.li,{children:"Linux: clang 4.0.0-1 (tags/RELEASE_400/rc1) Target: x86_64-pc-linux-gnu"}),"\n"]}),"\n",(0,i.jsx)(s.p,{children:"Environment used (Intel i7 3770k, 16GB RAM):"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"Windows 7 - on SSD"}),"\n",(0,i.jsx)(s.li,{children:"Ubuntu 17.04 in VirtualBox VM - on HDD"}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"doctest"})," version: 2.2.0 (released on December 02, 2018)\n",(0,i.jsx)(s.a,{href:"https://github.com/catchorg/Catch2",children:(0,i.jsx)(s.strong,{children:"Catch"})})," version: 2.3.0 (released on July 22, 2018)"]}),"\n",(0,i.jsx)(s.h2,{id:"compile-time-benchmarks",children:"Compile-Time Benchmarks"}),"\n",(0,i.jsx)(s.h3,{id:"cost-of-including-the-header",children:"Cost of Including the Header"}),"\n",(0,i.jsxs)(s.p,{children:["This benchmark is only relevant to single-header and header-only frameworks \u2013 such as ",(0,i.jsx)(s.strong,{children:"doctest"})," and ",(0,i.jsx)(s.a,{href:"https://github.com/catchorg/Catch2",children:(0,i.jsx)(s.strong,{children:"Catch"})}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["The script generates 201 source files: 200 of them create a function in the form of ",(0,i.jsx)(s.code,{children:"int f135() { return 135; }"}),", and all 200 such dummy functions are forward-declared in ",(0,i.jsx)(s.code,{children:"main.cpp"}),". Their results are accumulated to return from the ",(0,i.jsx)(s.code,{children:"main()"})," function. This ensures all source files are built and the linker does not remove or optimize any content."]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Baseline"})," - Time taken to build source files single-threaded with ",(0,i.jsx)(s.code,{children:"msbuild"}),"/",(0,i.jsx)(s.code,{children:"make"})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"+ Implement"})," - Only in ",(0,i.jsx)(s.code,{children:"main.cpp"}),", the header is included with a preceding ",(0,i.jsx)(s.code,{children:"#define"})," to implement the test runner:","\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-c++",children:'#define DOCTEST_CONFIG_IMPLEMENT_WITH_MAIN\n#include "doctest.h"\n'})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"+ header everywhere"})," - The framework header is also included in all other source files"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"+ disabled"})," - Remove all testing-related code from the binary"]}),"\n"]}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"doctest"}),(0,i.jsx)(s.th,{children:"baseline"}),(0,i.jsx)(s.th,{children:"+ implement"}),(0,i.jsx)(s.th,{children:"+ header everywhere"}),(0,i.jsx)(s.th,{children:"+ disabled"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"MSVC Debug"}),(0,i.jsx)(s.td,{children:"4.89"}),(0,i.jsx)(s.td,{children:"6.21"}),(0,i.jsx)(s.td,{children:"8.33"}),(0,i.jsx)(s.td,{children:"6.39"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"MSVC Release"}),(0,i.jsx)(s.td,{children:"4.38"}),(0,i.jsx)(s.td,{children:"6.39"}),(0,i.jsx)(s.td,{children:"8.71"}),(0,i.jsx)(s.td,{children:"6.02"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"MinGW GCC Debug"}),(0,i.jsx)(s.td,{children:"8.12"}),(0,i.jsx)(s.td,{children:"10.86"}),(0,i.jsx)(s.td,{children:"14.73"}),(0,i.jsx)(s.td,{children:"10.17"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"MinGW GCC Release"}),(0,i.jsx)(s.td,{children:"8.21"}),(0,i.jsx)(s.td,{children:"11.11"}),(0,i.jsx)(s.td,{children:"15.03"}),(0,i.jsx)(s.td,{children:"10.71"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Linux GCC Debug"}),(0,i.jsx)(s.td,{children:"4.20"}),(0,i.jsx)(s.td,{children:"6.23"}),(0,i.jsx)(s.td,{children:"9.81"}),(0,i.jsx)(s.td,{children:"6.24"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Linux GCC Release"}),(0,i.jsx)(s.td,{children:"4.29"}),(0,i.jsx)(s.td,{children:"6.93"}),(0,i.jsx)(s.td,{children:"11.05"}),(0,i.jsx)(s.td,{children:"6.76"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Linux Clang Debug"}),(0,i.jsx)(s.td,{children:"8.70"}),(0,i.jsx)(s.td,{children:"10.02"}),(0,i.jsx)(s.td,{children:"14.43"}),(0,i.jsx)(s.td,{children:"11.13"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Linux Clang Release"}),(0,i.jsx)(s.td,{children:"9.30"}),(0,i.jsx)(s.td,{children:"11.68"}),(0,i.jsx)(s.td,{children:"16.20"}),(0,i.jsx)(s.td,{children:"11.58"})]})]})]}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Catch"}),(0,i.jsx)(s.th,{children:"baseline"}),(0,i.jsx)(s.th,{children:"+ implement"}),(0,i.jsx)(s.th,{children:"+ header everywhere"}),(0,i.jsx)(s.th,{children:"+ disabled"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"MSVC Debug"}),(0,i.jsx)(s.td,{children:"4.82"}),(0,i.jsx)(s.td,{children:"7.83"}),(0,i.jsx)(s.td,{children:"88.85"}),(0,i.jsx)(s.td,{children:"88.72"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"MSVC Release"}),(0,i.jsx)(s.td,{children:"4.38"}),(0,i.jsx)(s.td,{children:"9.97"}),(0,i.jsx)(s.td,{children:"87.17"}),(0,i.jsx)(s.td,{children:"88.35"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"MinGW GCC Debug"}),(0,i.jsx)(s.td,{children:"8.00"}),(0,i.jsx)(s.td,{children:"57.28"}),(0,i.jsx)(s.td,{children:"137.28"}),(0,i.jsx)(s.td,{children:"132.73"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"MinGW GCC Release"}),(0,i.jsx)(s.td,{children:"8.38"}),(0,i.jsx)(s.td,{children:"22.94"}),(0,i.jsx)(s.td,{children:"97.17"}),(0,i.jsx)(s.td,{children:"97.22"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Linux GCC Debug"}),(0,i.jsx)(s.td,{children:"4.42"}),(0,i.jsx)(s.td,{children:"15.57"}),(0,i.jsx)(s.td,{children:"97.94"}),(0,i.jsx)(s.td,{children:"97.18"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Linux GCC Release"}),(0,i.jsx)(s.td,{children:"4.50"}),(0,i.jsx)(s.td,{children:"19.59"}),(0,i.jsx)(s.td,{children:"99.48"}),(0,i.jsx)(s.td,{children:"100.75"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Linux Clang Debug"}),(0,i.jsx)(s.td,{children:"8.76"}),(0,i.jsx)(s.td,{children:"15.60"}),(0,i.jsx)(s.td,{children:"107.99"}),(0,i.jsx)(s.td,{children:"110.61"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Linux Clang Release"}),(0,i.jsx)(s.td,{children:"9.32"}),(0,i.jsx)(s.td,{children:"25.75"}),(0,i.jsx)(s.td,{children:"118.67"}),(0,i.jsx)(s.td,{children:"117.11"})]})]})]}),"\n",(0,i.jsx)("img",{src:"https://gitee.com/kumo-hub/doctest/raw/master/scripts/data/benchmarks/header.png",width:"410",align:"right"}),"\n",(0,i.jsx)("img",{src:"https://gitee.com/kumo-hub/doctest/raw/master/scripts/data/benchmarks/implement.png",width:"410"}),"\n",(0,i.jsx)(s.h4,{id:"conclusion",children:"Conclusion"}),"\n",(0,i.jsx)(s.h5,{id:"doctest",children:"doctest"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Instantiating the test runner in one source file takes approximately 1\u20133 seconds (",(0,i.jsx)(s.code,{children:"implement - baseline"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:['Including "doctest.h" in one source file costs 11 ms \u2013 23 ms (',(0,i.jsx)(s.code,{children:"(header_everywhere - implement) / 200"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:["Including the library everywhere with all features disabled costs approximately 2 seconds (",(0,i.jsx)(s.code,{children:"disabled - baseline"}),") for 200 files"]}),"\n"]}),"\n",(0,i.jsx)(s.h5,{id:"catch",children:(0,i.jsx)(s.a,{href:"https://github.com/catchorg/Catch2",children:"Catch"})}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Instantiating the test runner in one source file takes approximately 3\u201350 seconds (",(0,i.jsx)(s.code,{children:"implement - baseline"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:["Including ",(0,i.jsx)(s.code,{children:"catch.hpp"})," in one source file costs 380 ms \u2013 470 ms (",(0,i.jsx)(s.code,{children:"(header_everywhere - implement) / 200"}),")"]}),"\n",(0,i.jsxs)(s.li,{children:["Disabling the library with the ",(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"CATCH_CONFIG_DISABLE"})})," configuration option has no impact on header inclusion cost"]}),"\n"]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsxs)(s.h2,{id:"therefore-if-doctesth-costs-11-ms-on-msvc-and-catchhpp-costs-400-ms--the-doctest-header-is--36-times-lighter-for-msvc",children:['Therefore, if "doctest.h" costs 11 ms on MSVC and "catch.hpp" costs 400 ms \u2013 the ',(0,i.jsx)(s.strong,{children:"doctest"})," header is ",(0,i.jsx)(s.code,{children:">>"})," ",(0,i.jsx)(s.strong,{children:"36"}),(0,i.jsx)(s.code,{children:"<<"})," times lighter (for MSVC)!"]}),"\n",(0,i.jsxs)(s.p,{children:["The results are shown in seconds and are ",(0,i.jsx)(s.strong,{children:"by no means"})," intended to criticize ",(0,i.jsx)(s.a,{href:"https://github.com/catchorg/Catch2",children:(0,i.jsx)(s.strong,{children:"Catch"})})," \u2013 the ",(0,i.jsx)(s.strong,{children:"doctest"})," framework would not exist without it."]}),"\n",(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.strong,{children:"doctest"})," header has minimal compile-time overhead because it forward-declares all content and does not pull any headers into source files (except the one implementing the test runner). This is a key design decision."]}),"\n",(0,i.jsx)(s.h3,{id:"cost-of-an-assertion-macro",children:"Cost of an Assertion Macro"}),"\n",(0,i.jsxs)(s.p,{children:["The script generates 11 .cpp files: 10 files create 50 test cases each, with 100 assertions per test case (in the form of ",(0,i.jsx)(s.code,{children:"CHECK(a==b)"})," where ",(0,i.jsx)(s.code,{children:"a"})," and ",(0,i.jsx)(s.code,{children:"b"})," are the same ",(0,i.jsx)(s.code,{children:"int"})," variable) \u2013 totaling ",(0,i.jsx)(s.strong,{children:"50k"})," assertions! The test framework is implemented in ",(0,i.jsx)(s.code,{children:"main.cpp"}),"."]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"Baseline"})," - Time for a single-threaded build with the header included everywhere (no test cases or assertions)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"CHECK(a==b)"})," - Adds ",(0,i.jsx)(s.code,{children:"CHECK()"})," assertions that decompose expressions using template mechanisms"]}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"doctest"})," specific:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"+fast 1"})," - Adds ",(0,i.jsx)(s.a,{href:"/cppdev/zh-cn/docs/foundamentals/testing/doct/configuration#doctest_config_super_fast_asserts",children:(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"DOCTEST_CONFIG_SUPER_FAST_ASSERTS"})})})," to speed up compilation of normal ",(0,i.jsx)(s.code,{children:"CHECK(a==b)"})," assertions"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"CHECK_EQ(a,b)"})," - Uses ",(0,i.jsx)(s.code,{children:"CHECK_EQ(a,b)"})," instead of expression decomposition"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"+fast 2"})," - Adds ",(0,i.jsx)(s.a,{href:"/cppdev/zh-cn/docs/foundamentals/testing/doct/configuration#doctest_config_super_fast_asserts",children:(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"DOCTEST_CONFIG_SUPER_FAST_ASSERTS"})})})," to speed up compilation of binary ",(0,i.jsx)(s.code,{children:"CHECK_EQ(a,b)"})," assertions"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"+disabled"})," - Disables all test cases and assertion macros with ",(0,i.jsx)(s.a,{href:"/cppdev/zh-cn/docs/foundamentals/testing/doct/configuration#doctest_config_disable",children:(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"DOCTEST_CONFIG_DISABLE"})})})]}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.a,{href:"https://github.com/catchorg/Catch2",children:(0,i.jsx)(s.strong,{children:"Catch"})})," specific:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"+fast"})," - Adds ",(0,i.jsx)(s.a,{href:"https://github.com/catchorg/Catch2/blob/master/docs/configuration.mdx#catch_config_fast_compile",children:(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"CATCH_CONFIG_FAST_COMPILE"})})})," to speed up compilation of normal ",(0,i.jsx)(s.code,{children:"CHECK(a==b)"})," assertions"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.strong,{children:"+disabled"})," - Disables all test cases and assertion macros with ",(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.code,{children:"CATCH_CONFIG_DISABLE"})})]}),"\n"]}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"doctest"}),(0,i.jsx)(s.th,{children:"baseline"}),(0,i.jsx)(s.th,{children:(0,i.jsx)(s.code,{children:"CHECK(a==b)"})}),(0,i.jsx)(s.th,{children:"+fast 1"}),(0,i.jsx)(s.th,{children:(0,i.jsx)(s.code,{children:"CHECK_EQ(a,b)"})}),(0,i.jsx)(s.th,{children:"+fast 2"}),(0,i.jsx)(s.th,{children:"+disabled"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"MSVC Debug"}),(0,i.jsx)(s.td,{children:"2.69"}),(0,i.jsx)(s.td,{children:"27.37"}),(0,i.jsx)(s.td,{children:"10.37"}),(0,i.jsx)(s.td,{children:"17.17"}),(0,i.jsx)(s.td,{children:"4.82"}),(0,i.jsx)(s.td,{children:"1.91"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"MSVC Release"}),(0,i.jsx)(s.td,{children:"3.15"}),(0,i.jsx)(s.td,{children:"58.73"}),(0,i.jsx)(s.td,{children:"20.73"}),(0,i.jsx)(s.td,{children:"26.07"}),(0,i.jsx)(s.td,{children:"6.43"}),(0,i.jsx)(s.td,{children:"1.83"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"MinGW GCC Debug"}),(0,i.jsx)(s.td,{children:"3.78"}),(0,i.jsx)(s.td,{children:"97.29"}),(0,i.jsx)(s.td,{children:"43.05"}),(0,i.jsx)(s.td,{children:"59.86"}),(0,i.jsx)(s.td,{children:"11.88"}),(0,i.jsx)(s.td,{children:"1.67"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"MinGW GCC Release"}),(0,i.jsx)(s.td,{children:"4.09"}),(0,i.jsx)(s.td,{children:"286.70"}),(0,i.jsx)(s.td,{children:"95.42"}),(0,i.jsx)(s.td,{children:"156.73"}),(0,i.jsx)(s.td,{children:"18.16"}),(0,i.jsx)(s.td,{children:"2.03"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Linux GCC Debug"}),(0,i.jsx)(s.td,{children:"2.39"}),(0,i.jsx)(s.td,{children:"91.36"}),(0,i.jsx)(s.td,{children:"41.92"}),(0,i.jsx)(s.td,{children:"52.26"}),(0,i.jsx)(s.td,{children:"10.16"}),(0,i.jsx)(s.td,{children:"1.32"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Linux GCC Release"}),(0,i.jsx)(s.td,{children:"3.29"}),(0,i.jsx)(s.td,{children:"257.40"}),(0,i.jsx)(s.td,{children:"97.46"}),(0,i.jsx)(s.td,{children:"128.84"}),(0,i.jsx)(s.td,{children:"19.38"}),(0,i.jsx)(s.td,{children:"1.79"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Linux Clang Debug"}),(0,i.jsx)(s.td,{children:"2.40"}),(0,i.jsx)(s.td,{children:"85.52"}),(0,i.jsx)(s.td,{children:"43.53"}),(0,i.jsx)(s.td,{children:"51.24"}),(0,i.jsx)(s.td,{children:"8.32"}),(0,i.jsx)(s.td,{children:"1.62"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Linux Clang Release"}),(0,i.jsx)(s.td,{children:"3.40"}),(0,i.jsx)(s.td,{children:"160.65"}),(0,i.jsx)(s.td,{children:"79.34"}),(0,i.jsx)(s.td,{children:"81.52"}),(0,i.jsx)(s.td,{children:"11.90"}),(0,i.jsx)(s.td,{children:"1.82"})]})]})]}),"\n",(0,i.jsxs)(s.p,{children:["Here are the results for ",(0,i.jsx)(s.a,{href:"https://github.com/catchorg/Catch2",children:(0,i.jsx)(s.strong,{children:"Catch"})})," (only supports normal ",(0,i.jsx)(s.code,{children:"CHECK(a==b)"})," assertions):"]}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"Catch"}),(0,i.jsx)(s.th,{children:"baseline"}),(0,i.jsx)(s.th,{children:(0,i.jsx)(s.code,{children:"CHECK(a==b)"})}),(0,i.jsx)(s.th,{children:"+fast"}),(0,i.jsx)(s.th,{children:"+disabled"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"MSVC Debug"}),(0,i.jsx)(s.td,{children:"8.20"}),(0,i.jsx)(s.td,{children:"31.22"}),(0,i.jsx)(s.td,{children:"25.54"}),(0,i.jsx)(s.td,{children:"8.22"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"MSVC Release"}),(0,i.jsx)(s.td,{children:"10.13"}),(0,i.jsx)(s.td,{children:"448.68"}),(0,i.jsx)(s.td,{children:"168.67"}),(0,i.jsx)(s.td,{children:"10.20"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"MinGW GCC Debug"}),(0,i.jsx)(s.td,{children:"53.54"}),(0,i.jsx)(s.td,{children:"152.38"}),(0,i.jsx)(s.td,{children:"131.85"}),(0,i.jsx)(s.td,{children:"49.07"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"MinGW GCC Release"}),(0,i.jsx)(s.td,{children:"19.26"}),(0,i.jsx)(s.td,{children:"590.16"}),(0,i.jsx)(s.td,{children:"466.69"}),(0,i.jsx)(s.td,{children:"18.99"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Linux GCC Debug"}),(0,i.jsx)(s.td,{children:"15.05"}),(0,i.jsx)(s.td,{children:"117.30"}),(0,i.jsx)(s.td,{children:"95.33"}),(0,i.jsx)(s.td,{children:"14.79"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Linux GCC Release"}),(0,i.jsx)(s.td,{children:"18.77"}),(0,i.jsx)(s.td,{children:"608.94"}),(0,i.jsx)(s.td,{children:"482.73"}),(0,i.jsx)(s.td,{children:"18.96"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Linux Clang Debug"}),(0,i.jsx)(s.td,{children:"12.27"}),(0,i.jsx)(s.td,{children:"94.39"}),(0,i.jsx)(s.td,{children:"77.33"}),(0,i.jsx)(s.td,{children:"12.11"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Linux Clang Release"}),(0,i.jsx)(s.td,{children:"20.75"}),(0,i.jsx)(s.td,{children:"545.84"}),(0,i.jsx)(s.td,{children:"506.02"}),(0,i.jsx)(s.td,{children:"20.15"})]})]})]}),"\n",(0,i.jsx)("img",{src:"https://gitee.com/kumo-hub/doctest/raw/master/scripts/data/benchmarks/asserts.png"}),"\n",(0,i.jsx)(s.h4,{id:"conclusion-1",children:"Conclusion"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"doctest"}),":"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Regex-decomposed ",(0,i.jsx)(s.code,{children:"CHECK(a==b)"})," assertions are 0\u20138 times faster than ",(0,i.jsx)(s.a,{href:"https://github.com/catchorg/Catch2",children:(0,i.jsx)(s.strong,{children:"Catch"})})]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"CHECK_EQ(a,b)"})," assertions (no expression decomposition) are approximately 31\u201363% faster than ",(0,i.jsx)(s.code,{children:"CHECK(a==b)"})]}),"\n",(0,i.jsxs)(s.li,{children:["The ",(0,i.jsx)(s.code,{children:"DOCTEST_CONFIG_SUPER_FAST_ASSERTS"})," identifier speeds up normal assertions by 57\u201368%"]}),"\n",(0,i.jsxs)(s.li,{children:["The ",(0,i.jsx)(s.code,{children:"DOCTEST_CONFIG_SUPER_FAST_ASSERTS"})," identifier speeds up binary assertions by an additional 84\u201391%"]}),"\n",(0,i.jsxs)(s.li,{children:["The ",(0,i.jsx)(s.code,{children:"DOCTEST_CONFIG_DISABLE"})," identifier makes assertions disappear entirely (even faster than baseline, as most implementation code is removed)"]}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.a,{href:"https://github.com/catchorg/Catch2",children:(0,i.jsx)(s.strong,{children:"Catch"})}),":"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"CATCH_CONFIG_FAST_COMPILE"})," speeds up assertion compilation by 10\u201330% (73% in one case)"]}),"\n",(0,i.jsxs)(s.li,{children:[(0,i.jsx)(s.code,{children:"CATCH_CONFIG_DISABLE"})," provides the same significant benefit for assertions as ",(0,i.jsx)(s.code,{children:"DOCTEST_CONFIG_DISABLE"})," \u2013 but does not reduce header inclusion cost"]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{id:"runtime-benchmarks",children:"Runtime Benchmarks"}),"\n",(0,i.jsxs)(s.p,{children:["Runtime benchmarks use a single test case with a loop of 10 million iterations: either a single normal assertion (with expression decomposition) or an assertion plus logging of the loop iterator ",(0,i.jsx)(s.code,{children:"i"}),":"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-c++",children:"for(int i = 0; i < 10000000; ++i)\n    CHECK(i == i);\n"})}),"\n",(0,i.jsx)(s.p,{children:"or"}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-c++",children:"for(int i = 0; i < 10000000; ++i) {\n    INFO(i);\n    CHECK(i == i);\n}\n"})}),"\n",(0,i.jsx)(s.p,{children:"Note: All assertions pass \u2013 the goal is to optimize for the common case (many passing test cases, few failures)."}),"\n",(0,i.jsxs)(s.table,{children:[(0,i.jsx)(s.thead,{children:(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.th,{children:"doctest"}),(0,i.jsx)(s.th,{children:"assert"}),(0,i.jsx)(s.th,{children:"+ info"}),(0,i.jsx)(s.th,{children:"\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0\xa0"}),(0,i.jsx)(s.th,{children:"Catch"}),(0,i.jsx)(s.th,{children:"assert"}),(0,i.jsx)(s.th,{children:"+ info"})]})}),(0,i.jsxs)(s.tbody,{children:[(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"MSVC Debug"}),(0,i.jsx)(s.td,{children:"4.00"}),(0,i.jsx)(s.td,{children:"11.41"}),(0,i.jsx)(s.td,{}),(0,i.jsx)(s.td,{children:"MSVC Debug"}),(0,i.jsx)(s.td,{children:"5.60"}),(0,i.jsx)(s.td,{children:"213.91"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"MSVC Release"}),(0,i.jsx)(s.td,{children:"0.40"}),(0,i.jsx)(s.td,{children:"1.47"}),(0,i.jsx)(s.td,{}),(0,i.jsx)(s.td,{children:"MSVC Release"}),(0,i.jsx)(s.td,{children:"0.76"}),(0,i.jsx)(s.td,{children:"7.60"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"MinGW GCC Debug"}),(0,i.jsx)(s.td,{children:"1.05"}),(0,i.jsx)(s.td,{children:"2.93"}),(0,i.jsx)(s.td,{}),(0,i.jsx)(s.td,{children:"MinGW GCC Debug"}),(0,i.jsx)(s.td,{children:"1.17"}),(0,i.jsx)(s.td,{children:"9.54"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"MinGW GCC Release"}),(0,i.jsx)(s.td,{children:"0.34"}),(0,i.jsx)(s.td,{children:"1.27"}),(0,i.jsx)(s.td,{}),(0,i.jsx)(s.td,{children:"MinGW GCC Release"}),(0,i.jsx)(s.td,{children:"0.36"}),(0,i.jsx)(s.td,{children:"4.28"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Linux GCC Debug"}),(0,i.jsx)(s.td,{children:"1.24"}),(0,i.jsx)(s.td,{children:"2.34"}),(0,i.jsx)(s.td,{}),(0,i.jsx)(s.td,{children:"Linux GCC Debug"}),(0,i.jsx)(s.td,{children:"1.44"}),(0,i.jsx)(s.td,{children:"9.69"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Linux GCC Release"}),(0,i.jsx)(s.td,{children:"0.29"}),(0,i.jsx)(s.td,{children:"0.52"}),(0,i.jsx)(s.td,{}),(0,i.jsx)(s.td,{children:"Linux GCC Release"}),(0,i.jsx)(s.td,{children:"0.29"}),(0,i.jsx)(s.td,{children:"3.60"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Linux Clang Debug"}),(0,i.jsx)(s.td,{children:"1.15"}),(0,i.jsx)(s.td,{children:"2.38"}),(0,i.jsx)(s.td,{}),(0,i.jsx)(s.td,{children:"Linux Clang Debug"}),(0,i.jsx)(s.td,{children:"1.21"}),(0,i.jsx)(s.td,{children:"9.91"})]}),(0,i.jsxs)(s.tr,{children:[(0,i.jsx)(s.td,{children:"Linux Clang Release"}),(0,i.jsx)(s.td,{children:"0.28"}),(0,i.jsx)(s.td,{children:"0.50"}),(0,i.jsx)(s.td,{}),(0,i.jsx)(s.td,{children:"Linux Clang Release"}),(0,i.jsx)(s.td,{children:"0.32"}),(0,i.jsx)(s.td,{children:"3.27"})]})]})]}),"\n",(0,i.jsx)("img",{src:"https://gitee.com/kumo-hub/doctest/raw/master/scripts/data/benchmarks/runtime_info.png",width:"410",align:"right"}),"\n",(0,i.jsx)("img",{src:"https://gitee.com/kumo-hub/doctest/raw/master/scripts/data/benchmarks/runtime_assert.png",width:"410"}),"\n",(0,i.jsx)(s.h4,{id:"conclusion-2",children:"Conclusion"}),"\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"doctest"})," assertions are approximately 20% faster than Catch's, and several times faster (over 18 times faster in one specific compiler scenario) when logging variables and context."]}),"\n",(0,i.jsx)(s.hr,{}),"\n",(0,i.jsxs)(s.p,{children:["Bar charts were generated by pasting table data into ",(0,i.jsx)(s.a,{href:"https://docs.google.com/spreadsheets/d/1p3MAURUfPzKT7gtJOVuJU2_yVKSqkoD1nbypA1K3618",children:(0,i.jsx)(s.strong,{children:"this Google Spreadsheet"})}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["For a non-synthetic benchmark, see this ",(0,i.jsx)(s.a,{href:"http://baptiste-wicht.com/posts/2016/09/blazing-fast-unit-test-compilation-with-doctest-11.html",children:"blog post"})," by ",(0,i.jsx)(s.a,{href:"https://github.com/wichtounet",children:"Baptiste Wicht"}),", who tested assertion compile times in version 1.1 with his ",(0,i.jsx)(s.a,{href:"https://github.com/wichtounet/etl",children:"expression template library"}),"!"]}),"\n",(0,i.jsx)(s.p,{children:"When reading the article: note that if a process segment takes 50% of the total time and is sped up 10,000 times, the entire process will only be about 50% faster overall."})]})}function x(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>c});var d=n(6540);const i={},t=d.createContext(i);function r(e){const s=d.useContext(t);return d.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),d.createElement(t.Provider,{value:s},e.children)}}}]);