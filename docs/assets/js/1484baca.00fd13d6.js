"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[4143],{2196:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>d,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"store/kv/leveldb","title":"LevelDB","description":"LevelDB is an embedded key\u2013value store used by Kumo for local metadata,","source":"@site/docs/store/kv/leveldb.mdx","sourceDirName":"store/kv","slug":"/store/kv/leveldb","permalink":"/cppdev/docs/store/kv/leveldb","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{"title":"LevelDB"},"sidebar":"tutorialSidebar","previous":{"title":"Granite Key/Value Encapsulation and Workflow","permalink":"/cppdev/docs/store/kv/rocksdb/granite"},"next":{"title":"LMDB","permalink":"/cppdev/docs/store/kv/lmdb"}}');var l=s(4848),r=s(8453);const d={title:"LevelDB"},i=void 0,c={},a=[{value:"1. Performance characteristics",id:"performance-characteristics",level:2},{value:"2. C++ API usage",id:"api",level:2},{value:"Open a database",id:"open-a-database",level:3},{value:"Put (Set)",id:"put-set",level:3},{value:"Get",id:"get",level:3},{value:"Delete",id:"delete",level:3},{value:"Close",id:"close",level:3},{value:"3. On-disk directory structure",id:"3-on-disk-directory-structure",level:2},{value:"Summary",id:"summary",level:2}];function o(e){const n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.p,{children:"LevelDB is an embedded key\u2013value store used by Kumo for local metadata,\nsmall structured data, and control-plane state."}),"\n",(0,l.jsxs)(n.p,{children:["This page documents its ",(0,l.jsx)(n.strong,{children:"performance characteristics"}),", ",(0,l.jsx)(n.strong,{children:"C++ API usage"}),",\nand ",(0,l.jsx)(n.strong,{children:"on-disk layout"})," as they relate to Kumo."]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"performance-characteristics",children:"1. Performance characteristics"}),"\n",(0,l.jsx)(n.p,{children:"LevelDB is optimized for:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Fast random reads"}),"\n",(0,l.jsx)(n.li,{children:"High write throughput via log-structured merge tree (LSM)"}),"\n",(0,l.jsx)(n.li,{children:"Ordered iteration by key"}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Typical characteristics (single node, SSD class storage):"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Metric"}),(0,l.jsx)(n.th,{children:"Typical range"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Point lookup (Get)"}),(0,l.jsx)(n.td,{children:"~5\u201350 \xb5s"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Sequential scan"}),(0,l.jsx)(n.td,{children:"Disk bandwidth bound"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Write throughput"}),(0,l.jsx)(n.td,{children:"50\u2013200 MB/s"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Write amplification"}),(0,l.jsx)(n.td,{children:"Moderate (LSM compaction)"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Read amplification"}),(0,l.jsx)(n.td,{children:"Low for recent data, higher for cold data"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Memory usage"}),(0,l.jsx)(n.td,{children:"Mostly block cache + memtables"})]})]})]}),"\n",(0,l.jsx)(n.admonition,{title:"TIPS",type:"warning",children:(0,l.jsxs)(n.p,{children:["LevelDB performance degrades with very large datasets.\nFor Kumo control-plane usage, the number of keys ",(0,l.jsx)(n.strong,{children:"should typically not exceed 10 million"}),".\nBeyond this, latency and memory usage can grow significantly."]})}),"\n",(0,l.jsxs)(n.p,{children:["LevelDB is designed for ",(0,l.jsx)(n.strong,{children:"embedded workloads"})," with predictable access patterns\nand works best when:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Data fits mostly on local SSD"}),"\n",(0,l.jsx)(n.li,{children:"Write rates are steady"}),"\n",(0,l.jsx)(n.li,{children:"Large values are avoided"}),"\n"]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"api",children:"2. C++ API usage"}),"\n",(0,l.jsx)(n.p,{children:"Kumo uses the native LevelDB C++ API directly."}),"\n",(0,l.jsx)(n.h3,{id:"open-a-database",children:"Open a database"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cpp",children:'#include <leveldb/db.h>\n\nleveldb::DB* db;\nleveldb::Options options;\noptions.create_if_missing = true;\n\nleveldb::Status status = leveldb::DB::Open(options, "/data/kumo/leveldb", &db);\nif (!status.ok()) {\n    // handle error\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"put-set",children:"Put (Set)"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cpp",children:'leveldb::WriteOptions wopt;\nwopt.sync = false;  // true for stronger durability\n\nleveldb::Status s = db->Put(wopt, "key1", "value1");\n'})}),"\n",(0,l.jsx)(n.h3,{id:"get",children:"Get"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cpp",children:'std::string value;\nleveldb::ReadOptions ropt;\n\nleveldb::Status s = db->Get(ropt, "key1", &value);\nif (s.ok()) {\n    // value is available\n}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"delete",children:"Delete"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cpp",children:'leveldb::Status s = db->Delete(leveldb::WriteOptions(), "key1");\n'})}),"\n",(0,l.jsx)(n.h3,{id:"close",children:"Close"}),"\n",(0,l.jsxs)(n.p,{children:["LevelDB does not have an explicit ",(0,l.jsx)(n.code,{children:"Close"})," API.\nThe database is closed by deleting the ",(0,l.jsx)(n.code,{children:"DB"})," object."]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-cpp",children:"delete db;\n"})}),"\n",(0,l.jsx)(n.p,{children:"All pending background work is flushed and file handles are released."}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"3-on-disk-directory-structure",children:"3. On-disk directory structure"}),"\n",(0,l.jsx)(n.p,{children:"A typical LevelDB directory looks like:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{children:"/data/kumo/leveldb/\n\u251c\u2500\u2500 000003.log\n\u251c\u2500\u2500 000004.log\n\u251c\u2500\u2500 000007.sst\n\u251c\u2500\u2500 000010.sst\n\u251c\u2500\u2500 CURRENT\n\u251c\u2500\u2500 MANIFEST-000005\n\u251c\u2500\u2500 LOCK\n\u2514\u2500\u2500 LOG\n"})}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"File"}),(0,l.jsx)(n.th,{children:"Purpose"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"*.log"})}),(0,l.jsx)(n.td,{children:"Write-ahead log (WAL) for recent writes"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"*.sst"})}),(0,l.jsx)(n.td,{children:"Immutable sorted string tables"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"MANIFEST-*"})}),(0,l.jsx)(n.td,{children:"Metadata describing SST files and levels"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"CURRENT"})}),(0,l.jsx)(n.td,{children:"Pointer to active manifest"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"LOCK"})}),(0,l.jsx)(n.td,{children:"File lock for single-process access"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"LOG"})}),(0,l.jsx)(n.td,{children:"Diagnostic logs"})]})]})]}),"\n",(0,l.jsxs)(n.p,{children:["LevelDB organizes SST files into ",(0,l.jsx)(n.strong,{children:"levels (L0\u2013L6)"})," internally.\nCompaction moves data from higher levels to lower levels to reduce read\namplification."]}),"\n",(0,l.jsxs)(n.p,{children:["Applications should treat this directory as ",(0,l.jsx)(n.strong,{children:"opaque"})," and never modify it\ndirectly."]}),"\n",(0,l.jsx)(n.hr,{}),"\n",(0,l.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,l.jsx)(n.p,{children:"LevelDB provides:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"A simple embedded KV interface"}),"\n",(0,l.jsx)(n.li,{children:"Predictable read performance"}),"\n",(0,l.jsx)(n.li,{children:"A compact, self-contained on-disk format"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["It is well suited for Kumo\u2019s ",(0,l.jsx)(n.strong,{children:"local control-plane"})," and metadata workloads."]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>i});var t=s(6540);const l={},r=t.createContext(l);function d(e){const n=t.useContext(r);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:d(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);