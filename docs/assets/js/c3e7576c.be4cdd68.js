"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[116],{719:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>m,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"foundamentals/monitor/index","title":"Monitoring","description":"This section describes monitoring and its implementation via tally. The following chapters will elaborate on the monitoring metrics, statistical implementation, metric collection, and other details of tally.","source":"@site/docs/foundamentals/monitor/index.mdx","sourceDirName":"foundamentals/monitor","slug":"/foundamentals/monitor/","permalink":"/cppdev/docs/foundamentals/monitor/","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/foundamentals/monitor/index.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"FAQ","permalink":"/cppdev/docs/foundamentals/fibers/faq"},"next":{"title":"Variables","permalink":"/cppdev/docs/foundamentals/monitor/var"}}');var r=n(4848),s=n(8453);const a={},o="Monitoring",l={},c=[{value:"What is <code>tally</code>",id:"what-is-tally",level:2},{value:"Metric Model",id:"metric-model",level:2},{value:"Counter",id:"counter",level:3},{value:"Gauge",id:"gauge",level:3},{value:"Histogram",id:"histogram",level:3},{value:"Metric Definition",id:"metric-definition",level:2},{value:"Metric Name",id:"metric-name",level:3},{value:"Label",id:"label",level:3},{value:"Metric Formatting",id:"metric-formatting",level:2},{value:"Implementation",id:"implementation",level:2},{value:"Integrating <code>tally</code>",id:"integrating-tally",level:2}];function d(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"monitoring",children:"Monitoring"})}),"\n",(0,r.jsxs)(t.p,{children:["This section describes monitoring and its implementation via ",(0,r.jsx)(t.code,{children:"tally"}),". The following chapters will elaborate on the monitoring metrics, statistical implementation, metric collection, and other details of ",(0,r.jsx)(t.code,{children:"tally"}),"."]}),"\n",(0,r.jsxs)(t.h2,{id:"what-is-tally",children:["What is ",(0,r.jsx)(t.code,{children:"tally"})]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.a,{href:"https://gitee.com/kumo-pub/tally/",children:"tally"})," is a monitoring metrics collection library designed for multi-threaded environments. It supports Prometheus metrics collection and aggregation, and integrates monitoring and counting capabilities for system metrics statistics."]}),"\n",(0,r.jsx)(t.h2,{id:"metric-model",children:"Metric Model"}),"\n",(0,r.jsx)(t.p,{children:"Metrics are used to measure the changing trends of performance, resource consumption, efficiency, and many other software attributes over time. They enable engineers to monitor the evolution of a series of measurements (such as CPU or memory usage, request duration, latency, etc.) through alerts and dashboards. Metrics have a long history in the IT monitoring field and are widely used by engineers, together with logs and distributed tracing, to detect unexpected system behaviors."}),"\n",(0,r.jsx)(t.p,{children:"In its most basic form, a metric data point consists of three components:"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"A metric name"}),"\n",(0,r.jsx)(t.li,{children:"A timestamp when the data point is collected"}),"\n",(0,r.jsx)(t.li,{children:"A numerical measurement value"}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"counter",children:"Counter"}),"\n",(0,r.jsx)(t.p,{children:"Counter-type metrics are used for monotonically increasing measurements. Therefore, their values are always cumulative and can only go up. The only exception is when a counter is reset (e.g., after a system restart), in which case its value is set back to zero."}),"\n",(0,r.jsx)(t.p,{children:"The absolute value of a counter is usually not very useful on its own. Counter values are often used to calculate the delta between two timestamps or the rate of change over time."}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Counter type with monotonically increasing values (non-decreasing)"}),"\n",(0,r.jsx)(t.li,{children:"Suitable for measuring uptime, request volume, etc."}),"\n",(0,r.jsx)(t.li,{children:"Resistant to system restarts (values are not reset to zero upon reboot in most implementations)"}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"gauge",children:"Gauge"}),"\n",(0,r.jsx)(t.p,{children:"Gauge metrics are used for measurements that can increase or decrease arbitrarily. This is a more familiar metric type for many engineers, as their raw values are meaningful without additional processing. Examples include metrics for temperature, CPU and memory usage, or queue size."}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Gauge type that reflects real-time changes of metrics"}),"\n",(0,r.jsx)(t.li,{children:"Supports both increase and decrease; applicable to CPU/memory usage"}),"\n",(0,r.jsx)(t.li,{children:"Most monitoring data types fall into the Gauge category"}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"histogram",children:"Histogram"}),"\n",(0,r.jsx)(t.p,{children:"Histogram metrics are useful for representing the distribution of measurements. They are often used to measure request duration, response size, and similar metrics."}),"\n",(0,r.jsx)(t.p,{children:"A histogram divides the entire range of measurements into a set of intervals called buckets, and counts how many measurements fall into each bucket."}),"\n",(0,r.jsx)(t.h2,{id:"metric-definition",children:"Metric Definition"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.code,{children:"<metric name>{<label name>=<label value>, ...}"})}),"\n",(0,r.jsx)(t.h3,{id:"metric-name",children:"Metric Name"}),"\n",(0,r.jsxs)(t.p,{children:["Describes the meaning of the metric.\nMetric names must consist of letters, numbers, underscores, or colons, complying with the regular expression ",(0,r.jsx)(t.code,{children:"[a-zA-Z:][a-zA-Z0-9:]"}),".\nColons are not allowed for use in exporters."]}),"\n",(0,r.jsx)(t.h3,{id:"label",children:"Label"}),"\n",(0,r.jsx)(t.p,{children:"Reflects the dimensional characteristics of metrics and is used for filtering and aggregation.\nLabels consist of key-value pairs to form multiple dimensions of metrics."}),"\n",(0,r.jsx)(t.h2,{id:"metric-formatting",children:"Metric Formatting"}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"tally"})," has built-in support for the Prometheus format and also allows custom output formats."]}),"\n",(0,r.jsx)(t.p,{children:"Below is an example of metrics exposed in the Prometheus exposition format:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-text",children:'# HELP http_requests_total Total number of http api requests\n# TYPE http_requests_total counter\nhttp_requests_total{api="add_product"} 4633433\n'})}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.code,{children:"# HELP"})," provides a description for the metric, and ",(0,r.jsx)(t.code,{children:"# TYPE"})," specifies the metric type. ",(0,r.jsx)(t.code,{children:"4633433"})," is the specific metric value, and ",(0,r.jsx)(t.code,{children:'api="add_product"'})," is a label key-value pair."]}),"\n",(0,r.jsx)(t.h2,{id:"implementation",children:"Implementation"}),"\n",(0,r.jsxs)(t.p,{children:["It leverages ",(0,r.jsx)(t.strong,{children:"thread-local storage"})," to reduce cache bouncing. Compared to ",(0,r.jsx)(t.code,{children:"std::mutex"}),", it adds almost no performance overhead to the program, and is also faster than frequently contended atomic operations."]}),"\n",(0,r.jsxs)(t.p,{children:["The ",(0,r.jsx)(t.code,{children:"tally"})," variable is designed for ",(0,r.jsx)(t.strong,{children:"scenarios with high write-to-read ratios"}),". It should not be used in scenarios where read operations are relatively frequent."]}),"\n",(0,r.jsxs)(t.h2,{id:"integrating-tally",children:["Integrating ",(0,r.jsx)(t.code,{children:"tally"})]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-shell",children:"kmpkg install tally\n"})}),"\n",(0,r.jsxs)(t.p,{children:["Alternatively, refer to the documentation of ",(0,r.jsx)(t.code,{children:"kmpkg"})," to integrate ",(0,r.jsx)(t.code,{children:"tally"})," in the ",(0,r.jsx)(t.code,{children:"kmpkg.json"})," file of your project."]})]})}function m(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>a,x:()=>o});var i=n(6540);const r={},s=i.createContext(r);function a(e){const t=i.useContext(s);return i.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function o(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);