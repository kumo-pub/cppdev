"use strict";(globalThis.webpackChunkwebsite=globalThis.webpackChunkwebsite||[]).push([[2152],{8453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>d});var s=i(6540);const r={},l=s.createContext(r);function t(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(l.Provider,{value:n},e.children)}},9099:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"store/kv/rocksdb/granite","title":"Granite Key/Value Encapsulation and Workflow","description":"Granite DB Initialization","source":"@site/docs/store/kv/rocksdb/granite.mdx","sourceDirName":"store/kv/rocksdb","slug":"/store/kv/rocksdb/granite","permalink":"/cppdev/docs/store/kv/rocksdb/granite","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"RocksDB Backup and Restore","permalink":"/cppdev/docs/store/kv/rocksdb/backup"},"next":{"title":"LevelDB","permalink":"/cppdev/docs/store/kv/leveldb"}}');var r=i(4848),l=i(8453);const t={},d="Granite Key/Value Encapsulation and Workflow",c={},a=[{value:"Granite DB Initialization",id:"granite-db-initialization",level:2},{value:"Granite Key Encapsulation",id:"granite-key-encapsulation",level:2},{value:"ElementValue",id:"elementvalue",level:3},{value:"KeyBuilder",id:"keybuilder",level:3},{value:"Multi-Prefix / Extensibility",id:"multi-prefix--extensibility",level:3},{value:"SST File Handling",id:"sst-file-handling",level:2},{value:"Backup / Checkpoint",id:"backup--checkpoint",level:2},{value:"1. Snapshot (SST-based)",id:"1-snapshot-sst-based",level:3},{value:"2. Checkpoint (directory-based)",id:"2-checkpoint-directory-based",level:3},{value:"Comparison with Native RocksDB",id:"comparison-with-native-rocksdb",level:2},{value:"Summary",id:"summary",level:2}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"granite-keyvalue-encapsulation-and-workflow",children:"Granite Key/Value Encapsulation and Workflow"})}),"\n",(0,r.jsx)(n.h2,{id:"granite-db-initialization",children:"Granite DB Initialization"}),"\n",(0,r.jsx)(n.p,{children:"Granite wraps RocksDB and manages database initialization and column families (CFs) in a unified manner."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configuration Inputs:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Database path"}),"\n",(0,r.jsx)(n.li,{children:"Column family definitions"}),"\n",(0,r.jsx)(n.li,{children:"Options to reset existing DB or create directories"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Initialization Flow:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Reset (optional):"})," Delete old data if requested."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Directory creation (optional):"})," Ensure parent directories exist."]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"DB existence check:"})}),"\n"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Exists:"})," Open the DB and fetch existing CF handles."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Does not exist:"})," Create a new DB and initialize all required CFs."]}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"CF handle management:"})," Automatically keeps track of CF handles and listeners for monitoring or callback hooks."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"granite-key-encapsulation",children:"Granite Key Encapsulation"}),"\n",(0,r.jsxs)(n.p,{children:["Granite introduces ",(0,r.jsx)(n.code,{children:"KeyBuilder"})," and ",(0,r.jsx)(n.code,{children:"ElementValue"})," to standardize key construction and decoding."]}),"\n",(0,r.jsx)(n.h3,{id:"elementvalue",children:"ElementValue"}),"\n",(0,r.jsx)(n.p,{children:"Supports multiple types:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Integer: ",(0,r.jsx)(n.code,{children:"int8"}),", ",(0,r.jsx)(n.code,{children:"int16"}),", ",(0,r.jsx)(n.code,{children:"int32"}),", ",(0,r.jsx)(n.code,{children:"int64"})]}),"\n",(0,r.jsx)(n.li,{children:"String: variable length"}),"\n",(0,r.jsx)(n.li,{children:"Fixed string: fixed-length"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"keybuilder",children:"KeyBuilder"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Supports ",(0,r.jsx)(n.strong,{children:"prefix and suffix"})," separation:"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Prefix:"})," For RocksDB prefix seek or slice transform"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Suffix:"})," Additional key elements, can be used for secondary indices or sorting"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Methods:"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"build_key(values)"})," \u2013 constructs the complete key"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"build_prefix_key(values)"})," \u2013 constructs prefix only"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"build_suffix_key(values)"})," \u2013 constructs suffix only"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"decode_key(key)"})," \u2013 parses complete key"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"decode_prefix_key(key)"})," \u2013 parses prefix"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"decode_prefix_key_with_filter(key)"})," \u2013 parses prefix and suffix with optional filtering"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"multi-prefix--extensibility",children:"Multi-Prefix / Extensibility"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"_schema.prefix()"})," supports multiple prefix fields"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"_schema.suffix()"})," allows extensible additional fields"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"_key_filter"})," can filter prefix + suffix for custom selection"]}),"\n",(0,r.jsxs)(n.li,{children:["Compatible with RocksDB ",(0,r.jsx)(n.strong,{children:"fixed prefix transform"})," or custom slice transforms"]}),"\n",(0,r.jsxs)(n.li,{children:["Automatically calculates fixed and variable prefix lengths (",(0,r.jsx)(n.code,{children:"_fixed_prefix"}),", ",(0,r.jsx)(n.code,{children:"_var_fixed_prefix"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"Supports big-endian / little-endian conversion to maintain RocksDB prefix sort order"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Advantages:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Encapsulates key serialization/deserialization logic"}),"\n",(0,r.jsx)(n.li,{children:"Works seamlessly in multi-column-family and multi-prefix scenarios"}),"\n",(0,r.jsx)(n.li,{children:"Ensures consistency and correctness for SST ingestion and snapshot/backup workflows"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"sst-file-handling",children:"SST File Handling"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Granite wraps RocksDB ",(0,r.jsx)(n.code,{children:"SstFileWriter"}),":"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["Each SST corresponds to ",(0,r.jsx)(n.strong,{children:"a single column family"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Multi-column-family scenarios produce multiple SST files"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Ingestion must respect SST generation order to maintain consistency"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Recovery and replication:"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Followers can catch up with master node snapshots"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"SST ingestion is sequential"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Further WAL replay can continue post-ingestion"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"KeyBuilder"})," ensures:"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Prefix-based ordering for RocksDB"}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:"Suffix fields maintain complete business logic for queries"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"backup--checkpoint",children:"Backup / Checkpoint"}),"\n",(0,r.jsx)(n.p,{children:"Granite supports two backup methods:"}),"\n",(0,r.jsx)(n.h3,{id:"1-snapshot-sst-based",children:"1. Snapshot (SST-based)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Generates SST per CF"}),"\n",(0,r.jsx)(n.li,{children:"Restoration ingests SSTs in the correct order"}),"\n",(0,r.jsx)(n.li,{children:"Supports incremental backup and replica catch-up"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"2-checkpoint-directory-based",children:"2. Checkpoint (directory-based)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Creates a RocksDB checkpoint directory"}),"\n",(0,r.jsx)(n.li,{children:"Restoration simply opens the checkpoint directory"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Granite Advantages:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Automatically manages CF handles"}),"\n",(0,r.jsx)(n.li,{children:"Tracks SST files and ingestion order"}),"\n",(0,r.jsx)(n.li,{children:"Provides unified APIs for ingest, flush, compact, and transaction operations"}),"\n",(0,r.jsx)(n.li,{children:"Fully compatible with multi-prefix and multi-CF schemas"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"comparison-with-native-rocksdb",children:"Comparison with Native RocksDB"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Feature"}),(0,r.jsx)(n.th,{children:"Native RocksDB"}),(0,r.jsx)(n.th,{children:"Granite"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"CF initialization"}),(0,r.jsx)(n.td,{children:"Manual"}),(0,r.jsx)(n.td,{children:"Automatic, including creation if missing"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Key construction"}),(0,r.jsx)(n.td,{children:"User-managed"}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"KeyBuilder"})," supports multi-type, multi-prefix, multi-suffix"]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Prefix Transform"}),(0,r.jsx)(n.td,{children:"Manual"}),(0,r.jsx)(n.td,{children:"Supports custom slice transform with optional filtering"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"SST writing"}),(0,r.jsx)(n.td,{children:"Manual"}),(0,r.jsx)(n.td,{children:"Encapsulated, with automatic multi-CF ordering"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Backup / Restore"}),(0,r.jsx)(n.td,{children:"Manual, CF order required"}),(0,r.jsx)(n.td,{children:"Automatic ingest/flush/compact/transaction APIs"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Multi-prefix / Multi-CF"}),(0,r.jsx)(n.td,{children:"Complex"}),(0,r.jsx)(n.td,{children:"Full support via prefix + suffix + filter"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Listener / Hooks"}),(0,r.jsx)(n.td,{children:"Manual"}),(0,r.jsx)(n.td,{children:"Built-in support"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Transaction / flush / compact"}),(0,r.jsx)(n.td,{children:"Direct DB API"}),(0,r.jsx)(n.td,{children:"Unified Granite APIs"})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsxs)(n.p,{children:["Granite provides a ",(0,r.jsx)(n.strong,{children:"unified wrapper"})," around RocksDB to manage:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"DB and CF initialization"}),"\n",(0,r.jsx)(n.li,{children:"Key construction and parsing with multi-type and multi-prefix support"}),"\n",(0,r.jsx)(n.li,{children:"SST generation and ingestion"}),"\n",(0,r.jsx)(n.li,{children:"Backup, checkpoint, and replica catch-up"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"KeyBuilder"})," + ",(0,r.jsx)(n.code,{children:"ElementValue"})," system ensures:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Multi-prefix scenarios are fully supported"}),"\n",(0,r.jsx)(n.li,{children:"Prefix-based RocksDB ordering is preserved"}),"\n",(0,r.jsx)(n.li,{children:"Column-family consistency is guaranteed during ingestion and recovery"}),"\n",(0,r.jsx)(n.li,{children:"Key filtering and extensibility are seamlessly integrated"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Granite abstracts away much of the repetitive low-level RocksDB logic while ensuring ",(0,r.jsx)(n.strong,{children:"high reliability, extensibility, and correctness"})," for production-scale workloads."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsxs)(n.p,{children:["I can also create a ",(0,r.jsx)(n.strong,{children:"full workflow diagram"})," showing:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"DB Init \u2192 KeyBuilder \u2192 SST \u2192 Backup/Checkpoint \u2192 Restore \u2192 Catch-up\n"})}),"\n",(0,r.jsxs)(n.p,{children:["with ",(0,r.jsx)(n.strong,{children:"prefix, suffix, multi-CF, and filter points"})," clearly marked, making it very visual for documentation or presentations."]}),"\n",(0,r.jsx)(n.p,{children:"Do you want me to generate that diagram next?"})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(o,{...e})}):o(e)}}}]);